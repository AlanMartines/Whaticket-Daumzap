const a12_0x3a2e82=a12_0x50ee;(function(_0x276b3e,_0xc7a534){const _0x49acc0=a12_0x50ee,_0x73d44f=_0x276b3e();while(!![]){try{const _0x160983=-parseInt(_0x49acc0(0xa1))/0x1+parseInt(_0x49acc0(0xb0))/0x2+-parseInt(_0x49acc0(0xcb))/0x3*(-parseInt(_0x49acc0(0xa7))/0x4)+parseInt(_0x49acc0(0xbe))/0x5+-parseInt(_0x49acc0(0xcc))/0x6+-parseInt(_0x49acc0(0xb7))/0x7+parseInt(_0x49acc0(0xb8))/0x8*(parseInt(_0x49acc0(0x9c))/0x9);if(_0x160983===_0xc7a534)break;else _0x73d44f['push'](_0x73d44f['shift']());}catch(_0x4255a3){_0x73d44f['push'](_0x73d44f['shift']());}}}(a12_0x4527,0x65ef8));const a12_0x3699f6=(function(){let _0x2f4ed6=!![];return function(_0x587ff3,_0x3bb762){const _0x3f3f23=_0x2f4ed6?function(){const _0x5934d6=a12_0x50ee;if(_0x3bb762){const _0x678760=_0x3bb762[_0x5934d6(0xc0)](_0x587ff3,arguments);return _0x3bb762=null,_0x678760;}}:function(){};return _0x2f4ed6=![],_0x3f3f23;};}()),a12_0x2ca5ff=a12_0x3699f6(this,function(){const _0x9ba76e=a12_0x50ee;return a12_0x2ca5ff[_0x9ba76e(0xaf)]()[_0x9ba76e(0xc1)](_0x9ba76e(0x9f))['toString']()[_0x9ba76e(0xc7)](a12_0x2ca5ff)['search']('(((.+)+)+)+$');});a12_0x2ca5ff();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x203a70){const _0x9d54ad=a12_0x50ee;return _0x203a70&&_0x203a70[_0x9d54ad(0xc3)]?_0x203a70:{'default':_0x203a70};};Object[a12_0x3a2e82(0xa0)](exports,'__esModule',{'value':!![]}),exports['messages']=exports[a12_0x3a2e82(0xc2)]=exports[a12_0x3a2e82(0xab)]=exports[a12_0x3a2e82(0xb4)]=exports[a12_0x3a2e82(0xa5)]=exports[a12_0x3a2e82(0xba)]=exports[a12_0x3a2e82(0xb5)]=exports['index']=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require(a12_0x3a2e82(0xc9))),ListService_1=__importDefault(require(a12_0x3a2e82(0xbb))),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a12_0x3a2e82(0x9e))),FindMessages_1=__importDefault(require(a12_0x3a2e82(0xb1))),UpdateService_1=__importDefault(require('../services/ChatService/UpdateService')),Chat_1=__importDefault(require(a12_0x3a2e82(0xb9))),CreateMessageService_1=__importDefault(require('../services/ChatService/CreateMessageService')),User_1=__importDefault(require(a12_0x3a2e82(0xbc))),ChatUser_1=__importDefault(require(a12_0x3a2e82(0xa2))),index=async(_0x422a74,_0x2098f1)=>{const _0x35566b=a12_0x3a2e82,{pageNumber:_0x3ccb9e}=_0x422a74[_0x35566b(0xb3)],_0x5a4217=+_0x422a74[_0x35566b(0x9d)]['id'],{records:_0x33fe84,count:_0x412790,hasMore:_0x3c17cb}=await(0x0,ListService_1[_0x35566b(0xa9)])({'ownerId':_0x5a4217,'pageNumber':_0x3ccb9e});return _0x2098f1[_0x35566b(0xac)]({'records':_0x33fe84,'count':_0x412790,'hasMore':_0x3c17cb});};exports['index']=index;function a12_0x4527(){const _0x491bb9=['json','-mainchannel','status','toString','780484KJzHtW','../services/ChatService/FindMessages','forEach','query','remove','store','delete','2034991JZrpJU','499664fDSjfL','../models/Chat','update','../services/ChatService/ListService','../models/User','-chat-user-','1028260HOsZNl','company-','apply','search','checkAsRead','__esModule','body','findByPk','-chat','constructor','emit','../services/ChatService/CreateService','messages','411UanuyO','1845204VaUxnW','Chat\x20deleted','params','users','81BsqCmA','user','../services/ChatService/DeleteService','(((.+)+)+)+$','defineProperty','161421vXnnRs','../models/ChatUser','-chat-','getIO','show','new-message','560yDnnXF','userId','default','findOne','saveMessage'];a12_0x4527=function(){return _0x491bb9;};return a12_0x4527();}const store=async(_0x56756b,_0x5c0b0c)=>{const _0x588a29=a12_0x3a2e82,{companyId:_0x4e874c}=_0x56756b[_0x588a29(0x9d)],_0x2f81c7=+_0x56756b[_0x588a29(0x9d)]['id'],_0x4ccc10=_0x56756b[_0x588a29(0xc4)],_0x4470e7=await(0x0,CreateService_1['default'])({..._0x4ccc10,'ownerId':_0x2f81c7,'companyId':_0x4e874c}),_0x9b7c3c=(0x0,socket_1['getIO'])();return _0x4470e7['users'][_0x588a29(0xb2)](_0x5090fc=>{const _0x3b8214=_0x588a29;_0x9b7c3c['to'](_0x3b8214(0xbf)+_0x4e874c+_0x3b8214(0xad))[_0x3b8214(0xc8)](_0x3b8214(0xbf)+_0x4e874c+'-chat-user-'+_0x5090fc[_0x3b8214(0xa8)],{'action':'create','record':_0x4470e7});}),_0x5c0b0c[_0x588a29(0xae)](0xc8)[_0x588a29(0xac)](_0x4470e7);};function a12_0x50ee(_0x26443e,_0x2ec0b2){const _0x44e27d=a12_0x4527();return a12_0x50ee=function(_0x2ca5ff,_0x3699f6){_0x2ca5ff=_0x2ca5ff-0x9a;let _0x45277f=_0x44e27d[_0x2ca5ff];return _0x45277f;},a12_0x50ee(_0x26443e,_0x2ec0b2);}exports[a12_0x3a2e82(0xb5)]=store;const update=async(_0x5f4375,_0x27e4a2)=>{const _0x3082dc=a12_0x3a2e82,{companyId:_0x4bb60a}=_0x5f4375['user'],_0x41d961=_0x5f4375['body'],{id:_0x35b1c1}=_0x5f4375[_0x3082dc(0x9a)],_0x50f883=await(0x0,UpdateService_1['default'])({..._0x41d961,'id':+_0x35b1c1}),_0x31da03=(0x0,socket_1[_0x3082dc(0xa4)])();return _0x50f883[_0x3082dc(0x9b)][_0x3082dc(0xb2)](_0x223551=>{const _0x3a05b3=_0x3082dc;_0x31da03['to'](_0x3a05b3(0xbf)+_0x4bb60a+_0x3a05b3(0xad))[_0x3a05b3(0xc8)](_0x3a05b3(0xbf)+_0x4bb60a+_0x3a05b3(0xbd)+_0x223551[_0x3a05b3(0xa8)],{'action':'update','record':_0x50f883});}),_0x27e4a2[_0x3082dc(0xae)](0xc8)['json'](_0x50f883);};exports[a12_0x3a2e82(0xba)]=update;const show=async(_0x582860,_0x199d9c)=>{const _0x5ad2e9=a12_0x3a2e82,{id:_0x585dbe}=_0x582860[_0x5ad2e9(0x9a)],_0x441549=await(0x0,ShowFromUuidService_1[_0x5ad2e9(0xa9)])(_0x585dbe);return _0x199d9c[_0x5ad2e9(0xae)](0xc8)[_0x5ad2e9(0xac)](_0x441549);};exports[a12_0x3a2e82(0xa5)]=show;const remove=async(_0x53e6c6,_0x561f3a)=>{const _0x863859=a12_0x3a2e82,{id:_0x31a4d2}=_0x53e6c6[_0x863859(0x9a)],{companyId:_0x543b64}=_0x53e6c6[_0x863859(0x9d)];await(0x0,DeleteService_1[_0x863859(0xa9)])(_0x31a4d2);const _0x2666a3=(0x0,socket_1[_0x863859(0xa4)])();return _0x2666a3['to']('company-'+_0x543b64+'-mainchannel')[_0x863859(0xc8)](_0x863859(0xbf)+_0x543b64+_0x863859(0xc6),{'action':_0x863859(0xb6),'id':_0x31a4d2}),_0x561f3a['status'](0xc8)[_0x863859(0xac)]({'message':_0x863859(0xcd)});};exports[a12_0x3a2e82(0xb4)]=remove;const saveMessage=async(_0x1fa2e2,_0x1aa6f6)=>{const _0x2e6e13=a12_0x3a2e82,{companyId:_0x50d17a}=_0x1fa2e2['user'],{message:_0x32fbb2}=_0x1fa2e2['body'],{id:_0x3d0ee6}=_0x1fa2e2[_0x2e6e13(0x9a)],_0x55bd9f=+_0x1fa2e2[_0x2e6e13(0x9d)]['id'],_0x168d90=+_0x3d0ee6,_0x42e8fd=await(0x0,CreateMessageService_1['default'])({'chatId':_0x168d90,'senderId':_0x55bd9f,'message':_0x32fbb2}),_0x24fa68=await Chat_1[_0x2e6e13(0xa9)]['findByPk'](_0x168d90,{'include':[{'model':User_1[_0x2e6e13(0xa9)],'as':'owner'},{'model':ChatUser_1[_0x2e6e13(0xa9)],'as':_0x2e6e13(0x9b)}]}),_0x32a491=(0x0,socket_1[_0x2e6e13(0xa4)])();return _0x32a491['to']('company-'+_0x50d17a+_0x2e6e13(0xad))[_0x2e6e13(0xc8)](_0x2e6e13(0xbf)+_0x50d17a+_0x2e6e13(0xa3)+_0x168d90,{'action':_0x2e6e13(0xa6),'newMessage':_0x42e8fd,'chat':_0x24fa68}),_0x32a491['to'](_0x2e6e13(0xbf)+_0x50d17a+_0x2e6e13(0xad))[_0x2e6e13(0xc8)]('company-'+_0x50d17a+_0x2e6e13(0xc6),{'action':_0x2e6e13(0xa6),'newMessage':_0x42e8fd,'chat':_0x24fa68}),_0x1aa6f6['json'](_0x42e8fd);};exports[a12_0x3a2e82(0xab)]=saveMessage;const checkAsRead=async(_0x26b66a,_0x3326b9)=>{const _0x2f0abc=a12_0x3a2e82,{companyId:_0x55de90}=_0x26b66a[_0x2f0abc(0x9d)],{userId:_0x2c9926}=_0x26b66a['body'],{id:_0x329ba9}=_0x26b66a[_0x2f0abc(0x9a)],_0xdfabdd=await ChatUser_1['default'][_0x2f0abc(0xaa)]({'where':{'chatId':_0x329ba9,'userId':_0x2c9926}});await _0xdfabdd['update']({'unreads':0x0});const _0x25f7bb=await Chat_1[_0x2f0abc(0xa9)][_0x2f0abc(0xc5)](_0x329ba9,{'include':[{'model':User_1['default'],'as':'owner'},{'model':ChatUser_1[_0x2f0abc(0xa9)],'as':_0x2f0abc(0x9b)}]}),_0x356cc4=(0x0,socket_1[_0x2f0abc(0xa4)])();return _0x356cc4['to'](_0x2f0abc(0xbf)+_0x55de90+_0x2f0abc(0xad))[_0x2f0abc(0xc8)](_0x2f0abc(0xbf)+_0x55de90+_0x2f0abc(0xa3)+_0x329ba9,{'action':_0x2f0abc(0xba),'chat':_0x25f7bb}),_0x356cc4['to']('company-'+_0x55de90+_0x2f0abc(0xad))[_0x2f0abc(0xc8)](_0x2f0abc(0xbf)+_0x55de90+_0x2f0abc(0xc6),{'action':_0x2f0abc(0xba),'chat':_0x25f7bb}),_0x3326b9['json'](_0x25f7bb);};exports[a12_0x3a2e82(0xc2)]=checkAsRead;const messages=async(_0x382142,_0x4e72a9)=>{const _0x31030a=a12_0x3a2e82,{pageNumber:_0x551023}=_0x382142[_0x31030a(0xb3)],{id:_0x11991c}=_0x382142['params'],_0x5683e3=+_0x382142[_0x31030a(0x9d)]['id'],{records:_0x1a8782,count:_0x274780,hasMore:_0xb99ca7}=await(0x0,FindMessages_1[_0x31030a(0xa9)])({'chatId':_0x11991c,'ownerId':_0x5683e3,'pageNumber':_0x551023});return _0x4e72a9[_0x31030a(0xac)]({'records':_0x1a8782,'count':_0x274780,'hasMore':_0xb99ca7});};exports[a12_0x3a2e82(0xca)]=messages;