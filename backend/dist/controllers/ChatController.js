const a12_0x101f18=a12_0x1893;(function(_0x497a00,_0x227186){const _0x23db71=a12_0x1893,_0x28bd43=_0x497a00();while(!![]){try{const _0x36894f=-parseInt(_0x23db71(0xea))/0x1*(parseInt(_0x23db71(0xf7))/0x2)+-parseInt(_0x23db71(0x10d))/0x3*(parseInt(_0x23db71(0x110))/0x4)+-parseInt(_0x23db71(0x10a))/0x5+parseInt(_0x23db71(0x106))/0x6+-parseInt(_0x23db71(0xef))/0x7*(parseInt(_0x23db71(0xff))/0x8)+parseInt(_0x23db71(0x10c))/0x9*(-parseInt(_0x23db71(0xe1))/0xa)+-parseInt(_0x23db71(0xf3))/0xb*(-parseInt(_0x23db71(0xdd))/0xc);if(_0x36894f===_0x227186)break;else _0x28bd43['push'](_0x28bd43['shift']());}catch(_0x13350d){_0x28bd43['push'](_0x28bd43['shift']());}}}(a12_0x3260,0x4cdff));const a12_0x2f5dd6=(function(){let _0x5c9d16=!![];return function(_0x4dae4c,_0x18bcf0){const _0x572fb4=_0x5c9d16?function(){const _0x447bdb=a12_0x1893;if(_0x18bcf0){const _0x4c6ac8=_0x18bcf0[_0x447bdb(0x112)](_0x4dae4c,arguments);return _0x18bcf0=null,_0x4c6ac8;}}:function(){};return _0x5c9d16=![],_0x572fb4;};}()),a12_0x5b4aa=a12_0x2f5dd6(this,function(){const _0x38b70a=a12_0x1893;return a12_0x5b4aa[_0x38b70a(0xe9)]()[_0x38b70a(0xfc)](_0x38b70a(0xed))['toString']()[_0x38b70a(0xe0)](a12_0x5b4aa)[_0x38b70a(0xfc)](_0x38b70a(0xed));});a12_0x5b4aa();function a12_0x3260(){const _0x29541b=['forEach','-mainchannel','update','1248954zHpkbJ','messages','index','default','1344710EkmgcQ','checkAsRead','9zSRjiq','15UwxuTT','new-message','store','82108Jhhonn','defineProperty','apply','users','query','-chat-','59676WTbQjl','body','company-','constructor','4598980zYWYvL','saveMessage','json','status','-chat','create','userId','delete','toString','298311cGMgyx','../services/ChatService/CreateMessageService','-chat-user-','(((.+)+)+)+$','findByPk','7klmSji','__esModule','__importDefault','emit','2871ZKgHFz','user','../services/ChatService/DeleteService','owner','2IOSYXE','../services/ChatService/CreateService','getIO','../models/Chat','params','search','remove','Chat\x20deleted','491576RAYaej','../services/ChatService/FindMessages','../services/ChatService/UpdateService','show'];a12_0x3260=function(){return _0x29541b;};return a12_0x3260();}'use strict';function a12_0x1893(_0x424fde,_0x18f972){const _0xcb0f56=a12_0x3260();return a12_0x1893=function(_0x5b4aa,_0x2f5dd6){_0x5b4aa=_0x5b4aa-0xdc;let _0x3260e6=_0xcb0f56[_0x5b4aa];return _0x3260e6;},a12_0x1893(_0x424fde,_0x18f972);}var __importDefault=this&&this[a12_0x101f18(0xf1)]||function(_0x65f486){const _0x3e9f52=a12_0x101f18;return _0x65f486&&_0x65f486[_0x3e9f52(0xf0)]?_0x65f486:{'default':_0x65f486};};Object[a12_0x101f18(0x111)](exports,a12_0x101f18(0xf0),{'value':!![]}),exports[a12_0x101f18(0x107)]=exports['checkAsRead']=exports[a12_0x101f18(0xe2)]=exports['remove']=exports[a12_0x101f18(0x102)]=exports[a12_0x101f18(0x105)]=exports[a12_0x101f18(0x10f)]=exports[a12_0x101f18(0x108)]=void 0x0;const socket_1=require('../libs/socket'),CreateService_1=__importDefault(require(a12_0x101f18(0xf8))),ListService_1=__importDefault(require('../services/ChatService/ListService')),ShowFromUuidService_1=__importDefault(require('../services/ChatService/ShowFromUuidService')),DeleteService_1=__importDefault(require(a12_0x101f18(0xf5))),FindMessages_1=__importDefault(require(a12_0x101f18(0x100))),UpdateService_1=__importDefault(require(a12_0x101f18(0x101))),Chat_1=__importDefault(require(a12_0x101f18(0xfa))),CreateMessageService_1=__importDefault(require(a12_0x101f18(0xeb))),User_1=__importDefault(require('../models/User')),ChatUser_1=__importDefault(require('../models/ChatUser')),index=async(_0x193f51,_0x237011)=>{const _0xa82446=a12_0x101f18,{pageNumber:_0x480477}=_0x193f51[_0xa82446(0x114)],_0x4b9804=+_0x193f51['user']['id'],{records:_0x2dd8e7,count:_0x2590ca,hasMore:_0x4a7da2}=await(0x0,ListService_1[_0xa82446(0x109)])({'ownerId':_0x4b9804,'pageNumber':_0x480477});return _0x237011[_0xa82446(0xe3)]({'records':_0x2dd8e7,'count':_0x2590ca,'hasMore':_0x4a7da2});};exports[a12_0x101f18(0x108)]=index;const store=async(_0x56c475,_0x11e976)=>{const _0x4c7245=a12_0x101f18,{companyId:_0x2538bc}=_0x56c475[_0x4c7245(0xf4)],_0x21c48d=+_0x56c475[_0x4c7245(0xf4)]['id'],_0xbad4de=_0x56c475['body'],_0x5f01fd=await(0x0,CreateService_1[_0x4c7245(0x109)])({..._0xbad4de,'ownerId':_0x21c48d,'companyId':_0x2538bc}),_0x3860ca=(0x0,socket_1[_0x4c7245(0xf9)])();return _0x5f01fd[_0x4c7245(0x113)][_0x4c7245(0x103)](_0x46122c=>{const _0x7d3655=_0x4c7245;_0x3860ca['to'](_0x7d3655(0xdf)+_0x2538bc+_0x7d3655(0x104))[_0x7d3655(0xf2)](_0x7d3655(0xdf)+_0x2538bc+'-chat-user-'+_0x46122c[_0x7d3655(0xe7)],{'action':_0x7d3655(0xe6),'record':_0x5f01fd});}),_0x11e976[_0x4c7245(0xe4)](0xc8)[_0x4c7245(0xe3)](_0x5f01fd);};exports[a12_0x101f18(0x10f)]=store;const update=async(_0x1853d5,_0x2b6908)=>{const _0x853e77=a12_0x101f18,{companyId:_0x5b19b6}=_0x1853d5[_0x853e77(0xf4)],_0x212c86=_0x1853d5[_0x853e77(0xde)],{id:_0x2fd5f0}=_0x1853d5['params'],_0x1d9fa5=await(0x0,UpdateService_1[_0x853e77(0x109)])({..._0x212c86,'id':+_0x2fd5f0}),_0x25b6c1=(0x0,socket_1[_0x853e77(0xf9)])();return _0x1d9fa5[_0x853e77(0x113)]['forEach'](_0x4ec387=>{const _0x5ded14=_0x853e77;_0x25b6c1['to']('company-'+_0x5b19b6+_0x5ded14(0x104))['emit'](_0x5ded14(0xdf)+_0x5b19b6+_0x5ded14(0xec)+_0x4ec387['userId'],{'action':_0x5ded14(0x105),'record':_0x1d9fa5});}),_0x2b6908['status'](0xc8)[_0x853e77(0xe3)](_0x1d9fa5);};exports[a12_0x101f18(0x105)]=update;const show=async(_0x5bbfbf,_0x2ab09b)=>{const _0x310e0b=a12_0x101f18,{id:_0x4e35a5}=_0x5bbfbf[_0x310e0b(0xfb)],_0x5702af=await(0x0,ShowFromUuidService_1['default'])(_0x4e35a5);return _0x2ab09b[_0x310e0b(0xe4)](0xc8)[_0x310e0b(0xe3)](_0x5702af);};exports[a12_0x101f18(0x102)]=show;const remove=async(_0xd20a6b,_0x141c2e)=>{const _0x304670=a12_0x101f18,{id:_0x5d5ba9}=_0xd20a6b[_0x304670(0xfb)],{companyId:_0x1d70a7}=_0xd20a6b[_0x304670(0xf4)];await(0x0,DeleteService_1[_0x304670(0x109)])(_0x5d5ba9);const _0x135276=(0x0,socket_1[_0x304670(0xf9)])();return _0x135276['to']('company-'+_0x1d70a7+_0x304670(0x104))[_0x304670(0xf2)](_0x304670(0xdf)+_0x1d70a7+_0x304670(0xe5),{'action':_0x304670(0xe8),'id':_0x5d5ba9}),_0x141c2e['status'](0xc8)['json']({'message':_0x304670(0xfe)});};exports[a12_0x101f18(0xfd)]=remove;const saveMessage=async(_0x2e2ad5,_0x4e134d)=>{const _0x2ea00c=a12_0x101f18,{companyId:_0x29b615}=_0x2e2ad5[_0x2ea00c(0xf4)],{message:_0x15cec1}=_0x2e2ad5[_0x2ea00c(0xde)],{id:_0x238465}=_0x2e2ad5[_0x2ea00c(0xfb)],_0x5be74a=+_0x2e2ad5[_0x2ea00c(0xf4)]['id'],_0x5950b5=+_0x238465,_0xacac50=await(0x0,CreateMessageService_1[_0x2ea00c(0x109)])({'chatId':_0x5950b5,'senderId':_0x5be74a,'message':_0x15cec1}),_0x510001=await Chat_1[_0x2ea00c(0x109)][_0x2ea00c(0xee)](_0x5950b5,{'include':[{'model':User_1[_0x2ea00c(0x109)],'as':_0x2ea00c(0xf6)},{'model':ChatUser_1[_0x2ea00c(0x109)],'as':'users'}]}),_0x1dc857=(0x0,socket_1['getIO'])();return _0x1dc857['to'](_0x2ea00c(0xdf)+_0x29b615+_0x2ea00c(0x104))[_0x2ea00c(0xf2)](_0x2ea00c(0xdf)+_0x29b615+_0x2ea00c(0xdc)+_0x5950b5,{'action':'new-message','newMessage':_0xacac50,'chat':_0x510001}),_0x1dc857['to']('company-'+_0x29b615+_0x2ea00c(0x104))['emit'](_0x2ea00c(0xdf)+_0x29b615+_0x2ea00c(0xe5),{'action':_0x2ea00c(0x10e),'newMessage':_0xacac50,'chat':_0x510001}),_0x4e134d[_0x2ea00c(0xe3)](_0xacac50);};exports[a12_0x101f18(0xe2)]=saveMessage;const checkAsRead=async(_0x513e8f,_0x3b33ab)=>{const _0x30cbfb=a12_0x101f18,{companyId:_0xd2efe3}=_0x513e8f[_0x30cbfb(0xf4)],{userId:_0x3351ab}=_0x513e8f[_0x30cbfb(0xde)],{id:_0x5bea2f}=_0x513e8f[_0x30cbfb(0xfb)],_0x482879=await ChatUser_1['default']['findOne']({'where':{'chatId':_0x5bea2f,'userId':_0x3351ab}});await _0x482879['update']({'unreads':0x0});const _0x4422b2=await Chat_1[_0x30cbfb(0x109)][_0x30cbfb(0xee)](_0x5bea2f,{'include':[{'model':User_1[_0x30cbfb(0x109)],'as':'owner'},{'model':ChatUser_1[_0x30cbfb(0x109)],'as':_0x30cbfb(0x113)}]}),_0x40d4be=(0x0,socket_1['getIO'])();return _0x40d4be['to'](_0x30cbfb(0xdf)+_0xd2efe3+_0x30cbfb(0x104))[_0x30cbfb(0xf2)](_0x30cbfb(0xdf)+_0xd2efe3+_0x30cbfb(0xdc)+_0x5bea2f,{'action':_0x30cbfb(0x105),'chat':_0x4422b2}),_0x40d4be['to'](_0x30cbfb(0xdf)+_0xd2efe3+_0x30cbfb(0x104))[_0x30cbfb(0xf2)](_0x30cbfb(0xdf)+_0xd2efe3+_0x30cbfb(0xe5),{'action':_0x30cbfb(0x105),'chat':_0x4422b2}),_0x3b33ab[_0x30cbfb(0xe3)](_0x4422b2);};exports[a12_0x101f18(0x10b)]=checkAsRead;const messages=async(_0x46e044,_0x36fbed)=>{const _0x4d74bc=a12_0x101f18,{pageNumber:_0x434dd8}=_0x46e044['query'],{id:_0x54a582}=_0x46e044[_0x4d74bc(0xfb)],_0x52a8bd=+_0x46e044[_0x4d74bc(0xf4)]['id'],{records:_0x5b0892,count:_0xa21274,hasMore:_0x1437fe}=await(0x0,FindMessages_1[_0x4d74bc(0x109)])({'chatId':_0x54a582,'ownerId':_0x52a8bd,'pageNumber':_0x434dd8});return _0x36fbed[_0x4d74bc(0xe3)]({'records':_0x5b0892,'count':_0xa21274,'hasMore':_0x1437fe});};exports[a12_0x101f18(0x107)]=messages;