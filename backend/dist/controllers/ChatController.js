const a12_0x51ec7d=a12_0x44db;(function(_0xb8265a,_0x192d81){const _0x26c175=a12_0x44db,_0x2ac595=_0xb8265a();while(!![]){try{const _0x401022=-parseInt(_0x26c175(0xe2))/0x1*(parseInt(_0x26c175(0xd3))/0x2)+parseInt(_0x26c175(0xf6))/0x3*(-parseInt(_0x26c175(0xff))/0x4)+-parseInt(_0x26c175(0xdb))/0x5+parseInt(_0x26c175(0xd1))/0x6*(parseInt(_0x26c175(0xf1))/0x7)+-parseInt(_0x26c175(0xfb))/0x8+-parseInt(_0x26c175(0xd8))/0x9*(-parseInt(_0x26c175(0xf4))/0xa)+parseInt(_0x26c175(0xf3))/0xb;if(_0x401022===_0x192d81)break;else _0x2ac595['push'](_0x2ac595['shift']());}catch(_0x475e2c){_0x2ac595['push'](_0x2ac595['shift']());}}}(a12_0x4ecb,0xe311a));const a12_0x4e065a=(function(){let _0x339e31=!![];return function(_0x301e47,_0x2ff256){const _0x35f24a=_0x339e31?function(){if(_0x2ff256){const _0x36fbcd=_0x2ff256['apply'](_0x301e47,arguments);return _0x2ff256=null,_0x36fbcd;}}:function(){};return _0x339e31=![],_0x35f24a;};}()),a12_0x1bf8d4=a12_0x4e065a(this,function(){const _0x1b0f60=a12_0x44db;return a12_0x1bf8d4[_0x1b0f60(0xe5)]()[_0x1b0f60(0xf8)]('(((.+)+)+)+$')[_0x1b0f60(0xe5)]()['constructor'](a12_0x1bf8d4)[_0x1b0f60(0xf8)](_0x1b0f60(0xd5));});a12_0x1bf8d4();'use strict';var __importDefault=this&&this[a12_0x51ec7d(0xdf)]||function(_0x144a1b){const _0x4f2b78=a12_0x51ec7d;return _0x144a1b&&_0x144a1b[_0x4f2b78(0xec)]?_0x144a1b:{'default':_0x144a1b};};Object[a12_0x51ec7d(0xed)](exports,a12_0x51ec7d(0xec),{'value':!![]}),exports[a12_0x51ec7d(0xe9)]=exports[a12_0x51ec7d(0xfd)]=exports['saveMessage']=exports[a12_0x51ec7d(0xdd)]=exports[a12_0x51ec7d(0xfe)]=exports[a12_0x51ec7d(0xf2)]=exports['store']=exports[a12_0x51ec7d(0xd4)]=void 0x0;const socket_1=require(a12_0x51ec7d(0xe8)),CreateService_1=__importDefault(require(a12_0x51ec7d(0x100))),ListService_1=__importDefault(require(a12_0x51ec7d(0xf7))),ShowFromUuidService_1=__importDefault(require(a12_0x51ec7d(0xee))),DeleteService_1=__importDefault(require(a12_0x51ec7d(0xce))),FindMessages_1=__importDefault(require(a12_0x51ec7d(0xef))),UpdateService_1=__importDefault(require(a12_0x51ec7d(0xca))),Chat_1=__importDefault(require('../models/Chat')),CreateMessageService_1=__importDefault(require(a12_0x51ec7d(0xe4))),User_1=__importDefault(require(a12_0x51ec7d(0xf9))),ChatUser_1=__importDefault(require(a12_0x51ec7d(0xd6))),index=async(_0x1f4825,_0x40170b)=>{const _0x515f0f=a12_0x51ec7d,{pageNumber:_0x135077}=_0x1f4825['query'],_0x2e366c=+_0x1f4825[_0x515f0f(0xf5)]['id'],{records:_0x5ec2a4,count:_0x3c1b19,hasMore:_0xd809e8}=await(0x0,ListService_1[_0x515f0f(0xea)])({'ownerId':_0x2e366c,'pageNumber':_0x135077});return _0x40170b[_0x515f0f(0xcf)]({'records':_0x5ec2a4,'count':_0x3c1b19,'hasMore':_0xd809e8});};exports[a12_0x51ec7d(0xd4)]=index;const store=async(_0x571fec,_0x49dc07)=>{const _0x412aec=a12_0x51ec7d,{companyId:_0x60b8d1}=_0x571fec[_0x412aec(0xf5)],_0x4a6318=+_0x571fec['user']['id'],_0x4c6d8b=_0x571fec[_0x412aec(0xe0)],_0x3acf73=await(0x0,CreateService_1['default'])({..._0x4c6d8b,'ownerId':_0x4a6318,'companyId':_0x60b8d1}),_0x370df2=(0x0,socket_1[_0x412aec(0xde)])();return _0x3acf73[_0x412aec(0xcb)][_0x412aec(0xd0)](_0x1002c0=>{const _0x463307=_0x412aec;_0x370df2['to']('company-'+_0x60b8d1+_0x463307(0xd7))[_0x463307(0xd9)](_0x463307(0xcc)+_0x60b8d1+_0x463307(0xda)+_0x1002c0['userId'],{'action':_0x463307(0xe3),'record':_0x3acf73});}),_0x49dc07['status'](0xc8)['json'](_0x3acf73);};function a12_0x44db(_0x33a456,_0x2f8905){const _0x3d2da7=a12_0x4ecb();return a12_0x44db=function(_0x1bf8d4,_0x4e065a){_0x1bf8d4=_0x1bf8d4-0xc9;let _0x4ecb3b=_0x3d2da7[_0x1bf8d4];return _0x4ecb3b;},a12_0x44db(_0x33a456,_0x2f8905);}exports[a12_0x51ec7d(0xd2)]=store;const update=async(_0xbe3b28,_0x3cbb48)=>{const _0x3934c3=a12_0x51ec7d,{companyId:_0x2da64f}=_0xbe3b28[_0x3934c3(0xf5)],_0x34ddf4=_0xbe3b28[_0x3934c3(0xe0)],{id:_0x1b702d}=_0xbe3b28['params'],_0x550688=await(0x0,UpdateService_1[_0x3934c3(0xea)])({..._0x34ddf4,'id':+_0x1b702d}),_0x172593=(0x0,socket_1[_0x3934c3(0xde)])();return _0x550688['users'][_0x3934c3(0xd0)](_0x36dcc1=>{const _0x1d38cf=_0x3934c3;_0x172593['to'](_0x1d38cf(0xcc)+_0x2da64f+_0x1d38cf(0xd7))[_0x1d38cf(0xd9)](_0x1d38cf(0xcc)+_0x2da64f+_0x1d38cf(0xda)+_0x36dcc1['userId'],{'action':_0x1d38cf(0xf2),'record':_0x550688});}),_0x3cbb48[_0x3934c3(0xe7)](0xc8)['json'](_0x550688);};exports[a12_0x51ec7d(0xf2)]=update;const show=async(_0x2aa5fb,_0x23ed06)=>{const _0x302ef5=a12_0x51ec7d,{id:_0x205de3}=_0x2aa5fb['params'],_0x1baf46=await(0x0,ShowFromUuidService_1[_0x302ef5(0xea)])(_0x205de3);return _0x23ed06['status'](0xc8)[_0x302ef5(0xcf)](_0x1baf46);};exports['show']=show;function a12_0x4ecb(){const _0xf0c45d=['forEach','18cGFgVY','store','33884eIMQpi','index','(((.+)+)+)+$','../models/ChatUser','-mainchannel','234xQujDH','emit','-chat-user-','7673845YsKnIA','findByPk','remove','getIO','__importDefault','body','new-message','27haViaM','create','../services/ChatService/CreateMessageService','toString','delete','status','../libs/socket','messages','default','query','__esModule','defineProperty','../services/ChatService/ShowFromUuidService','../services/ChatService/FindMessages','-chat','24647unfOrt','update','26408503puGipu','421550HkxiXt','user','2193KoWxoC','../services/ChatService/ListService','search','../models/User','params','2920464VBbnnP','Chat\x20deleted','checkAsRead','show','1204nVCvGb','../services/ChatService/CreateService','saveMessage','../services/ChatService/UpdateService','users','company-','-chat-','../services/ChatService/DeleteService','json'];a12_0x4ecb=function(){return _0xf0c45d;};return a12_0x4ecb();}const remove=async(_0x3ec699,_0x3b29e3)=>{const _0x40a112=a12_0x51ec7d,{id:_0x269ded}=_0x3ec699[_0x40a112(0xfa)],{companyId:_0x275af9}=_0x3ec699['user'];await(0x0,DeleteService_1['default'])(_0x269ded);const _0x4446dd=(0x0,socket_1['getIO'])();return _0x4446dd['to']('company-'+_0x275af9+'-mainchannel')[_0x40a112(0xd9)](_0x40a112(0xcc)+_0x275af9+_0x40a112(0xf0),{'action':_0x40a112(0xe6),'id':_0x269ded}),_0x3b29e3[_0x40a112(0xe7)](0xc8)[_0x40a112(0xcf)]({'message':_0x40a112(0xfc)});};exports['remove']=remove;const saveMessage=async(_0x32a98d,_0x31da50)=>{const _0x864c51=a12_0x51ec7d,{companyId:_0x309007}=_0x32a98d['user'],{message:_0x25fe22}=_0x32a98d[_0x864c51(0xe0)],{id:_0x23ba8e}=_0x32a98d[_0x864c51(0xfa)],_0x5d131b=+_0x32a98d[_0x864c51(0xf5)]['id'],_0x1bfd5d=+_0x23ba8e,_0x40f912=await(0x0,CreateMessageService_1[_0x864c51(0xea)])({'chatId':_0x1bfd5d,'senderId':_0x5d131b,'message':_0x25fe22}),_0x2e1409=await Chat_1[_0x864c51(0xea)]['findByPk'](_0x1bfd5d,{'include':[{'model':User_1[_0x864c51(0xea)],'as':'owner'},{'model':ChatUser_1[_0x864c51(0xea)],'as':_0x864c51(0xcb)}]}),_0x49b967=(0x0,socket_1[_0x864c51(0xde)])();return _0x49b967['to'](_0x864c51(0xcc)+_0x309007+_0x864c51(0xd7))[_0x864c51(0xd9)](_0x864c51(0xcc)+_0x309007+_0x864c51(0xcd)+_0x1bfd5d,{'action':_0x864c51(0xe1),'newMessage':_0x40f912,'chat':_0x2e1409}),_0x49b967['to'](_0x864c51(0xcc)+_0x309007+_0x864c51(0xd7))[_0x864c51(0xd9)](_0x864c51(0xcc)+_0x309007+_0x864c51(0xf0),{'action':_0x864c51(0xe1),'newMessage':_0x40f912,'chat':_0x2e1409}),_0x31da50['json'](_0x40f912);};exports[a12_0x51ec7d(0xc9)]=saveMessage;const checkAsRead=async(_0x3a7cbc,_0x38db0d)=>{const _0x280f43=a12_0x51ec7d,{companyId:_0x311d44}=_0x3a7cbc[_0x280f43(0xf5)],{userId:_0x3bce6f}=_0x3a7cbc[_0x280f43(0xe0)],{id:_0x2bc6c1}=_0x3a7cbc[_0x280f43(0xfa)],_0x196c4c=await ChatUser_1[_0x280f43(0xea)]['findOne']({'where':{'chatId':_0x2bc6c1,'userId':_0x3bce6f}});await _0x196c4c['update']({'unreads':0x0});const _0x3e2466=await Chat_1[_0x280f43(0xea)][_0x280f43(0xdc)](_0x2bc6c1,{'include':[{'model':User_1[_0x280f43(0xea)],'as':'owner'},{'model':ChatUser_1[_0x280f43(0xea)],'as':'users'}]}),_0x3a0b6d=(0x0,socket_1['getIO'])();return _0x3a0b6d['to']('company-'+_0x311d44+_0x280f43(0xd7))[_0x280f43(0xd9)](_0x280f43(0xcc)+_0x311d44+'-chat-'+_0x2bc6c1,{'action':_0x280f43(0xf2),'chat':_0x3e2466}),_0x3a0b6d['to'](_0x280f43(0xcc)+_0x311d44+_0x280f43(0xd7))['emit'](_0x280f43(0xcc)+_0x311d44+_0x280f43(0xf0),{'action':_0x280f43(0xf2),'chat':_0x3e2466}),_0x38db0d[_0x280f43(0xcf)](_0x3e2466);};exports[a12_0x51ec7d(0xfd)]=checkAsRead;const messages=async(_0x5781bf,_0x136d79)=>{const _0x8d7ebd=a12_0x51ec7d,{pageNumber:_0x419cba}=_0x5781bf[_0x8d7ebd(0xeb)],{id:_0x263483}=_0x5781bf[_0x8d7ebd(0xfa)],_0x1034aa=+_0x5781bf['user']['id'],{records:_0x255f2a,count:_0x14c8e2,hasMore:_0x37e170}=await(0x0,FindMessages_1[_0x8d7ebd(0xea)])({'chatId':_0x263483,'ownerId':_0x1034aa,'pageNumber':_0x419cba});return _0x136d79[_0x8d7ebd(0xcf)]({'records':_0x255f2a,'count':_0x14c8e2,'hasMore':_0x37e170});};exports[a12_0x51ec7d(0xe9)]=messages;