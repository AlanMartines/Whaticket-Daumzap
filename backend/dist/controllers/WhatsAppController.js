const a46_0xe94832=a46_0x3e9c;(function(_0x18ef16,_0x29176b){const _0x17da40=a46_0x3e9c,_0x14a36d=_0x18ef16();while(!![]){try{const _0x4126cb=parseInt(_0x17da40(0x10d))/0x1*(-parseInt(_0x17da40(0xed))/0x2)+-parseInt(_0x17da40(0x107))/0x3*(-parseInt(_0x17da40(0x114))/0x4)+parseInt(_0x17da40(0xea))/0x5*(-parseInt(_0x17da40(0x118))/0x6)+-parseInt(_0x17da40(0x110))/0x7+-parseInt(_0x17da40(0xfd))/0x8*(-parseInt(_0x17da40(0x11e))/0x9)+parseInt(_0x17da40(0xeb))/0xa+parseInt(_0x17da40(0x124))/0xb;if(_0x4126cb===_0x29176b)break;else _0x14a36d['push'](_0x14a36d['shift']());}catch(_0x88a4b7){_0x14a36d['push'](_0x14a36d['shift']());}}}(a46_0x15df,0xa298e));const a46_0x50433a=(function(){let _0x372413=!![];return function(_0x42f6df,_0x1d8273){const _0x3cedb4=_0x372413?function(){const _0x1eeb7c=a46_0x3e9c;if(_0x1d8273){const _0x50cfc4=_0x1d8273[_0x1eeb7c(0x11f)](_0x42f6df,arguments);return _0x1d8273=null,_0x50cfc4;}}:function(){};return _0x372413=![],_0x3cedb4;};}()),a46_0xabfe88=a46_0x50433a(this,function(){const _0x253a3e=a46_0x3e9c;return a46_0xabfe88[_0x253a3e(0x122)]()['search'](_0x253a3e(0x120))['toString']()[_0x253a3e(0x108)](a46_0xabfe88)[_0x253a3e(0x113)]('(((.+)+)+)+$');});a46_0xabfe88();'use strict';var __importDefault=this&&this['__importDefault']||function(_0xb91da5){return _0xb91da5&&_0xb91da5['__esModule']?_0xb91da5:{'default':_0xb91da5};};Object[a46_0xe94832(0x121)](exports,'__esModule',{'value':!![]}),exports[a46_0xe94832(0xf5)]=exports['remove']=exports[a46_0xe94832(0x10c)]=exports[a46_0xe94832(0x103)]=exports[a46_0xe94832(0xfa)]=exports[a46_0xe94832(0xf8)]=exports[a46_0xe94832(0x111)]=exports[a46_0xe94832(0x119)]=void 0x0;const socket_1=require(a46_0xe94832(0xf1)),wbot_1=require(a46_0xe94832(0xfc)),StartWhatsAppSession_1=require('../services/WbotServices/StartWhatsAppSession'),FindAllCompaniesService_1=__importDefault(require('../services/CompanyService/FindAllCompaniesService')),CreateWhatsAppService_1=__importDefault(require(a46_0xe94832(0x11a))),DeleteWhatsAppService_1=__importDefault(require(a46_0xe94832(0x11b))),ListWhatsAppsService_1=__importDefault(require(a46_0xe94832(0x117))),ShowWhatsAppService_1=__importDefault(require(a46_0xe94832(0x112))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a46_0xe94832(0xf3))),sequelize_1=require(a46_0xe94832(0x123)),ImportWhatsAppMessageService_1=require(a46_0xe94832(0x102)),Whatsapp_1=__importDefault(require(a46_0xe94832(0x11d))),closedTickets=async(_0x1ab399,_0x159de1)=>{const _0x5b734c=a46_0xe94832,{whatsappId:_0x48d65c}=_0x1ab399[_0x5b734c(0xfe)];return await(0x0,ImportWhatsAppMessageService_1[_0x5b734c(0x116)])(_0x48d65c),_0x159de1[_0x5b734c(0x104)](0xc8)[_0x5b734c(0xf6)](_0x5b734c(0x100));};exports[a46_0xe94832(0x119)]=closedTickets;const index=async(_0x187415,_0x31dd76)=>{const _0x2f5c1d=a46_0xe94832,{companyId:_0x59583e}=_0x187415[_0x2f5c1d(0x115)],{session:_0x3984b4}=_0x187415[_0x2f5c1d(0xe9)],_0x3bde1c=await(0x0,ListWhatsAppsService_1[_0x2f5c1d(0x10e)])({'companyId':_0x59583e,'session':_0x3984b4});return _0x31dd76[_0x2f5c1d(0x104)](0xc8)[_0x2f5c1d(0xf6)](_0x3bde1c);};exports[a46_0xe94832(0x111)]=index;const store=async(_0x2044ef,_0x3f8c16)=>{const _0x2f9294=a46_0xe94832,{name:_0x53dfc7,status:_0x31debe,isDefault:_0x4f41d2,greetingMessage:_0x100216,complationMessage:_0x1912fa,outOfHoursMessage:_0x181eb0,queueIds:_0x15824f,token:_0x59e0fc,allowGroup:_0x589f91,timeSendQueue:_0x4fb1e7,sendIdQueue:_0x143f68,promptId:_0x5dbdd4,maxUseBotQueues:_0x3ca85e,timeUseBotQueues:_0x560b15,expiresTicket:_0x209a3f,expiresInactiveMessage:_0x269a61,importOldMessages:_0x590c88,importRecentMessages:_0x48a70b,closedTicketsPostImported:_0x48e7f1,importOldMessagesGroups:_0x103cdb}=_0x2044ef[_0x2f9294(0xf0)],{companyId:_0xdb3e1d}=_0x2044ef[_0x2f9294(0x115)],{whatsapp:_0x265472,oldDefaultWhatsapp:_0x1ae59a}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x53dfc7,'status':_0x31debe,'isDefault':_0x4f41d2,'greetingMessage':_0x100216,'complationMessage':_0x1912fa,'outOfHoursMessage':_0x181eb0,'queueIds':_0x15824f,'companyId':_0xdb3e1d,'token':_0x59e0fc,'timeSendQueue':_0x4fb1e7,'sendIdQueue':_0x143f68,'promptId':_0x5dbdd4,'maxUseBotQueues':_0x3ca85e,'timeUseBotQueues':_0x560b15,'expiresTicket':_0x209a3f,'expiresInactiveMessage':_0x269a61,'allowGroup':_0x589f91,'importOldMessages':_0x590c88,'importRecentMessages':_0x48a70b,'closedTicketsPostImported':_0x48e7f1,'importOldMessagesGroups':_0x103cdb});(0x0,StartWhatsAppSession_1['StartWhatsAppSession'])(_0x265472,_0xdb3e1d);const _0x25fd3e=(0x0,socket_1[_0x2f9294(0xf2)])();return _0x25fd3e['to'](_0x2f9294(0xee)+_0xdb3e1d+'-mainchannel')['emit'](_0x2f9294(0xee)+_0xdb3e1d+_0x2f9294(0xf4),{'action':_0x2f9294(0x10c),'whatsapp':_0x265472}),_0x1ae59a&&_0x25fd3e['to'](_0x2f9294(0xee)+_0xdb3e1d+_0x2f9294(0xef))['emit'](_0x2f9294(0xee)+_0xdb3e1d+_0x2f9294(0xf4),{'action':'update','whatsapp':_0x1ae59a}),_0x3f8c16[_0x2f9294(0x104)](0xc8)[_0x2f9294(0xf6)](_0x265472);};exports[a46_0xe94832(0xf8)]=store;const show=async(_0x38fed0,_0x1c26d0)=>{const _0x1a55af=a46_0xe94832,{whatsappId:_0x436078}=_0x38fed0[_0x1a55af(0xfe)],{companyId:_0x580d06}=_0x38fed0[_0x1a55af(0x115)],{session:_0x5a4b27}=_0x38fed0[_0x1a55af(0xe9)],_0xfe93ed=await(0x0,ShowWhatsAppService_1['default'])(_0x436078,_0x580d06,_0x5a4b27);return _0x1c26d0['status'](0xc8)[_0x1a55af(0xf6)](_0xfe93ed);};exports[a46_0xe94832(0xfa)]=show;const getAllConnections=async(_0x2e9c32,_0x579014)=>{const _0x8b4640=a46_0xe94832;try{const _0x2a1acc=await(0x0,FindAllCompaniesService_1['default'])();if(!_0x2a1acc||_0x2a1acc['length']===0x0)return _0x579014['status'](0x194)[_0x8b4640(0xf6)]({'error':'No\x20companies\x20found'});const _0x136ce1=[];for(const _0x37f7ba of _0x2a1acc){if(typeof _0x37f7ba['id']!=='number')continue;const _0x24b187=await Whatsapp_1[_0x8b4640(0x10e)][_0x8b4640(0x11c)]({'where':{'companyId':_0x37f7ba['id']}});_0x136ce1[_0x8b4640(0xfb)](..._0x24b187);}return _0x579014[_0x8b4640(0x104)](0xc8)[_0x8b4640(0xf6)](_0x136ce1);}catch(_0x4d93ea){return console[_0x8b4640(0x109)](_0x4d93ea),_0x579014[_0x8b4640(0x104)](0x1f4)[_0x8b4640(0xf6)]({'error':_0x8b4640(0x106)});}};exports[a46_0xe94832(0x103)]=getAllConnections;const update=async(_0x493538,_0x47855d)=>{const _0x2cb492=a46_0xe94832,{whatsappId:_0x4fd2d6}=_0x493538['params'],_0x4f69c0=_0x493538[_0x2cb492(0xf0)],{companyId:_0x4f9fb0}=_0x493538[_0x2cb492(0x115)],{whatsapp:_0x4ee193,oldDefaultWhatsapp:_0x4970ff}=await(0x0,UpdateWhatsAppService_1[_0x2cb492(0x10e)])({'whatsappData':_0x4f69c0,'whatsappId':_0x4fd2d6,'companyId':_0x4f9fb0}),_0x32f82f=(0x0,socket_1['getIO'])();return _0x32f82f['to'](_0x2cb492(0xee)+_0x4f9fb0+_0x2cb492(0xef))[_0x2cb492(0x101)](_0x2cb492(0xee)+_0x4f9fb0+_0x2cb492(0xf4),{'action':'update','whatsapp':_0x4ee193}),_0x4970ff&&_0x32f82f['to'](_0x2cb492(0xee)+_0x4f9fb0+_0x2cb492(0xef))[_0x2cb492(0x101)](_0x2cb492(0xee)+_0x4f9fb0+_0x2cb492(0xf4),{'action':_0x2cb492(0x10c),'whatsapp':_0x4970ff}),_0x47855d[_0x2cb492(0x104)](0xc8)[_0x2cb492(0xf6)](_0x4ee193);};function a46_0x15df(){const _0x2aefc9=['Whatsapp\x20deleted.','whatsapp','emit','../services/WhatsappService/ImportWhatsAppMessageService','getAllConnections','status','$get','Failed\x20to\x20fetch\x20connections','4677xZtlvc','constructor','error','removeWbot','remove','update','665795rWdzCN','default','pending','5430817FEgLdB','index','../services/WhatsappService/ShowWhatsAppService','search','1516zxsoKz','user','closeImportedTickets','../services/WhatsappService/ListWhatsAppsService','270SSjtTB','closedTickets','../services/WhatsappService/CreateWhatsAppService','../services/WhatsappService/DeleteWhatsAppService','findAll','../models/Whatsapp','9jHxFmU','apply','(((.+)+)+)+$','defineProperty','toString','sequelize','13611444kgpBPa','open','query','33675ojLqXL','5336000PuzaIQ','restartWbot','2BwTzoi','company-','-mainchannel','body','../libs/socket','getIO','../errors/AppError','-whatsapp','restart','json','length','store','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','show','push','../libs/wbot','390672VzOrGH','params'];a46_0x15df=function(){return _0x2aefc9;};return a46_0x15df();}function a46_0x3e9c(_0xf83699,_0x45d1aa){const _0x4d1f38=a46_0x15df();return a46_0x3e9c=function(_0xabfe88,_0x50433a){_0xabfe88=_0xabfe88-0xe8;let _0x15df2d=_0x4d1f38[_0xabfe88];return _0x15df2d;},a46_0x3e9c(_0xf83699,_0x45d1aa);}exports['update']=update;const remove=async(_0x23f00e,_0x27d04f)=>{const _0x3228f4=a46_0xe94832,{whatsappId:_0x43d5ae}=_0x23f00e[_0x3228f4(0xfe)],{companyId:_0xb2fda}=_0x23f00e[_0x3228f4(0x115)],_0x19b164=await(0x0,ShowWhatsAppService_1[_0x3228f4(0x10e)])(_0x43d5ae,_0xb2fda),_0x31a0fb=await _0x19b164[_0x3228f4(0x105)]('tickets',{'where':{'status':{[sequelize_1['Op']['or']]:[_0x3228f4(0xe8),_0x3228f4(0x10f)]}}});if(_0x31a0fb[_0x3228f4(0xf7)]>0x0)throw new AppError_1[(_0x3228f4(0x10e))](_0x3228f4(0xf9));await(0x0,DeleteWhatsAppService_1[_0x3228f4(0x10e)])(_0x43d5ae),await(0x0,wbot_1[_0x3228f4(0x10a)])(+_0x43d5ae);const _0x2d117a=(0x0,socket_1[_0x3228f4(0xf2)])();return _0x2d117a['to'](_0x3228f4(0xee)+_0xb2fda+'-mainchannel')[_0x3228f4(0x101)](_0x3228f4(0xee)+_0xb2fda+'-whatsapp',{'action':'delete','whatsappId':+_0x43d5ae}),_0x27d04f[_0x3228f4(0x104)](0xc8)[_0x3228f4(0xf6)]({'message':_0x3228f4(0xff)});};exports[a46_0xe94832(0x10b)]=remove;const restart=async(_0x2e30ee,_0x57b709)=>{const _0x475998=a46_0xe94832,{companyId:_0x2478e9,profile:_0x557bf8}=_0x2e30ee[_0x475998(0x115)];if(_0x557bf8!=='admin')throw new AppError_1[(_0x475998(0x10e))]('ERR_NO_PERMISSION',0x193);return await(0x0,wbot_1[_0x475998(0xec)])(_0x2478e9),_0x57b709[_0x475998(0x104)](0xc8)[_0x475998(0xf6)]({'message':'Whatsapp\x20restart.'});};exports[a46_0xe94832(0xf5)]=restart;