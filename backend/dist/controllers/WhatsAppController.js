const a46_0x308b55=a46_0x599f;(function(_0xd6784c,_0x37638a){const _0x19c205=a46_0x599f,_0x5056a0=_0xd6784c();while(!![]){try{const _0x30ebd2=parseInt(_0x19c205(0x153))/0x1+parseInt(_0x19c205(0x16d))/0x2+-parseInt(_0x19c205(0x141))/0x3+parseInt(_0x19c205(0x13e))/0x4+parseInt(_0x19c205(0x160))/0x5*(parseInt(_0x19c205(0x15f))/0x6)+-parseInt(_0x19c205(0x161))/0x7+-parseInt(_0x19c205(0x149))/0x8;if(_0x30ebd2===_0x37638a)break;else _0x5056a0['push'](_0x5056a0['shift']());}catch(_0x44641b){_0x5056a0['push'](_0x5056a0['shift']());}}}(a46_0x2d85,0xa5bf8));function a46_0x599f(_0x32bc7c,_0x56156d){const _0x3c5fa9=a46_0x2d85();return a46_0x599f=function(_0x2da889,_0x594139){_0x2da889=_0x2da889-0x136;let _0x2d852f=_0x3c5fa9[_0x2da889];return _0x2d852f;},a46_0x599f(_0x32bc7c,_0x56156d);}const a46_0x594139=(function(){let _0x454197=!![];return function(_0x3a8ec2,_0x3e6487){const _0x416c0b=_0x454197?function(){const _0x1c23fd=a46_0x599f;if(_0x3e6487){const _0xbc62c4=_0x3e6487[_0x1c23fd(0x154)](_0x3a8ec2,arguments);return _0x3e6487=null,_0xbc62c4;}}:function(){};return _0x454197=![],_0x416c0b;};}()),a46_0x2da889=a46_0x594139(this,function(){const _0x7169c8=a46_0x599f;return a46_0x2da889[_0x7169c8(0x166)]()[_0x7169c8(0x143)](_0x7169c8(0x152))[_0x7169c8(0x166)]()[_0x7169c8(0x15b)](a46_0x2da889)[_0x7169c8(0x143)](_0x7169c8(0x152));});a46_0x2da889();'use strict';var __importDefault=this&&this[a46_0x308b55(0x159)]||function(_0x46575e){const _0x26df82=a46_0x308b55;return _0x46575e&&_0x46575e[_0x26df82(0x15d)]?_0x46575e:{'default':_0x46575e};};Object['defineProperty'](exports,a46_0x308b55(0x15d),{'value':!![]}),exports['restart']=exports[a46_0x308b55(0x13c)]=exports[a46_0x308b55(0x16a)]=exports[a46_0x308b55(0x137)]=exports['show']=exports[a46_0x308b55(0x165)]=exports['index']=exports['closedTickets']=void 0x0;const socket_1=require(a46_0x308b55(0x136)),wbot_1=require(a46_0x308b55(0x14c)),StartWhatsAppSession_1=require(a46_0x308b55(0x162)),FindAllCompaniesService_1=__importDefault(require(a46_0x308b55(0x142))),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a46_0x308b55(0x16e))),ListWhatsAppsService_1=__importDefault(require(a46_0x308b55(0x15c))),ShowWhatsAppService_1=__importDefault(require(a46_0x308b55(0x13d))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a46_0x308b55(0x174))),sequelize_1=require(a46_0x308b55(0x14f)),ImportWhatsAppMessageService_1=require(a46_0x308b55(0x14e)),Whatsapp_1=__importDefault(require(a46_0x308b55(0x146))),closedTickets=async(_0xcd439d,_0x22fce1)=>{const _0x41f734=a46_0x308b55,{whatsappId:_0x6fa534}=_0xcd439d['params'];return await(0x0,ImportWhatsAppMessageService_1[_0x41f734(0x170)])(_0x6fa534),_0x22fce1[_0x41f734(0x150)](0xc8)['json'](_0x41f734(0x13a));};exports[a46_0x308b55(0x138)]=closedTickets;const index=async(_0x3bcad5,_0x5119d6)=>{const _0x29225f=a46_0x308b55,{companyId:_0x10fcb8}=_0x3bcad5[_0x29225f(0x16b)],{session:_0x168151}=_0x3bcad5['query'],_0x32ded5=await(0x0,ListWhatsAppsService_1[_0x29225f(0x15a)])({'companyId':_0x10fcb8,'session':_0x168151});return _0x5119d6[_0x29225f(0x150)](0xc8)['json'](_0x32ded5);};exports[a46_0x308b55(0x156)]=index;function a46_0x2d85(){const _0x2529f4=['apply','ERR_NO_PERMISSION','index','open','restart','__importDefault','default','constructor','../services/WhatsappService/ListWhatsAppsService','__esModule','emit','354WcmjVd','18610jNwlDM','7675059OdBjMl','../services/WbotServices/StartWhatsAppSession','-whatsapp','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','store','toString','findAll','getIO','params','update','user','number','1458868lFmycI','../services/WhatsappService/DeleteWhatsAppService','removeWbot','closeImportedTickets','Whatsapp\x20restart.','tickets','admin','../errors/AppError','../libs/socket','getAllConnections','closedTickets','$get','whatsapp','company-','remove','../services/WhatsappService/ShowWhatsAppService','2777040dkCOcQ','-mainchannel','show','217245tZzsIz','../services/CompanyService/FindAllCompaniesService','search','delete','body','../models/Whatsapp','json','StartWhatsAppSession','6130840HbNnRO','pending','restartWbot','../libs/wbot','error','../services/WhatsappService/ImportWhatsAppMessageService','sequelize','status','length','(((.+)+)+)+$','970819DGquFJ'];a46_0x2d85=function(){return _0x2529f4;};return a46_0x2d85();}const store=async(_0x227278,_0x1efe19)=>{const _0xe08e9f=a46_0x308b55,{name:_0x2a7671,status:_0x5d8ead,isDefault:_0x586215,greetingMessage:_0x1b96b8,complationMessage:_0x261d72,outOfHoursMessage:_0x483b4d,queueIds:_0x4a689d,token:_0xcb74a,allowGroup:_0x3116bb,timeSendQueue:_0x30cc91,sendIdQueue:_0x22d309,promptId:_0x56168f,maxUseBotQueues:_0xd8fbe4,timeUseBotQueues:_0x449ba3,expiresTicket:_0x1fa776,expiresInactiveMessage:_0x3151ec,importOldMessages:_0x171173,importRecentMessages:_0x5bd69f,closedTicketsPostImported:_0x5d07e7,importOldMessagesGroups:_0x7c78fc}=_0x227278['body'],{companyId:_0x190dc9}=_0x227278[_0xe08e9f(0x16b)],{whatsapp:_0x38ff05,oldDefaultWhatsapp:_0x411987}=await(0x0,CreateWhatsAppService_1['default'])({'name':_0x2a7671,'status':_0x5d8ead,'isDefault':_0x586215,'greetingMessage':_0x1b96b8,'complationMessage':_0x261d72,'outOfHoursMessage':_0x483b4d,'queueIds':_0x4a689d,'companyId':_0x190dc9,'token':_0xcb74a,'timeSendQueue':_0x30cc91,'sendIdQueue':_0x22d309,'promptId':_0x56168f,'maxUseBotQueues':_0xd8fbe4,'timeUseBotQueues':_0x449ba3,'expiresTicket':_0x1fa776,'expiresInactiveMessage':_0x3151ec,'allowGroup':_0x3116bb,'importOldMessages':_0x171173,'importRecentMessages':_0x5bd69f,'closedTicketsPostImported':_0x5d07e7,'importOldMessagesGroups':_0x7c78fc});(0x0,StartWhatsAppSession_1[_0xe08e9f(0x148)])(_0x38ff05,_0x190dc9);const _0x780ef5=(0x0,socket_1[_0xe08e9f(0x168)])();return _0x780ef5['to'](_0xe08e9f(0x13b)+_0x190dc9+'-mainchannel')[_0xe08e9f(0x15e)](_0xe08e9f(0x13b)+_0x190dc9+'-whatsapp',{'action':'update','whatsapp':_0x38ff05}),_0x411987&&_0x780ef5['to']('company-'+_0x190dc9+_0xe08e9f(0x13f))['emit'](_0xe08e9f(0x13b)+_0x190dc9+_0xe08e9f(0x163),{'action':_0xe08e9f(0x16a),'whatsapp':_0x411987}),_0x1efe19['status'](0xc8)[_0xe08e9f(0x147)](_0x38ff05);};exports[a46_0x308b55(0x165)]=store;const show=async(_0x2ee065,_0x4daf3a)=>{const _0x26aea4=a46_0x308b55,{whatsappId:_0x712473}=_0x2ee065[_0x26aea4(0x169)],{companyId:_0x10604b}=_0x2ee065[_0x26aea4(0x16b)],{session:_0x361e41}=_0x2ee065['query'],_0x14b857=await(0x0,ShowWhatsAppService_1[_0x26aea4(0x15a)])(_0x712473,_0x10604b,_0x361e41);return _0x4daf3a[_0x26aea4(0x150)](0xc8)['json'](_0x14b857);};exports[a46_0x308b55(0x140)]=show;const getAllConnections=async(_0x34116e,_0x19a0e8)=>{const _0x3cc0c0=a46_0x308b55;try{const _0x4b6184=await(0x0,FindAllCompaniesService_1['default'])();if(!_0x4b6184||_0x4b6184[_0x3cc0c0(0x151)]===0x0)return _0x19a0e8[_0x3cc0c0(0x150)](0x194)[_0x3cc0c0(0x147)]({'error':'No\x20companies\x20found'});const _0x4f26ab=[];for(const _0x564431 of _0x4b6184){if(typeof _0x564431['id']!==_0x3cc0c0(0x16c))continue;const _0x163cdf=await Whatsapp_1[_0x3cc0c0(0x15a)][_0x3cc0c0(0x167)]({'where':{'companyId':_0x564431['id']}});_0x4f26ab['push'](..._0x163cdf);}return _0x19a0e8[_0x3cc0c0(0x150)](0xc8)[_0x3cc0c0(0x147)](_0x4f26ab);}catch(_0x184d2d){return console[_0x3cc0c0(0x14d)](_0x184d2d),_0x19a0e8[_0x3cc0c0(0x150)](0x1f4)['json']({'error':'Failed\x20to\x20fetch\x20connections'});}};exports[a46_0x308b55(0x137)]=getAllConnections;const update=async(_0x198302,_0x5f07f5)=>{const _0xefd9d1=a46_0x308b55,{whatsappId:_0x3a5779}=_0x198302['params'],_0x437d83=_0x198302[_0xefd9d1(0x145)],{companyId:_0x2a2fab}=_0x198302[_0xefd9d1(0x16b)],{whatsapp:_0x165a5b,oldDefaultWhatsapp:_0xc73aa7}=await(0x0,UpdateWhatsAppService_1[_0xefd9d1(0x15a)])({'whatsappData':_0x437d83,'whatsappId':_0x3a5779,'companyId':_0x2a2fab}),_0x1df85d=(0x0,socket_1[_0xefd9d1(0x168)])();return _0x1df85d['to'](_0xefd9d1(0x13b)+_0x2a2fab+_0xefd9d1(0x13f))[_0xefd9d1(0x15e)](_0xefd9d1(0x13b)+_0x2a2fab+_0xefd9d1(0x163),{'action':_0xefd9d1(0x16a),'whatsapp':_0x165a5b}),_0xc73aa7&&_0x1df85d['to']('company-'+_0x2a2fab+_0xefd9d1(0x13f))[_0xefd9d1(0x15e)]('company-'+_0x2a2fab+_0xefd9d1(0x163),{'action':_0xefd9d1(0x16a),'whatsapp':_0xc73aa7}),_0x5f07f5[_0xefd9d1(0x150)](0xc8)[_0xefd9d1(0x147)](_0x165a5b);};exports['update']=update;const remove=async(_0x1f54b4,_0x54726e)=>{const _0x2edc41=a46_0x308b55,{whatsappId:_0x4581cf}=_0x1f54b4[_0x2edc41(0x169)],{companyId:_0x1877d1}=_0x1f54b4[_0x2edc41(0x16b)],_0x2da65e=await(0x0,ShowWhatsAppService_1[_0x2edc41(0x15a)])(_0x4581cf,_0x1877d1),_0x103030=await _0x2da65e[_0x2edc41(0x139)](_0x2edc41(0x172),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x2edc41(0x157),_0x2edc41(0x14a)]}}});if(_0x103030['length']>0x0)throw new AppError_1[(_0x2edc41(0x15a))](_0x2edc41(0x164));await(0x0,DeleteWhatsAppService_1[_0x2edc41(0x15a)])(_0x4581cf),await(0x0,wbot_1[_0x2edc41(0x16f)])(+_0x4581cf);const _0x31e713=(0x0,socket_1[_0x2edc41(0x168)])();return _0x31e713['to'](_0x2edc41(0x13b)+_0x1877d1+_0x2edc41(0x13f))[_0x2edc41(0x15e)]('company-'+_0x1877d1+_0x2edc41(0x163),{'action':_0x2edc41(0x144),'whatsappId':+_0x4581cf}),_0x54726e[_0x2edc41(0x150)](0xc8)[_0x2edc41(0x147)]({'message':'Whatsapp\x20deleted.'});};exports['remove']=remove;const restart=async(_0x231cee,_0x47be72)=>{const _0x391046=a46_0x308b55,{companyId:_0x597434,profile:_0x47c80c}=_0x231cee[_0x391046(0x16b)];if(_0x47c80c!==_0x391046(0x173))throw new AppError_1[(_0x391046(0x15a))](_0x391046(0x155),0x193);return await(0x0,wbot_1[_0x391046(0x14b)])(_0x597434),_0x47be72['status'](0xc8)[_0x391046(0x147)]({'message':_0x391046(0x171)});};exports[a46_0x308b55(0x158)]=restart;