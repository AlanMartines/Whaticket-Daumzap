const a46_0x1e9dca=a46_0x58b9;(function(_0x1c073d,_0x332ad7){const _0x109b5e=a46_0x58b9,_0x4f9374=_0x1c073d();while(!![]){try{const _0x39116e=parseInt(_0x109b5e(0x169))/0x1+parseInt(_0x109b5e(0x177))/0x2*(parseInt(_0x109b5e(0x148))/0x3)+parseInt(_0x109b5e(0x168))/0x4*(parseInt(_0x109b5e(0x15d))/0x5)+-parseInt(_0x109b5e(0x160))/0x6+parseInt(_0x109b5e(0x171))/0x7*(parseInt(_0x109b5e(0x180))/0x8)+-parseInt(_0x109b5e(0x142))/0x9*(parseInt(_0x109b5e(0x164))/0xa)+parseInt(_0x109b5e(0x178))/0xb*(parseInt(_0x109b5e(0x149))/0xc);if(_0x39116e===_0x332ad7)break;else _0x4f9374['push'](_0x4f9374['shift']());}catch(_0x54fc2e){_0x4f9374['push'](_0x4f9374['shift']());}}}(a46_0xd38d,0x2f554));const a46_0x2f00b2=(function(){let _0x2b371b=!![];return function(_0xdf33e9,_0x11fd1f){const _0x3ad778=_0x2b371b?function(){if(_0x11fd1f){const _0x812827=_0x11fd1f['apply'](_0xdf33e9,arguments);return _0x11fd1f=null,_0x812827;}}:function(){};return _0x2b371b=![],_0x3ad778;};}()),a46_0x4886fd=a46_0x2f00b2(this,function(){const _0x5cdafb=a46_0x58b9;return a46_0x4886fd[_0x5cdafb(0x15c)]()[_0x5cdafb(0x156)]('(((.+)+)+)+$')['toString']()[_0x5cdafb(0x145)](a46_0x4886fd)['search'](_0x5cdafb(0x15e));});a46_0x4886fd();'use strict';var __importDefault=this&&this[a46_0x1e9dca(0x14c)]||function(_0x45efac){return _0x45efac&&_0x45efac['__esModule']?_0x45efac:{'default':_0x45efac};};Object['defineProperty'](exports,a46_0x1e9dca(0x143),{'value':!![]}),exports[a46_0x1e9dca(0x181)]=exports[a46_0x1e9dca(0x14f)]=exports['update']=exports[a46_0x1e9dca(0x153)]=exports['show']=exports[a46_0x1e9dca(0x154)]=exports[a46_0x1e9dca(0x172)]=exports[a46_0x1e9dca(0x16e)]=void 0x0;const socket_1=require(a46_0x1e9dca(0x141)),wbot_1=require(a46_0x1e9dca(0x14a)),StartWhatsAppSession_1=require(a46_0x1e9dca(0x17d)),FindAllCompaniesService_1=__importDefault(require('../services/CompanyService/FindAllCompaniesService')),CreateWhatsAppService_1=__importDefault(require(a46_0x1e9dca(0x162))),DeleteWhatsAppService_1=__importDefault(require(a46_0x1e9dca(0x155))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require(a46_0x1e9dca(0x175))),UpdateWhatsAppService_1=__importDefault(require('../services/WhatsappService/UpdateWhatsAppService')),AppError_1=__importDefault(require(a46_0x1e9dca(0x144))),sequelize_1=require(a46_0x1e9dca(0x182)),ImportWhatsAppMessageService_1=require(a46_0x1e9dca(0x14b)),Whatsapp_1=__importDefault(require('../models/Whatsapp')),closedTickets=async(_0x2dbfcd,_0x175ffc)=>{const _0x393452=a46_0x1e9dca,{whatsappId:_0x3605ce}=_0x2dbfcd[_0x393452(0x166)];return await(0x0,ImportWhatsAppMessageService_1[_0x393452(0x17f)])(_0x3605ce),_0x175ffc[_0x393452(0x15b)](0xc8)[_0x393452(0x152)](_0x393452(0x176));};function a46_0xd38d(){const _0x109315=['removeWbot','params','error','440732GmIVtK','61223bZzWDP','length','push','-mainchannel','$get','closedTickets','getIO','open','581427FBKggd','index','emit','ERR_NO_PERMISSION','../services/WhatsappService/ShowWhatsAppService','whatsapp','1102vlTizw','3281377PlPbtp','update','body','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','Whatsapp\x20restart.','../services/WbotServices/StartWhatsAppSession','default','closeImportedTickets','8dVwSGS','restart','sequelize','../libs/socket','58788KNSErU','__esModule','../errors/AppError','constructor','query','tickets','408aBiNBK','12LfQtUW','../libs/wbot','../services/WhatsappService/ImportWhatsAppMessageService','__importDefault','findAll','show','remove','No\x20companies\x20found','delete','json','getAllConnections','store','../services/WhatsappService/DeleteWhatsAppService','search','number','-whatsapp','admin','company-','status','toString','10DpOufa','(((.+)+)+)+$','StartWhatsAppSession','1892382IzWpSN','user','../services/WhatsappService/CreateWhatsAppService','Whatsapp\x20deleted.','350KNMuCE'];a46_0xd38d=function(){return _0x109315;};return a46_0xd38d();}exports[a46_0x1e9dca(0x16e)]=closedTickets;const index=async(_0x549ed8,_0x49abb9)=>{const _0x4e17af=a46_0x1e9dca,{companyId:_0x4db7b9}=_0x549ed8['user'],{session:_0xa12d58}=_0x549ed8[_0x4e17af(0x146)],_0x57942f=await(0x0,ListWhatsAppsService_1[_0x4e17af(0x17e)])({'companyId':_0x4db7b9,'session':_0xa12d58});return _0x49abb9[_0x4e17af(0x15b)](0xc8)[_0x4e17af(0x152)](_0x57942f);};exports[a46_0x1e9dca(0x172)]=index;const store=async(_0x37e803,_0x781087)=>{const _0x3ef354=a46_0x1e9dca,{name:_0x4d7084,status:_0x7f7592,isDefault:_0x3bbd82,greetingMessage:_0x4e0313,complationMessage:_0x5f2310,outOfHoursMessage:_0x5102dd,queueIds:_0x30cc9b,token:_0x31c81c,allowGroup:_0x3f6dee,timeSendQueue:_0x257c83,sendIdQueue:_0x5a3b49,promptId:_0xb2eab9,maxUseBotQueues:_0x109e92,timeUseBotQueues:_0x36cf74,expiresTicket:_0x1f2615,expiresInactiveMessage:_0x27f6bd,importOldMessages:_0x312994,importRecentMessages:_0x6647,closedTicketsPostImported:_0x1e2f5c,importOldMessagesGroups:_0xdff7bf}=_0x37e803[_0x3ef354(0x17a)],{companyId:_0x14f694}=_0x37e803[_0x3ef354(0x161)],{whatsapp:_0x282951,oldDefaultWhatsapp:_0x378124}=await(0x0,CreateWhatsAppService_1[_0x3ef354(0x17e)])({'name':_0x4d7084,'status':_0x7f7592,'isDefault':_0x3bbd82,'greetingMessage':_0x4e0313,'complationMessage':_0x5f2310,'outOfHoursMessage':_0x5102dd,'queueIds':_0x30cc9b,'companyId':_0x14f694,'token':_0x31c81c,'timeSendQueue':_0x257c83,'sendIdQueue':_0x5a3b49,'promptId':_0xb2eab9,'maxUseBotQueues':_0x109e92,'timeUseBotQueues':_0x36cf74,'expiresTicket':_0x1f2615,'expiresInactiveMessage':_0x27f6bd,'allowGroup':_0x3f6dee,'importOldMessages':_0x312994,'importRecentMessages':_0x6647,'closedTicketsPostImported':_0x1e2f5c,'importOldMessagesGroups':_0xdff7bf});(0x0,StartWhatsAppSession_1[_0x3ef354(0x15f)])(_0x282951,_0x14f694);const _0x5aab59=(0x0,socket_1['getIO'])();return _0x5aab59['to'](_0x3ef354(0x15a)+_0x14f694+'-mainchannel')['emit'](_0x3ef354(0x15a)+_0x14f694+_0x3ef354(0x158),{'action':_0x3ef354(0x179),'whatsapp':_0x282951}),_0x378124&&_0x5aab59['to']('company-'+_0x14f694+'-mainchannel')[_0x3ef354(0x173)](_0x3ef354(0x15a)+_0x14f694+_0x3ef354(0x158),{'action':_0x3ef354(0x179),'whatsapp':_0x378124}),_0x781087[_0x3ef354(0x15b)](0xc8)[_0x3ef354(0x152)](_0x282951);};exports[a46_0x1e9dca(0x154)]=store;const show=async(_0x52d615,_0xff34d1)=>{const _0x2d5f20=a46_0x1e9dca,{whatsappId:_0x2b32ff}=_0x52d615['params'],{companyId:_0x56677a}=_0x52d615[_0x2d5f20(0x161)],{session:_0x51e417}=_0x52d615[_0x2d5f20(0x146)],_0x1030f0=await(0x0,ShowWhatsAppService_1[_0x2d5f20(0x17e)])(_0x2b32ff,_0x56677a,_0x51e417);return _0xff34d1['status'](0xc8)[_0x2d5f20(0x152)](_0x1030f0);};exports[a46_0x1e9dca(0x14e)]=show;const getAllConnections=async(_0x5a45f2,_0x32e942)=>{const _0x14adc2=a46_0x1e9dca;try{const _0x1c64be=await(0x0,FindAllCompaniesService_1[_0x14adc2(0x17e)])();if(!_0x1c64be||_0x1c64be['length']===0x0)return _0x32e942['status'](0x194)[_0x14adc2(0x152)]({'error':_0x14adc2(0x150)});const _0x35fbbf=[];for(const _0x10f53d of _0x1c64be){if(typeof _0x10f53d['id']!==_0x14adc2(0x157))continue;const _0x34f7ba=await Whatsapp_1[_0x14adc2(0x17e)][_0x14adc2(0x14d)]({'where':{'companyId':_0x10f53d['id']}});_0x35fbbf[_0x14adc2(0x16b)](..._0x34f7ba);}return _0x32e942[_0x14adc2(0x15b)](0xc8)[_0x14adc2(0x152)](_0x35fbbf);}catch(_0x14795e){return console[_0x14adc2(0x167)](_0x14795e),_0x32e942['status'](0x1f4)[_0x14adc2(0x152)]({'error':'Failed\x20to\x20fetch\x20connections'});}};exports['getAllConnections']=getAllConnections;const update=async(_0x5c9b50,_0x5d5dbf)=>{const _0x928fcb=a46_0x1e9dca,{whatsappId:_0x52cd0d}=_0x5c9b50[_0x928fcb(0x166)],_0x3a4ca2=_0x5c9b50['body'],{companyId:_0x3b89f8}=_0x5c9b50['user'],{whatsapp:_0x37bd57,oldDefaultWhatsapp:_0x484532}=await(0x0,UpdateWhatsAppService_1['default'])({'whatsappData':_0x3a4ca2,'whatsappId':_0x52cd0d,'companyId':_0x3b89f8}),_0x14a256=(0x0,socket_1['getIO'])();return _0x14a256['to'](_0x928fcb(0x15a)+_0x3b89f8+_0x928fcb(0x16c))[_0x928fcb(0x173)]('company-'+_0x3b89f8+_0x928fcb(0x158),{'action':_0x928fcb(0x179),'whatsapp':_0x37bd57}),_0x484532&&_0x14a256['to']('company-'+_0x3b89f8+_0x928fcb(0x16c))[_0x928fcb(0x173)]('company-'+_0x3b89f8+_0x928fcb(0x158),{'action':_0x928fcb(0x179),'whatsapp':_0x484532}),_0x5d5dbf[_0x928fcb(0x15b)](0xc8)[_0x928fcb(0x152)](_0x37bd57);};exports['update']=update;const remove=async(_0x1c4f7c,_0x25e6d3)=>{const _0x2b2b35=a46_0x1e9dca,{whatsappId:_0x69968f}=_0x1c4f7c['params'],{companyId:_0x179f8e}=_0x1c4f7c[_0x2b2b35(0x161)],_0x1913af=await(0x0,ShowWhatsAppService_1[_0x2b2b35(0x17e)])(_0x69968f,_0x179f8e),_0xafc960=await _0x1913af[_0x2b2b35(0x16d)](_0x2b2b35(0x147),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x2b2b35(0x170),'pending']}}});if(_0xafc960[_0x2b2b35(0x16a)]>0x0)throw new AppError_1[(_0x2b2b35(0x17e))](_0x2b2b35(0x17b));await(0x0,DeleteWhatsAppService_1[_0x2b2b35(0x17e)])(_0x69968f),await(0x0,wbot_1[_0x2b2b35(0x165)])(+_0x69968f);const _0x3a0db0=(0x0,socket_1[_0x2b2b35(0x16f)])();return _0x3a0db0['to'](_0x2b2b35(0x15a)+_0x179f8e+'-mainchannel')['emit'](_0x2b2b35(0x15a)+_0x179f8e+_0x2b2b35(0x158),{'action':_0x2b2b35(0x151),'whatsappId':+_0x69968f}),_0x25e6d3['status'](0xc8)['json']({'message':_0x2b2b35(0x163)});};exports[a46_0x1e9dca(0x14f)]=remove;function a46_0x58b9(_0x39e058,_0x4f8ca2){const _0x303100=a46_0xd38d();return a46_0x58b9=function(_0x4886fd,_0x2f00b2){_0x4886fd=_0x4886fd-0x141;let _0xd38d42=_0x303100[_0x4886fd];return _0xd38d42;},a46_0x58b9(_0x39e058,_0x4f8ca2);}const restart=async(_0x4ab8bf,_0x31404f)=>{const _0x536dad=a46_0x1e9dca,{companyId:_0x87fdec,profile:_0x485e01}=_0x4ab8bf[_0x536dad(0x161)];if(_0x485e01!==_0x536dad(0x159))throw new AppError_1[(_0x536dad(0x17e))](_0x536dad(0x174),0x193);return await(0x0,wbot_1['restartWbot'])(_0x87fdec),_0x31404f[_0x536dad(0x15b)](0xc8)[_0x536dad(0x152)]({'message':_0x536dad(0x17c)});};exports[a46_0x1e9dca(0x181)]=restart;