const a46_0x5cf192=a46_0x1484;(function(_0x5e2930,_0x250035){const _0x58080e=a46_0x1484,_0x1ca7a6=_0x5e2930();while(!![]){try{const _0xf3c4ca=parseInt(_0x58080e(0x1d2))/0x1+parseInt(_0x58080e(0x1e1))/0x2+-parseInt(_0x58080e(0x1f0))/0x3+-parseInt(_0x58080e(0x1cf))/0x4*(-parseInt(_0x58080e(0x1c8))/0x5)+parseInt(_0x58080e(0x1c3))/0x6+-parseInt(_0x58080e(0x1d7))/0x7+-parseInt(_0x58080e(0x1e9))/0x8;if(_0xf3c4ca===_0x250035)break;else _0x1ca7a6['push'](_0x1ca7a6['shift']());}catch(_0x2744de){_0x1ca7a6['push'](_0x1ca7a6['shift']());}}}(a46_0x1c56,0x6c7ad));const a46_0xb7f261=(function(){let _0x59429c=!![];return function(_0x5d58d7,_0x10f86c){const _0xd59338=_0x59429c?function(){const _0x214949=a46_0x1484;if(_0x10f86c){const _0x540171=_0x10f86c[_0x214949(0x1e3)](_0x5d58d7,arguments);return _0x10f86c=null,_0x540171;}}:function(){};return _0x59429c=![],_0xd59338;};}()),a46_0x38b5a9=a46_0xb7f261(this,function(){const _0x2be4c9=a46_0x1484;return a46_0x38b5a9[_0x2be4c9(0x1f7)]()[_0x2be4c9(0x1ea)](_0x2be4c9(0x1e5))[_0x2be4c9(0x1f7)]()[_0x2be4c9(0x1e0)](a46_0x38b5a9)[_0x2be4c9(0x1ea)](_0x2be4c9(0x1e5));});a46_0x38b5a9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x12d115){const _0x14f6ed=a46_0x1484;return _0x12d115&&_0x12d115[_0x14f6ed(0x1f4)]?_0x12d115:{'default':_0x12d115};};Object['defineProperty'](exports,a46_0x5cf192(0x1f4),{'value':!![]}),exports[a46_0x5cf192(0x1f9)]=exports[a46_0x5cf192(0x1dd)]=exports[a46_0x5cf192(0x1f5)]=exports[a46_0x5cf192(0x1de)]=exports[a46_0x5cf192(0x1fb)]=exports[a46_0x5cf192(0x1fc)]=exports[a46_0x5cf192(0x1f8)]=exports['closedTickets']=void 0x0;const socket_1=require(a46_0x5cf192(0x1ca)),wbot_1=require(a46_0x5cf192(0x1c6)),StartWhatsAppSession_1=require(a46_0x5cf192(0x1e8)),FindAllCompaniesService_1=__importDefault(require(a46_0x5cf192(0x1e2))),CreateWhatsAppService_1=__importDefault(require(a46_0x5cf192(0x1e7))),DeleteWhatsAppService_1=__importDefault(require('../services/WhatsappService/DeleteWhatsAppService')),ListWhatsAppsService_1=__importDefault(require(a46_0x5cf192(0x1e6))),ShowWhatsAppService_1=__importDefault(require(a46_0x5cf192(0x1c5))),UpdateWhatsAppService_1=__importDefault(require(a46_0x5cf192(0x1fa))),AppError_1=__importDefault(require('../errors/AppError')),sequelize_1=require(a46_0x5cf192(0x1cb)),ImportWhatsAppMessageService_1=require(a46_0x5cf192(0x1d9)),Whatsapp_1=__importDefault(require(a46_0x5cf192(0x1dc))),closedTickets=async(_0x33b1de,_0x1ae4a5)=>{const _0x3b6ef5=a46_0x5cf192,{whatsappId:_0x1edc46}=_0x33b1de[_0x3b6ef5(0x1c7)];return await(0x0,ImportWhatsAppMessageService_1[_0x3b6ef5(0x1d5)])(_0x1edc46),_0x1ae4a5[_0x3b6ef5(0x1f1)](0xc8)[_0x3b6ef5(0x1f6)]('whatsapp');};function a46_0x1484(_0x4ed535,_0x5b54fa){const _0x415e1b=a46_0x1c56();return a46_0x1484=function(_0x38b5a9,_0xb7f261){_0x38b5a9=_0x38b5a9-0x1c2;let _0x1c5696=_0x415e1b[_0x38b5a9];return _0x1c5696;},a46_0x1484(_0x4ed535,_0x5b54fa);}exports[a46_0x5cf192(0x1ee)]=closedTickets;const index=async(_0x40a4b8,_0x1ea1ab)=>{const _0x16c7ab=a46_0x5cf192,{companyId:_0x1d8212}=_0x40a4b8[_0x16c7ab(0x1d6)],{session:_0x4310bf}=_0x40a4b8[_0x16c7ab(0x1cd)],_0x2b68c2=await(0x0,ListWhatsAppsService_1[_0x16c7ab(0x1d0)])({'companyId':_0x1d8212,'session':_0x4310bf});return _0x1ea1ab[_0x16c7ab(0x1f1)](0xc8)[_0x16c7ab(0x1f6)](_0x2b68c2);};exports[a46_0x5cf192(0x1f8)]=index;const store=async(_0x345dd8,_0x962997)=>{const _0x1af7c2=a46_0x5cf192,{name:_0x2d75ab,status:_0x73e8b4,isDefault:_0x28ed6a,greetingMessage:_0x27803f,complationMessage:_0xe39b78,outOfHoursMessage:_0xd2c966,queueIds:_0x11ae05,token:_0x5f3acf,allowGroup:_0x1cb751,timeSendQueue:_0x4bf7d5,sendIdQueue:_0x4fa138,promptId:_0x11c6c8,maxUseBotQueues:_0x2cbde0,timeUseBotQueues:_0x36f2b1,expiresTicket:_0x2bba89,expiresInactiveMessage:_0x446ce8,importOldMessages:_0x1b8038,importRecentMessages:_0x210e57,closedTicketsPostImported:_0x400bfd,importOldMessagesGroups:_0x1102bf}=_0x345dd8['body'],{companyId:_0x237597}=_0x345dd8[_0x1af7c2(0x1d6)],{whatsapp:_0x1d4ecf,oldDefaultWhatsapp:_0x5308ef}=await(0x0,CreateWhatsAppService_1[_0x1af7c2(0x1d0)])({'name':_0x2d75ab,'status':_0x73e8b4,'isDefault':_0x28ed6a,'greetingMessage':_0x27803f,'complationMessage':_0xe39b78,'outOfHoursMessage':_0xd2c966,'queueIds':_0x11ae05,'companyId':_0x237597,'token':_0x5f3acf,'timeSendQueue':_0x4bf7d5,'sendIdQueue':_0x4fa138,'promptId':_0x11c6c8,'maxUseBotQueues':_0x2cbde0,'timeUseBotQueues':_0x36f2b1,'expiresTicket':_0x2bba89,'expiresInactiveMessage':_0x446ce8,'allowGroup':_0x1cb751,'importOldMessages':_0x1b8038,'importRecentMessages':_0x210e57,'closedTicketsPostImported':_0x400bfd,'importOldMessagesGroups':_0x1102bf});(0x0,StartWhatsAppSession_1[_0x1af7c2(0x1e4)])(_0x1d4ecf,_0x237597);const _0x1b1ae0=(0x0,socket_1[_0x1af7c2(0x1ec)])();return _0x1b1ae0['to'](_0x1af7c2(0x1d4)+_0x237597+_0x1af7c2(0x1c2))[_0x1af7c2(0x1ce)]('company-'+_0x237597+_0x1af7c2(0x1eb),{'action':_0x1af7c2(0x1f5),'whatsapp':_0x1d4ecf}),_0x5308ef&&_0x1b1ae0['to'](_0x1af7c2(0x1d4)+_0x237597+_0x1af7c2(0x1c2))[_0x1af7c2(0x1ce)](_0x1af7c2(0x1d4)+_0x237597+_0x1af7c2(0x1eb),{'action':_0x1af7c2(0x1f5),'whatsapp':_0x5308ef}),_0x962997[_0x1af7c2(0x1f1)](0xc8)[_0x1af7c2(0x1f6)](_0x1d4ecf);};exports['store']=store;const show=async(_0x465c30,_0x55d5f2)=>{const _0x20e4d0=a46_0x5cf192,{whatsappId:_0x4c59ba}=_0x465c30['params'],{companyId:_0x1436fc}=_0x465c30[_0x20e4d0(0x1d6)],{session:_0x2a76c7}=_0x465c30[_0x20e4d0(0x1cd)],_0x119d85=await(0x0,ShowWhatsAppService_1['default'])(_0x4c59ba,_0x1436fc,_0x2a76c7);return _0x55d5f2[_0x20e4d0(0x1f1)](0xc8)[_0x20e4d0(0x1f6)](_0x119d85);};exports[a46_0x5cf192(0x1fb)]=show;const getAllConnections=async(_0x31edf6,_0xcd1df9)=>{const _0x2a8627=a46_0x5cf192;try{const _0x2fc22e=await(0x0,FindAllCompaniesService_1[_0x2a8627(0x1d0)])();if(!_0x2fc22e||_0x2fc22e['length']===0x0)return _0xcd1df9[_0x2a8627(0x1f1)](0x194)[_0x2a8627(0x1f6)]({'error':'No\x20companies\x20found'});const _0x5d679e=[];for(const _0x55639f of _0x2fc22e){if(typeof _0x55639f['id']!==_0x2a8627(0x1c9))continue;const _0x26929c=await Whatsapp_1[_0x2a8627(0x1d0)]['findAll']({'where':{'companyId':_0x55639f['id']}});_0x5d679e[_0x2a8627(0x1d1)](..._0x26929c);}return _0xcd1df9[_0x2a8627(0x1f1)](0xc8)[_0x2a8627(0x1f6)](_0x5d679e);}catch(_0x35d493){return console[_0x2a8627(0x1d3)](_0x35d493),_0xcd1df9['status'](0x1f4)[_0x2a8627(0x1f6)]({'error':_0x2a8627(0x1ef)});}};exports['getAllConnections']=getAllConnections;const update=async(_0x346c88,_0x1064e0)=>{const _0x1cfb5f=a46_0x5cf192,{whatsappId:_0x4432b1}=_0x346c88[_0x1cfb5f(0x1c7)],_0x15e2e0=_0x346c88[_0x1cfb5f(0x1f3)],{companyId:_0x16ed13}=_0x346c88[_0x1cfb5f(0x1d6)],{whatsapp:_0x46d970,oldDefaultWhatsapp:_0x556913}=await(0x0,UpdateWhatsAppService_1[_0x1cfb5f(0x1d0)])({'whatsappData':_0x15e2e0,'whatsappId':_0x4432b1,'companyId':_0x16ed13}),_0x86468=(0x0,socket_1[_0x1cfb5f(0x1ec)])();return _0x86468['to'](_0x1cfb5f(0x1d4)+_0x16ed13+'-mainchannel')['emit'](_0x1cfb5f(0x1d4)+_0x16ed13+_0x1cfb5f(0x1eb),{'action':_0x1cfb5f(0x1f5),'whatsapp':_0x46d970}),_0x556913&&_0x86468['to'](_0x1cfb5f(0x1d4)+_0x16ed13+_0x1cfb5f(0x1c2))['emit'](_0x1cfb5f(0x1d4)+_0x16ed13+_0x1cfb5f(0x1eb),{'action':_0x1cfb5f(0x1f5),'whatsapp':_0x556913}),_0x1064e0['status'](0xc8)[_0x1cfb5f(0x1f6)](_0x46d970);};exports[a46_0x5cf192(0x1f5)]=update;const remove=async(_0x5c2810,_0x19e0bf)=>{const _0x3e996c=a46_0x5cf192,{whatsappId:_0x2672be}=_0x5c2810[_0x3e996c(0x1c7)],{companyId:_0x2485ab}=_0x5c2810[_0x3e996c(0x1d6)],_0x29cc21=await(0x0,ShowWhatsAppService_1['default'])(_0x2672be,_0x2485ab),_0x518a99=await _0x29cc21[_0x3e996c(0x1da)](_0x3e996c(0x1f2),{'where':{'status':{[sequelize_1['Op']['or']]:['open',_0x3e996c(0x1d8)]}}});if(_0x518a99[_0x3e996c(0x1df)]>0x0)throw new AppError_1[(_0x3e996c(0x1d0))](_0x3e996c(0x1ed));await(0x0,DeleteWhatsAppService_1[_0x3e996c(0x1d0)])(_0x2672be),await(0x0,wbot_1['removeWbot'])(+_0x2672be);const _0x301765=(0x0,socket_1['getIO'])();return _0x301765['to'](_0x3e996c(0x1d4)+_0x2485ab+_0x3e996c(0x1c2))[_0x3e996c(0x1ce)](_0x3e996c(0x1d4)+_0x2485ab+_0x3e996c(0x1eb),{'action':'delete','whatsappId':+_0x2672be}),_0x19e0bf['status'](0xc8)['json']({'message':_0x3e996c(0x1cc)});};exports['remove']=remove;const restart=async(_0x5976db,_0x4894d9)=>{const _0x50a172=a46_0x5cf192,{companyId:_0x4f9d1c,profile:_0x2808e8}=_0x5976db[_0x50a172(0x1d6)];if(_0x2808e8!=='admin')throw new AppError_1[(_0x50a172(0x1d0))](_0x50a172(0x1fd),0x193);return await(0x0,wbot_1[_0x50a172(0x1db)])(_0x4f9d1c),_0x4894d9[_0x50a172(0x1f1)](0xc8)[_0x50a172(0x1f6)]({'message':_0x50a172(0x1c4)});};function a46_0x1c56(){const _0x1f461c=['StartWhatsAppSession','(((.+)+)+)+$','../services/WhatsappService/ListWhatsAppsService','../services/WhatsappService/CreateWhatsAppService','../services/WbotServices/StartWhatsAppSession','2108584YpOmDp','search','-whatsapp','getIO','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','closedTickets','Failed\x20to\x20fetch\x20connections','175821GjdJya','status','tickets','body','__esModule','update','json','toString','index','restart','../services/WhatsappService/UpdateWhatsAppService','show','store','ERR_NO_PERMISSION','-mainchannel','4386744lEWKlE','Whatsapp\x20restart.','../services/WhatsappService/ShowWhatsAppService','../libs/wbot','params','35sEDtOG','number','../libs/socket','sequelize','Whatsapp\x20deleted.','query','emit','338548LcfiBI','default','push','1221FJNODm','error','company-','closeImportedTickets','user','5283670rbZIxI','pending','../services/WhatsappService/ImportWhatsAppMessageService','$get','restartWbot','../models/Whatsapp','remove','getAllConnections','length','constructor','393038NUEygv','../services/CompanyService/FindAllCompaniesService','apply'];a46_0x1c56=function(){return _0x1f461c;};return a46_0x1c56();}exports[a46_0x5cf192(0x1f9)]=restart;