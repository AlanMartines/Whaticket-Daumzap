const a46_0x44de32=a46_0x2edf;(function(_0x3056c8,_0x348bc8){const _0x24a528=a46_0x2edf,_0x1f6acd=_0x3056c8();while(!![]){try{const _0x443ee0=parseInt(_0x24a528(0xa5))/0x1+parseInt(_0x24a528(0x7e))/0x2+parseInt(_0x24a528(0x8e))/0x3*(parseInt(_0x24a528(0xb8))/0x4)+-parseInt(_0x24a528(0x88))/0x5+-parseInt(_0x24a528(0xb2))/0x6+-parseInt(_0x24a528(0x7d))/0x7*(-parseInt(_0x24a528(0x9c))/0x8)+-parseInt(_0x24a528(0x9f))/0x9*(parseInt(_0x24a528(0x85))/0xa);if(_0x443ee0===_0x348bc8)break;else _0x1f6acd['push'](_0x1f6acd['shift']());}catch(_0x34bd65){_0x1f6acd['push'](_0x1f6acd['shift']());}}}(a46_0xe709,0x463ed));const a46_0x8bde77=(function(){let _0x2e1257=!![];return function(_0x29c761,_0x5a0900){const _0x7298ec=_0x2e1257?function(){const _0x46e4ab=a46_0x2edf;if(_0x5a0900){const _0x146c47=_0x5a0900[_0x46e4ab(0x94)](_0x29c761,arguments);return _0x5a0900=null,_0x146c47;}}:function(){};return _0x2e1257=![],_0x7298ec;};}()),a46_0x2710a2=a46_0x8bde77(this,function(){const _0x3960fe=a46_0x2edf;return a46_0x2710a2[_0x3960fe(0xb0)]()[_0x3960fe(0xa6)](_0x3960fe(0x7c))[_0x3960fe(0xb0)]()['constructor'](a46_0x2710a2)[_0x3960fe(0xa6)](_0x3960fe(0x7c));});a46_0x2710a2();'use strict';var __importDefault=this&&this[a46_0x44de32(0xa2)]||function(_0x46eed9){const _0x402c18=a46_0x44de32;return _0x46eed9&&_0x46eed9[_0x402c18(0xa3)]?_0x46eed9:{'default':_0x46eed9};};Object[a46_0x44de32(0x83)](exports,a46_0x44de32(0xa3),{'value':!![]}),exports[a46_0x44de32(0xa4)]=exports[a46_0x44de32(0x8a)]=exports[a46_0x44de32(0xad)]=exports[a46_0x44de32(0x99)]=exports[a46_0x44de32(0xa8)]=exports[a46_0x44de32(0xa1)]=exports[a46_0x44de32(0x86)]=exports[a46_0x44de32(0x91)]=void 0x0;const socket_1=require(a46_0x44de32(0x9d)),wbot_1=require('../libs/wbot'),StartWhatsAppSession_1=require(a46_0x44de32(0xa0)),FindAllCompaniesService_1=__importDefault(require(a46_0x44de32(0xb9))),CreateWhatsAppService_1=__importDefault(require('../services/WhatsappService/CreateWhatsAppService')),DeleteWhatsAppService_1=__importDefault(require(a46_0x44de32(0xb3))),ListWhatsAppsService_1=__importDefault(require('../services/WhatsappService/ListWhatsAppsService')),ShowWhatsAppService_1=__importDefault(require(a46_0x44de32(0xac))),UpdateWhatsAppService_1=__importDefault(require(a46_0x44de32(0xa9))),AppError_1=__importDefault(require('../errors/AppError')),sequelize_1=require(a46_0x44de32(0x9e)),ImportWhatsAppMessageService_1=require(a46_0x44de32(0x87)),Whatsapp_1=__importDefault(require(a46_0x44de32(0xa7))),closedTickets=async(_0x365845,_0x2ca336)=>{const _0x345b91=a46_0x44de32,{whatsappId:_0x2feba9}=_0x365845['params'];return await(0x0,ImportWhatsAppMessageService_1['closeImportedTickets'])(_0x2feba9),_0x2ca336[_0x345b91(0x92)](0xc8)[_0x345b91(0x9a)]('whatsapp');};exports[a46_0x44de32(0x91)]=closedTickets;const index=async(_0x467028,_0xa8df16)=>{const _0x5ea627=a46_0x44de32,{companyId:_0x1741be}=_0x467028[_0x5ea627(0x9b)],{session:_0x3b92bb}=_0x467028[_0x5ea627(0xb5)],_0x538d21=await(0x0,ListWhatsAppsService_1[_0x5ea627(0x90)])({'companyId':_0x1741be,'session':_0x3b92bb});return _0xa8df16['status'](0xc8)['json'](_0x538d21);};exports['index']=index;const store=async(_0x56f55,_0x3de13f)=>{const _0x149189=a46_0x44de32,{name:_0x31ab95,status:_0x28e7c7,isDefault:_0x153aef,greetingMessage:_0x296983,complationMessage:_0x52cf2f,outOfHoursMessage:_0x1e5b65,queueIds:_0x54a4e8,token:_0x53dfdb,allowGroup:_0x1d9930,timeSendQueue:_0x4ee432,sendIdQueue:_0x2de80f,promptId:_0x55af2c,maxUseBotQueues:_0x392477,timeUseBotQueues:_0x152dac,expiresTicket:_0xbd0482,expiresInactiveMessage:_0x3854d0,importOldMessages:_0x5db77c,importRecentMessages:_0x5d01a9,closedTicketsPostImported:_0x2afc20,importOldMessagesGroups:_0x7dffab}=_0x56f55['body'],{companyId:_0x27464a}=_0x56f55[_0x149189(0x9b)],{whatsapp:_0xa7d7b7,oldDefaultWhatsapp:_0x30d466}=await(0x0,CreateWhatsAppService_1[_0x149189(0x90)])({'name':_0x31ab95,'status':_0x28e7c7,'isDefault':_0x153aef,'greetingMessage':_0x296983,'complationMessage':_0x52cf2f,'outOfHoursMessage':_0x1e5b65,'queueIds':_0x54a4e8,'companyId':_0x27464a,'token':_0x53dfdb,'timeSendQueue':_0x4ee432,'sendIdQueue':_0x2de80f,'promptId':_0x55af2c,'maxUseBotQueues':_0x392477,'timeUseBotQueues':_0x152dac,'expiresTicket':_0xbd0482,'expiresInactiveMessage':_0x3854d0,'allowGroup':_0x1d9930,'importOldMessages':_0x5db77c,'importRecentMessages':_0x5d01a9,'closedTicketsPostImported':_0x2afc20,'importOldMessagesGroups':_0x7dffab});(0x0,StartWhatsAppSession_1[_0x149189(0x8d)])(_0xa7d7b7,_0x27464a);const _0x44fa0e=(0x0,socket_1[_0x149189(0xaf)])();return _0x44fa0e['to'](_0x149189(0x8c)+_0x27464a+_0x149189(0x81))[_0x149189(0xb4)]('company-'+_0x27464a+_0x149189(0xb1),{'action':'update','whatsapp':_0xa7d7b7}),_0x30d466&&_0x44fa0e['to']('company-'+_0x27464a+'-mainchannel')[_0x149189(0xb4)](_0x149189(0x8c)+_0x27464a+_0x149189(0xb1),{'action':'update','whatsapp':_0x30d466}),_0x3de13f[_0x149189(0x92)](0xc8)[_0x149189(0x9a)](_0xa7d7b7);};exports[a46_0x44de32(0xa1)]=store;const show=async(_0x40c467,_0x1f307f)=>{const _0x171abb=a46_0x44de32,{whatsappId:_0x2f9fe9}=_0x40c467[_0x171abb(0x95)],{companyId:_0x5b267f}=_0x40c467[_0x171abb(0x9b)],{session:_0x3987e1}=_0x40c467['query'],_0x699ec9=await(0x0,ShowWhatsAppService_1[_0x171abb(0x90)])(_0x2f9fe9,_0x5b267f,_0x3987e1);return _0x1f307f[_0x171abb(0x92)](0xc8)[_0x171abb(0x9a)](_0x699ec9);};exports[a46_0x44de32(0xa8)]=show;const getAllConnections=async(_0x30d675,_0xb93142)=>{const _0x5ba37b=a46_0x44de32;try{const _0x37cb26=await(0x0,FindAllCompaniesService_1[_0x5ba37b(0x90)])();if(!_0x37cb26||_0x37cb26[_0x5ba37b(0xb6)]===0x0)return _0xb93142[_0x5ba37b(0x92)](0x194)[_0x5ba37b(0x9a)]({'error':_0x5ba37b(0x80)});const _0x3ac317=[];for(const _0x1844b2 of _0x37cb26){if(typeof _0x1844b2['id']!==_0x5ba37b(0x98))continue;const _0x4e4d80=await Whatsapp_1[_0x5ba37b(0x90)]['findAll']({'where':{'companyId':_0x1844b2['id']}});_0x3ac317[_0x5ba37b(0x84)](..._0x4e4d80);}return _0xb93142[_0x5ba37b(0x92)](0xc8)[_0x5ba37b(0x9a)](_0x3ac317);}catch(_0x223dd1){return console['error'](_0x223dd1),_0xb93142['status'](0x1f4)['json']({'error':_0x5ba37b(0x93)});}};exports[a46_0x44de32(0x99)]=getAllConnections;const update=async(_0x8454b4,_0x553aab)=>{const _0x40a4a8=a46_0x44de32,{whatsappId:_0x224f33}=_0x8454b4[_0x40a4a8(0x95)],_0x1e83fe=_0x8454b4['body'],{companyId:_0x50e70e}=_0x8454b4['user'],{whatsapp:_0x35410b,oldDefaultWhatsapp:_0xe4a197}=await(0x0,UpdateWhatsAppService_1[_0x40a4a8(0x90)])({'whatsappData':_0x1e83fe,'whatsappId':_0x224f33,'companyId':_0x50e70e}),_0x12cfb3=(0x0,socket_1[_0x40a4a8(0xaf)])();return _0x12cfb3['to'](_0x40a4a8(0x8c)+_0x50e70e+'-mainchannel')[_0x40a4a8(0xb4)](_0x40a4a8(0x8c)+_0x50e70e+_0x40a4a8(0xb1),{'action':_0x40a4a8(0xad),'whatsapp':_0x35410b}),_0xe4a197&&_0x12cfb3['to'](_0x40a4a8(0x8c)+_0x50e70e+_0x40a4a8(0x81))[_0x40a4a8(0xb4)](_0x40a4a8(0x8c)+_0x50e70e+_0x40a4a8(0xb1),{'action':_0x40a4a8(0xad),'whatsapp':_0xe4a197}),_0x553aab[_0x40a4a8(0x92)](0xc8)[_0x40a4a8(0x9a)](_0x35410b);};function a46_0x2edf(_0xe01a60,_0x4f4430){const _0x29b257=a46_0xe709();return a46_0x2edf=function(_0x2710a2,_0x8bde77){_0x2710a2=_0x2710a2-0x7c;let _0xe70952=_0x29b257[_0x2710a2];return _0xe70952;},a46_0x2edf(_0xe01a60,_0x4f4430);}exports[a46_0x44de32(0xad)]=update;const remove=async(_0xfd304,_0x221e29)=>{const _0x1043e8=a46_0x44de32,{whatsappId:_0x3bbcf1}=_0xfd304[_0x1043e8(0x95)],{companyId:_0x2453c1}=_0xfd304[_0x1043e8(0x9b)],_0x1153ee=await(0x0,ShowWhatsAppService_1[_0x1043e8(0x90)])(_0x3bbcf1,_0x2453c1),_0x4b9bd8=await _0x1153ee[_0x1043e8(0x96)](_0x1043e8(0x7f),{'where':{'status':{[sequelize_1['Op']['or']]:[_0x1043e8(0x8b),_0x1043e8(0xab)]}}});if(_0x4b9bd8[_0x1043e8(0xb6)]>0x0)throw new AppError_1[(_0x1043e8(0x90))](_0x1043e8(0x82));await(0x0,DeleteWhatsAppService_1[_0x1043e8(0x90)])(_0x3bbcf1),await(0x0,wbot_1[_0x1043e8(0x89)])(+_0x3bbcf1);const _0x1e6c0e=(0x0,socket_1[_0x1043e8(0xaf)])();return _0x1e6c0e['to'](_0x1043e8(0x8c)+_0x2453c1+_0x1043e8(0x81))['emit'](_0x1043e8(0x8c)+_0x2453c1+_0x1043e8(0xb1),{'action':_0x1043e8(0x97),'whatsappId':+_0x3bbcf1}),_0x221e29[_0x1043e8(0x92)](0xc8)[_0x1043e8(0x9a)]({'message':_0x1043e8(0xb7)});};exports['remove']=remove;const restart=async(_0x4bd45d,_0x35d683)=>{const _0x3a1c5b=a46_0x44de32,{companyId:_0x2f75d2,profile:_0x44a081}=_0x4bd45d[_0x3a1c5b(0x9b)];if(_0x44a081!==_0x3a1c5b(0x8f))throw new AppError_1[(_0x3a1c5b(0x90))]('ERR_NO_PERMISSION',0x193);return await(0x0,wbot_1[_0x3a1c5b(0xae)])(_0x2f75d2),_0x35d683[_0x3a1c5b(0x92)](0xc8)[_0x3a1c5b(0x9a)]({'message':_0x3a1c5b(0xaa)});};function a46_0xe709(){const _0x2b453d=['closedTickets','status','Failed\x20to\x20fetch\x20connections','apply','params','$get','delete','number','getAllConnections','json','user','1854616cypxoU','../libs/socket','sequelize','36jppjIX','../services/WbotServices/StartWhatsAppSession','store','__importDefault','__esModule','restart','343819evpCQj','search','../models/Whatsapp','show','../services/WhatsappService/UpdateWhatsAppService','Whatsapp\x20restart.','pending','../services/WhatsappService/ShowWhatsAppService','update','restartWbot','getIO','toString','-whatsapp','1607310NdPwOt','../services/WhatsappService/DeleteWhatsAppService','emit','query','length','Whatsapp\x20deleted.','2220640DEaZlJ','../services/CompanyService/FindAllCompaniesService','(((.+)+)+)+$','7sQEhLi','944962QtBNqo','tickets','No\x20companies\x20found','-mainchannel','Não\x20é\x20possível\x20remover\x20conexão\x20que\x20contém\x20tickets\x20não\x20resolvidos','defineProperty','push','2472170bGvRjh','index','../services/WhatsappService/ImportWhatsAppMessageService','294045UlkilA','removeWbot','remove','open','company-','StartWhatsAppSession','3PNVYSN','admin','default'];a46_0xe709=function(){return _0x2b453d;};return a46_0xe709();}exports[a46_0x44de32(0xa4)]=restart;