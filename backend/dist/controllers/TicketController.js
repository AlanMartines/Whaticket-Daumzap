const a40_0x2dfae2=a40_0x47c3;(function(_0x3b19c0,_0x31ac76){const _0x51f6c7=a40_0x47c3,_0x4f9f6c=_0x3b19c0();while(!![]){try{const _0x84752a=parseInt(_0x51f6c7(0xfe))/0x1*(parseInt(_0x51f6c7(0xd6))/0x2)+-parseInt(_0x51f6c7(0xdc))/0x3+parseInt(_0x51f6c7(0xf6))/0x4*(parseInt(_0x51f6c7(0xcf))/0x5)+-parseInt(_0x51f6c7(0xed))/0x6+parseInt(_0x51f6c7(0xf1))/0x7+-parseInt(_0x51f6c7(0x101))/0x8*(parseInt(_0x51f6c7(0x10a))/0x9)+parseInt(_0x51f6c7(0xdf))/0xa;if(_0x84752a===_0x31ac76)break;else _0x4f9f6c['push'](_0x4f9f6c['shift']());}catch(_0x452a48){_0x4f9f6c['push'](_0x4f9f6c['shift']());}}}(a40_0x33af,0x3c6bc));const a40_0x1d22f5=(function(){let _0x5f92ef=!![];return function(_0xc86af5,_0x65fc7d){const _0x39bfbc=_0x5f92ef?function(){if(_0x65fc7d){const _0xa975f8=_0x65fc7d['apply'](_0xc86af5,arguments);return _0x65fc7d=null,_0xa975f8;}}:function(){};return _0x5f92ef=![],_0x39bfbc;};}()),a40_0x327c9a=a40_0x1d22f5(this,function(){const _0x2eca16=a40_0x47c3;return a40_0x327c9a[_0x2eca16(0xd7)]()[_0x2eca16(0x109)]('(((.+)+)+)+$')['toString']()[_0x2eca16(0xe7)](a40_0x327c9a)[_0x2eca16(0x109)](_0x2eca16(0xce));});a40_0x327c9a();'use strict';var __importDefault=this&&this[a40_0x2dfae2(0x107)]||function(_0x33a901){return _0x33a901&&_0x33a901['__esModule']?_0x33a901:{'default':_0x33a901};};function a40_0x33af(){const _0x394f17=['userId','../models/Ticket','emit','queue-','constructor','ticket\x20deleted','showFromUUID','__esModule','remove','-ticket','1144140jfcxgE','async-mutex','getIO','-notification','931168lXkEpP','runExclusive','kanban','store','params','6964OQsbMG','../services/TicketServices/ShowTicketService','queueId','../services/TicketServices/ListTicketsServiceKanban','../models/User','status','query','show','15rJsMXb','open','company-','32Gktijj','tokenData','findByPk','index','defineProperty','body','__importDefault','../services/TicketServices/CreateTicketService','search','119907syuLQL','Mutex','default','(((.+)+)+)+$','135bKedpU','../libs/socket','update','parse','delete','../services/TicketServices/ShowTicketFromUUIDService','count','35444psudWt','toString','user','../services/TicketServices/ListTicketsService','json','../services/TicketServices/UpdateTicketService','1242642ntmWMT','findAll','closed','4598190UQSbyj','closeAll','../services/TicketServices/DeleteTicketService','companyId'];a40_0x33af=function(){return _0x394f17;};return a40_0x33af();}Object[a40_0x2dfae2(0x105)](exports,a40_0x2dfae2(0xea),{'value':!![]}),exports['remove']=exports[a40_0x2dfae2(0xd1)]=exports['closeAll']=exports[a40_0x2dfae2(0xe9)]=exports[a40_0x2dfae2(0xfd)]=exports[a40_0x2dfae2(0xf3)]=exports[a40_0x2dfae2(0xf4)]=exports['index']=void 0x0;const socket_1=require(a40_0x2dfae2(0xd0)),Ticket_1=__importDefault(require(a40_0x2dfae2(0xe4))),CreateTicketService_1=__importDefault(require(a40_0x2dfae2(0x108))),DeleteTicketService_1=__importDefault(require(a40_0x2dfae2(0xe1))),ListTicketsService_1=__importDefault(require(a40_0x2dfae2(0xd9))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x2dfae2(0xd4))),ShowTicketService_1=__importDefault(require(a40_0x2dfae2(0xf7))),UpdateTicketService_1=__importDefault(require(a40_0x2dfae2(0xdb))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x2dfae2(0xf9))),async_mutex_1=require(a40_0x2dfae2(0xee)),User_1=__importDefault(require(a40_0x2dfae2(0xfa))),index=async(_0x55b560,_0x48b76b)=>{const _0x49461d=a40_0x2dfae2,{pageNumber:_0x1d8f1f,status:_0x1510aa,date:_0x8876a4,updatedAt:_0x33bbef,searchParam:_0x33b5fc,showAll:_0x569cec,queueIds:_0x50fced,tags:_0xafb01b,users:_0x49c333,withUnreadMessages:_0x1729e7}=_0x55b560['query'],_0x2b40fb=_0x55b560['user']['id'],{companyId:_0x2a23d4}=_0x55b560[_0x49461d(0xd8)];let _0x86efe0=[],_0x44e449=[],_0x118506=[];_0x50fced&&(_0x86efe0=JSON[_0x49461d(0xd2)](_0x50fced));_0xafb01b&&(_0x44e449=JSON[_0x49461d(0xd2)](_0xafb01b));_0x49c333&&(_0x118506=JSON['parse'](_0x49c333));const _0x26b336=_0x55b560[_0x49461d(0xfc)]['startDate'],_0x136509=_0x55b560[_0x49461d(0xfc)]['endDate'],{tickets:_0x4a2a63,count:_0x149805,hasMore:_0x133014}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x33b5fc,'tags':_0x44e449,'users':_0x118506,'pageNumber':_0x1d8f1f,'status':_0x1510aa,'date':_0x8876a4,'updatedAt':_0x33bbef,'showAll':_0x569cec,'userId':_0x2b40fb,'queueIds':_0x86efe0,'withUnreadMessages':_0x1729e7,'companyId':_0x2a23d4,'startDate':_0x26b336,'endDate':_0x136509});return _0x48b76b[_0x49461d(0xfb)](0xc8)[_0x49461d(0xda)]({'tickets':_0x4a2a63,'count':_0x149805,'hasMore':_0x133014});};exports[a40_0x2dfae2(0x104)]=index;const store=async(_0x28b473,_0x1780ee)=>{const _0x33c86a=a40_0x2dfae2,{contactId:_0xfa3b50,status:_0x5096fc,userId:_0x11add6,queueId:_0x1d3fe3,whatsappId:_0x23d2b4}=_0x28b473['body'],{companyId:_0x470ee9,id:_0x144943}=_0x28b473[_0x33c86a(0xd8)],_0xace62d=await Ticket_1[_0x33c86a(0xcd)]['count']({'where':{'userId':_0x144943,'status':_0x33c86a(0xff),'companyId':_0x470ee9}}),{limitAttendance:_0x40128f,name:_0x2cc65b}=await User_1[_0x33c86a(0xcd)][_0x33c86a(0x103)](_0x144943);if(_0xace62d>=_0x40128f){}const _0x5c0724=await(0x0,CreateTicketService_1[_0x33c86a(0xcd)])({'contactId':_0xfa3b50,'status':_0x5096fc,'userId':_0x11add6,'companyId':_0x470ee9,'queueId':_0x1d3fe3,'whatsappId':_0x23d2b4}),_0x436e46=(0x0,socket_1[_0x33c86a(0xef)])();return _0x436e46['to'](_0x33c86a(0x100)+_0x5c0724[_0x33c86a(0xe2)]+'-'+_0x5c0724[_0x33c86a(0xfb)])['to'](_0x33c86a(0xe6)+_0x5c0724[_0x33c86a(0xf8)]+'-'+_0x5c0724[_0x33c86a(0xfb)])[_0x33c86a(0xe5)](_0x33c86a(0x100)+_0x470ee9+_0x33c86a(0xec),{'action':_0x33c86a(0xd1),'ticket':_0x5c0724}),_0x1780ee[_0x33c86a(0xfb)](0xc8)[_0x33c86a(0xda)](_0x5c0724);};exports[a40_0x2dfae2(0xf4)]=store;const kanban=async(_0x5bfba0,_0x54c950)=>{const _0x2e80eb=a40_0x2dfae2,{pageNumber:_0x464737,status:_0x4528fc,date:_0x51cf37,updatedAt:_0x2dccba,searchParam:_0xb7bf14,showAll:_0x1627d2,queueIds:_0x8c08f7,tags:_0x1ccfa3,users:_0x57dcea,withUnreadMessages:_0x42d591}=_0x5bfba0[_0x2e80eb(0xfc)],_0x4c16e0=_0x5bfba0[_0x2e80eb(0xd8)]['id'],{companyId:_0x437354}=_0x5bfba0[_0x2e80eb(0xd8)];let _0x58c810=[],_0x47de9b=[],_0x391bbf=[];_0x8c08f7&&(_0x58c810=JSON[_0x2e80eb(0xd2)](_0x8c08f7));_0x1ccfa3&&(_0x47de9b=JSON[_0x2e80eb(0xd2)](_0x1ccfa3));_0x57dcea&&(_0x391bbf=JSON[_0x2e80eb(0xd2)](_0x57dcea));const {tickets:_0x23ca4f,count:_0x4c3fc2,hasMore:_0x4d05ea}=await(0x0,ListTicketsServiceKanban_1[_0x2e80eb(0xcd)])({'searchParam':_0xb7bf14,'tags':_0x47de9b,'users':_0x391bbf,'pageNumber':_0x464737,'status':_0x4528fc,'date':_0x51cf37,'updatedAt':_0x2dccba,'showAll':_0x1627d2,'userId':_0x4c16e0,'queueIds':_0x58c810,'withUnreadMessages':_0x42d591,'companyId':_0x437354});return _0x54c950[_0x2e80eb(0xfb)](0xc8)['json']({'tickets':_0x23ca4f,'count':_0x4c3fc2,'hasMore':_0x4d05ea});};exports[a40_0x2dfae2(0xf3)]=kanban;const show=async(_0x2c5371,_0x18038d)=>{const _0x66039b=a40_0x2dfae2,{ticketId:_0x5b69fe}=_0x2c5371['params'],{companyId:_0x28a689}=_0x2c5371[_0x66039b(0xd8)],_0x46369c=await(0x0,ShowTicketService_1[_0x66039b(0xcd)])(_0x5b69fe,_0x28a689);return _0x18038d[_0x66039b(0xfb)](0xc8)[_0x66039b(0xda)](_0x46369c);};exports[a40_0x2dfae2(0xfd)]=show;const showFromUUID=async(_0x22812d,_0x1a6056)=>{const _0x132d48=a40_0x2dfae2,{uuid:_0x1117d4}=_0x22812d['params'],_0x4e8701=await(0x0,ShowTicketFromUUIDService_1['default'])(_0x1117d4);return _0x1a6056['status'](0xc8)[_0x132d48(0xda)](_0x4e8701);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x549232,_0x350f19)=>{const _0x289750=a40_0x2dfae2,{companyId:_0x56ed10}=_0x549232[_0x289750(0xd8)];var _0x4fae41=_0x549232['body'][_0x289750(0xfb)],_0x331cab=await Ticket_1[_0x289750(0xcd)][_0x289750(0xdd)]({'where':{'companyId':_0x56ed10,'status':_0x4fae41}});for(const _0x173f1a of _0x331cab){(0x0,UpdateTicketService_1[_0x289750(0xcd)])({'ticketData':{'status':_0x289750(0xde),'userId':_0x173f1a[_0x289750(0xe3)]||null,'queueId':_0x173f1a[_0x289750(0xf8)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x173f1a['id'],'companyId':_0x56ed10});}return _0x350f19[_0x289750(0xfb)](0xc8)['json']({'message':'all\x20tickets\x20closed'});};exports[a40_0x2dfae2(0xe0)]=closeAll;const update=async(_0xcaaf90,_0x40febe)=>{const _0x5e0037=a40_0x2dfae2,{ticketId:_0x30e3d4}=_0xcaaf90['params'],_0x511ec2=_0xcaaf90[_0x5e0037(0x106)],{companyId:_0x4fcca8,id:_0x1e9afe}=_0xcaaf90[_0x5e0037(0xd8)],_0x35efa6=await Ticket_1[_0x5e0037(0xcd)][_0x5e0037(0xd5)]({'where':{'userId':_0x1e9afe,'status':_0x5e0037(0xff),'companyId':_0x4fcca8}}),{limitAttendance:_0x48a604,name:_0xcd5d6}=await User_1[_0x5e0037(0xcd)][_0x5e0037(0x103)](_0x1e9afe);if(_0x511ec2['status']===_0x5e0037(0xff)&&_0x35efa6>=_0x48a604){}const _0x698a36=new async_mutex_1[(_0x5e0037(0xcc))](),{ticket:_0x44e936}=await _0x698a36[_0x5e0037(0xf2)](async()=>{const _0x4f7adf=_0x5e0037;return await(0x0,UpdateTicketService_1[_0x4f7adf(0xcd)])({'ticketData':_0xcaaf90[_0x4f7adf(0x106)],'ticketId':_0x30e3d4,'companyId':_0x4fcca8,'tokenData':_0xcaaf90[_0x4f7adf(0x102)]});});return _0x40febe['status'](0xc8)[_0x5e0037(0xda)](_0x44e936);};function a40_0x47c3(_0x10b88a,_0x50db27){const _0x58faf5=a40_0x33af();return a40_0x47c3=function(_0x327c9a,_0x1d22f5){_0x327c9a=_0x327c9a-0xcc;let _0x33af9a=_0x58faf5[_0x327c9a];return _0x33af9a;},a40_0x47c3(_0x10b88a,_0x50db27);}exports[a40_0x2dfae2(0xd1)]=update;const remove=async(_0x5106ff,_0x289810)=>{const _0x44d504=a40_0x2dfae2,{ticketId:_0xc8f00}=_0x5106ff[_0x44d504(0xf5)],{companyId:_0x8e95c7}=_0x5106ff[_0x44d504(0xd8)];await(0x0,ShowTicketService_1[_0x44d504(0xcd)])(_0xc8f00,_0x8e95c7);const _0x5c5f29=await(0x0,DeleteTicketService_1[_0x44d504(0xcd)])(_0xc8f00),_0x580240=(0x0,socket_1[_0x44d504(0xef)])();return _0x580240['to'](_0x44d504(0x100)+_0x8e95c7+'-'+_0x5c5f29['status'])['to'](_0xc8f00)['to'](_0x44d504(0xe6)+_0x5c5f29[_0x44d504(0xf8)]+_0x44d504(0xf0))['to'](_0x44d504(0xe6)+_0x5c5f29[_0x44d504(0xf8)]+'-'+_0x5c5f29[_0x44d504(0xfb)])['to']('company-'+_0x5c5f29[_0x44d504(0xe2)]+_0x44d504(0xf0))[_0x44d504(0xe5)]('company-'+_0x8e95c7+_0x44d504(0xec),{'action':_0x44d504(0xd3),'ticketId':+_0xc8f00}),_0x289810[_0x44d504(0xfb)](0xc8)[_0x44d504(0xda)]({'message':_0x44d504(0xe8)});};exports[a40_0x2dfae2(0xeb)]=remove;