const a40_0x10c36d=a40_0x400b;(function(_0x3962fa,_0x278e7d){const _0x21db20=a40_0x400b,_0x590069=_0x3962fa();while(!![]){try{const _0x3fdd34=-parseInt(_0x21db20(0xff))/0x1+-parseInt(_0x21db20(0xf2))/0x2*(parseInt(_0x21db20(0xf1))/0x3)+-parseInt(_0x21db20(0x11b))/0x4*(parseInt(_0x21db20(0x101))/0x5)+parseInt(_0x21db20(0x100))/0x6+-parseInt(_0x21db20(0xf3))/0x7+parseInt(_0x21db20(0x119))/0x8+parseInt(_0x21db20(0x11f))/0x9;if(_0x3fdd34===_0x278e7d)break;else _0x590069['push'](_0x590069['shift']());}catch(_0x4d86a6){_0x590069['push'](_0x590069['shift']());}}}(a40_0x360f,0xf36a2));const a40_0x5ea4e0=(function(){let _0x387dbc=!![];return function(_0x13b123,_0x5d1eb7){const _0xcf83b2=_0x387dbc?function(){if(_0x5d1eb7){const _0x285615=_0x5d1eb7['apply'](_0x13b123,arguments);return _0x5d1eb7=null,_0x285615;}}:function(){};return _0x387dbc=![],_0xcf83b2;};}()),a40_0x21a5f0=a40_0x5ea4e0(this,function(){const _0x4b0534=a40_0x400b;return a40_0x21a5f0['toString']()[_0x4b0534(0xea)](_0x4b0534(0xfa))[_0x4b0534(0xf9)]()[_0x4b0534(0x102)](a40_0x21a5f0)[_0x4b0534(0xea)]('(((.+)+)+)+$');});a40_0x21a5f0();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5350a3){const _0x33ae73=a40_0x400b;return _0x5350a3&&_0x5350a3[_0x33ae73(0x114)]?_0x5350a3:{'default':_0x5350a3};};function a40_0x360f(){const _0x2758f6=['../services/TicketServices/UpdateTicketService','update','../services/TicketServices/ListTicketsService','__esModule','delete','params','findAll','../services/TicketServices/DeleteTicketService','9292336nRNsyc','ticket\x20deleted','16UqPxFz','all\x20tickets\x20closed','../services/TicketServices/ShowTicketFromUUIDService','companyId','22539897shByMh','json','Mutex','body','emit','search','getIO','-notification','open','defineProperty','status','remove','3CwMAHq','3483356XDhfpZ','1168069oXUGLE','closeAll','showFromUUID','../services/TicketServices/ShowTicketService','user','parse','toString','(((.+)+)+)+$','queue-','../models/User','default','closed','1444686pWtDff','5640900HHZBzO','319835cywGMR','constructor','kanban','runExclusive','../models/Ticket','async-mutex','store','queueId','query','-ticket','../services/TicketServices/ListTicketsServiceKanban','count','show','index','tokenData','company-'];a40_0x360f=function(){return _0x2758f6;};return a40_0x360f();}Object[a40_0x10c36d(0xee)](exports,a40_0x10c36d(0x114),{'value':!![]}),exports[a40_0x10c36d(0xf0)]=exports['update']=exports[a40_0x10c36d(0xf4)]=exports[a40_0x10c36d(0xf5)]=exports[a40_0x10c36d(0x10d)]=exports[a40_0x10c36d(0x103)]=exports[a40_0x10c36d(0x107)]=exports['index']=void 0x0;const socket_1=require('../libs/socket'),Ticket_1=__importDefault(require(a40_0x10c36d(0x105))),CreateTicketService_1=__importDefault(require('../services/TicketServices/CreateTicketService')),DeleteTicketService_1=__importDefault(require(a40_0x10c36d(0x118))),ListTicketsService_1=__importDefault(require(a40_0x10c36d(0x113))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x10c36d(0x11d))),ShowTicketService_1=__importDefault(require(a40_0x10c36d(0xf6))),UpdateTicketService_1=__importDefault(require(a40_0x10c36d(0x111))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x10c36d(0x10b))),async_mutex_1=require(a40_0x10c36d(0x106)),User_1=__importDefault(require(a40_0x10c36d(0xfc))),index=async(_0x11a8ef,_0x16b0a0)=>{const _0x5c9f39=a40_0x10c36d,{pageNumber:_0x513fb0,status:_0x3e147a,date:_0x24ac02,updatedAt:_0x4a5480,searchParam:_0x398c2c,showAll:_0x543784,queueIds:_0x307e4a,tags:_0x35d894,users:_0x146df1,withUnreadMessages:_0x1ea08c}=_0x11a8ef['query'],_0x2f4f6f=_0x11a8ef[_0x5c9f39(0xf7)]['id'],{companyId:_0x122119}=_0x11a8ef[_0x5c9f39(0xf7)];let _0x4d9b35=[],_0x447cf1=[],_0x4d02c6=[];_0x307e4a&&(_0x4d9b35=JSON[_0x5c9f39(0xf8)](_0x307e4a));_0x35d894&&(_0x447cf1=JSON['parse'](_0x35d894));_0x146df1&&(_0x4d02c6=JSON[_0x5c9f39(0xf8)](_0x146df1));const _0x544479=_0x11a8ef[_0x5c9f39(0x109)]['startDate'],_0x43a61a=_0x11a8ef['query']['endDate'],{tickets:_0x16629a,count:_0x1b550,hasMore:_0x34d549}=await(0x0,ListTicketsService_1[_0x5c9f39(0xfd)])({'searchParam':_0x398c2c,'tags':_0x447cf1,'users':_0x4d02c6,'pageNumber':_0x513fb0,'status':_0x3e147a,'date':_0x24ac02,'updatedAt':_0x4a5480,'showAll':_0x543784,'userId':_0x2f4f6f,'queueIds':_0x4d9b35,'withUnreadMessages':_0x1ea08c,'companyId':_0x122119,'startDate':_0x544479,'endDate':_0x43a61a});return _0x16b0a0[_0x5c9f39(0xef)](0xc8)[_0x5c9f39(0x120)]({'tickets':_0x16629a,'count':_0x1b550,'hasMore':_0x34d549});};exports[a40_0x10c36d(0x10e)]=index;const store=async(_0x265f7b,_0x195c69)=>{const _0x1c50b6=a40_0x10c36d,{contactId:_0x8f7cbf,status:_0x3c5f47,userId:_0x5f230a,queueId:_0x3e3ef1,whatsappId:_0x18afd3}=_0x265f7b[_0x1c50b6(0x122)],{companyId:_0x346c90,id:_0x16c673}=_0x265f7b['user'],_0x4fef8d=await Ticket_1[_0x1c50b6(0xfd)][_0x1c50b6(0x10c)]({'where':{'userId':_0x16c673,'status':_0x1c50b6(0xed),'companyId':_0x346c90}}),{limitAttendance:_0x5e1964,name:_0x2167ad}=await User_1[_0x1c50b6(0xfd)]['findByPk'](_0x16c673);if(_0x4fef8d>=_0x5e1964){}const _0x390b58=await(0x0,CreateTicketService_1[_0x1c50b6(0xfd)])({'contactId':_0x8f7cbf,'status':_0x3c5f47,'userId':_0x5f230a,'companyId':_0x346c90,'queueId':_0x3e3ef1,'whatsappId':_0x18afd3}),_0x3644d0=(0x0,socket_1[_0x1c50b6(0xeb)])();return _0x3644d0['to'](_0x1c50b6(0x110)+_0x390b58[_0x1c50b6(0x11e)]+'-'+_0x390b58[_0x1c50b6(0xef)])['to'](_0x1c50b6(0xfb)+_0x390b58[_0x1c50b6(0x108)]+'-'+_0x390b58[_0x1c50b6(0xef)])[_0x1c50b6(0x123)](_0x1c50b6(0x110)+_0x346c90+'-ticket',{'action':_0x1c50b6(0x112),'ticket':_0x390b58}),_0x195c69[_0x1c50b6(0xef)](0xc8)[_0x1c50b6(0x120)](_0x390b58);};exports[a40_0x10c36d(0x107)]=store;const kanban=async(_0x2637a5,_0x31a158)=>{const _0x14d6b5=a40_0x10c36d,{pageNumber:_0x42f673,status:_0xaf74a2,date:_0x1f7bf4,updatedAt:_0x3cf340,searchParam:_0x57e13d,showAll:_0x29344b,queueIds:_0x5a9d75,tags:_0x4e6f3f,users:_0x317628,withUnreadMessages:_0x5722f7}=_0x2637a5[_0x14d6b5(0x109)],_0x47bece=_0x2637a5['user']['id'],{companyId:_0x1adca9}=_0x2637a5[_0x14d6b5(0xf7)];let _0x27a11b=[],_0x638f5c=[],_0x509039=[];_0x5a9d75&&(_0x27a11b=JSON[_0x14d6b5(0xf8)](_0x5a9d75));_0x4e6f3f&&(_0x638f5c=JSON[_0x14d6b5(0xf8)](_0x4e6f3f));_0x317628&&(_0x509039=JSON['parse'](_0x317628));const {tickets:_0x2551b9,count:_0x674561,hasMore:_0x5301a7}=await(0x0,ListTicketsServiceKanban_1[_0x14d6b5(0xfd)])({'searchParam':_0x57e13d,'tags':_0x638f5c,'users':_0x509039,'pageNumber':_0x42f673,'status':_0xaf74a2,'date':_0x1f7bf4,'updatedAt':_0x3cf340,'showAll':_0x29344b,'userId':_0x47bece,'queueIds':_0x27a11b,'withUnreadMessages':_0x5722f7,'companyId':_0x1adca9});return _0x31a158[_0x14d6b5(0xef)](0xc8)[_0x14d6b5(0x120)]({'tickets':_0x2551b9,'count':_0x674561,'hasMore':_0x5301a7});};exports[a40_0x10c36d(0x103)]=kanban;function a40_0x400b(_0x3a514e,_0x713383){const _0x43085b=a40_0x360f();return a40_0x400b=function(_0x21a5f0,_0x5ea4e0){_0x21a5f0=_0x21a5f0-0xea;let _0x360f60=_0x43085b[_0x21a5f0];return _0x360f60;},a40_0x400b(_0x3a514e,_0x713383);}const show=async(_0xb471d8,_0x5e3489)=>{const _0x2138f4=a40_0x10c36d,{ticketId:_0x505417}=_0xb471d8[_0x2138f4(0x116)],{companyId:_0x595213}=_0xb471d8[_0x2138f4(0xf7)],_0x1d7994=await(0x0,ShowTicketService_1[_0x2138f4(0xfd)])(_0x505417,_0x595213);return _0x5e3489['status'](0xc8)[_0x2138f4(0x120)](_0x1d7994);};exports[a40_0x10c36d(0x10d)]=show;const showFromUUID=async(_0x1d94f6,_0x2ccca9)=>{const _0x80fcbf=a40_0x10c36d,{uuid:_0x256a1b}=_0x1d94f6[_0x80fcbf(0x116)],_0x2e9b44=await(0x0,ShowTicketFromUUIDService_1[_0x80fcbf(0xfd)])(_0x256a1b);return _0x2ccca9[_0x80fcbf(0xef)](0xc8)[_0x80fcbf(0x120)](_0x2e9b44);};exports[a40_0x10c36d(0xf5)]=showFromUUID;const closeAll=async(_0x5f1d0f,_0x1c1cba)=>{const _0x1a71fc=a40_0x10c36d,{companyId:_0x556816}=_0x5f1d0f['user'];var _0x143a65=_0x5f1d0f[_0x1a71fc(0x122)][_0x1a71fc(0xef)],_0x853ea2=await Ticket_1['default'][_0x1a71fc(0x117)]({'where':{'companyId':_0x556816,'status':_0x143a65}});for(const _0x43f6a4 of _0x853ea2){(0x0,UpdateTicketService_1[_0x1a71fc(0xfd)])({'ticketData':{'status':_0x1a71fc(0xfe),'userId':_0x43f6a4['userId']||null,'queueId':_0x43f6a4[_0x1a71fc(0x108)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x43f6a4['id'],'companyId':_0x556816});}return _0x1c1cba[_0x1a71fc(0xef)](0xc8)[_0x1a71fc(0x120)]({'message':_0x1a71fc(0x11c)});};exports['closeAll']=closeAll;const update=async(_0x48660f,_0x27dabb)=>{const _0x154fab=a40_0x10c36d,{ticketId:_0x55f089}=_0x48660f[_0x154fab(0x116)],_0x3128a3=_0x48660f[_0x154fab(0x122)],{companyId:_0x1a301b,id:_0x417ea8}=_0x48660f[_0x154fab(0xf7)],_0x4e194a=await Ticket_1['default'][_0x154fab(0x10c)]({'where':{'userId':_0x417ea8,'status':_0x154fab(0xed),'companyId':_0x1a301b}}),{limitAttendance:_0x231aff,name:_0x311306}=await User_1[_0x154fab(0xfd)]['findByPk'](_0x417ea8);if(_0x3128a3[_0x154fab(0xef)]==='open'&&_0x4e194a>=_0x231aff){}const _0x49cf83=new async_mutex_1[(_0x154fab(0x121))](),{ticket:_0x34ae64}=await _0x49cf83[_0x154fab(0x104)](async()=>{const _0x25f43b=_0x154fab;return await(0x0,UpdateTicketService_1[_0x25f43b(0xfd)])({'ticketData':_0x48660f['body'],'ticketId':_0x55f089,'companyId':_0x1a301b,'tokenData':_0x48660f[_0x25f43b(0x10f)]});});return _0x27dabb['status'](0xc8)[_0x154fab(0x120)](_0x34ae64);};exports[a40_0x10c36d(0x112)]=update;const remove=async(_0x185989,_0x2c6bd5)=>{const _0x2b5380=a40_0x10c36d,{ticketId:_0x3ef10d}=_0x185989[_0x2b5380(0x116)],{companyId:_0x16afbf}=_0x185989['user'];await(0x0,ShowTicketService_1[_0x2b5380(0xfd)])(_0x3ef10d,_0x16afbf);const _0x46bb70=await(0x0,DeleteTicketService_1['default'])(_0x3ef10d),_0x36f18c=(0x0,socket_1[_0x2b5380(0xeb)])();return _0x36f18c['to'](_0x2b5380(0x110)+_0x16afbf+'-'+_0x46bb70[_0x2b5380(0xef)])['to'](_0x3ef10d)['to'](_0x2b5380(0xfb)+_0x46bb70[_0x2b5380(0x108)]+_0x2b5380(0xec))['to'](_0x2b5380(0xfb)+_0x46bb70[_0x2b5380(0x108)]+'-'+_0x46bb70[_0x2b5380(0xef)])['to'](_0x2b5380(0x110)+_0x46bb70[_0x2b5380(0x11e)]+_0x2b5380(0xec))[_0x2b5380(0x123)]('company-'+_0x16afbf+_0x2b5380(0x10a),{'action':_0x2b5380(0x115),'ticketId':+_0x3ef10d}),_0x2c6bd5[_0x2b5380(0xef)](0xc8)['json']({'message':_0x2b5380(0x11a)});};exports['remove']=remove;