function a40_0xa005(){const _0x38d48d=['showFromUUID','../libs/socket','4rmlDGS','findByPk','queueId','../services/TicketServices/CreateTicketService','count','constructor','delete','userId','search','__importDefault','open','894548LUzizc','toString','parse','remove','../services/TicketServices/UpdateTicketService','getIO','startDate','queue-','kanban','tokenData','runExclusive','json','emit','-notification','1568292OKWhxu','14021IYiLff','828515gMcqVr','query','ticket\x20deleted','params','apply','show','closeAll','closed','body','defineProperty','company-','../models/User','2594166RvtjuJ','../services/TicketServices/DeleteTicketService','143653VtUGEI','update','../services/TicketServices/ShowTicketService','../services/TicketServices/ListTicketsServiceKanban','../services/TicketServices/ListTicketsService','../models/Ticket','index','8755208zzNwDL','store','status','(((.+)+)+)+$','companyId','__esModule','user','default','-ticket','Mutex'];a40_0xa005=function(){return _0x38d48d;};return a40_0xa005();}const a40_0xfe5e37=a40_0x24ea;(function(_0x46b47f,_0x33e134){const _0x5cce1e=a40_0x24ea,_0x51a66b=_0x46b47f();while(!![]){try{const _0x40b99b=-parseInt(_0x5cce1e(0x1bc))/0x1+parseInt(_0x5cce1e(0x19e))/0x2+-parseInt(_0x5cce1e(0x1ac))/0x3*(parseInt(_0x5cce1e(0x193))/0x4)+-parseInt(_0x5cce1e(0x1ae))/0x5+-parseInt(_0x5cce1e(0x1ba))/0x6+-parseInt(_0x5cce1e(0x1ad))/0x7+parseInt(_0x5cce1e(0x187))/0x8;if(_0x40b99b===_0x33e134)break;else _0x51a66b['push'](_0x51a66b['shift']());}catch(_0x2630a6){_0x51a66b['push'](_0x51a66b['shift']());}}}(a40_0xa005,0x432f7));const a40_0x3be86e=(function(){let _0x1fbb22=!![];return function(_0x1e18a2,_0x80f808){const _0x1c947d=_0x1fbb22?function(){const _0x41491f=a40_0x24ea;if(_0x80f808){const _0x3e3132=_0x80f808[_0x41491f(0x1b2)](_0x1e18a2,arguments);return _0x80f808=null,_0x3e3132;}}:function(){};return _0x1fbb22=![],_0x1c947d;};}()),a40_0x5625e5=a40_0x3be86e(this,function(){const _0x427297=a40_0x24ea;return a40_0x5625e5[_0x427297(0x19f)]()[_0x427297(0x19b)](_0x427297(0x18a))[_0x427297(0x19f)]()[_0x427297(0x198)](a40_0x5625e5)[_0x427297(0x19b)](_0x427297(0x18a));});a40_0x5625e5();'use strict';var __importDefault=this&&this[a40_0xfe5e37(0x19c)]||function(_0x268041){const _0x441332=a40_0xfe5e37;return _0x268041&&_0x268041[_0x441332(0x18c)]?_0x268041:{'default':_0x268041};};Object[a40_0xfe5e37(0x1b7)](exports,a40_0xfe5e37(0x18c),{'value':!![]}),exports[a40_0xfe5e37(0x1a1)]=exports[a40_0xfe5e37(0x1bd)]=exports[a40_0xfe5e37(0x1b4)]=exports[a40_0xfe5e37(0x191)]=exports[a40_0xfe5e37(0x1b3)]=exports['kanban']=exports[a40_0xfe5e37(0x188)]=exports[a40_0xfe5e37(0x186)]=void 0x0;const socket_1=require(a40_0xfe5e37(0x192)),Ticket_1=__importDefault(require(a40_0xfe5e37(0x185))),CreateTicketService_1=__importDefault(require(a40_0xfe5e37(0x196))),DeleteTicketService_1=__importDefault(require(a40_0xfe5e37(0x1bb))),ListTicketsService_1=__importDefault(require(a40_0xfe5e37(0x184))),ShowTicketFromUUIDService_1=__importDefault(require('../services/TicketServices/ShowTicketFromUUIDService')),ShowTicketService_1=__importDefault(require(a40_0xfe5e37(0x182))),UpdateTicketService_1=__importDefault(require(a40_0xfe5e37(0x1a2))),ListTicketsServiceKanban_1=__importDefault(require(a40_0xfe5e37(0x183))),async_mutex_1=require('async-mutex'),User_1=__importDefault(require(a40_0xfe5e37(0x1b9))),index=async(_0xd409ea,_0x4b157c)=>{const _0x2b7a0a=a40_0xfe5e37,{pageNumber:_0x569bf9,status:_0x19545b,date:_0x196162,updatedAt:_0x5e15ac,searchParam:_0x55f23e,showAll:_0x50610c,queueIds:_0x24ba21,tags:_0x43980e,users:_0x1c1991,withUnreadMessages:_0x2bc762}=_0xd409ea[_0x2b7a0a(0x1af)],_0x501171=_0xd409ea[_0x2b7a0a(0x18d)]['id'],{companyId:_0xdc18ae}=_0xd409ea[_0x2b7a0a(0x18d)];let _0x4c516e=[],_0x543af0=[],_0x59facc=[];_0x24ba21&&(_0x4c516e=JSON[_0x2b7a0a(0x1a0)](_0x24ba21));_0x43980e&&(_0x543af0=JSON[_0x2b7a0a(0x1a0)](_0x43980e));_0x1c1991&&(_0x59facc=JSON[_0x2b7a0a(0x1a0)](_0x1c1991));const _0x5261a4=_0xd409ea[_0x2b7a0a(0x1af)][_0x2b7a0a(0x1a4)],_0x7e66d7=_0xd409ea[_0x2b7a0a(0x1af)]['endDate'],{tickets:_0x35f6fe,count:_0x5b2648,hasMore:_0x3ae143}=await(0x0,ListTicketsService_1['default'])({'searchParam':_0x55f23e,'tags':_0x543af0,'users':_0x59facc,'pageNumber':_0x569bf9,'status':_0x19545b,'date':_0x196162,'updatedAt':_0x5e15ac,'showAll':_0x50610c,'userId':_0x501171,'queueIds':_0x4c516e,'withUnreadMessages':_0x2bc762,'companyId':_0xdc18ae,'startDate':_0x5261a4,'endDate':_0x7e66d7});return _0x4b157c[_0x2b7a0a(0x189)](0xc8)['json']({'tickets':_0x35f6fe,'count':_0x5b2648,'hasMore':_0x3ae143});};exports[a40_0xfe5e37(0x186)]=index;const store=async(_0x3400ff,_0x1f75c9)=>{const _0x314e28=a40_0xfe5e37,{contactId:_0x3dba9e,status:_0xa62a9b,userId:_0x2ae02a,queueId:_0x5ae0c3,whatsappId:_0x5db00e}=_0x3400ff['body'],{companyId:_0x37f316,id:_0x85cba0}=_0x3400ff[_0x314e28(0x18d)],_0x56d56f=await Ticket_1['default'][_0x314e28(0x197)]({'where':{'userId':_0x85cba0,'status':_0x314e28(0x19d),'companyId':_0x37f316}}),{limitAttendance:_0x1e61f2,name:_0x28a18b}=await User_1[_0x314e28(0x18e)][_0x314e28(0x194)](_0x85cba0);if(_0x56d56f>=_0x1e61f2){}const _0xee6fd3=await(0x0,CreateTicketService_1[_0x314e28(0x18e)])({'contactId':_0x3dba9e,'status':_0xa62a9b,'userId':_0x2ae02a,'companyId':_0x37f316,'queueId':_0x5ae0c3,'whatsappId':_0x5db00e}),_0x216151=(0x0,socket_1[_0x314e28(0x1a3)])();return _0x216151['to']('company-'+_0xee6fd3[_0x314e28(0x18b)]+'-'+_0xee6fd3['status'])['to'](_0x314e28(0x1a5)+_0xee6fd3[_0x314e28(0x195)]+'-'+_0xee6fd3[_0x314e28(0x189)])[_0x314e28(0x1aa)](_0x314e28(0x1b8)+_0x37f316+_0x314e28(0x18f),{'action':_0x314e28(0x1bd),'ticket':_0xee6fd3}),_0x1f75c9['status'](0xc8)[_0x314e28(0x1a9)](_0xee6fd3);};exports[a40_0xfe5e37(0x188)]=store;const kanban=async(_0x9b7cf3,_0xe2252c)=>{const _0x34672b=a40_0xfe5e37,{pageNumber:_0x21b351,status:_0x4202de,date:_0x53826a,updatedAt:_0x507144,searchParam:_0x22cdde,showAll:_0x2f2292,queueIds:_0x5a9815,tags:_0x40e25d,users:_0x26f74b,withUnreadMessages:_0x5766d5}=_0x9b7cf3['query'],_0x3fa1ed=_0x9b7cf3[_0x34672b(0x18d)]['id'],{companyId:_0x1ae8cd}=_0x9b7cf3['user'];let _0x119a24=[],_0x25edf8=[],_0x2a2253=[];_0x5a9815&&(_0x119a24=JSON['parse'](_0x5a9815));_0x40e25d&&(_0x25edf8=JSON['parse'](_0x40e25d));_0x26f74b&&(_0x2a2253=JSON[_0x34672b(0x1a0)](_0x26f74b));const {tickets:_0x3d1e8a,count:_0x265027,hasMore:_0x6965d0}=await(0x0,ListTicketsServiceKanban_1[_0x34672b(0x18e)])({'searchParam':_0x22cdde,'tags':_0x25edf8,'users':_0x2a2253,'pageNumber':_0x21b351,'status':_0x4202de,'date':_0x53826a,'updatedAt':_0x507144,'showAll':_0x2f2292,'userId':_0x3fa1ed,'queueIds':_0x119a24,'withUnreadMessages':_0x5766d5,'companyId':_0x1ae8cd});return _0xe2252c['status'](0xc8)[_0x34672b(0x1a9)]({'tickets':_0x3d1e8a,'count':_0x265027,'hasMore':_0x6965d0});};function a40_0x24ea(_0x16672d,_0x2f2562){const _0x1a6fa1=a40_0xa005();return a40_0x24ea=function(_0x5625e5,_0x3be86e){_0x5625e5=_0x5625e5-0x182;let _0xa0058b=_0x1a6fa1[_0x5625e5];return _0xa0058b;},a40_0x24ea(_0x16672d,_0x2f2562);}exports[a40_0xfe5e37(0x1a6)]=kanban;const show=async(_0x5d286d,_0x25415f)=>{const _0x4c5bec=a40_0xfe5e37,{ticketId:_0x39dcf5}=_0x5d286d[_0x4c5bec(0x1b1)],{companyId:_0x56f36e}=_0x5d286d[_0x4c5bec(0x18d)],_0x1d4838=await(0x0,ShowTicketService_1['default'])(_0x39dcf5,_0x56f36e);return _0x25415f[_0x4c5bec(0x189)](0xc8)[_0x4c5bec(0x1a9)](_0x1d4838);};exports['show']=show;const showFromUUID=async(_0x50160a,_0x5f8126)=>{const _0x29eabd=a40_0xfe5e37,{uuid:_0x499581}=_0x50160a['params'],_0x3ff7ff=await(0x0,ShowTicketFromUUIDService_1[_0x29eabd(0x18e)])(_0x499581);return _0x5f8126[_0x29eabd(0x189)](0xc8)['json'](_0x3ff7ff);};exports['showFromUUID']=showFromUUID;const closeAll=async(_0x784498,_0x15e86f)=>{const _0xd54d4a=a40_0xfe5e37,{companyId:_0x1f5aad}=_0x784498['user'];var _0x4ecc8d=_0x784498[_0xd54d4a(0x1b6)][_0xd54d4a(0x189)],_0x1d18c4=await Ticket_1[_0xd54d4a(0x18e)]['findAll']({'where':{'companyId':_0x1f5aad,'status':_0x4ecc8d}});for(const _0x351383 of _0x1d18c4){(0x0,UpdateTicketService_1[_0xd54d4a(0x18e)])({'ticketData':{'status':_0xd54d4a(0x1b5),'userId':_0x351383[_0xd54d4a(0x19a)]||null,'queueId':_0x351383[_0xd54d4a(0x195)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x351383['id'],'companyId':_0x1f5aad});}return _0x15e86f['status'](0xc8)[_0xd54d4a(0x1a9)]({'message':'all\x20tickets\x20closed'});};exports['closeAll']=closeAll;const update=async(_0x2fb90f,_0x2560a4)=>{const _0x3c8d36=a40_0xfe5e37,{ticketId:_0x27d2c2}=_0x2fb90f[_0x3c8d36(0x1b1)],_0x511453=_0x2fb90f['body'],{companyId:_0x58943f,id:_0x2e2a80}=_0x2fb90f[_0x3c8d36(0x18d)],_0x50ac8f=await Ticket_1[_0x3c8d36(0x18e)][_0x3c8d36(0x197)]({'where':{'userId':_0x2e2a80,'status':_0x3c8d36(0x19d),'companyId':_0x58943f}}),{limitAttendance:_0x4a5ca3,name:_0x3d2098}=await User_1['default'][_0x3c8d36(0x194)](_0x2e2a80);if(_0x511453[_0x3c8d36(0x189)]===_0x3c8d36(0x19d)&&_0x50ac8f>=_0x4a5ca3){}const _0x2f10b7=new async_mutex_1[(_0x3c8d36(0x190))](),{ticket:_0xe08071}=await _0x2f10b7[_0x3c8d36(0x1a8)](async()=>{const _0x1694b4=_0x3c8d36;return await(0x0,UpdateTicketService_1[_0x1694b4(0x18e)])({'ticketData':_0x2fb90f['body'],'ticketId':_0x27d2c2,'companyId':_0x58943f,'tokenData':_0x2fb90f[_0x1694b4(0x1a7)]});});return _0x2560a4[_0x3c8d36(0x189)](0xc8)[_0x3c8d36(0x1a9)](_0xe08071);};exports[a40_0xfe5e37(0x1bd)]=update;const remove=async(_0x8c95c1,_0x1cc920)=>{const _0x165557=a40_0xfe5e37,{ticketId:_0x4d41ab}=_0x8c95c1['params'],{companyId:_0x271cce}=_0x8c95c1[_0x165557(0x18d)];await(0x0,ShowTicketService_1['default'])(_0x4d41ab,_0x271cce);const _0x21cafb=await(0x0,DeleteTicketService_1[_0x165557(0x18e)])(_0x4d41ab),_0x47d5f7=(0x0,socket_1[_0x165557(0x1a3)])();return _0x47d5f7['to'](_0x165557(0x1b8)+_0x271cce+'-'+_0x21cafb[_0x165557(0x189)])['to'](_0x4d41ab)['to'](_0x165557(0x1a5)+_0x21cafb[_0x165557(0x195)]+_0x165557(0x1ab))['to'](_0x165557(0x1a5)+_0x21cafb[_0x165557(0x195)]+'-'+_0x21cafb['status'])['to']('company-'+_0x21cafb['companyId']+_0x165557(0x1ab))['emit']('company-'+_0x271cce+'-ticket',{'action':_0x165557(0x199),'ticketId':+_0x4d41ab}),_0x1cc920[_0x165557(0x189)](0xc8)[_0x165557(0x1a9)]({'message':_0x165557(0x1b0)});};exports[a40_0xfe5e37(0x1a1)]=remove;