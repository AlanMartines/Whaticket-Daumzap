const a40_0x3b20c1=a40_0x553e;(function(_0x494f1c,_0x2a1750){const _0xa54d4e=a40_0x553e,_0x1125a0=_0x494f1c();while(!![]){try{const _0x502e9a=-parseInt(_0xa54d4e(0x15b))/0x1+-parseInt(_0xa54d4e(0x131))/0x2*(-parseInt(_0xa54d4e(0x145))/0x3)+parseInt(_0xa54d4e(0x15a))/0x4*(-parseInt(_0xa54d4e(0x154))/0x5)+parseInt(_0xa54d4e(0x159))/0x6*(parseInt(_0xa54d4e(0x12b))/0x7)+parseInt(_0xa54d4e(0x140))/0x8+parseInt(_0xa54d4e(0x136))/0x9+parseInt(_0xa54d4e(0x148))/0xa*(-parseInt(_0xa54d4e(0x164))/0xb);if(_0x502e9a===_0x2a1750)break;else _0x1125a0['push'](_0x1125a0['shift']());}catch(_0x7dd439){_0x1125a0['push'](_0x1125a0['shift']());}}}(a40_0xbe2c,0x34c26));const a40_0xfcde0e=(function(){let _0x31147b=!![];return function(_0x41154d,_0x34c7cb){const _0x11ee6c=_0x31147b?function(){const _0x4eebdb=a40_0x553e;if(_0x34c7cb){const _0xdf0f=_0x34c7cb[_0x4eebdb(0x13a)](_0x41154d,arguments);return _0x34c7cb=null,_0xdf0f;}}:function(){};return _0x31147b=![],_0x11ee6c;};}()),a40_0x3c1961=a40_0xfcde0e(this,function(){const _0x1af251=a40_0x553e;return a40_0x3c1961[_0x1af251(0x158)]()[_0x1af251(0x12c)](_0x1af251(0x157))['toString']()[_0x1af251(0x130)](a40_0x3c1961)[_0x1af251(0x12c)](_0x1af251(0x157));});a40_0x3c1961();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x36da2f){const _0xdf4558=a40_0x553e;return _0x36da2f&&_0x36da2f[_0xdf4558(0x161)]?_0x36da2f:{'default':_0x36da2f};};Object[a40_0x3b20c1(0x163)](exports,a40_0x3b20c1(0x161),{'value':!![]}),exports[a40_0x3b20c1(0x13e)]=exports['update']=exports[a40_0x3b20c1(0x13c)]=exports[a40_0x3b20c1(0x15c)]=exports[a40_0x3b20c1(0x14c)]=exports[a40_0x3b20c1(0x12a)]=exports['store']=exports[a40_0x3b20c1(0x153)]=void 0x0;const socket_1=require(a40_0x3b20c1(0x13b)),Ticket_1=__importDefault(require('../models/Ticket')),CreateTicketService_1=__importDefault(require(a40_0x3b20c1(0x160))),DeleteTicketService_1=__importDefault(require(a40_0x3b20c1(0x143))),ListTicketsService_1=__importDefault(require(a40_0x3b20c1(0x12e))),ShowTicketFromUUIDService_1=__importDefault(require(a40_0x3b20c1(0x142))),ShowTicketService_1=__importDefault(require('../services/TicketServices/ShowTicketService')),UpdateTicketService_1=__importDefault(require(a40_0x3b20c1(0x12f))),ListTicketsServiceKanban_1=__importDefault(require(a40_0x3b20c1(0x132))),async_mutex_1=require(a40_0x3b20c1(0x135)),User_1=__importDefault(require(a40_0x3b20c1(0x15d))),index=async(_0x7fc086,_0x306130)=>{const _0x2ab744=a40_0x3b20c1,{pageNumber:_0x469552,status:_0x40ef47,date:_0x23e439,updatedAt:_0x1a0662,searchParam:_0x4de03a,showAll:_0x2a9550,queueIds:_0x236777,tags:_0x3d3e35,users:_0x363d7c,withUnreadMessages:_0x168453}=_0x7fc086[_0x2ab744(0x127)],_0x494b94=_0x7fc086[_0x2ab744(0x12d)]['id'],{companyId:_0x461c56}=_0x7fc086[_0x2ab744(0x12d)];let _0x1b18d1=[],_0x30cb92=[],_0x18727d=[];_0x236777&&(_0x1b18d1=JSON['parse'](_0x236777));_0x3d3e35&&(_0x30cb92=JSON[_0x2ab744(0x15f)](_0x3d3e35));_0x363d7c&&(_0x18727d=JSON[_0x2ab744(0x15f)](_0x363d7c));const _0x24bd32=_0x7fc086[_0x2ab744(0x127)][_0x2ab744(0x138)],_0x4d2c5f=_0x7fc086['query']['endDate'],{tickets:_0x5daa05,count:_0x21e20e,hasMore:_0x3d093b}=await(0x0,ListTicketsService_1[_0x2ab744(0x141)])({'searchParam':_0x4de03a,'tags':_0x30cb92,'users':_0x18727d,'pageNumber':_0x469552,'status':_0x40ef47,'date':_0x23e439,'updatedAt':_0x1a0662,'showAll':_0x2a9550,'userId':_0x494b94,'queueIds':_0x1b18d1,'withUnreadMessages':_0x168453,'companyId':_0x461c56,'startDate':_0x24bd32,'endDate':_0x4d2c5f});return _0x306130[_0x2ab744(0x134)](0xc8)[_0x2ab744(0x14f)]({'tickets':_0x5daa05,'count':_0x21e20e,'hasMore':_0x3d093b});};exports[a40_0x3b20c1(0x153)]=index;const store=async(_0x1df15b,_0x698582)=>{const _0x418740=a40_0x3b20c1,{contactId:_0x4e10c0,status:_0x4be72b,userId:_0x5a7816,queueId:_0x512b7e,whatsappId:_0x4ec2e5}=_0x1df15b[_0x418740(0x15e)],{companyId:_0x357b81,id:_0xb37ef5}=_0x1df15b[_0x418740(0x12d)],_0x598850=await Ticket_1['default'][_0x418740(0x137)]({'where':{'userId':_0xb37ef5,'status':_0x418740(0x133),'companyId':_0x357b81}}),{limitAttendance:_0x2e5c26,name:_0x2c12b4}=await User_1['default'][_0x418740(0x151)](_0xb37ef5);if(_0x598850>=_0x2e5c26){}const _0x2629e7=await(0x0,CreateTicketService_1['default'])({'contactId':_0x4e10c0,'status':_0x4be72b,'userId':_0x5a7816,'companyId':_0x357b81,'queueId':_0x512b7e,'whatsappId':_0x4ec2e5}),_0x498625=(0x0,socket_1[_0x418740(0x13f)])();return _0x498625['to'](_0x418740(0x13d)+_0x2629e7[_0x418740(0x14b)]+'-'+_0x2629e7[_0x418740(0x134)])['to'](_0x418740(0x146)+_0x2629e7[_0x418740(0x156)]+'-'+_0x2629e7['status'])[_0x418740(0x147)]('company-'+_0x357b81+'-ticket',{'action':_0x418740(0x150),'ticket':_0x2629e7}),_0x698582[_0x418740(0x134)](0xc8)[_0x418740(0x14f)](_0x2629e7);};exports['store']=store;const kanban=async(_0x4790f3,_0x2d966c)=>{const _0x4baa6a=a40_0x3b20c1,{pageNumber:_0xdd3415,status:_0x15f17a,date:_0x33bf43,updatedAt:_0x50ffee,searchParam:_0x2b2b65,showAll:_0x2c8f3f,queueIds:_0x9ebe74,tags:_0x229ca4,users:_0x282e6d,withUnreadMessages:_0x24c40e}=_0x4790f3['query'],_0x445ee4=_0x4790f3['user']['id'],{companyId:_0xd5a367}=_0x4790f3[_0x4baa6a(0x12d)];let _0x27eea0=[],_0x2b0c7c=[],_0x3ab557=[];_0x9ebe74&&(_0x27eea0=JSON[_0x4baa6a(0x15f)](_0x9ebe74));_0x229ca4&&(_0x2b0c7c=JSON[_0x4baa6a(0x15f)](_0x229ca4));_0x282e6d&&(_0x3ab557=JSON[_0x4baa6a(0x15f)](_0x282e6d));const {tickets:_0x5d58b0,count:_0x4c40cc,hasMore:_0x3f3b0b}=await(0x0,ListTicketsServiceKanban_1[_0x4baa6a(0x141)])({'searchParam':_0x2b2b65,'tags':_0x2b0c7c,'users':_0x3ab557,'pageNumber':_0xdd3415,'status':_0x15f17a,'date':_0x33bf43,'updatedAt':_0x50ffee,'showAll':_0x2c8f3f,'userId':_0x445ee4,'queueIds':_0x27eea0,'withUnreadMessages':_0x24c40e,'companyId':_0xd5a367});return _0x2d966c[_0x4baa6a(0x134)](0xc8)[_0x4baa6a(0x14f)]({'tickets':_0x5d58b0,'count':_0x4c40cc,'hasMore':_0x3f3b0b});};exports['kanban']=kanban;const show=async(_0x1c3001,_0x25fed7)=>{const _0x5904ae=a40_0x3b20c1,{ticketId:_0x589cde}=_0x1c3001[_0x5904ae(0x128)],{companyId:_0x273246}=_0x1c3001[_0x5904ae(0x12d)],_0x497937=await(0x0,ShowTicketService_1[_0x5904ae(0x141)])(_0x589cde,_0x273246);return _0x25fed7[_0x5904ae(0x134)](0xc8)[_0x5904ae(0x14f)](_0x497937);};exports['show']=show;const showFromUUID=async(_0x4e61fd,_0x31d01f)=>{const _0x13d717=a40_0x3b20c1,{uuid:_0x749262}=_0x4e61fd[_0x13d717(0x128)],_0x360d29=await(0x0,ShowTicketFromUUIDService_1[_0x13d717(0x141)])(_0x749262);return _0x31d01f[_0x13d717(0x134)](0xc8)[_0x13d717(0x14f)](_0x360d29);};function a40_0xbe2c(){const _0x16b6c1=['142ITSyuV','../services/TicketServices/ListTicketsServiceKanban','open','status','async-mutex','2733984NMMyak','count','startDate','userId','apply','../libs/socket','closeAll','company-','remove','getIO','1980888zIntGr','default','../services/TicketServices/ShowTicketFromUUIDService','../services/TicketServices/DeleteTicketService','ticket\x20deleted','3543gmmJgA','queue-','emit','10IunYJB','findAll','-notification','companyId','show','runExclusive','-ticket','json','update','findByPk','closed','index','10JfNTFT','Mutex','queueId','(((.+)+)+)+$','toString','20226BMyaBa','197280flsBDw','181242itzEiy','showFromUUID','../models/User','body','parse','../services/TicketServices/CreateTicketService','__esModule','tokenData','defineProperty','2903791HivREa','query','params','delete','kanban','259kssEjU','search','user','../services/TicketServices/ListTicketsService','../services/TicketServices/UpdateTicketService','constructor'];a40_0xbe2c=function(){return _0x16b6c1;};return a40_0xbe2c();}exports[a40_0x3b20c1(0x15c)]=showFromUUID;const closeAll=async(_0x1028b0,_0x47bcbd)=>{const _0x38ac64=a40_0x3b20c1,{companyId:_0x390767}=_0x1028b0['user'];var _0x3ebc73=_0x1028b0[_0x38ac64(0x15e)][_0x38ac64(0x134)],_0x2b1e1f=await Ticket_1[_0x38ac64(0x141)][_0x38ac64(0x149)]({'where':{'companyId':_0x390767,'status':_0x3ebc73}});for(const _0x4b6613 of _0x2b1e1f){(0x0,UpdateTicketService_1[_0x38ac64(0x141)])({'ticketData':{'status':_0x38ac64(0x152),'userId':_0x4b6613[_0x38ac64(0x139)]||null,'queueId':_0x4b6613[_0x38ac64(0x156)]||null,'unreadMessages':0x0,'amountUsedBotQueues':0x0,'sendFarewellMessage':![]},'ticketId':_0x4b6613['id'],'companyId':_0x390767});}return _0x47bcbd[_0x38ac64(0x134)](0xc8)[_0x38ac64(0x14f)]({'message':'all\x20tickets\x20closed'});};exports[a40_0x3b20c1(0x13c)]=closeAll;const update=async(_0x5003d6,_0x43b44e)=>{const _0x15e647=a40_0x3b20c1,{ticketId:_0x11b291}=_0x5003d6[_0x15e647(0x128)],_0x562b33=_0x5003d6['body'],{companyId:_0x16ebe6,id:_0xa64ecb}=_0x5003d6['user'],_0x271e2e=await Ticket_1['default'][_0x15e647(0x137)]({'where':{'userId':_0xa64ecb,'status':'open','companyId':_0x16ebe6}}),{limitAttendance:_0xa96582,name:_0x3ddfe0}=await User_1[_0x15e647(0x141)]['findByPk'](_0xa64ecb);if(_0x562b33[_0x15e647(0x134)]==='open'&&_0x271e2e>=_0xa96582){}const _0x52cf7f=new async_mutex_1[(_0x15e647(0x155))](),{ticket:_0x224ca0}=await _0x52cf7f[_0x15e647(0x14d)](async()=>{const _0x5b71cc=_0x15e647;return await(0x0,UpdateTicketService_1[_0x5b71cc(0x141)])({'ticketData':_0x5003d6[_0x5b71cc(0x15e)],'ticketId':_0x11b291,'companyId':_0x16ebe6,'tokenData':_0x5003d6[_0x5b71cc(0x162)]});});return _0x43b44e[_0x15e647(0x134)](0xc8)[_0x15e647(0x14f)](_0x224ca0);};exports['update']=update;const remove=async(_0x245926,_0x2a2500)=>{const _0x443ddb=a40_0x3b20c1,{ticketId:_0x317399}=_0x245926['params'],{companyId:_0xb17fa6}=_0x245926[_0x443ddb(0x12d)];await(0x0,ShowTicketService_1[_0x443ddb(0x141)])(_0x317399,_0xb17fa6);const _0x505c39=await(0x0,DeleteTicketService_1['default'])(_0x317399),_0x1c6d38=(0x0,socket_1[_0x443ddb(0x13f)])();return _0x1c6d38['to'](_0x443ddb(0x13d)+_0xb17fa6+'-'+_0x505c39[_0x443ddb(0x134)])['to'](_0x317399)['to'](_0x443ddb(0x146)+_0x505c39[_0x443ddb(0x156)]+'-notification')['to'](_0x443ddb(0x146)+_0x505c39[_0x443ddb(0x156)]+'-'+_0x505c39[_0x443ddb(0x134)])['to'](_0x443ddb(0x13d)+_0x505c39[_0x443ddb(0x14b)]+_0x443ddb(0x14a))[_0x443ddb(0x147)](_0x443ddb(0x13d)+_0xb17fa6+_0x443ddb(0x14e),{'action':_0x443ddb(0x129),'ticketId':+_0x317399}),_0x2a2500[_0x443ddb(0x134)](0xc8)['json']({'message':_0x443ddb(0x144)});};function a40_0x553e(_0x397cb9,_0x173249){const _0x30dd61=a40_0xbe2c();return a40_0x553e=function(_0x3c1961,_0xfcde0e){_0x3c1961=_0x3c1961-0x127;let _0xbe2c59=_0x30dd61[_0x3c1961];return _0xbe2c59;},a40_0x553e(_0x397cb9,_0x173249);}exports[a40_0x3b20c1(0x13e)]=remove;