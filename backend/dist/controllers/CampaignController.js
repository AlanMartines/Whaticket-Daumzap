const a10_0x22ddf1=a10_0x5e3d;(function(_0x40d317,_0x2b54af){const _0x43a35d=a10_0x5e3d,_0x15814f=_0x40d317();while(!![]){try{const _0x2c4d5f=parseInt(_0x43a35d(0x1cc))/0x1*(-parseInt(_0x43a35d(0x1c2))/0x2)+parseInt(_0x43a35d(0x1b8))/0x3+parseInt(_0x43a35d(0x1ca))/0x4+parseInt(_0x43a35d(0x1c3))/0x5+-parseInt(_0x43a35d(0x1d8))/0x6+parseInt(_0x43a35d(0x18b))/0x7*(parseInt(_0x43a35d(0x1d3))/0x8)+-parseInt(_0x43a35d(0x1c9))/0x9;if(_0x2c4d5f===_0x2b54af)break;else _0x15814f['push'](_0x15814f['shift']());}catch(_0x2791c3){_0x15814f['push'](_0x15814f['shift']());}}}(a10_0x5281,0x1fada));const a10_0x79b9f8=(function(){let _0x39d440=!![];return function(_0x3cbc3a,_0x235127){const _0x1c8750=_0x39d440?function(){if(_0x235127){const _0x2dbba4=_0x235127['apply'](_0x3cbc3a,arguments);return _0x235127=null,_0x2dbba4;}}:function(){};return _0x39d440=![],_0x1c8750;};}()),a10_0x2dd6a3=a10_0x79b9f8(this,function(){const _0x5da797=a10_0x5e3d;return a10_0x2dd6a3['toString']()['search'](_0x5da797(0x187))[_0x5da797(0x1d4)]()[_0x5da797(0x1a4)](a10_0x2dd6a3)['search'](_0x5da797(0x187));});a10_0x2dd6a3();'use strict';var __createBinding=this&&this[a10_0x22ddf1(0x1c1)]||(Object[a10_0x22ddf1(0x1c0)]?function(_0x2e9f34,_0x1832cf,_0x48f2d5,_0xcb538e){const _0x396a13=a10_0x22ddf1;if(_0xcb538e===undefined)_0xcb538e=_0x48f2d5;var _0x12575a=Object['getOwnPropertyDescriptor'](_0x1832cf,_0x48f2d5);(!_0x12575a||(_0x396a13(0x1dd)in _0x12575a?!_0x1832cf['__esModule']:_0x12575a[_0x396a13(0x1ce)]||_0x12575a[_0x396a13(0x19b)]))&&(_0x12575a={'enumerable':!![],'get':function(){return _0x1832cf[_0x48f2d5];}}),Object[_0x396a13(0x199)](_0x2e9f34,_0xcb538e,_0x12575a);}:function(_0x1c3d6b,_0x34c794,_0x26d9d6,_0x17e585){if(_0x17e585===undefined)_0x17e585=_0x26d9d6;_0x1c3d6b[_0x17e585]=_0x34c794[_0x26d9d6];}),__setModuleDefault=this&&this[a10_0x22ddf1(0x1d2)]||(Object['create']?function(_0x1c38c7,_0x4dbcb3){const _0x6841ff=a10_0x22ddf1;Object[_0x6841ff(0x199)](_0x1c38c7,'default',{'enumerable':!![],'value':_0x4dbcb3});}:function(_0xaf0e31,_0x430c2c){const _0x15126c=a10_0x22ddf1;_0xaf0e31[_0x15126c(0x1a0)]=_0x430c2c;}),__importStar=this&&this[a10_0x22ddf1(0x1b3)]||function(_0x3cc7d1){const _0x2d722d=a10_0x22ddf1;if(_0x3cc7d1&&_0x3cc7d1[_0x2d722d(0x193)])return _0x3cc7d1;var _0x4521a1={};if(_0x3cc7d1!=null){for(var _0x361f81 in _0x3cc7d1)if(_0x361f81!=='default'&&Object[_0x2d722d(0x188)]['hasOwnProperty'][_0x2d722d(0x1b0)](_0x3cc7d1,_0x361f81))__createBinding(_0x4521a1,_0x3cc7d1,_0x361f81);}return __setModuleDefault(_0x4521a1,_0x3cc7d1),_0x4521a1;},__importDefault=this&&this[a10_0x22ddf1(0x198)]||function(_0x35e6c7){return _0x35e6c7&&_0x35e6c7['__esModule']?_0x35e6c7:{'default':_0x35e6c7};};Object[a10_0x22ddf1(0x199)](exports,'__esModule',{'value':!![]}),exports[a10_0x22ddf1(0x1b6)]=exports[a10_0x22ddf1(0x1b1)]=exports[a10_0x22ddf1(0x1d9)]=exports[a10_0x22ddf1(0x1dc)]=exports['restart']=exports['cancel']=exports[a10_0x22ddf1(0x1a1)]=exports[a10_0x22ddf1(0x18e)]=exports[a10_0x22ddf1(0x1c8)]=exports[a10_0x22ddf1(0x19d)]=void 0x0;const Yup=__importStar(require('yup')),socket_1=require('../libs/socket'),lodash_1=require(a10_0x22ddf1(0x195)),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a10_0x22ddf1(0x18d))),ListService_1=__importDefault(require(a10_0x22ddf1(0x1af))),CreateService_1=__importDefault(require('../services/CampaignService/CreateService')),ShowService_1=__importDefault(require('../services/CampaignService/ShowService')),UpdateService_1=__importDefault(require('../services/CampaignService/UpdateService')),DeleteService_1=__importDefault(require(a10_0x22ddf1(0x18c))),FindService_1=__importDefault(require('../services/CampaignService/FindService')),Campaign_1=__importDefault(require('../models/Campaign')),AppError_1=__importDefault(require(a10_0x22ddf1(0x18a))),CancelService_1=require(a10_0x22ddf1(0x191)),RestartService_1=require(a10_0x22ddf1(0x1d7)),TicketTag_1=__importDefault(require(a10_0x22ddf1(0x197))),Ticket_1=__importDefault(require('../models/Ticket')),Contact_1=__importDefault(require(a10_0x22ddf1(0x1d5))),ContactList_1=__importDefault(require('../models/ContactList')),ContactListItem_1=__importDefault(require(a10_0x22ddf1(0x1c6))),index=async(_0x301281,_0x193b12)=>{const _0x268889=a10_0x22ddf1,{searchParam:_0x1d36c5,pageNumber:_0x2fc307}=_0x301281[_0x268889(0x18f)],{companyId:_0x2268d2}=_0x301281[_0x268889(0x1be)],{records:_0x52d4d1,count:_0x4ccda0,hasMore:_0x42dd31}=await(0x0,ListService_1[_0x268889(0x1a0)])({'searchParam':_0x1d36c5,'pageNumber':_0x2fc307,'companyId':_0x2268d2});return _0x193b12[_0x268889(0x1a3)]({'records':_0x52d4d1,'count':_0x4ccda0,'hasMore':_0x42dd31});};exports[a10_0x22ddf1(0x19d)]=index;const store=async(_0x2564c5,_0x7f9b07)=>{const _0x504edb=a10_0x22ddf1,{companyId:_0x576712}=_0x2564c5[_0x504edb(0x1be)],_0x30bd6a=_0x2564c5['body'],_0x20a04e=Yup[_0x504edb(0x1d1)]()[_0x504edb(0x1aa)]({'name':Yup['string']()[_0x504edb(0x1ba)]()});try{await _0x20a04e[_0x504edb(0x1bb)](_0x30bd6a);}catch(_0x5b9506){throw new AppError_1[(_0x504edb(0x1a0))](_0x5b9506[_0x504edb(0x1d0)]);}if(typeof _0x30bd6a[_0x504edb(0x1bf)]==='number'){const _0x5704ab=_0x30bd6a[_0x504edb(0x1bf)],_0x1a8bc7=_0x30bd6a[_0x504edb(0x1c4)];async function _0x45e26f(_0xaba191){const _0x40a0c7=_0x504edb,_0x4a2915=new Date(),_0x249177=_0x4a2915[_0x40a0c7(0x1b2)]();try{const _0x56b0c6=await TicketTag_1[_0x40a0c7(0x1a0)][_0x40a0c7(0x19e)]({'where':{'tagId':_0xaba191}}),_0x448404=_0x56b0c6[_0x40a0c7(0x1ae)](_0x36c69c=>_0x36c69c[_0x40a0c7(0x1a9)]),_0x37e602=await Ticket_1[_0x40a0c7(0x1a0)][_0x40a0c7(0x19e)]({'where':{'id':_0x448404}}),_0x11130e=_0x37e602['map'](_0x4793f5=>_0x4793f5[_0x40a0c7(0x1cb)]),_0x54f101=await Contact_1['default']['findAll']({'where':{'id':_0x11130e}}),_0x2d2f04=_0x1a8bc7+'\x20|\x20TAG:\x20'+_0xaba191+'\x20-\x20'+_0x249177,_0x2a07e7=await ContactList_1[_0x40a0c7(0x1a0)]['create']({'name':_0x2d2f04,'companyId':_0x576712}),{id:_0x355b6e}=_0x2a07e7,_0x2ebf8c=_0x54f101[_0x40a0c7(0x1ae)](_0x3c7a47=>({'name':_0x3c7a47[_0x40a0c7(0x1c4)],'number':_0x3c7a47[_0x40a0c7(0x1ac)],'email':_0x3c7a47[_0x40a0c7(0x194)],'contactListId':_0x355b6e,'companyId':_0x576712,'isWhatsappValid':!![]}));return await ContactListItem_1[_0x40a0c7(0x1a0)]['bulkCreate'](_0x2ebf8c),_0x355b6e;}catch(_0x543f16){console[_0x40a0c7(0x1bc)]('Error\x20creating\x20contact\x20list:',_0x543f16);throw _0x543f16;}}_0x45e26f(_0x5704ab)['then'](async _0x184858=>{const _0x3be604=_0x504edb,_0x43155b=await(0x0,CreateService_1[_0x3be604(0x1a0)])({..._0x30bd6a,'companyId':_0x576712,'contactListId':_0x184858}),_0x38b6b2=(0x0,socket_1['getIO'])();return _0x38b6b2['to'](_0x3be604(0x1a6)+_0x576712+'-mainchannel')['emit'](_0x3be604(0x1a6)+_0x576712+'-campaign',{'action':'create','record':_0x43155b}),_0x7f9b07['status'](0xc8)['json'](_0x43155b);})[_0x504edb(0x189)](_0x24a5a1=>{const _0x30e933=_0x504edb;return console[_0x30e933(0x1bc)]('Error:',_0x24a5a1),_0x7f9b07[_0x30e933(0x1ad)](0x1f4)[_0x30e933(0x1a3)]({'error':_0x30e933(0x1b4)});});}else{const _0x3561a6=await(0x0,CreateService_1[_0x504edb(0x1a0)])({..._0x30bd6a,'companyId':_0x576712}),_0x158427=(0x0,socket_1[_0x504edb(0x1bd)])();return _0x158427['to']('company-'+_0x576712+_0x504edb(0x19a))['emit'](_0x504edb(0x1a6)+_0x576712+_0x504edb(0x1b5),{'action':_0x504edb(0x1c0),'record':_0x3561a6}),_0x7f9b07[_0x504edb(0x1ad)](0xc8)[_0x504edb(0x1a3)](_0x3561a6);}};exports[a10_0x22ddf1(0x1c8)]=store;const show=async(_0x56e45b,_0x3d8c1f)=>{const _0x21c40b=a10_0x22ddf1,{id:_0x2032e7}=_0x56e45b['params'],_0xbea9f4=await(0x0,ShowService_1[_0x21c40b(0x1a0)])(_0x2032e7);return _0x3d8c1f['status'](0xc8)[_0x21c40b(0x1a3)](_0xbea9f4);};exports['show']=show;const update=async(_0x2572fe,_0x12cd23)=>{const _0x333792=a10_0x22ddf1,_0x598653=_0x2572fe[_0x333792(0x19f)],{companyId:_0x41c5c0}=_0x2572fe['user'],_0xdd9d52=Yup[_0x333792(0x1d1)]()[_0x333792(0x1aa)]({'name':Yup[_0x333792(0x1d6)]()[_0x333792(0x1ba)]()});try{await _0xdd9d52[_0x333792(0x1bb)](_0x598653);}catch(_0xe4f579){throw new AppError_1[(_0x333792(0x1a0))](_0xe4f579[_0x333792(0x1d0)]);}const {id:_0x5e50fd}=_0x2572fe[_0x333792(0x1cd)],_0x5207d8=await(0x0,UpdateService_1[_0x333792(0x1a0)])({..._0x598653,'id':_0x5e50fd}),_0x400812=(0x0,socket_1['getIO'])();return _0x400812['to']('company-'+_0x41c5c0+_0x333792(0x19a))['emit'](_0x333792(0x1a6)+_0x41c5c0+_0x333792(0x1b5),{'action':_0x333792(0x1a1),'record':_0x5207d8}),_0x12cd23[_0x333792(0x1ad)](0xc8)[_0x333792(0x1a3)](_0x5207d8);};exports[a10_0x22ddf1(0x1a1)]=update;function a10_0x5281(){const _0x1bce19=['-campaign','deleteMedia','Mensagem\x20enviada','376893dhIDjR','Cancelamento\x20realizado','required','validate','error','getIO','user','tagListId','create','__createBinding','31634TWMLxE','554280eBtAGB','name','mediaPath','../models/ContactListItem','Campaign\x20deleted','store','1524096UolDiE','77456IjboVR','contactId','8CqNSmE','params','writable','originalname','message','object','__setModuleDefault','1048RBRrXT','toString','../models/Contact','string','../services/CampaignService/RestartService','466056vmNMCa','findList','emit','delete','remove','get','resolve','(((.+)+)+)+$','prototype','catch','../errors/AppError','13223RGxlMi','../services/CampaignService/DeleteService','path','show','query','findByPk','../services/CampaignService/CancelService','save','__esModule','email','lodash','companyId','../models/TicketTag','__importDefault','defineProperty','-mainchannel','configurable','existsSync','index','findAll','body','default','update','unlinkSync','json','constructor','files','company-','Rein√≠cio\x20dos\x20disparos','mediaName','ticketId','shape','send','number','status','map','../services/CampaignService/ListService','call','mediaUpload','toISOString','__importStar','Error\x20creating\x20contact\x20list'];a10_0x5281=function(){return _0x1bce19;};return a10_0x5281();}function a10_0x5e3d(_0x554d9e,_0x41b6fa){const _0x474282=a10_0x5281();return a10_0x5e3d=function(_0x2dd6a3,_0x79b9f8){_0x2dd6a3=_0x2dd6a3-0x186;let _0x528134=_0x474282[_0x2dd6a3];return _0x528134;},a10_0x5e3d(_0x554d9e,_0x41b6fa);}const cancel=async(_0x3e266b,_0x32e869)=>{const _0xa3839c=a10_0x22ddf1,{id:_0x5d189e}=_0x3e266b['params'];return await(0x0,CancelService_1['CancelService'])(+_0x5d189e),_0x32e869[_0xa3839c(0x1ad)](0xcc)['json']({'message':_0xa3839c(0x1b9)});};exports['cancel']=cancel;const restart=async(_0x510710,_0x1a2637)=>{const _0x30a078=a10_0x22ddf1,{id:_0x171cd7}=_0x510710[_0x30a078(0x1cd)];return await(0x0,RestartService_1['RestartService'])(+_0x171cd7),_0x1a2637['status'](0xcc)[_0x30a078(0x1a3)]({'message':_0x30a078(0x1a7)});};exports['restart']=restart;const remove=async(_0x5c79d2,_0x4f5b13)=>{const _0x5b836e=a10_0x22ddf1,{id:_0xd4a2d0}=_0x5c79d2['params'],{companyId:_0x46a7e7}=_0x5c79d2[_0x5b836e(0x1be)];await(0x0,DeleteService_1[_0x5b836e(0x1a0)])(_0xd4a2d0);const _0x4d9f19=(0x0,socket_1[_0x5b836e(0x1bd)])();return _0x4d9f19['to']('company-'+_0x46a7e7+'-mainchannel')[_0x5b836e(0x1da)]('company-'+_0x46a7e7+_0x5b836e(0x1b5),{'action':_0x5b836e(0x1db),'id':_0xd4a2d0}),_0x4f5b13['status'](0xc8)['json']({'message':_0x5b836e(0x1c7)});};exports['remove']=remove;const findList=async(_0x3d0d20,_0x99b2ee)=>{const _0x2f43e8=a10_0x22ddf1,_0x474eb8=_0x3d0d20[_0x2f43e8(0x18f)],_0xf371bc=await(0x0,FindService_1[_0x2f43e8(0x1a0)])(_0x474eb8);return _0x99b2ee[_0x2f43e8(0x1ad)](0xc8)[_0x2f43e8(0x1a3)](_0xf371bc);};exports[a10_0x22ddf1(0x1d9)]=findList;const mediaUpload=async(_0x1855ed,_0x16d1d0)=>{const _0x28d7a4=a10_0x22ddf1,{id:_0x48d96c}=_0x1855ed['params'],_0x26e25c=_0x1855ed[_0x28d7a4(0x1a5)],_0x297bb8=(0x0,lodash_1['head'])(_0x26e25c);try{const _0x4ddabb=await Campaign_1[_0x28d7a4(0x1a0)][_0x28d7a4(0x190)](_0x48d96c);return _0x4ddabb[_0x28d7a4(0x1c5)]=_0x297bb8['filename'],_0x4ddabb[_0x28d7a4(0x1a8)]=_0x297bb8[_0x28d7a4(0x1cf)],await _0x4ddabb[_0x28d7a4(0x192)](),_0x16d1d0[_0x28d7a4(0x1ab)]({'mensagem':_0x28d7a4(0x1b7)});}catch(_0x4bd84d){throw new AppError_1[(_0x28d7a4(0x1a0))](_0x4bd84d[_0x28d7a4(0x1d0)]);}};exports['mediaUpload']=mediaUpload;const deleteMedia=async(_0x5b811e,_0x3734ba)=>{const _0x4cf5ff=a10_0x22ddf1,{id:_0x40f3a2}=_0x5b811e[_0x4cf5ff(0x1cd)];try{const _0xf0db73=await Campaign_1[_0x4cf5ff(0x1a0)]['findByPk'](_0x40f3a2),_0x127a61=path_1['default'][_0x4cf5ff(0x186)]('public','company'+_0xf0db73[_0x4cf5ff(0x196)],_0xf0db73[_0x4cf5ff(0x1c5)]),_0x341f49=fs_1[_0x4cf5ff(0x1a0)][_0x4cf5ff(0x19c)](_0x127a61);return _0x341f49&&fs_1['default'][_0x4cf5ff(0x1a2)](_0x127a61),_0xf0db73['mediaPath']=null,_0xf0db73['mediaName']=null,await _0xf0db73['save'](),_0x3734ba[_0x4cf5ff(0x1ab)]({'mensagem':'Arquivo\x20exclu√≠do'});}catch(_0xa3a323){throw new AppError_1[(_0x4cf5ff(0x1a0))](_0xa3a323['message']);}};exports[a10_0x22ddf1(0x1b6)]=deleteMedia;