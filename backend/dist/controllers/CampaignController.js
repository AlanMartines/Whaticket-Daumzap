const a10_0x32d9a8=a10_0xe159;(function(_0xd6e37c,_0x2798e6){const _0x491bdd=a10_0xe159,_0xa43825=_0xd6e37c();while(!![]){try{const _0x76605c=-parseInt(_0x491bdd(0x17b))/0x1+-parseInt(_0x491bdd(0x17e))/0x2+-parseInt(_0x491bdd(0x130))/0x3+parseInt(_0x491bdd(0x177))/0x4*(-parseInt(_0x491bdd(0x122))/0x5)+parseInt(_0x491bdd(0x14e))/0x6*(-parseInt(_0x491bdd(0x12e))/0x7)+parseInt(_0x491bdd(0x17c))/0x8*(parseInt(_0x491bdd(0x14c))/0x9)+parseInt(_0x491bdd(0x12b))/0xa;if(_0x76605c===_0x2798e6)break;else _0xa43825['push'](_0xa43825['shift']());}catch(_0x444991){_0xa43825['push'](_0xa43825['shift']());}}}(a10_0x461c,0x4eb80));const a10_0x4e40bb=(function(){let _0x47d359=!![];return function(_0x9ff25f,_0x5261c4){const _0x2c8fbc=_0x47d359?function(){if(_0x5261c4){const _0x49438=_0x5261c4['apply'](_0x9ff25f,arguments);return _0x5261c4=null,_0x49438;}}:function(){};return _0x47d359=![],_0x2c8fbc;};}()),a10_0x35e0aa=a10_0x4e40bb(this,function(){const _0x5ba237=a10_0xe159;return a10_0x35e0aa[_0x5ba237(0x121)]()[_0x5ba237(0x174)](_0x5ba237(0x11a))[_0x5ba237(0x121)]()[_0x5ba237(0x164)](a10_0x35e0aa)['search'](_0x5ba237(0x11a));});a10_0x35e0aa();'use strict';var __createBinding=this&&this[a10_0x32d9a8(0x133)]||(Object[a10_0x32d9a8(0x13c)]?function(_0x288b16,_0x2da729,_0x345320,_0x1550ef){const _0x53aece=a10_0x32d9a8;if(_0x1550ef===undefined)_0x1550ef=_0x345320;var _0x44f867=Object[_0x53aece(0x126)](_0x2da729,_0x345320);(!_0x44f867||(_0x53aece(0x162)in _0x44f867?!_0x2da729[_0x53aece(0x125)]:_0x44f867[_0x53aece(0x132)]||_0x44f867[_0x53aece(0x154)]))&&(_0x44f867={'enumerable':!![],'get':function(){return _0x2da729[_0x345320];}}),Object[_0x53aece(0x123)](_0x288b16,_0x1550ef,_0x44f867);}:function(_0x1bc4aa,_0x32ec09,_0x1b7e73,_0x4ce546){if(_0x4ce546===undefined)_0x4ce546=_0x1b7e73;_0x1bc4aa[_0x4ce546]=_0x32ec09[_0x1b7e73];}),__setModuleDefault=this&&this[a10_0x32d9a8(0x11f)]||(Object['create']?function(_0x11bfb6,_0x371479){const _0x2cec65=a10_0x32d9a8;Object['defineProperty'](_0x11bfb6,_0x2cec65(0x179),{'enumerable':!![],'value':_0x371479});}:function(_0x57e4c6,_0x36e17e){const _0x24d164=a10_0x32d9a8;_0x57e4c6[_0x24d164(0x179)]=_0x36e17e;}),__importStar=this&&this[a10_0x32d9a8(0x147)]||function(_0x2f2076){const _0xa27de=a10_0x32d9a8;if(_0x2f2076&&_0x2f2076[_0xa27de(0x125)])return _0x2f2076;var _0x2e943a={};if(_0x2f2076!=null){for(var _0x2b216f in _0x2f2076)if(_0x2b216f!==_0xa27de(0x179)&&Object[_0xa27de(0x16f)][_0xa27de(0x16a)][_0xa27de(0x158)](_0x2f2076,_0x2b216f))__createBinding(_0x2e943a,_0x2f2076,_0x2b216f);}return __setModuleDefault(_0x2e943a,_0x2f2076),_0x2e943a;},__importDefault=this&&this[a10_0x32d9a8(0x13d)]||function(_0x5af7f4){const _0xb2d06d=a10_0x32d9a8;return _0x5af7f4&&_0x5af7f4[_0xb2d06d(0x125)]?_0x5af7f4:{'default':_0x5af7f4};};Object['defineProperty'](exports,a10_0x32d9a8(0x125),{'value':!![]}),exports[a10_0x32d9a8(0x15c)]=exports[a10_0x32d9a8(0x148)]=exports[a10_0x32d9a8(0x16c)]=exports[a10_0x32d9a8(0x136)]=exports['restart']=exports['cancel']=exports['update']=exports[a10_0x32d9a8(0x165)]=exports[a10_0x32d9a8(0x12c)]=exports['index']=void 0x0;const Yup=__importStar(require(a10_0x32d9a8(0x173))),socket_1=require('../libs/socket'),lodash_1=require(a10_0x32d9a8(0x140)),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a10_0x32d9a8(0x124))),ListService_1=__importDefault(require(a10_0x32d9a8(0x13b))),CreateService_1=__importDefault(require(a10_0x32d9a8(0x169))),ShowService_1=__importDefault(require(a10_0x32d9a8(0x143))),UpdateService_1=__importDefault(require('../services/CampaignService/UpdateService')),DeleteService_1=__importDefault(require(a10_0x32d9a8(0x15d))),FindService_1=__importDefault(require(a10_0x32d9a8(0x139))),Campaign_1=__importDefault(require('../models/Campaign')),AppError_1=__importDefault(require(a10_0x32d9a8(0x156))),CancelService_1=require('../services/CampaignService/CancelService'),RestartService_1=require(a10_0x32d9a8(0x15e)),TicketTag_1=__importDefault(require(a10_0x32d9a8(0x16b))),Ticket_1=__importDefault(require(a10_0x32d9a8(0x120))),Contact_1=__importDefault(require(a10_0x32d9a8(0x116))),ContactList_1=__importDefault(require(a10_0x32d9a8(0x131))),ContactListItem_1=__importDefault(require(a10_0x32d9a8(0x149))),index=async(_0x2977b5,_0x3b3d34)=>{const _0x1832d1=a10_0x32d9a8,{searchParam:_0x20f88f,pageNumber:_0x4b3361}=_0x2977b5['query'],{companyId:_0x283765}=_0x2977b5['user'],{records:_0x4e9b93,count:_0xfa42a0,hasMore:_0x2fb45c}=await(0x0,ListService_1[_0x1832d1(0x179)])({'searchParam':_0x20f88f,'pageNumber':_0x4b3361,'companyId':_0x283765});return _0x3b3d34['json']({'records':_0x4e9b93,'count':_0xfa42a0,'hasMore':_0x2fb45c});};exports[a10_0x32d9a8(0x15f)]=index;const store=async(_0x3a5fcd,_0x47313c)=>{const _0x2d4683=a10_0x32d9a8,{companyId:_0x18960f}=_0x3a5fcd['user'],_0x1462d7=_0x3a5fcd[_0x2d4683(0x146)],_0x555204=Yup[_0x2d4683(0x119)]()['shape']({'name':Yup[_0x2d4683(0x11d)]()[_0x2d4683(0x138)]()});try{await _0x555204[_0x2d4683(0x171)](_0x1462d7);}catch(_0x4b70b8){throw new AppError_1[(_0x2d4683(0x179))](_0x4b70b8['message']);}if(typeof _0x1462d7[_0x2d4683(0x11b)]===_0x2d4683(0x16e)){const _0x50734a=_0x1462d7[_0x2d4683(0x11b)],_0x5a3233=_0x1462d7[_0x2d4683(0x159)];async function _0x43ecf8(_0x563820){const _0x2086c3=_0x2d4683,_0x33c85d=new Date(),_0x4868a8=_0x33c85d[_0x2086c3(0x167)]();try{const _0x17bc04=await TicketTag_1['default']['findAll']({'where':{'tagId':_0x563820}}),_0x4b3d28=_0x17bc04[_0x2086c3(0x11c)](_0x2856d3=>_0x2856d3['ticketId']),_0x471ae6=await Ticket_1['default'][_0x2086c3(0x153)]({'where':{'id':_0x4b3d28}}),_0x439474=_0x471ae6[_0x2086c3(0x11c)](_0x2bae71=>_0x2bae71['contactId']),_0x5283aa=await Contact_1['default']['findAll']({'where':{'id':_0x439474}}),_0x284054=_0x5a3233+'\x20|\x20TAG:\x20'+_0x563820+_0x2086c3(0x14b)+_0x4868a8,_0x315d8f=await ContactList_1[_0x2086c3(0x179)][_0x2086c3(0x13c)]({'name':_0x284054,'companyId':_0x18960f}),{id:_0x41070e}=_0x315d8f,_0x4b688e=_0x5283aa[_0x2086c3(0x11c)](_0x5de945=>({'name':_0x5de945['name'],'number':_0x5de945[_0x2086c3(0x16e)],'email':_0x5de945[_0x2086c3(0x114)],'contactListId':_0x41070e,'companyId':_0x18960f,'isWhatsappValid':!![]}));return await ContactListItem_1[_0x2086c3(0x179)][_0x2086c3(0x118)](_0x4b688e),_0x41070e;}catch(_0x56ff71){console[_0x2086c3(0x151)]('Error\x20creating\x20contact\x20list:',_0x56ff71);throw _0x56ff71;}}_0x43ecf8(_0x50734a)[_0x2d4683(0x127)](async _0x46242c=>{const _0x3273b8=_0x2d4683,_0x4340f3=await(0x0,CreateService_1[_0x3273b8(0x179)])({..._0x1462d7,'companyId':_0x18960f,'contactListId':_0x46242c}),_0x453baf=(0x0,socket_1[_0x3273b8(0x175)])();return _0x453baf['to']('company-'+_0x18960f+_0x3273b8(0x17d))['emit'](_0x3273b8(0x16d)+_0x18960f+_0x3273b8(0x12a),{'action':_0x3273b8(0x13c),'record':_0x4340f3}),_0x47313c[_0x3273b8(0x142)](0xc8)['json'](_0x4340f3);})[_0x2d4683(0x152)](_0x581c33=>{const _0x24790c=_0x2d4683;return console['error'](_0x24790c(0x144),_0x581c33),_0x47313c[_0x24790c(0x142)](0x1f4)[_0x24790c(0x115)]({'error':_0x24790c(0x137)});});}else{const _0x4ac45a=await(0x0,CreateService_1['default'])({..._0x1462d7,'companyId':_0x18960f}),_0x99e0a0=(0x0,socket_1[_0x2d4683(0x175)])();return _0x99e0a0['to'](_0x2d4683(0x16d)+_0x18960f+'-mainchannel')[_0x2d4683(0x12d)](_0x2d4683(0x16d)+_0x18960f+'-campaign',{'action':_0x2d4683(0x13c),'record':_0x4ac45a}),_0x47313c[_0x2d4683(0x142)](0xc8)['json'](_0x4ac45a);}};exports[a10_0x32d9a8(0x12c)]=store;const show=async(_0x2e55da,_0x4cf3ef)=>{const _0x5b32d2=a10_0x32d9a8,{id:_0x429477}=_0x2e55da[_0x5b32d2(0x157)],_0x3a36fb=await(0x0,ShowService_1[_0x5b32d2(0x179)])(_0x429477);return _0x4cf3ef[_0x5b32d2(0x142)](0xc8)['json'](_0x3a36fb);};exports[a10_0x32d9a8(0x165)]=show;const update=async(_0x334580,_0x525a39)=>{const _0x3e01ab=a10_0x32d9a8,_0x13278d=_0x334580[_0x3e01ab(0x146)],{companyId:_0xee22c0}=_0x334580[_0x3e01ab(0x166)],_0x2fe43f=Yup[_0x3e01ab(0x119)]()[_0x3e01ab(0x168)]({'name':Yup[_0x3e01ab(0x11d)]()[_0x3e01ab(0x138)]()});try{await _0x2fe43f[_0x3e01ab(0x171)](_0x13278d);}catch(_0x32646f){throw new AppError_1[(_0x3e01ab(0x179))](_0x32646f[_0x3e01ab(0x134)]);}const {id:_0x492e77}=_0x334580[_0x3e01ab(0x157)],_0x3bc7bd=await(0x0,UpdateService_1[_0x3e01ab(0x179)])({..._0x13278d,'id':_0x492e77}),_0x535f2a=(0x0,socket_1[_0x3e01ab(0x175)])();return _0x535f2a['to'](_0x3e01ab(0x16d)+_0xee22c0+_0x3e01ab(0x17d))['emit'](_0x3e01ab(0x16d)+_0xee22c0+_0x3e01ab(0x12a),{'action':_0x3e01ab(0x172),'record':_0x3bc7bd}),_0x525a39[_0x3e01ab(0x142)](0xc8)[_0x3e01ab(0x115)](_0x3bc7bd);};exports[a10_0x32d9a8(0x172)]=update;const cancel=async(_0x3caf75,_0x37dd1e)=>{const _0x18bc63=a10_0x32d9a8,{id:_0xd0d18a}=_0x3caf75[_0x18bc63(0x157)];return await(0x0,CancelService_1[_0x18bc63(0x135)])(+_0xd0d18a),_0x37dd1e[_0x18bc63(0x142)](0xcc)[_0x18bc63(0x115)]({'message':_0x18bc63(0x14d)});};function a10_0xe159(_0x130f9f,_0x26eb74){const _0x5649fc=a10_0x461c();return a10_0xe159=function(_0x35e0aa,_0x4e40bb){_0x35e0aa=_0x35e0aa-0x114;let _0x461c76=_0x5649fc[_0x35e0aa];return _0x461c76;},a10_0xe159(_0x130f9f,_0x26eb74);}exports[a10_0x32d9a8(0x150)]=cancel;const restart=async(_0x50194c,_0x34b269)=>{const _0x1390bc=a10_0x32d9a8,{id:_0x5c8fe2}=_0x50194c[_0x1390bc(0x157)];return await(0x0,RestartService_1['RestartService'])(+_0x5c8fe2),_0x34b269[_0x1390bc(0x142)](0xcc)['json']({'message':_0x1390bc(0x13a)});};function a10_0x461c(){const _0x5be5fb=['companyId','cancel','error','catch','findAll','configurable','resolve','../errors/AppError','params','call','name','delete','Mensagem\x20enviada','deleteMedia','../services/CampaignService/DeleteService','../services/CampaignService/RestartService','index','Arquivo\x20exclu√≠do','mediaPath','get','save','constructor','show','user','toISOString','shape','../services/CampaignService/CreateService','hasOwnProperty','../models/TicketTag','findList','company-','number','prototype','findByPk','validate','update','yup','search','getIO','originalname','265596MjbRYB','files','default','send','423273rZsMiM','2577272XbrzuX','-mainchannel','890042IbRNuv','email','json','../models/Contact','query','bulkCreate','object','(((.+)+)+)+$','tagListId','map','string','public','__setModuleDefault','../models/Ticket','toString','30QjqoQi','defineProperty','path','__esModule','getOwnPropertyDescriptor','then','company','existsSync','-campaign','19024790ttzGet','store','emit','4025utZIGM','restart','1163079vImSFs','../models/ContactList','writable','__createBinding','message','CancelService','remove','Error\x20creating\x20contact\x20list','required','../services/CampaignService/FindService','Rein√≠cio\x20dos\x20disparos','../services/CampaignService/ListService','create','__importDefault','mediaName','filename','lodash','head','status','../services/CampaignService/ShowService','Error:','unlinkSync','body','__importStar','mediaUpload','../models/ContactListItem','Campaign\x20deleted','\x20-\x20','9PXtMjg','Cancelamento\x20realizado','2586lbecxv'];a10_0x461c=function(){return _0x5be5fb;};return a10_0x461c();}exports[a10_0x32d9a8(0x12f)]=restart;const remove=async(_0x33bfb9,_0x1b0715)=>{const _0xdc9668=a10_0x32d9a8,{id:_0x1b0724}=_0x33bfb9['params'],{companyId:_0x5c8981}=_0x33bfb9['user'];await(0x0,DeleteService_1[_0xdc9668(0x179)])(_0x1b0724);const _0x23a134=(0x0,socket_1[_0xdc9668(0x175)])();return _0x23a134['to'](_0xdc9668(0x16d)+_0x5c8981+'-mainchannel')[_0xdc9668(0x12d)](_0xdc9668(0x16d)+_0x5c8981+'-campaign',{'action':_0xdc9668(0x15a),'id':_0x1b0724}),_0x1b0715[_0xdc9668(0x142)](0xc8)[_0xdc9668(0x115)]({'message':_0xdc9668(0x14a)});};exports[a10_0x32d9a8(0x136)]=remove;const findList=async(_0x2a27eb,_0x563402)=>{const _0x2329d1=a10_0x32d9a8,_0x488f41=_0x2a27eb[_0x2329d1(0x117)],_0x5db7c6=await(0x0,FindService_1[_0x2329d1(0x179)])(_0x488f41);return _0x563402[_0x2329d1(0x142)](0xc8)[_0x2329d1(0x115)](_0x5db7c6);};exports[a10_0x32d9a8(0x16c)]=findList;const mediaUpload=async(_0x324b88,_0x41c5be)=>{const _0x1eec70=a10_0x32d9a8,{id:_0x3c6715}=_0x324b88[_0x1eec70(0x157)],_0x36dc13=_0x324b88[_0x1eec70(0x178)],_0x42e9b2=(0x0,lodash_1[_0x1eec70(0x141)])(_0x36dc13);try{const _0x268aae=await Campaign_1[_0x1eec70(0x179)][_0x1eec70(0x170)](_0x3c6715);return _0x268aae[_0x1eec70(0x161)]=_0x42e9b2[_0x1eec70(0x13f)],_0x268aae[_0x1eec70(0x13e)]=_0x42e9b2[_0x1eec70(0x176)],await _0x268aae[_0x1eec70(0x163)](),_0x41c5be[_0x1eec70(0x17a)]({'mensagem':_0x1eec70(0x15b)});}catch(_0x512ca7){throw new AppError_1[(_0x1eec70(0x179))](_0x512ca7[_0x1eec70(0x134)]);}};exports[a10_0x32d9a8(0x148)]=mediaUpload;const deleteMedia=async(_0x58e10b,_0x4b5a28)=>{const _0x48eded=a10_0x32d9a8,{id:_0x4e09ef}=_0x58e10b['params'];try{const _0x34d4c7=await Campaign_1[_0x48eded(0x179)]['findByPk'](_0x4e09ef),_0x206ed8=path_1['default'][_0x48eded(0x155)](_0x48eded(0x11e),_0x48eded(0x128)+_0x34d4c7[_0x48eded(0x14f)],_0x34d4c7[_0x48eded(0x161)]),_0x4a8bfc=fs_1[_0x48eded(0x179)][_0x48eded(0x129)](_0x206ed8);return _0x4a8bfc&&fs_1[_0x48eded(0x179)][_0x48eded(0x145)](_0x206ed8),_0x34d4c7[_0x48eded(0x161)]=null,_0x34d4c7[_0x48eded(0x13e)]=null,await _0x34d4c7[_0x48eded(0x163)](),_0x4b5a28[_0x48eded(0x17a)]({'mensagem':_0x48eded(0x160)});}catch(_0x18ca1a){throw new AppError_1[(_0x48eded(0x179))](_0x18ca1a[_0x48eded(0x134)]);}};exports['deleteMedia']=deleteMedia;