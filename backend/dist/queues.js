const a308_0x4377ed=a308_0x4f66;(function(_0x5d2c10,_0x18e175){const _0x32bf50=a308_0x4f66,_0xca274e=_0x5d2c10();while(!![]){try{const _0x8f3878=-parseInt(_0x32bf50(0x175))/0x1+-parseInt(_0x32bf50(0x11c))/0x2*(parseInt(_0x32bf50(0x124))/0x3)+-parseInt(_0x32bf50(0x126))/0x4+-parseInt(_0x32bf50(0x10b))/0x5+parseInt(_0x32bf50(0x114))/0x6+-parseInt(_0x32bf50(0xf1))/0x7+-parseInt(_0x32bf50(0xe4))/0x8*(-parseInt(_0x32bf50(0x15d))/0x9);if(_0x8f3878===_0x18e175)break;else _0xca274e['push'](_0xca274e['shift']());}catch(_0x6b3d1d){_0xca274e['push'](_0xca274e['shift']());}}}(a308_0x466c,0x59004));const a308_0x4173d5=(function(){let _0x1a448c=!![];return function(_0x438463,_0x79a7c){const _0x5e6c59=_0x1a448c?function(){const _0x145435=a308_0x4f66;if(_0x79a7c){const _0x2fee2b=_0x79a7c[_0x145435(0x165)](_0x438463,arguments);return _0x79a7c=null,_0x2fee2b;}}:function(){};return _0x1a448c=![],_0x5e6c59;};}()),a308_0x36a7ce=a308_0x4173d5(this,function(){const _0x2cfc4d=a308_0x4f66;return a308_0x36a7ce[_0x2cfc4d(0x14e)]()[_0x2cfc4d(0x15c)](_0x2cfc4d(0x117))[_0x2cfc4d(0x14e)]()[_0x2cfc4d(0x109)](a308_0x36a7ce)[_0x2cfc4d(0x15c)](_0x2cfc4d(0x117));});a308_0x36a7ce();'use strict';var __createBinding=this&&this[a308_0x4377ed(0xfb)]||(Object['create']?function(_0x5e40fb,_0x34ac09,_0x5011d4,_0x2b0460){const _0x61704e=a308_0x4377ed;if(_0x2b0460===undefined)_0x2b0460=_0x5011d4;var _0xada871=Object['getOwnPropertyDescriptor'](_0x34ac09,_0x5011d4);(!_0xada871||(_0x61704e(0x12e)in _0xada871?!_0x34ac09['__esModule']:_0xada871[_0x61704e(0x17b)]||_0xada871[_0x61704e(0xf4)]))&&(_0xada871={'enumerable':!![],'get':function(){return _0x34ac09[_0x5011d4];}}),Object[_0x61704e(0xf2)](_0x5e40fb,_0x2b0460,_0xada871);}:function(_0x2af76c,_0x3cfcfb,_0xc14cda,_0x43734f){if(_0x43734f===undefined)_0x43734f=_0xc14cda;_0x2af76c[_0x43734f]=_0x3cfcfb[_0xc14cda];}),__setModuleDefault=this&&this[a308_0x4377ed(0x15f)]||(Object[a308_0x4377ed(0x150)]?function(_0x13aebe,_0x23541f){Object['defineProperty'](_0x13aebe,'default',{'enumerable':!![],'value':_0x23541f});}:function(_0x4fae5a,_0x3c15dc){const _0x12dd38=a308_0x4377ed;_0x4fae5a[_0x12dd38(0xe9)]=_0x3c15dc;}),__importStar=this&&this[a308_0x4377ed(0xdf)]||function(_0x4f4409){const _0xe8c699=a308_0x4377ed;if(_0x4f4409&&_0x4f4409[_0xe8c699(0x100)])return _0x4f4409;var _0x432c05={};if(_0x4f4409!=null){for(var _0x4c39fd in _0x4f4409)if(_0x4c39fd!==_0xe8c699(0xe9)&&Object[_0xe8c699(0x155)][_0xe8c699(0xee)][_0xe8c699(0x10d)](_0x4f4409,_0x4c39fd))__createBinding(_0x432c05,_0x4f4409,_0x4c39fd);}return __setModuleDefault(_0x432c05,_0x4f4409),_0x432c05;},__importDefault=this&&this[a308_0x4377ed(0x113)]||function(_0xc238a0){const _0x5f22df=a308_0x4377ed;return _0xc238a0&&_0xc238a0[_0x5f22df(0x100)]?_0xc238a0:{'default':_0xc238a0};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a308_0x4377ed(0xe6)]=exports[a308_0x4377ed(0x112)]=exports['sleep']=exports[a308_0x4377ed(0x164)]=exports[a308_0x4377ed(0x177)]=exports[a308_0x4377ed(0x12b)]=exports[a308_0x4377ed(0x161)]=exports[a308_0x4377ed(0x16c)]=exports[a308_0x4377ed(0x12f)]=exports['userMonitor']=void 0x0;const Sentry=__importStar(require(a308_0x4377ed(0xfa))),bullmq_1=require('bullmq'),SendMessage_1=require(a308_0x4377ed(0x151)),Whatsapp_1=__importDefault(require('./models/Whatsapp')),logger_1=require(a308_0x4377ed(0x160)),moment_1=__importDefault(require('moment')),Contact_1=__importDefault(require(a308_0x4377ed(0x125))),sequelize_1=require(a308_0x4377ed(0x12c)),socket_1=require(a308_0x4377ed(0xe5)),User_1=__importDefault(require(a308_0x4377ed(0x127))),Company_1=__importDefault(require('./models/Company')),Plan_1=__importDefault(require(a308_0x4377ed(0x11e))),Ticket_1=__importDefault(require(a308_0x4377ed(0x13c))),wbotClosedTickets_1=require(a308_0x4377ed(0x13b)),Invoices_1=__importDefault(require(a308_0x4377ed(0x169))),wbotMessageListener_1=require(a308_0x4377ed(0x141)),wbot_1=require(a308_0x4377ed(0xe8)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a308_0x4377ed(0x16b))),ioredis_1=__importDefault(require(a308_0x4377ed(0x14a))),campaingJob_1=__importDefault(require(a308_0x4377ed(0x167))),scheduledMessageJob_1=__importDefault(require(a308_0x4377ed(0x139))),connection={'port':parseInt(process[a308_0x4377ed(0x132)]['REDIS_PORT']),'host':process[a308_0x4377ed(0x132)]['REDIS_HOST']||a308_0x4377ed(0x116),'password':process[a308_0x4377ed(0x132)][a308_0x4377ed(0x14b)]},limiterMax=process[a308_0x4377ed(0x132)][a308_0x4377ed(0x16e)]||0x1,limiterDuration=process[a308_0x4377ed(0x132)][a308_0x4377ed(0xe0)]||0xbb8,redis=new ioredis_1['default'](process[a308_0x4377ed(0x132)][a308_0x4377ed(0x156)]);exports[a308_0x4377ed(0x122)]=new bullmq_1[(a308_0x4377ed(0x17a))]('UserMonitor',{'connection':connection}),exports['generalMonitor']=new bullmq_1[(a308_0x4377ed(0x17a))](a308_0x4377ed(0x123),{'connection':connection}),exports[a308_0x4377ed(0x16c)]=new bullmq_1[(a308_0x4377ed(0x17a))](a308_0x4377ed(0x12a),{'connection':connection}),exports[a308_0x4377ed(0x161)]=new bullmq_1[(a308_0x4377ed(0x17a))](a308_0x4377ed(0x118),{'connection':connection}),exports['scheduleMonitor']=new bullmq_1['Queue'](a308_0x4377ed(0x163),{'connection':connection}),exports['campaignQueue']=new bullmq_1[(a308_0x4377ed(0x17a))](a308_0x4377ed(0xf9),{'connection':connection});async function handleVerifyQueueOld(_0x1a7296){const _0x270070=a308_0x4377ed;logger_1[_0x270070(0x146)][_0x270070(0x10f)]('Buscando\x20atendimentos\x20perdidos\x20nas\x20filas');try{const _0xfd126d=await Company_1[_0x270070(0xe9)][_0x270070(0x16f)]({'attributes':['id',_0x270070(0x11d)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x270070(0x147)][_0x270070(0xe3)](_0x270070(0x159))}},'include':[{'model':Whatsapp_1[_0x270070(0xe9)],'attributes':['id',_0x270070(0x11d),_0x270070(0xfd),_0x270070(0x12d),_0x270070(0x107)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0xfd126d[_0x270070(0xf0)](async _0x550085=>{const _0x155ad2=_0x270070;_0x550085['whatsapps'][_0x155ad2(0xf0)](async _0xd8c2fd=>{const _0x37fa66=_0x155ad2;if(_0xd8c2fd[_0x37fa66(0xfd)]===_0x37fa66(0xec)){var _0x37b167=_0x550085['id'];const _0x23d1f5=_0xd8c2fd[_0x37fa66(0x12d)]?_0xd8c2fd[_0x37fa66(0x12d)]:0x0,_0x43e12e=_0xd8c2fd[_0x37fa66(0x107)],_0x7d686f=_0x23d1f5,_0x3b9536=_0x43e12e,_0x3afe0e=_0x7d686f;if(_0x23d1f5>0x0){if(!isNaN(_0x3b9536)&&Number['isInteger'](_0x3b9536)&&!isNaN(_0x3afe0e)&&Number[_0x37fa66(0x136)](_0x3afe0e)){const _0x529756=(0x0,moment_1[_0x37fa66(0xe9)])()[_0x37fa66(0x13e)](_0x3afe0e,_0x37fa66(0xfe))[_0x37fa66(0xf6)]()[_0x37fa66(0xef)](),{count:_0x57392f,rows:_0x2a1bca}=await Ticket_1[_0x37fa66(0xe9)][_0x37fa66(0x130)]({'where':{'status':'pending','queueId':null,'companyId':_0x37b167,'whatsappId':_0xd8c2fd['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x529756}},'include':[{'model':Contact_1[_0x37fa66(0xe9)],'as':_0x37fa66(0x162),'attributes':['id',_0x37fa66(0x11d),_0x37fa66(0x179),_0x37fa66(0x170),_0x37fa66(0x14c)],'include':['extraInfo']}]});_0x57392f>0x0?_0x2a1bca['map'](async _0x4fe785=>{const _0x2c92a5=_0x37fa66;await _0x4fe785[_0x2c92a5(0x149)]({'queueId':_0x3b9536}),await _0x4fe785[_0x2c92a5(0x13d)]();const _0x16fee3=(0x0,socket_1[_0x2c92a5(0x148)])();_0x16fee3['to'](_0x2c92a5(0x16a)+_0x4fe785['companyId']+'-'+_0x4fe785[_0x2c92a5(0xfd)])['to'](_0x2c92a5(0x16a)+_0x4fe785[_0x2c92a5(0xf8)]+_0x2c92a5(0x15e))['to'](_0x4fe785['id'][_0x2c92a5(0x14e)]())[_0x2c92a5(0x101)](_0x2c92a5(0x16a)+_0x37b167+_0x2c92a5(0x131),{'action':_0x2c92a5(0x149),'ticket':_0x4fe785,'ticketId':_0x4fe785['id']}),logger_1[_0x2c92a5(0x146)][_0x2c92a5(0x10f)](_0x2c92a5(0x15a)+_0x4fe785['id']+_0x2c92a5(0x153)+_0x37b167);}):logger_1[_0x37fa66(0x146)][_0x37fa66(0x10f)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x37b167);}else logger_1[_0x37fa66(0x146)]['info'](_0x37fa66(0x103)+_0x37b167);}}});});}catch(_0x341060){Sentry[_0x270070(0xe1)](_0x341060),logger_1[_0x270070(0x146)]['error'](_0x270070(0x11f)+_0x341060);throw _0x341060;}};async function handleVerifyQueue(_0x1c4e6a){const _0x35e607=a308_0x4377ed;logger_1[_0x35e607(0x146)][_0x35e607(0x10f)](_0x35e607(0x16d));try{const _0x29efd0=await Company_1[_0x35e607(0xe9)]['findAll']({'attributes':['id','name'],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0x35e607(0xe3)](_0x35e607(0x159))}},'include':[{'model':Whatsapp_1['default'],'attributes':['id','name',_0x35e607(0xfd),_0x35e607(0x12d),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x29efd0['map'](async _0x4f21b6=>{const _0x1cc33a=_0x35e607;_0x4f21b6[_0x1cc33a(0x14d)][_0x1cc33a(0xf0)](async _0x26fa2b=>{const _0x344aaa=_0x1cc33a;if(_0x26fa2b[_0x344aaa(0xfd)]===_0x344aaa(0xec)){const _0x318dc1=_0x4f21b6['id'],_0x14837a=_0x26fa2b[_0x344aaa(0x12d)]?_0x26fa2b[_0x344aaa(0x12d)]:0x0,_0x34d169=_0x26fa2b[_0x344aaa(0x107)],_0x57b5cb=_0x14837a,_0x37802e=_0x34d169,_0x44d5e3=_0x57b5cb;if(_0x14837a>0x0&&!isNaN(_0x37802e)&&Number[_0x344aaa(0x136)](_0x37802e)&&!isNaN(_0x44d5e3)&&Number['isInteger'](_0x44d5e3)){const _0x3c6971=(0x0,moment_1['default'])()[_0x344aaa(0x13e)](_0x44d5e3,'minutes')[_0x344aaa(0xf6)]()[_0x344aaa(0xef)](),{count:_0x2aeeb2,rows:_0x4d4436}=await Ticket_1[_0x344aaa(0xe9)][_0x344aaa(0x130)]({'where':{'status':_0x344aaa(0x121),'queueId':null,'companyId':_0x318dc1,'whatsappId':_0x26fa2b['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x3c6971}},'include':[{'model':Contact_1['default'],'as':_0x344aaa(0x162),'attributes':['id',_0x344aaa(0x11d),'number',_0x344aaa(0x170),_0x344aaa(0x14c)],'include':[_0x344aaa(0x15b)]}]});_0x2aeeb2>0x0?_0x4d4436[_0x344aaa(0xf0)](async _0x10d179=>{const _0x16044c=_0x344aaa;await _0x10d179['update']({'queueId':_0x37802e}),await _0x10d179['reload']();const _0x3c85a2=(0x0,socket_1[_0x16044c(0x148)])();_0x3c85a2['to']('company-'+_0x10d179[_0x16044c(0xf8)]+'-'+_0x10d179['status'])['to'](_0x16044c(0x16a)+_0x10d179[_0x16044c(0xf8)]+_0x16044c(0x15e))['to'](_0x10d179['id'][_0x16044c(0x14e)]())[_0x16044c(0x101)](_0x16044c(0x16a)+_0x318dc1+_0x16044c(0x131),{'action':'update','ticket':_0x10d179,'ticketId':_0x10d179['id']}),logger_1[_0x16044c(0x146)][_0x16044c(0x10f)]('Atendimento\x20Perdido:\x20'+_0x10d179['id']+'\x20-\x20Empresa:\x20'+_0x318dc1);}):logger_1[_0x344aaa(0x146)][_0x344aaa(0x10f)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x318dc1);}else logger_1['logger'][_0x344aaa(0x10f)](_0x344aaa(0x103)+_0x318dc1);}});});}catch(_0x24725e){console[_0x35e607(0x154)](_0x24725e);}}async function handleCloseTicketsAutomatic(){const _0x582095=a308_0x4377ed,_0xeefa68=await Company_1[_0x582095(0xe9)][_0x582095(0x16f)]({'where':{'status':!![]}});_0xeefa68[_0x582095(0xf0)](async _0x2cd5e5=>{const _0x20ff27=_0x582095;try{const _0x63b78e=_0x2cd5e5['id'];await(0x0,wbotClosedTickets_1[_0x20ff27(0x108)])(_0x63b78e);}catch(_0x749764){Sentry[_0x20ff27(0xe1)](_0x749764),logger_1[_0x20ff27(0x146)][_0x20ff27(0x154)](_0x20ff27(0x133),_0x749764[_0x20ff27(0xe7)]);throw _0x749764;}});}async function messageUpdateJob(_0xf0d397){const _0x59c097=a308_0x4377ed,{data:_0x424b2c}=_0xf0d397;var _0x52fd2d=_0x424b2c[_0x59c097(0xf8)],_0xdd7304=_0x424b2c[_0x59c097(0x14f)],_0x2d80aa=_0x424b2c['whatsappId'];const _0x1e8445=(0x0,wbot_1[_0x59c097(0x106)])(_0x424b2c['whatsappId']);for(const _0x591038 of _0xdd7304){await _0x1e8445[_0x59c097(0x178)]([_0x591038[_0x59c097(0x173)]]);const _0x58237c={..._0xdd7304};_0x58237c['0']?.[_0x59c097(0x149)]['messageStubType']===0x1&&_0x58237c['0']?.[_0x59c097(0x173)][_0x59c097(0x137)]!=='status@broadcast'&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x59c097(0xe9)])(_0x58237c['0']?.[_0x59c097(0x173)]['remoteJid'],null,_0x58237c['0']?.['key']['id'],_0x52fd2d),await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x591038,_0x591038[_0x59c097(0x149)]['status']);}}async function handleMessageJob(_0x10bae6){const _0x46ea70=a308_0x4377ed,{data:_0x4379a8}=_0x10bae6;var _0x41dbe1=_0x4379a8['messages'],_0x14e0f1=_0x4379a8[_0x46ea70(0xf8)];const _0x1433c3=(0x0,wbot_1[_0x46ea70(0x106)])(_0x4379a8['whatsappId']);for(const _0x5e958d of _0x41dbe1){await(0x0,wbotMessageListener_1['handleMessage'])(_0x5e958d,_0x1433c3,_0x14e0f1),await(0x0,wbotMessageListener_1[_0x46ea70(0x102)])(_0x5e958d,_0x14e0f1),await(0x0,wbotMessageListener_1['verifyCampaignMessageAndCloseTicket'])(_0x5e958d,_0x14e0f1),_0x5e958d[_0x46ea70(0x173)][_0x46ea70(0x137)]?.[_0x46ea70(0x144)]('@g.us')&&await(0x0,wbotMessageListener_1[_0x46ea70(0x174)])(_0x5e958d,0x2);}}async function handleSendMessage(_0x2ca9f8){const _0x3fa700=a308_0x4377ed;console[_0x3fa700(0x171)]('HANDLE\x20SEND\x20MESSAGE');try{const {data:_0x45c010}=_0x2ca9f8,_0x4ebf1b=await Whatsapp_1[_0x3fa700(0xe9)][_0x3fa700(0x10a)](_0x45c010[_0x3fa700(0x142)]);if(_0x4ebf1b==null)throw new sequelize_1[(_0x3fa700(0xfc))]('Whatsapp\x20não\x20identificado');const _0x2e44bb=_0x45c010[_0x3fa700(0xea)];await(0x0,SendMessage_1[_0x3fa700(0x168)])(_0x4ebf1b,_0x2e44bb);}catch(_0x21a86f){Sentry['captureException'](_0x21a86f),logger_1[_0x3fa700(0x146)][_0x3fa700(0x154)](_0x3fa700(0x119),_0x21a86f[_0x3fa700(0xe7)]);throw _0x21a86f;}}function parseToMilliseconds(_0x42e1cc){return _0x42e1cc*0x3e8;}exports[a308_0x4377ed(0x164)]=parseToMilliseconds;function a308_0x4f66(_0x41d4e1,_0x1bec9c){const _0x16bd5f=a308_0x466c();return a308_0x4f66=function(_0x36a7ce,_0x4173d5){_0x36a7ce=_0x36a7ce-0xdf;let _0x466ca6=_0x16bd5f[_0x36a7ce];return _0x466ca6;},a308_0x4f66(_0x41d4e1,_0x1bec9c);}function a308_0x466c(){const _0x4ce944=['QueueMonitor','MessageQueue\x20->\x20SendMessage:\x20error','planId','open','10aECFuw','name','./models/Plan','SearchForQueue\x20->\x20VerifyQueue:\x20error','count','pending','userMonitor','GeneralMonitor','350319BMDKhD','./models/Contact','2465228UDnhUq','./models/User','InvoiceCreate','CloseTicketsAutomatic','MessageQueue','scheduleMonitor','sequelize','timeSendQueue','get','generalMonitor','findAndCountAll','-ticket','env','ClosedAllOpenTickets\x20->\x20Verify:\x20error','HandleMessageJob','like','isInteger','remoteJid','VerifyCampaigns','./workers/scheduledMessageJob','value','./services/WbotServices/wbotClosedTickets','./models/Ticket','reload','subtract','DD/MM/yyyy','diff','./services/WbotServices/wbotMessageListener','whatsappId','handle\x20login','endsWith','getQueue','logger','Sequelize','getIO','update','ioredis','REDIS_PASSWORD','profilePicUrl','whatsapps','toString','messageUpdate','create','./helpers/SendMessage','VerifyQueueStatus','\x20-\x20Empresa:\x20','error','prototype','REDIS_URI','getMinutes','verify','CURRENT_DATE','Atendimento\x20Perdido:\x20','extraInfo','search','207ZeHlix','-notification','__setModuleDefault','./utils/logger','queueMonitor','contact','ScheduleMonitor','parseToMilliseconds','apply','Iniciando\x20processamento\x20de\x20filas','./workers/campaingJob','SendMessage','./models/Invoices','company-','./services/WbotServices/MarkDeleteWhatsAppMessage','messageQueue','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','REDIS_OPT_LIMITER_MAX','findAll','email','log','random','key','handleMsgAck','123183ScwOvb','asDays','campaignQueue','readMessages','number','Queue','writable','__importStar','REDIS_OPT_LIMITER_DURATION','captureException','\x20segundos\x20finalizado:\x20','literal','449568PKdlNA','./libs/socket','startQueueProcess','message','./libs/wbot','default','data','VerifyLoginStatus','CONNECTED','\x20failed\x20with\x20error:\x20','hasOwnProperty','format','map','42287ybEXpX','defineProperty','YYYY-MM-DD','configurable','failed','utc','setHours','companyId','CampaignQueue','@sentry/node','__createBinding','Error','status','minutes','\x20completed','__esModule','emit','verifyRecentCampaign','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','Worker','add','getWbot','sendIdQueue','ClosedAllOpenTickets','constructor','findByPk','1390210caXhHv','duration','call','HH:mm:ss','info','\x20segundos\x20iniciado:\x20','completed','randomValue','__importDefault','4076868SlHRip','Job\x20','127.0.0.1','(((.+)+)+)+$'];a308_0x466c=function(){return _0x4ce944;};return a308_0x466c();}async function sleep(_0x4e44b9){const _0x4f56c1=a308_0x4377ed;return logger_1[_0x4f56c1(0x146)]['info']('Sleep\x20de\x20'+_0x4e44b9+_0x4f56c1(0x110)+(0x0,moment_1[_0x4f56c1(0xe9)])()['format'](_0x4f56c1(0x10e))),new Promise(_0xe0f449=>{setTimeout(()=>{const _0x36ce32=a308_0x4f66;logger_1[_0x36ce32(0x146)]['info']('Sleep\x20de\x20'+_0x4e44b9+_0x36ce32(0xe2)+(0x0,moment_1[_0x36ce32(0xe9)])()[_0x36ce32(0xef)](_0x36ce32(0x10e))),_0xe0f449(!![]);},parseToMilliseconds(_0x4e44b9));});}exports['sleep']=sleep;function randomValue(_0x337485,_0x3d2b60){const _0xf8abe6=a308_0x4377ed;return Math['floor'](Math[_0xf8abe6(0x172)]()*_0x3d2b60)+_0x337485;}exports['randomValue']=randomValue;async function handleLoginStatus(){const _0x32314d=a308_0x4377ed;console[_0x32314d(0x171)](_0x32314d(0x143));const _0x1c78fa=new Date();_0x1c78fa['setMinutes'](_0x1c78fa[_0x32314d(0x157)]()-0x5),await User_1[_0x32314d(0xe9)][_0x32314d(0x149)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x1c78fa},'online':!![]}});}async function handleInvoiceCreate(){const _0x5420f2=a308_0x4377ed;logger_1[_0x5420f2(0x146)][_0x5420f2(0x10f)]('Iniciando\x20geração\x20de\x20boletos');const _0x54eb22=await Company_1['default'][_0x5420f2(0x16f)]({'where':{'status':!![]}});_0x54eb22[_0x5420f2(0xf0)](async _0x1f630f=>{const _0x37a71b=_0x5420f2,{dueDate:_0x26b556}=_0x1f630f,_0x278582=new Date(_0x26b556)[_0x37a71b(0xf7)](0x0,0x0,0x0,0x0),_0x44a2ab=new Date(_0x26b556)[_0x37a71b(0xf7)](0x17,0x3b,0x3b,0x3e7),_0x3bce72=(0x0,moment_1[_0x37a71b(0xe9)])((0x0,moment_1[_0x37a71b(0xe9)])())['format'](_0x37a71b(0x13f)),_0x4ca3c9=(0x0,moment_1[_0x37a71b(0xe9)])(_0x26b556)[_0x37a71b(0xef)]('DD/MM/yyyy'),_0x10e19b=(0x0,moment_1[_0x37a71b(0xe9)])(_0x4ca3c9,_0x37a71b(0x13f))[_0x37a71b(0x140)]((0x0,moment_1[_0x37a71b(0xe9)])(_0x3bce72,_0x37a71b(0x13f))),_0x2081a3=moment_1[_0x37a71b(0xe9)][_0x37a71b(0x10c)](_0x10e19b)[_0x37a71b(0x176)]();if(_0x2081a3<0x14){const _0xdfa44d=await Plan_1[_0x37a71b(0xe9)][_0x37a71b(0x10a)](_0x1f630f[_0x37a71b(0x11a)]);let _0x11e62f=await Invoices_1[_0x37a71b(0xe9)][_0x37a71b(0x120)]({'where':{'companyId':_0x1f630f['id'],'dueDate':{[sequelize_1['Op'][_0x37a71b(0x135)]]:(0x0,moment_1[_0x37a71b(0xe9)])(_0x26b556)['format'](_0x37a71b(0xf3))}}});if(+_0x11e62f===0x0){const _0x3cfcb4=(0x0,moment_1[_0x37a71b(0xe9)])()[_0x37a71b(0xef)]();await Invoices_1['default'][_0x37a71b(0x150)]({'detail':_0xdfa44d['name'],'status':_0x37a71b(0x11b),'value':_0xdfa44d[_0x37a71b(0x13a)],'updatedAt':_0x3cfcb4,'createdAt':_0x3cfcb4,'dueDate':(0x0,moment_1[_0x37a71b(0xe9)])(_0x26b556)['format'](_0x37a71b(0xf3)),'companyId':_0x1f630f['id']});}}});}async function startQueueProcess(){const _0x144505=a308_0x4377ed;logger_1[_0x144505(0x146)][_0x144505(0x10f)](_0x144505(0x166)),await exports[_0x144505(0x122)][_0x144505(0x105)](_0x144505(0xeb),{},{'repeat':{'every':0xea60*0x5,'key':_0x144505(0xeb)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x481856=new bullmq_1[(_0x144505(0x104))](exports[_0x144505(0x122)][_0x144505(0x11d)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x481856['on'](_0x144505(0x111),async _0x29ed7c=>{const _0x2a28e2=_0x144505;logger_1[_0x2a28e2(0x146)][_0x2a28e2(0x10f)](_0x2a28e2(0x115)+_0x29ed7c[_0x2a28e2(0x11d)]+_0x2a28e2(0xff));}),await exports[_0x144505(0x12f)][_0x144505(0x105)](_0x144505(0x129),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x144505(0x129)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x144505(0x12f)][_0x144505(0x105)](_0x144505(0x128),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x144505(0x128)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x30cbad=new bullmq_1[(_0x144505(0x104))](exports[_0x144505(0x12f)]['name'],async _0x2d5661=>{const _0x2e24cc=_0x144505;if(_0x2d5661[_0x2e24cc(0x11d)]=='CloseTicketsAutomatic')await handleCloseTicketsAutomatic();else _0x2d5661[_0x2e24cc(0x11d)]==_0x2e24cc(0x128)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x144505(0x177)][_0x144505(0x105)](_0x144505(0x138),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x144505(0x138)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0x144505(0xe9))](exports[_0x144505(0x177)][_0x144505(0x11d)],connection);const _0x5d5e68=new bullmq_1[(_0x144505(0x104))](exports[_0x144505(0x16c)]['name'],async _0x4bc88d=>{const _0x539bb6=_0x144505;if(_0x4bc88d[_0x539bb6(0x11d)]==_0x539bb6(0x134))await handleMessageJob(_0x4bc88d);else{if(_0x4bc88d[_0x539bb6(0x11d)]=='MessageUpdateJob')await messageUpdateJob(_0x4bc88d);else _0x4bc88d[_0x539bb6(0x11d)]=='SendMessage'&&await handleSendMessage(_0x4bc88d);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x5d5e68['on'](_0x144505(0x111),async _0x32a227=>{const _0xe1b2db=_0x144505;logger_1[_0xe1b2db(0x146)]['info']('Job\x20'+_0x32a227[_0xe1b2db(0x11d)]+_0xe1b2db(0xff));}),_0x5d5e68['on'](_0x144505(0xf5),async(_0x590551,_0x4cc32b)=>{const _0x56aefc=_0x144505;logger_1[_0x56aefc(0x146)][_0x56aefc(0x154)]('Job\x20'+_0x590551[_0x56aefc(0x11d)]+_0x56aefc(0xed)+_0x4cc32b[_0x56aefc(0xe7)]);}),await exports['queueMonitor'][_0x144505(0x105)](_0x144505(0x152),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x144505(0x152)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x428954=new bullmq_1[(_0x144505(0x104))](exports[_0x144505(0x161)]['name'],async _0x5d7bbc=>{const _0x3dd0b9=_0x144505;_0x5d7bbc[_0x3dd0b9(0x11d)]==_0x3dd0b9(0x152)&&await handleVerifyQueue(_0x5d7bbc);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x428954['on'](_0x144505(0x111),async _0x14d935=>{const _0x456e4a=_0x144505;logger_1[_0x456e4a(0x146)][_0x456e4a(0x10f)](_0x456e4a(0x115)+_0x14d935['id']+_0x456e4a(0xff));});let _0x4aa5f0=new scheduledMessageJob_1[(_0x144505(0xe9))](exports[_0x144505(0x12b)],connection);await _0x4aa5f0[_0x144505(0x145)]()[_0x144505(0x105)]('VerifySchedules',{},{'repeat':{'every':0xea60*0x5,'key':_0x144505(0x158)},'removeOnComplete':!![],'removeOnFail':!![]});}exports['startQueueProcess']=startQueueProcess;