const a308_0x20cadc=a308_0x3271;function a308_0x3271(_0x45739e,_0x2f2cb2){const _0x20847d=a308_0x283f();return a308_0x3271=function(_0x3dacb9,_0x335a88){_0x3dacb9=_0x3dacb9-0x77;let _0x283fbf=_0x20847d[_0x3dacb9];return _0x283fbf;},a308_0x3271(_0x45739e,_0x2f2cb2);}(function(_0x3e3db6,_0x4bb019){const _0x2cc60d=a308_0x3271,_0x5cc403=_0x3e3db6();while(!![]){try{const _0x404f65=-parseInt(_0x2cc60d(0x111))/0x1*(parseInt(_0x2cc60d(0xd1))/0x2)+parseInt(_0x2cc60d(0x10a))/0x3+-parseInt(_0x2cc60d(0x112))/0x4*(-parseInt(_0x2cc60d(0x117))/0x5)+-parseInt(_0x2cc60d(0xf5))/0x6+parseInt(_0x2cc60d(0xd3))/0x7*(parseInt(_0x2cc60d(0x88))/0x8)+-parseInt(_0x2cc60d(0x85))/0x9*(-parseInt(_0x2cc60d(0x9c))/0xa)+-parseInt(_0x2cc60d(0xe3))/0xb*(-parseInt(_0x2cc60d(0x86))/0xc);if(_0x404f65===_0x4bb019)break;else _0x5cc403['push'](_0x5cc403['shift']());}catch(_0x988b3d){_0x5cc403['push'](_0x5cc403['shift']());}}}(a308_0x283f,0xd0336));const a308_0x335a88=(function(){let _0x46d156=!![];return function(_0x367da9,_0x50c2cf){const _0x52b200=_0x46d156?function(){const _0x2435ca=a308_0x3271;if(_0x50c2cf){const _0x598153=_0x50c2cf[_0x2435ca(0xb7)](_0x367da9,arguments);return _0x50c2cf=null,_0x598153;}}:function(){};return _0x46d156=![],_0x52b200;};}()),a308_0x3dacb9=a308_0x335a88(this,function(){const _0xfc9215=a308_0x3271;return a308_0x3dacb9[_0xfc9215(0x107)]()[_0xfc9215(0xaf)](_0xfc9215(0xff))[_0xfc9215(0x107)]()[_0xfc9215(0x110)](a308_0x3dacb9)[_0xfc9215(0xaf)]('(((.+)+)+)+$');});a308_0x3dacb9();'use strict';function a308_0x283f(){const _0x15a180=['VerifyCampaigns','create','VerifyLoginStatus','HH:mm:ss','Queue','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','endsWith','format','30Kygxgw','messageQueue','message','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','defineProperty','moment','@g.us','./models/Company','./models/Plan','./services/WbotServices/MarkDeleteWhatsAppMessage','default','./helpers/SendMessage','call','failed','name','\x20segundos\x20iniciado:\x20','number','ClosedAllOpenTickets\x20->\x20Verify:\x20error','random','search','sequelize','asDays','getQueue','MessageUpdateJob','setHours','companyId','\x20-\x20Empresa:\x20','apply','InvoiceCreate','./workers/scheduledMessageJob','QueueMonitor','CloseTicketsAutomatic','env','./services/WbotServices/wbotClosedTickets','count','\x20completed','Iniciando\x20geração\x20de\x20boletos','REDIS_OPT_LIMITER_DURATION','__importDefault','MessageQueue\x20->\x20SendMessage:\x20error','userMonitor','scheduleMonitor','REDIS_PORT','error','emit','sleep','Worker','./models/Whatsapp','findAndCountAll','whatsappId','completed','duration','REDIS_PASSWORD','18HVcKtZ','contact','2465834rPBSpj','generalMonitor','YYYY-MM-DD','update','./libs/wbot','handleMessage','key','startQueueProcess','literal','Whatsapp\x20não\x20identificado','handle\x20login','whatsapps','extraInfo','./models/Invoices','utc','prototype','272921BxjAoT','CampaignQueue','info','planId','findAll','queueMonitor','-notification','CURRENT_DATE','@sentry/node','company-','Error','handleMsgAck','UserMonitor','Sleep\x20de\x20','DD/MM/yyyy','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','randomValue','Iniciando\x20processamento\x20de\x20filas','3977244cmdrSv','getWbot','email','__importStar','logger','minutes','bullmq','-ticket','CONNECTED','REDIS_OPT_LIMITER_MAX','(((.+)+)+)+$','getOwnPropertyDescriptor','HANDLE\x20SEND\x20MESSAGE','Job\x20','getIO','VerifyQueueStatus','MessageQueue','add','toString','data','SendMessage','790800zmDqTS','configurable','status@broadcast','log','ClosedAllOpenTickets','./models/User','constructor','178170cyBraq','84kdchgq','REDIS_HOST','__setModuleDefault','findByPk','diff','192365waEduj','profilePicUrl','SearchForQueue\x20->\x20VerifyQueue:\x20error','messages','__esModule','captureException','Sequelize','get','messageStubType','writable','map','readMessages','\x20segundos\x20finalizado:\x20','parseToMilliseconds','./workers/campaingJob','3061782NtqrWv','156OohDse','campaignQueue','16vrVUdF','timeSendQueue','REDIS_URI','remoteJid','sendIdQueue','VerifySchedules','status','isInteger','verifyRecentCampaign','getMinutes','./models/Contact','subtract'];a308_0x283f=function(){return _0x15a180;};return a308_0x283f();}var __createBinding=this&&this['__createBinding']||(Object[a308_0x20cadc(0x95)]?function(_0x340fd4,_0x16ba29,_0x3d1e2c,_0x406ebe){const _0x391762=a308_0x20cadc;if(_0x406ebe===undefined)_0x406ebe=_0x3d1e2c;var _0x415674=Object[_0x391762(0x100)](_0x16ba29,_0x3d1e2c);(!_0x415674||(_0x391762(0x7d)in _0x415674?!_0x16ba29['__esModule']:_0x415674[_0x391762(0x7f)]||_0x415674[_0x391762(0x10b)]))&&(_0x415674={'enumerable':!![],'get':function(){return _0x16ba29[_0x3d1e2c];}}),Object[_0x391762(0xa0)](_0x340fd4,_0x406ebe,_0x415674);}:function(_0x2e73c4,_0x3b6ef0,_0x2d6535,_0x2fc978){if(_0x2fc978===undefined)_0x2fc978=_0x2d6535;_0x2e73c4[_0x2fc978]=_0x3b6ef0[_0x2d6535];}),__setModuleDefault=this&&this[a308_0x20cadc(0x114)]||(Object[a308_0x20cadc(0x95)]?function(_0x342b74,_0x41a67c){const _0x5bc5d7=a308_0x20cadc;Object[_0x5bc5d7(0xa0)](_0x342b74,_0x5bc5d7(0xa6),{'enumerable':!![],'value':_0x41a67c});}:function(_0x4b99a8,_0x3c341e){_0x4b99a8['default']=_0x3c341e;}),__importStar=this&&this[a308_0x20cadc(0xf8)]||function(_0x5d3898){const _0x5d3bc=a308_0x20cadc;if(_0x5d3898&&_0x5d3898['__esModule'])return _0x5d3898;var _0x247d4f={};if(_0x5d3898!=null){for(var _0xa56a7d in _0x5d3898)if(_0xa56a7d!==_0x5d3bc(0xa6)&&Object[_0x5d3bc(0xe2)]['hasOwnProperty'][_0x5d3bc(0xa8)](_0x5d3898,_0xa56a7d))__createBinding(_0x247d4f,_0x5d3898,_0xa56a7d);}return __setModuleDefault(_0x247d4f,_0x5d3898),_0x247d4f;},__importDefault=this&&this[a308_0x20cadc(0xc2)]||function(_0x143236){const _0x48df1a=a308_0x20cadc;return _0x143236&&_0x143236[_0x48df1a(0x7a)]?_0x143236:{'default':_0x143236};};Object[a308_0x20cadc(0xa0)](exports,a308_0x20cadc(0x7a),{'value':!![]}),exports[a308_0x20cadc(0xda)]=exports[a308_0x20cadc(0xf3)]=exports[a308_0x20cadc(0xc9)]=exports[a308_0x20cadc(0x83)]=exports[a308_0x20cadc(0x87)]=exports[a308_0x20cadc(0xc5)]=exports[a308_0x20cadc(0xe8)]=exports[a308_0x20cadc(0x9d)]=exports[a308_0x20cadc(0xd4)]=exports[a308_0x20cadc(0xc4)]=void 0x0;const Sentry=__importStar(require(a308_0x20cadc(0xeb))),bullmq_1=require(a308_0x20cadc(0xfb)),SendMessage_1=require(a308_0x20cadc(0xa7)),Whatsapp_1=__importDefault(require(a308_0x20cadc(0xcb))),logger_1=require('./utils/logger'),moment_1=__importDefault(require(a308_0x20cadc(0xa1))),Contact_1=__importDefault(require(a308_0x20cadc(0x92))),sequelize_1=require(a308_0x20cadc(0xb0)),socket_1=require('./libs/socket'),User_1=__importDefault(require(a308_0x20cadc(0x10f))),Company_1=__importDefault(require(a308_0x20cadc(0xa3))),Plan_1=__importDefault(require(a308_0x20cadc(0xa4))),Ticket_1=__importDefault(require('./models/Ticket')),wbotClosedTickets_1=require(a308_0x20cadc(0xbd)),Invoices_1=__importDefault(require(a308_0x20cadc(0xe0))),wbotMessageListener_1=require('./services/WbotServices/wbotMessageListener'),wbot_1=require(a308_0x20cadc(0xd7)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a308_0x20cadc(0xa5))),ioredis_1=__importDefault(require('ioredis')),campaingJob_1=__importDefault(require(a308_0x20cadc(0x84))),scheduledMessageJob_1=__importDefault(require(a308_0x20cadc(0xb9))),connection={'port':parseInt(process[a308_0x20cadc(0xbc)][a308_0x20cadc(0xc6)]),'host':process[a308_0x20cadc(0xbc)][a308_0x20cadc(0x113)]||'127.0.0.1','password':process[a308_0x20cadc(0xbc)][a308_0x20cadc(0xd0)]},limiterMax=process['env'][a308_0x20cadc(0xfe)]||0x1,limiterDuration=process[a308_0x20cadc(0xbc)][a308_0x20cadc(0xc1)]||0xbb8,redis=new ioredis_1[(a308_0x20cadc(0xa6))](process[a308_0x20cadc(0xbc)][a308_0x20cadc(0x8a)]);exports[a308_0x20cadc(0xc4)]=new bullmq_1[(a308_0x20cadc(0x98))](a308_0x20cadc(0xef),{'connection':connection}),exports[a308_0x20cadc(0xd4)]=new bullmq_1[(a308_0x20cadc(0x98))]('GeneralMonitor',{'connection':connection}),exports[a308_0x20cadc(0x9d)]=new bullmq_1[(a308_0x20cadc(0x98))](a308_0x20cadc(0x105),{'connection':connection}),exports['queueMonitor']=new bullmq_1[(a308_0x20cadc(0x98))](a308_0x20cadc(0xba),{'connection':connection}),exports[a308_0x20cadc(0xc5)]=new bullmq_1[(a308_0x20cadc(0x98))]('ScheduleMonitor',{'connection':connection}),exports[a308_0x20cadc(0x87)]=new bullmq_1[(a308_0x20cadc(0x98))](a308_0x20cadc(0xe4),{'connection':connection});async function handleVerifyQueueOld(_0x239d15){const _0x350892=a308_0x20cadc;logger_1[_0x350892(0xf9)][_0x350892(0xe5)](_0x350892(0xf2));try{const _0x1deaa8=await Company_1[_0x350892(0xa6)][_0x350892(0xe7)]({'attributes':['id','name'],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x350892(0x7c)][_0x350892(0xdb)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x350892(0xa6)],'attributes':['id',_0x350892(0xaa),'status',_0x350892(0x89),'sendIdQueue'],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x1deaa8[_0x350892(0x80)](async _0x5dfb38=>{const _0x46e296=_0x350892;_0x5dfb38[_0x46e296(0xde)][_0x46e296(0x80)](async _0x108174=>{const _0x133efb=_0x46e296;if(_0x108174[_0x133efb(0x8e)]===_0x133efb(0xfd)){var _0x13830b=_0x5dfb38['id'];const _0x3e0ed7=_0x108174[_0x133efb(0x89)]?_0x108174[_0x133efb(0x89)]:0x0,_0x58ae99=_0x108174[_0x133efb(0x8c)],_0x52715b=_0x3e0ed7,_0x2291c2=_0x58ae99,_0x1c8d63=_0x52715b;if(_0x3e0ed7>0x0){if(!isNaN(_0x2291c2)&&Number['isInteger'](_0x2291c2)&&!isNaN(_0x1c8d63)&&Number[_0x133efb(0x8f)](_0x1c8d63)){const _0x3c1a5f=(0x0,moment_1['default'])()[_0x133efb(0x93)](_0x1c8d63,_0x133efb(0xfa))[_0x133efb(0xe1)]()[_0x133efb(0x9b)](),{count:_0x382de7,rows:_0x44cadd}=await Ticket_1[_0x133efb(0xa6)][_0x133efb(0xcc)]({'where':{'status':'pending','queueId':null,'companyId':_0x13830b,'whatsappId':_0x108174['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x3c1a5f}},'include':[{'model':Contact_1[_0x133efb(0xa6)],'as':_0x133efb(0xd2),'attributes':['id','name','number',_0x133efb(0xf7),'profilePicUrl'],'include':['extraInfo']}]});_0x382de7>0x0?_0x44cadd[_0x133efb(0x80)](async _0x29eb56=>{const _0x5f5244=_0x133efb;await _0x29eb56[_0x5f5244(0xd6)]({'queueId':_0x2291c2}),await _0x29eb56['reload']();const _0x2bd6dd=(0x0,socket_1[_0x5f5244(0x103)])();_0x2bd6dd['to']('company-'+_0x29eb56[_0x5f5244(0xb5)]+'-'+_0x29eb56[_0x5f5244(0x8e)])['to'](_0x5f5244(0xec)+_0x29eb56['companyId']+'-notification')['to'](_0x29eb56['id'][_0x5f5244(0x107)]())[_0x5f5244(0xc8)](_0x5f5244(0xec)+_0x13830b+_0x5f5244(0xfc),{'action':_0x5f5244(0xd6),'ticket':_0x29eb56,'ticketId':_0x29eb56['id']}),logger_1[_0x5f5244(0xf9)][_0x5f5244(0xe5)]('Atendimento\x20Perdido:\x20'+_0x29eb56['id']+_0x5f5244(0xb6)+_0x13830b);}):logger_1[_0x133efb(0xf9)]['info'](_0x133efb(0x9f)+_0x13830b);}else logger_1['logger'][_0x133efb(0xe5)](_0x133efb(0x99)+_0x13830b);}}});});}catch(_0x327477){Sentry['captureException'](_0x327477),logger_1['logger']['error'](_0x350892(0x78)+_0x327477);throw _0x327477;}};async function handleVerifyQueue(_0x468ac9){const _0x486208=a308_0x20cadc;logger_1[_0x486208(0xf9)]['info'](_0x486208(0xf2));try{const _0x33b806=await Company_1[_0x486208(0xa6)][_0x486208(0xe7)]({'attributes':['id',_0x486208(0xaa)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x486208(0x7c)][_0x486208(0xdb)](_0x486208(0xea))}},'include':[{'model':Whatsapp_1[_0x486208(0xa6)],'attributes':['id',_0x486208(0xaa),_0x486208(0x8e),'timeSendQueue',_0x486208(0x8c)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x33b806[_0x486208(0x80)](async _0x1346ac=>{const _0x5ca163=_0x486208;_0x1346ac[_0x5ca163(0xde)][_0x5ca163(0x80)](async _0x2c07aa=>{const _0x37de55=_0x5ca163;if(_0x2c07aa[_0x37de55(0x8e)]===_0x37de55(0xfd)){const _0x3615c5=_0x1346ac['id'],_0x2ca7ec=_0x2c07aa[_0x37de55(0x89)]?_0x2c07aa['timeSendQueue']:0x0,_0x2895e4=_0x2c07aa[_0x37de55(0x8c)],_0x5c6838=_0x2ca7ec,_0x2ad669=_0x2895e4,_0x3082ff=_0x5c6838;if(_0x2ca7ec>0x0&&!isNaN(_0x2ad669)&&Number[_0x37de55(0x8f)](_0x2ad669)&&!isNaN(_0x3082ff)&&Number[_0x37de55(0x8f)](_0x3082ff)){const _0x5c8f88=(0x0,moment_1['default'])()['subtract'](_0x3082ff,_0x37de55(0xfa))[_0x37de55(0xe1)]()[_0x37de55(0x9b)](),{count:_0x53859d,rows:_0x1c6138}=await Ticket_1[_0x37de55(0xa6)][_0x37de55(0xcc)]({'where':{'status':'pending','queueId':null,'companyId':_0x3615c5,'whatsappId':_0x2c07aa['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x5c8f88}},'include':[{'model':Contact_1[_0x37de55(0xa6)],'as':_0x37de55(0xd2),'attributes':['id',_0x37de55(0xaa),_0x37de55(0xac),_0x37de55(0xf7),_0x37de55(0x77)],'include':[_0x37de55(0xdf)]}]});_0x53859d>0x0?_0x1c6138[_0x37de55(0x80)](async _0x3b7832=>{const _0x5ef9c3=_0x37de55;await _0x3b7832['update']({'queueId':_0x2ad669}),await _0x3b7832['reload']();const _0x4b1088=(0x0,socket_1[_0x5ef9c3(0x103)])();_0x4b1088['to'](_0x5ef9c3(0xec)+_0x3b7832[_0x5ef9c3(0xb5)]+'-'+_0x3b7832[_0x5ef9c3(0x8e)])['to']('company-'+_0x3b7832[_0x5ef9c3(0xb5)]+_0x5ef9c3(0xe9))['to'](_0x3b7832['id'][_0x5ef9c3(0x107)]())['emit'](_0x5ef9c3(0xec)+_0x3615c5+'-ticket',{'action':'update','ticket':_0x3b7832,'ticketId':_0x3b7832['id']}),logger_1[_0x5ef9c3(0xf9)][_0x5ef9c3(0xe5)]('Atendimento\x20Perdido:\x20'+_0x3b7832['id']+_0x5ef9c3(0xb6)+_0x3615c5);}):logger_1[_0x37de55(0xf9)]['info'](_0x37de55(0x9f)+_0x3615c5);}else logger_1['logger']['info'](_0x37de55(0x99)+_0x3615c5);}});});}catch(_0x526e38){console[_0x486208(0xc7)](_0x526e38);}}async function handleCloseTicketsAutomatic(){const _0x27b8d2=a308_0x20cadc,_0x513860=await Company_1[_0x27b8d2(0xa6)][_0x27b8d2(0xe7)]({'where':{'status':!![]}});_0x513860[_0x27b8d2(0x80)](async _0xedd9e0=>{const _0x400c7e=_0x27b8d2;try{const _0x184cd9=_0xedd9e0['id'];await(0x0,wbotClosedTickets_1[_0x400c7e(0x10e)])(_0x184cd9);}catch(_0x464184){Sentry['captureException'](_0x464184),logger_1[_0x400c7e(0xf9)][_0x400c7e(0xc7)](_0x400c7e(0xad),_0x464184[_0x400c7e(0x9e)]);throw _0x464184;}});}async function messageUpdateJob(_0x27fb80){const _0x25408c=a308_0x20cadc,{data:_0x26b774}=_0x27fb80;var _0x4ad657=_0x26b774[_0x25408c(0xb5)],_0x3cb36d=_0x26b774['messageUpdate'],_0xe4f93a=_0x26b774['whatsappId'];const _0x446ec4=(0x0,wbot_1['getWbot'])(_0x26b774[_0x25408c(0xcd)]);for(const _0x28cee7 of _0x3cb36d){await _0x446ec4[_0x25408c(0x81)]([_0x28cee7[_0x25408c(0xd9)]]);const _0x55fb6a={..._0x3cb36d};_0x55fb6a['0']?.['update'][_0x25408c(0x7e)]===0x1&&_0x55fb6a['0']?.[_0x25408c(0xd9)][_0x25408c(0x8b)]!==_0x25408c(0x10c)&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x25408c(0xa6)])(_0x55fb6a['0']?.['key'][_0x25408c(0x8b)],null,_0x55fb6a['0']?.[_0x25408c(0xd9)]['id'],_0x4ad657),await(0x0,wbotMessageListener_1[_0x25408c(0xee)])(_0x28cee7,_0x28cee7[_0x25408c(0xd6)][_0x25408c(0x8e)]);}}async function handleMessageJob(_0xc6fa34){const _0x1e0c45=a308_0x20cadc,{data:_0x3ecfdf}=_0xc6fa34;var _0x38c684=_0x3ecfdf[_0x1e0c45(0x79)],_0x31bca1=_0x3ecfdf[_0x1e0c45(0xb5)];const _0x39c7a2=(0x0,wbot_1[_0x1e0c45(0xf6)])(_0x3ecfdf[_0x1e0c45(0xcd)]);for(const _0x49969f of _0x38c684){await(0x0,wbotMessageListener_1[_0x1e0c45(0xd8)])(_0x49969f,_0x39c7a2,_0x31bca1),await(0x0,wbotMessageListener_1[_0x1e0c45(0x90)])(_0x49969f,_0x31bca1),await(0x0,wbotMessageListener_1['verifyCampaignMessageAndCloseTicket'])(_0x49969f,_0x31bca1),_0x49969f['key'][_0x1e0c45(0x8b)]?.[_0x1e0c45(0x9a)](_0x1e0c45(0xa2))&&await(0x0,wbotMessageListener_1[_0x1e0c45(0xee)])(_0x49969f,0x2);}}async function handleSendMessage(_0x8fa2d1){const _0x30575d=a308_0x20cadc;console[_0x30575d(0x10d)](_0x30575d(0x101));try{const {data:_0x7aac00}=_0x8fa2d1,_0x3dc82e=await Whatsapp_1[_0x30575d(0xa6)][_0x30575d(0x115)](_0x7aac00['whatsappId']);if(_0x3dc82e==null)throw new sequelize_1[(_0x30575d(0xed))](_0x30575d(0xdc));const _0xa1101c=_0x7aac00[_0x30575d(0x108)];await(0x0,SendMessage_1[_0x30575d(0x109)])(_0x3dc82e,_0xa1101c);}catch(_0x2960d2){Sentry[_0x30575d(0x7b)](_0x2960d2),logger_1[_0x30575d(0xf9)][_0x30575d(0xc7)](_0x30575d(0xc3),_0x2960d2[_0x30575d(0x9e)]);throw _0x2960d2;}}function parseToMilliseconds(_0x528060){return _0x528060*0x3e8;}exports['parseToMilliseconds']=parseToMilliseconds;async function sleep(_0x59ebf1){const _0x5566ea=a308_0x20cadc;return logger_1[_0x5566ea(0xf9)][_0x5566ea(0xe5)]('Sleep\x20de\x20'+_0x59ebf1+_0x5566ea(0xab)+(0x0,moment_1['default'])()[_0x5566ea(0x9b)](_0x5566ea(0x97))),new Promise(_0x5f176d=>{setTimeout(()=>{const _0x506c14=a308_0x3271;logger_1['logger'][_0x506c14(0xe5)](_0x506c14(0xf0)+_0x59ebf1+_0x506c14(0x82)+(0x0,moment_1['default'])()[_0x506c14(0x9b)](_0x506c14(0x97))),_0x5f176d(!![]);},parseToMilliseconds(_0x59ebf1));});}exports['sleep']=sleep;function randomValue(_0xbdb8ef,_0x7e3523){const _0x2c3d4e=a308_0x20cadc;return Math['floor'](Math[_0x2c3d4e(0xae)]()*_0x7e3523)+_0xbdb8ef;}exports['randomValue']=randomValue;async function handleLoginStatus(){const _0x38c535=a308_0x20cadc;console[_0x38c535(0x10d)](_0x38c535(0xdd));const _0x16d9c2=new Date();_0x16d9c2['setMinutes'](_0x16d9c2[_0x38c535(0x91)]()-0x5),await User_1[_0x38c535(0xa6)]['update']({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x16d9c2},'online':!![]}});}async function handleInvoiceCreate(){const _0x451558=a308_0x20cadc;logger_1[_0x451558(0xf9)]['info'](_0x451558(0xc0));const _0x32561c=await Company_1[_0x451558(0xa6)]['findAll']({'where':{'status':!![]}});_0x32561c[_0x451558(0x80)](async _0x84b407=>{const _0x214733=_0x451558,{dueDate:_0x3ef7ec}=_0x84b407,_0x5ac06e=new Date(_0x3ef7ec)[_0x214733(0xb4)](0x0,0x0,0x0,0x0),_0x2b1389=new Date(_0x3ef7ec)['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5c5c87=(0x0,moment_1[_0x214733(0xa6)])((0x0,moment_1[_0x214733(0xa6)])())[_0x214733(0x9b)]('DD/MM/yyyy'),_0x2bf32a=(0x0,moment_1[_0x214733(0xa6)])(_0x3ef7ec)[_0x214733(0x9b)]('DD/MM/yyyy'),_0x14a27b=(0x0,moment_1[_0x214733(0xa6)])(_0x2bf32a,_0x214733(0xf1))[_0x214733(0x116)]((0x0,moment_1[_0x214733(0xa6)])(_0x5c5c87,_0x214733(0xf1))),_0x1dfc97=moment_1[_0x214733(0xa6)][_0x214733(0xcf)](_0x14a27b)[_0x214733(0xb1)]();if(_0x1dfc97<0x14){const _0x43db91=await Plan_1[_0x214733(0xa6)]['findByPk'](_0x84b407[_0x214733(0xe6)]);let _0x39d728=await Invoices_1[_0x214733(0xa6)][_0x214733(0xbe)]({'where':{'companyId':_0x84b407['id'],'dueDate':{[sequelize_1['Op']['like']]:(0x0,moment_1[_0x214733(0xa6)])(_0x3ef7ec)[_0x214733(0x9b)](_0x214733(0xd5))}}});if(+_0x39d728===0x0){const _0x5e3e37=(0x0,moment_1[_0x214733(0xa6)])()[_0x214733(0x9b)]();await Invoices_1[_0x214733(0xa6)][_0x214733(0x95)]({'detail':_0x43db91[_0x214733(0xaa)],'status':'open','value':_0x43db91['value'],'updatedAt':_0x5e3e37,'createdAt':_0x5e3e37,'dueDate':(0x0,moment_1['default'])(_0x3ef7ec)[_0x214733(0x9b)]('YYYY-MM-DD'),'companyId':_0x84b407['id']});}}});}async function startQueueProcess(){const _0x20a881=a308_0x20cadc;logger_1[_0x20a881(0xf9)][_0x20a881(0xe5)](_0x20a881(0xf4)),await exports['userMonitor']['add'](_0x20a881(0x96),{},{'repeat':{'every':0xea60*0x5,'key':_0x20a881(0x96)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x243a17=new bullmq_1['Worker'](exports[_0x20a881(0xc4)][_0x20a881(0xaa)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x243a17['on'](_0x20a881(0xce),async _0x31bba4=>{const _0x18b2d7=_0x20a881;logger_1[_0x18b2d7(0xf9)][_0x18b2d7(0xe5)](_0x18b2d7(0x102)+_0x31bba4['name']+'\x20completed');}),await exports[_0x20a881(0xd4)][_0x20a881(0x106)](_0x20a881(0xbb),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':'CloseTicketsAutomatic'},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x20a881(0xd4)][_0x20a881(0x106)](_0x20a881(0xb8),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x20a881(0xb8)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x5eb466=new bullmq_1[(_0x20a881(0xca))](exports[_0x20a881(0xd4)]['name'],async _0x16d6b3=>{const _0x2affe2=_0x20a881;if(_0x16d6b3[_0x2affe2(0xaa)]==_0x2affe2(0xbb))await handleCloseTicketsAutomatic();else _0x16d6b3[_0x2affe2(0xaa)]==_0x2affe2(0xb8)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x20a881(0x87)][_0x20a881(0x106)](_0x20a881(0x94),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x20a881(0x94)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1['default'](exports['campaignQueue'][_0x20a881(0xaa)],connection);const _0x4084b6=new bullmq_1[(_0x20a881(0xca))](exports[_0x20a881(0x9d)][_0x20a881(0xaa)],async _0x9f2186=>{const _0x4df747=_0x20a881;if(_0x9f2186[_0x4df747(0xaa)]=='HandleMessageJob')await handleMessageJob(_0x9f2186);else{if(_0x9f2186[_0x4df747(0xaa)]==_0x4df747(0xb3))await messageUpdateJob(_0x9f2186);else _0x9f2186[_0x4df747(0xaa)]==_0x4df747(0x109)&&await handleSendMessage(_0x9f2186);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x4084b6['on']('completed',async _0x5c3dc3=>{const _0x45da95=_0x20a881;logger_1[_0x45da95(0xf9)][_0x45da95(0xe5)]('Job\x20'+_0x5c3dc3[_0x45da95(0xaa)]+_0x45da95(0xbf));}),_0x4084b6['on'](_0x20a881(0xa9),async(_0x48d7b0,_0x3422a0)=>{const _0x3c1874=_0x20a881;logger_1[_0x3c1874(0xf9)][_0x3c1874(0xc7)]('Job\x20'+_0x48d7b0[_0x3c1874(0xaa)]+'\x20failed\x20with\x20error:\x20'+_0x3422a0['message']);}),await exports['queueMonitor'][_0x20a881(0x106)](_0x20a881(0x104),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x20a881(0x104)},'removeOnComplete':!![],'removeOnFail':!![]});const _0xf300e5=new bullmq_1[(_0x20a881(0xca))](exports[_0x20a881(0xe8)][_0x20a881(0xaa)],async _0x1c3b53=>{const _0x2b54d2=_0x20a881;_0x1c3b53[_0x2b54d2(0xaa)]==_0x2b54d2(0x104)&&await handleVerifyQueue(_0x1c3b53);},{'connection':connection,'removeOnFail':{'count':0x0}});_0xf300e5['on'](_0x20a881(0xce),async _0x19f4d8=>{const _0x302911=_0x20a881;logger_1[_0x302911(0xf9)][_0x302911(0xe5)]('Job\x20'+_0x19f4d8['id']+_0x302911(0xbf));});let _0x8d538a=new scheduledMessageJob_1['default'](exports[_0x20a881(0xc5)],connection);await _0x8d538a[_0x20a881(0xb2)]()['add'](_0x20a881(0x8d),{},{'repeat':{'every':0xea60*0x5,'key':'verify'},'removeOnComplete':!![],'removeOnFail':!![]});}exports['startQueueProcess']=startQueueProcess;