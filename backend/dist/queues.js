const a308_0x2d4d71=a308_0x5c6f;(function(_0x46875f,_0x17c947){const _0x2c5640=a308_0x5c6f,_0x4e9411=_0x46875f();while(!![]){try{const _0x43c41e=-parseInt(_0x2c5640(0x217))/0x1+parseInt(_0x2c5640(0x1b7))/0x2+parseInt(_0x2c5640(0x204))/0x3*(parseInt(_0x2c5640(0x1c5))/0x4)+-parseInt(_0x2c5640(0x233))/0x5*(parseInt(_0x2c5640(0x1fc))/0x6)+-parseInt(_0x2c5640(0x225))/0x7+parseInt(_0x2c5640(0x1ba))/0x8+parseInt(_0x2c5640(0x1e7))/0x9;if(_0x43c41e===_0x17c947)break;else _0x4e9411['push'](_0x4e9411['shift']());}catch(_0x57531c){_0x4e9411['push'](_0x4e9411['shift']());}}}(a308_0x3d49,0x5ddb2));const a308_0x175af1=(function(){let _0x25f32a=!![];return function(_0x513cc7,_0x4bd5ac){const _0x590598=_0x25f32a?function(){if(_0x4bd5ac){const _0x1f3557=_0x4bd5ac['apply'](_0x513cc7,arguments);return _0x4bd5ac=null,_0x1f3557;}}:function(){};return _0x25f32a=![],_0x590598;};}()),a308_0x2758ae=a308_0x175af1(this,function(){const _0x180b69=a308_0x5c6f;return a308_0x2758ae['toString']()[_0x180b69(0x221)](_0x180b69(0x1c6))['toString']()[_0x180b69(0x1d4)](a308_0x2758ae)[_0x180b69(0x221)]('(((.+)+)+)+$');});a308_0x2758ae();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a308_0x2d4d71(0x1e0)]?function(_0x422a0b,_0xb83877,_0x1c1cc5,_0x43165f){const _0x31ef12=a308_0x2d4d71;if(_0x43165f===undefined)_0x43165f=_0x1c1cc5;var _0x576b97=Object[_0x31ef12(0x21c)](_0xb83877,_0x1c1cc5);(!_0x576b97||(_0x31ef12(0x1ca)in _0x576b97?!_0xb83877[_0x31ef12(0x22b)]:_0x576b97['writable']||_0x576b97['configurable']))&&(_0x576b97={'enumerable':!![],'get':function(){return _0xb83877[_0x1c1cc5];}}),Object[_0x31ef12(0x1b3)](_0x422a0b,_0x43165f,_0x576b97);}:function(_0x54b888,_0x233962,_0x101382,_0x9d7120){if(_0x9d7120===undefined)_0x9d7120=_0x101382;_0x54b888[_0x9d7120]=_0x233962[_0x101382];}),__setModuleDefault=this&&this[a308_0x2d4d71(0x1a6)]||(Object['create']?function(_0x4feb2b,_0x565851){const _0x10143d=a308_0x2d4d71;Object[_0x10143d(0x1b3)](_0x4feb2b,_0x10143d(0x21b),{'enumerable':!![],'value':_0x565851});}:function(_0x3276b4,_0x4eb5e2){const _0x1c4977=a308_0x2d4d71;_0x3276b4[_0x1c4977(0x21b)]=_0x4eb5e2;}),__importStar=this&&this['__importStar']||function(_0x2b986d){const _0xc1caac=a308_0x2d4d71;if(_0x2b986d&&_0x2b986d[_0xc1caac(0x22b)])return _0x2b986d;var _0x1e92c3={};if(_0x2b986d!=null){for(var _0x30b6d2 in _0x2b986d)if(_0x30b6d2!==_0xc1caac(0x21b)&&Object['prototype'][_0xc1caac(0x1f4)][_0xc1caac(0x216)](_0x2b986d,_0x30b6d2))__createBinding(_0x1e92c3,_0x2b986d,_0x30b6d2);}return __setModuleDefault(_0x1e92c3,_0x2b986d),_0x1e92c3;},__importDefault=this&&this[a308_0x2d4d71(0x1b6)]||function(_0xcc5b0b){const _0x268a8d=a308_0x2d4d71;return _0xcc5b0b&&_0xcc5b0b[_0x268a8d(0x22b)]?_0xcc5b0b:{'default':_0xcc5b0b};};Object[a308_0x2d4d71(0x1b3)](exports,'__esModule',{'value':!![]}),exports[a308_0x2d4d71(0x1c0)]=exports[a308_0x2d4d71(0x21a)]=exports[a308_0x2d4d71(0x205)]=exports['parseToMilliseconds']=exports[a308_0x2d4d71(0x213)]=exports[a308_0x2d4d71(0x1ee)]=exports[a308_0x2d4d71(0x1ae)]=exports['messageQueue']=exports[a308_0x2d4d71(0x1e1)]=exports[a308_0x2d4d71(0x235)]=void 0x0;const Sentry=__importStar(require(a308_0x2d4d71(0x222))),bullmq_1=require(a308_0x2d4d71(0x1bc)),SendMessage_1=require(a308_0x2d4d71(0x1d9)),Whatsapp_1=__importDefault(require(a308_0x2d4d71(0x22c))),logger_1=require('./utils/logger'),moment_1=__importDefault(require(a308_0x2d4d71(0x228))),Contact_1=__importDefault(require('./models/Contact')),sequelize_1=require(a308_0x2d4d71(0x1cf)),socket_1=require(a308_0x2d4d71(0x20e)),User_1=__importDefault(require(a308_0x2d4d71(0x1ad))),Company_1=__importDefault(require(a308_0x2d4d71(0x1d8))),Plan_1=__importDefault(require('./models/Plan')),Ticket_1=__importDefault(require(a308_0x2d4d71(0x1eb))),wbotClosedTickets_1=require(a308_0x2d4d71(0x1fd)),Invoices_1=__importDefault(require('./models/Invoices')),wbotMessageListener_1=require(a308_0x2d4d71(0x224)),wbot_1=require(a308_0x2d4d71(0x211)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a308_0x2d4d71(0x1de))),ioredis_1=__importDefault(require(a308_0x2d4d71(0x1d0))),campaingJob_1=__importDefault(require(a308_0x2d4d71(0x1c2))),scheduledMessageJob_1=__importDefault(require(a308_0x2d4d71(0x21f))),connection={'port':parseInt(process[a308_0x2d4d71(0x218)]['REDIS_PORT']),'host':process[a308_0x2d4d71(0x218)]['REDIS_HOST']||a308_0x2d4d71(0x1ce),'password':process[a308_0x2d4d71(0x218)][a308_0x2d4d71(0x1d1)]},limiterMax=process[a308_0x2d4d71(0x218)][a308_0x2d4d71(0x234)]||0x1,limiterDuration=process[a308_0x2d4d71(0x218)]['REDIS_OPT_LIMITER_DURATION']||0xbb8,redis=new ioredis_1[(a308_0x2d4d71(0x21b))](process[a308_0x2d4d71(0x218)][a308_0x2d4d71(0x1c9)]);exports[a308_0x2d4d71(0x235)]=new bullmq_1[(a308_0x2d4d71(0x231))]('UserMonitor',{'connection':connection}),exports['generalMonitor']=new bullmq_1[(a308_0x2d4d71(0x231))](a308_0x2d4d71(0x220),{'connection':connection}),exports[a308_0x2d4d71(0x1df)]=new bullmq_1[(a308_0x2d4d71(0x231))]('MessageQueue',{'connection':connection}),exports['queueMonitor']=new bullmq_1['Queue'](a308_0x2d4d71(0x1b2),{'connection':connection}),exports[a308_0x2d4d71(0x1ee)]=new bullmq_1[(a308_0x2d4d71(0x231))](a308_0x2d4d71(0x1ed),{'connection':connection}),exports[a308_0x2d4d71(0x213)]=new bullmq_1[(a308_0x2d4d71(0x231))](a308_0x2d4d71(0x1c3),{'connection':connection});async function handleVerifyQueueOld(_0x29b510){const _0x50d9be=a308_0x2d4d71;logger_1['logger'][_0x50d9be(0x22e)](_0x50d9be(0x207));try{const _0x177200=await Company_1[_0x50d9be(0x21b)][_0x50d9be(0x1f8)]({'attributes':['id',_0x50d9be(0x227)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x50d9be(0x1fb)]['literal'](_0x50d9be(0x22d))}},'include':[{'model':Whatsapp_1[_0x50d9be(0x21b)],'attributes':['id',_0x50d9be(0x227),_0x50d9be(0x1d3),_0x50d9be(0x1fe),_0x50d9be(0x202)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x177200['map'](async _0x2a5e10=>{const _0x4fd9d5=_0x50d9be;_0x2a5e10[_0x4fd9d5(0x226)][_0x4fd9d5(0x1b8)](async _0x348414=>{const _0x14665e=_0x4fd9d5;if(_0x348414[_0x14665e(0x1d3)]==='CONNECTED'){var _0x32e76e=_0x2a5e10['id'];const _0xba7e36=_0x348414[_0x14665e(0x1fe)]?_0x348414[_0x14665e(0x1fe)]:0x0,_0x12049a=_0x348414['sendIdQueue'],_0x407f9e=_0xba7e36,_0x5cfb07=_0x12049a,_0x2162e3=_0x407f9e;if(_0xba7e36>0x0){if(!isNaN(_0x5cfb07)&&Number[_0x14665e(0x203)](_0x5cfb07)&&!isNaN(_0x2162e3)&&Number[_0x14665e(0x203)](_0x2162e3)){const _0x36b896=(0x0,moment_1[_0x14665e(0x21b)])()['subtract'](_0x2162e3,_0x14665e(0x22f))[_0x14665e(0x229)]()[_0x14665e(0x1c7)](),{count:_0x56c554,rows:_0x5a4b32}=await Ticket_1[_0x14665e(0x21b)][_0x14665e(0x1d2)]({'where':{'status':_0x14665e(0x1bd),'queueId':null,'companyId':_0x32e76e,'whatsappId':_0x348414['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x36b896}},'include':[{'model':Contact_1[_0x14665e(0x21b)],'as':_0x14665e(0x1b5),'attributes':['id',_0x14665e(0x227),_0x14665e(0x1ea),'email',_0x14665e(0x1af)],'include':[_0x14665e(0x1f9)]}]});_0x56c554>0x0?_0x5a4b32[_0x14665e(0x1b8)](async _0x4388f0=>{const _0x1b3b0e=_0x14665e;await _0x4388f0[_0x1b3b0e(0x1bb)]({'queueId':_0x5cfb07}),await _0x4388f0[_0x1b3b0e(0x209)]();const _0x33ccd2=(0x0,socket_1[_0x1b3b0e(0x1f6)])();_0x33ccd2['to'](_0x1b3b0e(0x1a8)+_0x4388f0[_0x1b3b0e(0x201)]+'-'+_0x4388f0['status'])['to'](_0x1b3b0e(0x1a8)+_0x4388f0[_0x1b3b0e(0x201)]+'-notification')['to'](_0x4388f0['id'][_0x1b3b0e(0x1e5)]())[_0x1b3b0e(0x1ef)]('company-'+_0x32e76e+'-ticket',{'action':_0x1b3b0e(0x1bb),'ticket':_0x4388f0,'ticketId':_0x4388f0['id']}),logger_1[_0x1b3b0e(0x214)][_0x1b3b0e(0x22e)](_0x1b3b0e(0x1b4)+_0x4388f0['id']+_0x1b3b0e(0x20f)+_0x32e76e);}):logger_1[_0x14665e(0x214)][_0x14665e(0x22e)](_0x14665e(0x20b)+_0x32e76e);}else logger_1[_0x14665e(0x214)][_0x14665e(0x22e)](_0x14665e(0x1d5)+_0x32e76e);}}});});}catch(_0x56580f){Sentry[_0x50d9be(0x1be)](_0x56580f),logger_1[_0x50d9be(0x214)][_0x50d9be(0x1b9)](_0x50d9be(0x21e)+_0x56580f);throw _0x56580f;}};async function handleVerifyQueue(_0x370098){const _0x5322e7=a308_0x2d4d71;logger_1['logger'][_0x5322e7(0x22e)](_0x5322e7(0x207));try{const _0x33bbd1=await Company_1['default'][_0x5322e7(0x1f8)]({'attributes':['id','name'],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x5322e7(0x1fb)][_0x5322e7(0x1a9)](_0x5322e7(0x22d))}},'include':[{'model':Whatsapp_1['default'],'attributes':['id',_0x5322e7(0x227),'status',_0x5322e7(0x1fe),_0x5322e7(0x202)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x33bbd1[_0x5322e7(0x1b8)](async _0x57a03d=>{const _0x4828c6=_0x5322e7;_0x57a03d[_0x4828c6(0x226)][_0x4828c6(0x1b8)](async _0x55f031=>{const _0x4b93ba=_0x4828c6;if(_0x55f031[_0x4b93ba(0x1d3)]==='CONNECTED'){const _0x52e1b3=_0x57a03d['id'],_0x28c6e6=_0x55f031[_0x4b93ba(0x1fe)]?_0x55f031[_0x4b93ba(0x1fe)]:0x0,_0x4e53ef=_0x55f031[_0x4b93ba(0x202)],_0x2888e5=_0x28c6e6,_0x325798=_0x4e53ef,_0x6952a7=_0x2888e5;if(_0x28c6e6>0x0&&!isNaN(_0x325798)&&Number['isInteger'](_0x325798)&&!isNaN(_0x6952a7)&&Number[_0x4b93ba(0x203)](_0x6952a7)){const _0x38364b=(0x0,moment_1[_0x4b93ba(0x21b)])()[_0x4b93ba(0x1c1)](_0x6952a7,_0x4b93ba(0x22f))[_0x4b93ba(0x229)]()[_0x4b93ba(0x1c7)](),{count:_0x462f05,rows:_0x3da4c5}=await Ticket_1[_0x4b93ba(0x21b)][_0x4b93ba(0x1d2)]({'where':{'status':_0x4b93ba(0x1bd),'queueId':null,'companyId':_0x52e1b3,'whatsappId':_0x55f031['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x38364b}},'include':[{'model':Contact_1['default'],'as':_0x4b93ba(0x1b5),'attributes':['id',_0x4b93ba(0x227),_0x4b93ba(0x1ea),'email','profilePicUrl'],'include':[_0x4b93ba(0x1f9)]}]});_0x462f05>0x0?_0x3da4c5[_0x4b93ba(0x1b8)](async _0x3215b3=>{const _0x4b48f2=_0x4b93ba;await _0x3215b3['update']({'queueId':_0x325798}),await _0x3215b3['reload']();const _0x53eff7=(0x0,socket_1[_0x4b48f2(0x1f6)])();_0x53eff7['to']('company-'+_0x3215b3[_0x4b48f2(0x201)]+'-'+_0x3215b3['status'])['to'](_0x4b48f2(0x1a8)+_0x3215b3[_0x4b48f2(0x201)]+'-notification')['to'](_0x3215b3['id'][_0x4b48f2(0x1e5)]())[_0x4b48f2(0x1ef)](_0x4b48f2(0x1a8)+_0x52e1b3+_0x4b48f2(0x200),{'action':_0x4b48f2(0x1bb),'ticket':_0x3215b3,'ticketId':_0x3215b3['id']}),logger_1[_0x4b48f2(0x214)]['info'](_0x4b48f2(0x1b4)+_0x3215b3['id']+'\x20-\x20Empresa:\x20'+_0x52e1b3);}):logger_1[_0x4b93ba(0x214)][_0x4b93ba(0x22e)]('Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20'+_0x52e1b3);}else logger_1[_0x4b93ba(0x214)][_0x4b93ba(0x22e)](_0x4b93ba(0x1d5)+_0x52e1b3);}});});}catch(_0xe8b68a){console['error'](_0xe8b68a);}}async function handleCloseTicketsAutomatic(){const _0x37b823=a308_0x2d4d71,_0x5b5808=await Company_1[_0x37b823(0x21b)][_0x37b823(0x1f8)]({'where':{'status':!![]}});_0x5b5808['map'](async _0x37a894=>{const _0x550936=_0x37b823;try{const _0x21f5d8=_0x37a894['id'];await(0x0,wbotClosedTickets_1['ClosedAllOpenTickets'])(_0x21f5d8);}catch(_0x34258c){Sentry[_0x550936(0x1be)](_0x34258c),logger_1[_0x550936(0x214)][_0x550936(0x1b9)](_0x550936(0x210),_0x34258c['message']);throw _0x34258c;}});}async function messageUpdateJob(_0xd96028){const _0x4b42d8=a308_0x2d4d71,{data:_0x438e86}=_0xd96028;var _0x2ae4ec=_0x438e86['companyId'],_0x33cf72=_0x438e86[_0x4b42d8(0x1f5)],_0x275f44=_0x438e86['whatsappId'];const _0x40c624=(0x0,wbot_1['getWbot'])(_0x438e86['whatsappId']);for(const _0x4f917c of _0x33cf72){await _0x40c624[_0x4b42d8(0x1cb)]([_0x4f917c[_0x4b42d8(0x236)]]);const _0x4aa76e={..._0x33cf72};_0x4aa76e['0']?.['update'][_0x4b42d8(0x206)]===0x1&&_0x4aa76e['0']?.['key']['remoteJid']!==_0x4b42d8(0x1f3)&&await(0x0,MarkDeleteWhatsAppMessage_1['default'])(_0x4aa76e['0']?.[_0x4b42d8(0x236)][_0x4b42d8(0x21d)],null,_0x4aa76e['0']?.['key']['id'],_0x2ae4ec),await(0x0,wbotMessageListener_1[_0x4b42d8(0x1bf)])(_0x4f917c,_0x4f917c[_0x4b42d8(0x1bb)]['status']);}}async function handleMessageJob(_0x5ac2f8){const _0x9a1dd3=a308_0x2d4d71,{data:_0x1a57d5}=_0x5ac2f8;var _0x18780f=_0x1a57d5[_0x9a1dd3(0x20a)],_0x35619a=_0x1a57d5[_0x9a1dd3(0x201)];const _0x47ddd4=(0x0,wbot_1['getWbot'])(_0x1a57d5[_0x9a1dd3(0x212)]);for(const _0x250618 of _0x18780f){await(0x0,wbotMessageListener_1[_0x9a1dd3(0x1f0)])(_0x250618,_0x47ddd4,_0x35619a),await(0x0,wbotMessageListener_1[_0x9a1dd3(0x1aa)])(_0x250618,_0x35619a),await(0x0,wbotMessageListener_1[_0x9a1dd3(0x1c4)])(_0x250618,_0x35619a),_0x250618[_0x9a1dd3(0x236)][_0x9a1dd3(0x21d)]?.['endsWith'](_0x9a1dd3(0x208))&&await(0x0,wbotMessageListener_1[_0x9a1dd3(0x1bf)])(_0x250618,0x2);}}async function handleSendMessage(_0x590df0){const _0x491cec=a308_0x2d4d71;console[_0x491cec(0x1e8)]('HANDLE\x20SEND\x20MESSAGE');try{const {data:_0xccc097}=_0x590df0,_0x1b71f0=await Whatsapp_1[_0x491cec(0x21b)][_0x491cec(0x22a)](_0xccc097[_0x491cec(0x212)]);if(_0x1b71f0==null)throw new sequelize_1[(_0x491cec(0x1a7))]('Whatsapp\x20não\x20identificado');const _0x279064=_0xccc097[_0x491cec(0x1e4)];await(0x0,SendMessage_1[_0x491cec(0x1cd)])(_0x1b71f0,_0x279064);}catch(_0x3d9bd7){Sentry[_0x491cec(0x1be)](_0x3d9bd7),logger_1[_0x491cec(0x214)][_0x491cec(0x1b9)]('MessageQueue\x20->\x20SendMessage:\x20error',_0x3d9bd7[_0x491cec(0x1b0)]);throw _0x3d9bd7;}}function parseToMilliseconds(_0x28fff1){return _0x28fff1*0x3e8;}exports[a308_0x2d4d71(0x1da)]=parseToMilliseconds;function a308_0x5c6f(_0x4a8aac,_0x1c6e69){const _0x164bfa=a308_0x3d49();return a308_0x5c6f=function(_0x2758ae,_0x175af1){_0x2758ae=_0x2758ae-0x1a6;let _0x3d49b9=_0x164bfa[_0x2758ae];return _0x3d49b9;},a308_0x5c6f(_0x4a8aac,_0x1c6e69);}async function sleep(_0xbe60a2){const _0x4d26ee=a308_0x2d4d71;return logger_1[_0x4d26ee(0x214)][_0x4d26ee(0x22e)]('Sleep\x20de\x20'+_0xbe60a2+_0x4d26ee(0x1db)+(0x0,moment_1[_0x4d26ee(0x21b)])()['format']('HH:mm:ss')),new Promise(_0xae74e1=>{setTimeout(()=>{const _0x11c2b2=a308_0x5c6f;logger_1[_0x11c2b2(0x214)][_0x11c2b2(0x22e)](_0x11c2b2(0x1e6)+_0xbe60a2+_0x11c2b2(0x1dc)+(0x0,moment_1[_0x11c2b2(0x21b)])()[_0x11c2b2(0x1c7)](_0x11c2b2(0x223))),_0xae74e1(!![]);},parseToMilliseconds(_0xbe60a2));});}exports[a308_0x2d4d71(0x205)]=sleep;function randomValue(_0xdc4d21,_0xe748e3){const _0xa155c0=a308_0x2d4d71;return Math['floor'](Math[_0xa155c0(0x20c)]()*_0xe748e3)+_0xdc4d21;}exports[a308_0x2d4d71(0x21a)]=randomValue;async function handleLoginStatus(){const _0x1998b1=a308_0x2d4d71;console[_0x1998b1(0x1e8)](_0x1998b1(0x232));const _0x50128b=new Date();_0x50128b[_0x1998b1(0x1e9)](_0x50128b['getMinutes']()-0x5),await User_1['default'][_0x1998b1(0x1bb)]({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x50128b},'online':!![]}});}function a308_0x3d49(){const _0x4af32c=['map','error','6095968RuVbPr','update','bullmq','pending','captureException','handleMsgAck','startQueueProcess','subtract','./workers/campaingJob','CampaignQueue','verifyCampaignMessageAndCloseTicket','36eGcjIE','(((.+)+)+)+$','format','value','REDIS_URI','get','readMessages','\x20failed\x20with\x20error:\x20','SendMessage','127.0.0.1','sequelize','ioredis','REDIS_PASSWORD','findAndCountAll','status','constructor','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','completed','InvoiceCreate','./models/Company','./helpers/SendMessage','parseToMilliseconds','\x20segundos\x20iniciado:\x20','\x20segundos\x20finalizado:\x20','VerifyCampaigns','./services/WbotServices/MarkDeleteWhatsAppMessage','messageQueue','create','generalMonitor','\x20completed','count','data','toString','Sleep\x20de\x20','11842218ONfEFy','log','setMinutes','number','./models/Ticket','verify','ScheduleMonitor','scheduleMonitor','emit','handleMessage','asDays','VerifyLoginStatus','status@broadcast','hasOwnProperty','messageUpdate','getIO','CloseTicketsAutomatic','findAll','extraInfo','YYYY-MM-DD','Sequelize','6EcSLuP','./services/WbotServices/wbotClosedTickets','timeSendQueue','VerifySchedules','-ticket','companyId','sendIdQueue','isInteger','78927lqzLkX','sleep','messageStubType','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','@g.us','reload','messages','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','random','Iniciando\x20geração\x20de\x20boletos','./libs/socket','\x20-\x20Empresa:\x20','ClosedAllOpenTickets\x20->\x20Verify:\x20error','./libs/wbot','whatsappId','campaignQueue','logger','setHours','call','664405dYMKdD','env','add','randomValue','default','getOwnPropertyDescriptor','remoteJid','SearchForQueue\x20->\x20VerifyQueue:\x20error','./workers/scheduledMessageJob','GeneralMonitor','search','@sentry/node','HH:mm:ss','./services/WbotServices/wbotMessageListener','4787979oEBhih','whatsapps','name','moment','utc','findByPk','__esModule','./models/Whatsapp','CURRENT_DATE','info','minutes','DD/MM/yyyy','Queue','handle\x20login','3280215nOcgvE','REDIS_OPT_LIMITER_MAX','userMonitor','key','__setModuleDefault','Error','company-','literal','verifyRecentCampaign','Job\x20','Worker','./models/User','queueMonitor','profilePicUrl','message','getQueue','QueueMonitor','defineProperty','Atendimento\x20Perdido:\x20','contact','__importDefault','148600ncLcTR'];a308_0x3d49=function(){return _0x4af32c;};return a308_0x3d49();}async function handleInvoiceCreate(){const _0x134a04=a308_0x2d4d71;logger_1['logger'][_0x134a04(0x22e)](_0x134a04(0x20d));const _0x5638f6=await Company_1[_0x134a04(0x21b)][_0x134a04(0x1f8)]({'where':{'status':!![]}});_0x5638f6['map'](async _0x1369b9=>{const _0x114fd5=_0x134a04,{dueDate:_0x170ef7}=_0x1369b9,_0x5d92e9=new Date(_0x170ef7)['setHours'](0x0,0x0,0x0,0x0),_0x3dcc51=new Date(_0x170ef7)[_0x114fd5(0x215)](0x17,0x3b,0x3b,0x3e7),_0x41e615=(0x0,moment_1[_0x114fd5(0x21b)])((0x0,moment_1[_0x114fd5(0x21b)])())['format'](_0x114fd5(0x230)),_0x18a286=(0x0,moment_1['default'])(_0x170ef7)[_0x114fd5(0x1c7)](_0x114fd5(0x230)),_0x1fd2e9=(0x0,moment_1[_0x114fd5(0x21b)])(_0x18a286,_0x114fd5(0x230))['diff']((0x0,moment_1['default'])(_0x41e615,_0x114fd5(0x230))),_0x5e5840=moment_1[_0x114fd5(0x21b)]['duration'](_0x1fd2e9)[_0x114fd5(0x1f1)]();if(_0x5e5840<0x14){const _0x1af3f6=await Plan_1[_0x114fd5(0x21b)]['findByPk'](_0x1369b9['planId']);let _0xfd3b10=await Invoices_1['default'][_0x114fd5(0x1e3)]({'where':{'companyId':_0x1369b9['id'],'dueDate':{[sequelize_1['Op']['like']]:(0x0,moment_1[_0x114fd5(0x21b)])(_0x170ef7)[_0x114fd5(0x1c7)](_0x114fd5(0x1fa))}}});if(+_0xfd3b10===0x0){const _0x1e2acb=(0x0,moment_1[_0x114fd5(0x21b)])()['format']();await Invoices_1['default']['create']({'detail':_0x1af3f6[_0x114fd5(0x227)],'status':'open','value':_0x1af3f6[_0x114fd5(0x1c8)],'updatedAt':_0x1e2acb,'createdAt':_0x1e2acb,'dueDate':(0x0,moment_1[_0x114fd5(0x21b)])(_0x170ef7)['format'](_0x114fd5(0x1fa)),'companyId':_0x1369b9['id']});}}});}async function startQueueProcess(){const _0x1f21c5=a308_0x2d4d71;logger_1[_0x1f21c5(0x214)][_0x1f21c5(0x22e)]('Iniciando\x20processamento\x20de\x20filas'),await exports[_0x1f21c5(0x235)][_0x1f21c5(0x219)]('VerifyLoginStatus',{},{'repeat':{'every':0xea60*0x5,'key':_0x1f21c5(0x1f2)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x515b7d=new bullmq_1['Worker'](exports[_0x1f21c5(0x235)][_0x1f21c5(0x227)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x515b7d['on'](_0x1f21c5(0x1d6),async _0x1d998a=>{const _0x4d86aa=_0x1f21c5;logger_1[_0x4d86aa(0x214)][_0x4d86aa(0x22e)](_0x4d86aa(0x1ab)+_0x1d998a[_0x4d86aa(0x227)]+'\x20completed');}),await exports[_0x1f21c5(0x1e1)][_0x1f21c5(0x219)](_0x1f21c5(0x1f7),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x1f21c5(0x1f7)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x1f21c5(0x1e1)][_0x1f21c5(0x219)](_0x1f21c5(0x1d7),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x1f21c5(0x1d7)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x8b2c37=new bullmq_1[(_0x1f21c5(0x1ac))](exports[_0x1f21c5(0x1e1)][_0x1f21c5(0x227)],async _0x537fe1=>{const _0x472d9f=_0x1f21c5;if(_0x537fe1[_0x472d9f(0x227)]==_0x472d9f(0x1f7))await handleCloseTicketsAutomatic();else _0x537fe1[_0x472d9f(0x227)]==_0x472d9f(0x1d7)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x1f21c5(0x213)]['add'](_0x1f21c5(0x1dd),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x1f21c5(0x1dd)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0x1f21c5(0x21b))](exports[_0x1f21c5(0x213)][_0x1f21c5(0x227)],connection);const _0x2096ab=new bullmq_1[(_0x1f21c5(0x1ac))](exports['messageQueue'][_0x1f21c5(0x227)],async _0x3e7f6b=>{const _0xb2b12b=_0x1f21c5;if(_0x3e7f6b[_0xb2b12b(0x227)]=='HandleMessageJob')await handleMessageJob(_0x3e7f6b);else{if(_0x3e7f6b[_0xb2b12b(0x227)]=='MessageUpdateJob')await messageUpdateJob(_0x3e7f6b);else _0x3e7f6b[_0xb2b12b(0x227)]==_0xb2b12b(0x1cd)&&await handleSendMessage(_0x3e7f6b);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x2096ab['on']('completed',async _0x5080f5=>{const _0x4ac906=_0x1f21c5;logger_1['logger'][_0x4ac906(0x22e)](_0x4ac906(0x1ab)+_0x5080f5[_0x4ac906(0x227)]+_0x4ac906(0x1e2));}),_0x2096ab['on']('failed',async(_0xec453b,_0x2bbc42)=>{const _0x249f08=_0x1f21c5;logger_1[_0x249f08(0x214)]['error'](_0x249f08(0x1ab)+_0xec453b[_0x249f08(0x227)]+_0x249f08(0x1cc)+_0x2bbc42[_0x249f08(0x1b0)]);}),await exports['queueMonitor']['add']('VerifyQueueStatus',{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':'VerifyQueueStatus'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x6dfb8e=new bullmq_1['Worker'](exports[_0x1f21c5(0x1ae)][_0x1f21c5(0x227)],async _0x2fc53c=>{_0x2fc53c['name']=='VerifyQueueStatus'&&await handleVerifyQueue(_0x2fc53c);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x6dfb8e['on']('completed',async _0x31a94b=>{const _0x1040dd=_0x1f21c5;logger_1[_0x1040dd(0x214)][_0x1040dd(0x22e)]('Job\x20'+_0x31a94b['id']+'\x20completed');});let _0x121b4d=new scheduledMessageJob_1[(_0x1f21c5(0x21b))](exports[_0x1f21c5(0x1ee)],connection);await _0x121b4d[_0x1f21c5(0x1b1)]()[_0x1f21c5(0x219)](_0x1f21c5(0x1ff),{},{'repeat':{'every':0xea60*0x5,'key':_0x1f21c5(0x1ec)},'removeOnComplete':!![],'removeOnFail':!![]});}exports['startQueueProcess']=startQueueProcess;