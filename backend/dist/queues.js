const a308_0x23c085=a308_0x28a5;(function(_0x8f9faa,_0x4242f7){const _0x400a7f=a308_0x28a5,_0x246a16=_0x8f9faa();while(!![]){try{const _0x18b9c3=-parseInt(_0x400a7f(0x248))/0x1*(parseInt(_0x400a7f(0x242))/0x2)+-parseInt(_0x400a7f(0x22d))/0x3*(parseInt(_0x400a7f(0x1e6))/0x4)+-parseInt(_0x400a7f(0x213))/0x5*(parseInt(_0x400a7f(0x26a))/0x6)+-parseInt(_0x400a7f(0x1fe))/0x7+-parseInt(_0x400a7f(0x23d))/0x8+-parseInt(_0x400a7f(0x20f))/0x9*(-parseInt(_0x400a7f(0x25b))/0xa)+-parseInt(_0x400a7f(0x25c))/0xb*(-parseInt(_0x400a7f(0x261))/0xc);if(_0x18b9c3===_0x4242f7)break;else _0x246a16['push'](_0x246a16['shift']());}catch(_0x42b8dd){_0x246a16['push'](_0x246a16['shift']());}}}(a308_0x1d54,0x479a2));const a308_0x374e7a=(function(){let _0xe7d67c=!![];return function(_0x2f10ec,_0x2f9bfb){const _0x346c00=_0xe7d67c?function(){const _0xce0498=a308_0x28a5;if(_0x2f9bfb){const _0x576051=_0x2f9bfb[_0xce0498(0x1f8)](_0x2f10ec,arguments);return _0x2f9bfb=null,_0x576051;}}:function(){};return _0xe7d67c=![],_0x346c00;};}()),a308_0x29c45d=a308_0x374e7a(this,function(){const _0x246338=a308_0x28a5;return a308_0x29c45d[_0x246338(0x24b)]()['search']('(((.+)+)+)+$')[_0x246338(0x24b)]()['constructor'](a308_0x29c45d)['search'](_0x246338(0x266));});a308_0x29c45d();'use strict';var __createBinding=this&&this[a308_0x23c085(0x1e8)]||(Object[a308_0x23c085(0x1eb)]?function(_0x1cd4dd,_0x11e6b6,_0x595258,_0x20bee1){const _0x51d361=a308_0x23c085;if(_0x20bee1===undefined)_0x20bee1=_0x595258;var _0x314c06=Object[_0x51d361(0x225)](_0x11e6b6,_0x595258);(!_0x314c06||(_0x51d361(0x22a)in _0x314c06?!_0x11e6b6[_0x51d361(0x222)]:_0x314c06[_0x51d361(0x23e)]||_0x314c06['configurable']))&&(_0x314c06={'enumerable':!![],'get':function(){return _0x11e6b6[_0x595258];}}),Object['defineProperty'](_0x1cd4dd,_0x20bee1,_0x314c06);}:function(_0x51d838,_0xcda3f1,_0x5bf4e9,_0x4d1979){if(_0x4d1979===undefined)_0x4d1979=_0x5bf4e9;_0x51d838[_0x4d1979]=_0xcda3f1[_0x5bf4e9];}),__setModuleDefault=this&&this[a308_0x23c085(0x21f)]||(Object['create']?function(_0x2b6795,_0x1e8d89){const _0x35df09=a308_0x23c085;Object[_0x35df09(0x1cb)](_0x2b6795,_0x35df09(0x265),{'enumerable':!![],'value':_0x1e8d89});}:function(_0x2945be,_0x47337d){const _0x57ae6f=a308_0x23c085;_0x2945be[_0x57ae6f(0x265)]=_0x47337d;}),__importStar=this&&this['__importStar']||function(_0x9a618e){const _0x1d9e23=a308_0x23c085;if(_0x9a618e&&_0x9a618e[_0x1d9e23(0x222)])return _0x9a618e;var _0x42e56c={};if(_0x9a618e!=null){for(var _0x50b6e3 in _0x9a618e)if(_0x50b6e3!==_0x1d9e23(0x265)&&Object[_0x1d9e23(0x255)][_0x1d9e23(0x22c)][_0x1d9e23(0x264)](_0x9a618e,_0x50b6e3))__createBinding(_0x42e56c,_0x9a618e,_0x50b6e3);}return __setModuleDefault(_0x42e56c,_0x9a618e),_0x42e56c;},__importDefault=this&&this[a308_0x23c085(0x1fb)]||function(_0xa9eead){const _0x9b6065=a308_0x23c085;return _0xa9eead&&_0xa9eead[_0x9b6065(0x222)]?_0xa9eead:{'default':_0xa9eead};};Object[a308_0x23c085(0x1cb)](exports,a308_0x23c085(0x222),{'value':!![]}),exports[a308_0x23c085(0x1d5)]=exports[a308_0x23c085(0x246)]=exports[a308_0x23c085(0x21c)]=exports['parseToMilliseconds']=exports[a308_0x23c085(0x251)]=exports[a308_0x23c085(0x260)]=exports['queueMonitor']=exports[a308_0x23c085(0x257)]=exports['generalMonitor']=exports['userMonitor']=void 0x0;const Sentry=__importStar(require(a308_0x23c085(0x241))),bullmq_1=require(a308_0x23c085(0x230)),SendMessage_1=require('./helpers/SendMessage'),Whatsapp_1=__importDefault(require('./models/Whatsapp')),logger_1=require(a308_0x23c085(0x26b)),moment_1=__importDefault(require(a308_0x23c085(0x1f5))),Contact_1=__importDefault(require(a308_0x23c085(0x227))),sequelize_1=require(a308_0x23c085(0x1dc)),socket_1=require(a308_0x23c085(0x1db)),User_1=__importDefault(require(a308_0x23c085(0x24e))),Company_1=__importDefault(require(a308_0x23c085(0x1d9))),Plan_1=__importDefault(require(a308_0x23c085(0x250))),Ticket_1=__importDefault(require(a308_0x23c085(0x1f1))),wbotClosedTickets_1=require(a308_0x23c085(0x1e7)),Invoices_1=__importDefault(require(a308_0x23c085(0x25a))),wbotMessageListener_1=require(a308_0x23c085(0x1e9)),wbot_1=require(a308_0x23c085(0x1da)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a308_0x23c085(0x1cf))),ioredis_1=__importDefault(require(a308_0x23c085(0x1ec))),campaingJob_1=__importDefault(require(a308_0x23c085(0x224))),scheduledMessageJob_1=__importDefault(require(a308_0x23c085(0x1dd))),connection={'port':parseInt(process[a308_0x23c085(0x243)]['REDIS_PORT']),'host':process[a308_0x23c085(0x243)][a308_0x23c085(0x204)]||a308_0x23c085(0x208),'password':process[a308_0x23c085(0x243)][a308_0x23c085(0x21b)]},limiterMax=process['env'][a308_0x23c085(0x215)]||0x1,limiterDuration=process[a308_0x23c085(0x243)][a308_0x23c085(0x1df)]||0xbb8,redis=new ioredis_1[(a308_0x23c085(0x265))](process[a308_0x23c085(0x243)]['REDIS_URI']);exports[a308_0x23c085(0x1f6)]=new bullmq_1[(a308_0x23c085(0x228))](a308_0x23c085(0x20b),{'connection':connection}),exports[a308_0x23c085(0x240)]=new bullmq_1[(a308_0x23c085(0x228))](a308_0x23c085(0x1d1),{'connection':connection}),exports[a308_0x23c085(0x257)]=new bullmq_1[(a308_0x23c085(0x228))](a308_0x23c085(0x1d2),{'connection':connection}),exports[a308_0x23c085(0x24c)]=new bullmq_1[(a308_0x23c085(0x228))](a308_0x23c085(0x223),{'connection':connection}),exports[a308_0x23c085(0x260)]=new bullmq_1[(a308_0x23c085(0x228))](a308_0x23c085(0x239),{'connection':connection}),exports[a308_0x23c085(0x251)]=new bullmq_1[(a308_0x23c085(0x228))](a308_0x23c085(0x235),{'connection':connection});async function handleVerifyQueueOld(_0x3b4f0c){const _0x53cecf=a308_0x23c085;logger_1[_0x53cecf(0x258)][_0x53cecf(0x25f)]('Buscando\x20atendimentos\x20perdidos\x20nas\x20filas');try{const _0x1049d7=await Company_1['default'][_0x53cecf(0x23f)]({'attributes':['id',_0x53cecf(0x23b)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1[_0x53cecf(0x20e)]['literal'](_0x53cecf(0x269))}},'include':[{'model':Whatsapp_1[_0x53cecf(0x265)],'attributes':['id',_0x53cecf(0x23b),_0x53cecf(0x1d6),_0x53cecf(0x206),_0x53cecf(0x1e4)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x1049d7['map'](async _0x169b4b=>{const _0x262247=_0x53cecf;_0x169b4b[_0x262247(0x22b)][_0x262247(0x263)](async _0x430fce=>{const _0x423b28=_0x262247;if(_0x430fce[_0x423b28(0x1d6)]==='CONNECTED'){var _0x5880d6=_0x169b4b['id'];const _0x5f056f=_0x430fce[_0x423b28(0x206)]?_0x430fce[_0x423b28(0x206)]:0x0,_0x175388=_0x430fce['sendIdQueue'],_0x3b05b3=_0x5f056f,_0x3cd606=_0x175388,_0x3fca85=_0x3b05b3;if(_0x5f056f>0x0){if(!isNaN(_0x3cd606)&&Number[_0x423b28(0x221)](_0x3cd606)&&!isNaN(_0x3fca85)&&Number[_0x423b28(0x221)](_0x3fca85)){const _0x54361e=(0x0,moment_1[_0x423b28(0x265)])()[_0x423b28(0x1fa)](_0x3fca85,_0x423b28(0x249))[_0x423b28(0x1cd)]()[_0x423b28(0x232)](),{count:_0x38a808,rows:_0x1ccb74}=await Ticket_1['default'][_0x423b28(0x201)]({'where':{'status':_0x423b28(0x238),'queueId':null,'companyId':_0x5880d6,'whatsappId':_0x430fce['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x54361e}},'include':[{'model':Contact_1['default'],'as':_0x423b28(0x1f2),'attributes':['id',_0x423b28(0x23b),_0x423b28(0x1fd),_0x423b28(0x237),'profilePicUrl'],'include':[_0x423b28(0x234)]}]});_0x38a808>0x0?_0x1ccb74['map'](async _0x360d1e=>{const _0xe09463=_0x423b28;await _0x360d1e[_0xe09463(0x1f9)]({'queueId':_0x3cd606}),await _0x360d1e['reload']();const _0x58fb8a=(0x0,socket_1[_0xe09463(0x21e)])();_0x58fb8a['to']('company-'+_0x360d1e[_0xe09463(0x1d7)]+'-'+_0x360d1e['status'])['to'](_0xe09463(0x252)+_0x360d1e[_0xe09463(0x1d7)]+_0xe09463(0x233))['to'](_0x360d1e['id']['toString']())[_0xe09463(0x20d)](_0xe09463(0x252)+_0x5880d6+'-ticket',{'action':_0xe09463(0x1f9),'ticket':_0x360d1e,'ticketId':_0x360d1e['id']}),logger_1[_0xe09463(0x258)]['info'](_0xe09463(0x25d)+_0x360d1e['id']+_0xe09463(0x205)+_0x5880d6);}):logger_1[_0x423b28(0x258)][_0x423b28(0x25f)](_0x423b28(0x1e0)+_0x5880d6);}else logger_1['logger'][_0x423b28(0x25f)](_0x423b28(0x1ef)+_0x5880d6);}}});});}catch(_0x206432){Sentry[_0x53cecf(0x231)](_0x206432),logger_1[_0x53cecf(0x258)][_0x53cecf(0x1d8)]('SearchForQueue\x20->\x20VerifyQueue:\x20error'+_0x206432);throw _0x206432;}};async function handleVerifyQueue(_0x2aa107){const _0x401fd3=a308_0x23c085;logger_1[_0x401fd3(0x258)][_0x401fd3(0x25f)](_0x401fd3(0x268));try{const _0x3cbe14=await Company_1[_0x401fd3(0x265)][_0x401fd3(0x23f)]({'attributes':['id',_0x401fd3(0x23b)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0x401fd3(0x220)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x401fd3(0x265)],'attributes':['id',_0x401fd3(0x23b),_0x401fd3(0x1d6),'timeSendQueue',_0x401fd3(0x1e4)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x3cbe14[_0x401fd3(0x263)](async _0x2bad67=>{const _0xf79f34=_0x401fd3;_0x2bad67[_0xf79f34(0x22b)][_0xf79f34(0x263)](async _0x153ac9=>{const _0x4cbc16=_0xf79f34;if(_0x153ac9[_0x4cbc16(0x1d6)]===_0x4cbc16(0x209)){const _0x4954f0=_0x2bad67['id'],_0x54d068=_0x153ac9[_0x4cbc16(0x206)]?_0x153ac9[_0x4cbc16(0x206)]:0x0,_0x1b6e4e=_0x153ac9[_0x4cbc16(0x1e4)],_0x1ca604=_0x54d068,_0x42d984=_0x1b6e4e,_0x130a81=_0x1ca604;if(_0x54d068>0x0&&!isNaN(_0x42d984)&&Number[_0x4cbc16(0x221)](_0x42d984)&&!isNaN(_0x130a81)&&Number[_0x4cbc16(0x221)](_0x130a81)){const _0x595d2f=(0x0,moment_1['default'])()[_0x4cbc16(0x1fa)](_0x130a81,_0x4cbc16(0x249))[_0x4cbc16(0x1cd)]()[_0x4cbc16(0x232)](),{count:_0x5af57f,rows:_0x156782}=await Ticket_1[_0x4cbc16(0x265)][_0x4cbc16(0x201)]({'where':{'status':_0x4cbc16(0x238),'queueId':null,'companyId':_0x4954f0,'whatsappId':_0x153ac9['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x595d2f}},'include':[{'model':Contact_1[_0x4cbc16(0x265)],'as':'contact','attributes':['id',_0x4cbc16(0x23b),_0x4cbc16(0x1fd),_0x4cbc16(0x237),_0x4cbc16(0x218)],'include':['extraInfo']}]});_0x5af57f>0x0?_0x156782[_0x4cbc16(0x263)](async _0x2e5b96=>{const _0x5304ce=_0x4cbc16;await _0x2e5b96[_0x5304ce(0x1f9)]({'queueId':_0x42d984}),await _0x2e5b96[_0x5304ce(0x23a)]();const _0x298cfd=(0x0,socket_1['getIO'])();_0x298cfd['to'](_0x5304ce(0x252)+_0x2e5b96[_0x5304ce(0x1d7)]+'-'+_0x2e5b96[_0x5304ce(0x1d6)])['to'](_0x5304ce(0x252)+_0x2e5b96[_0x5304ce(0x1d7)]+_0x5304ce(0x233))['to'](_0x2e5b96['id'][_0x5304ce(0x24b)]())[_0x5304ce(0x20d)](_0x5304ce(0x252)+_0x4954f0+'-ticket',{'action':_0x5304ce(0x1f9),'ticket':_0x2e5b96,'ticketId':_0x2e5b96['id']}),logger_1['logger'][_0x5304ce(0x25f)](_0x5304ce(0x25d)+_0x2e5b96['id']+'\x20-\x20Empresa:\x20'+_0x4954f0);}):logger_1[_0x4cbc16(0x258)][_0x4cbc16(0x25f)](_0x4cbc16(0x1e0)+_0x4954f0);}else logger_1['logger'][_0x4cbc16(0x25f)](_0x4cbc16(0x1ef)+_0x4954f0);}});});}catch(_0x204000){console[_0x401fd3(0x1d8)](_0x204000);}}async function handleCloseTicketsAutomatic(){const _0x559b15=a308_0x23c085,_0xfb1114=await Company_1[_0x559b15(0x265)][_0x559b15(0x23f)]({'where':{'status':!![]}});_0xfb1114[_0x559b15(0x263)](async _0x54f2fd=>{const _0x4fb1f9=_0x559b15;try{const _0x343dc0=_0x54f2fd['id'];await(0x0,wbotClosedTickets_1[_0x4fb1f9(0x1fc)])(_0x343dc0);}catch(_0x506900){Sentry[_0x4fb1f9(0x231)](_0x506900),logger_1[_0x4fb1f9(0x258)][_0x4fb1f9(0x1d8)](_0x4fb1f9(0x1c9),_0x506900[_0x4fb1f9(0x244)]);throw _0x506900;}});}async function messageUpdateJob(_0x15d513){const _0x17218b=a308_0x23c085,{data:_0x52a364}=_0x15d513;var _0x5f3262=_0x52a364[_0x17218b(0x1d7)],_0x1f62af=_0x52a364[_0x17218b(0x212)],_0x462793=_0x52a364[_0x17218b(0x1e3)];const _0x5cebe1=(0x0,wbot_1['getWbot'])(_0x52a364[_0x17218b(0x1e3)]);for(const _0x4c30e5 of _0x1f62af){await _0x5cebe1[_0x17218b(0x236)]([_0x4c30e5[_0x17218b(0x1d3)]]);const _0x4ebb01={..._0x1f62af};_0x4ebb01['0']?.[_0x17218b(0x1f9)][_0x17218b(0x1e1)]===0x1&&_0x4ebb01['0']?.['key'][_0x17218b(0x24d)]!==_0x17218b(0x267)&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x17218b(0x265)])(_0x4ebb01['0']?.[_0x17218b(0x1d3)][_0x17218b(0x24d)],null,_0x4ebb01['0']?.['key']['id'],_0x5f3262),await(0x0,wbotMessageListener_1[_0x17218b(0x247)])(_0x4c30e5,_0x4c30e5['update'][_0x17218b(0x1d6)]);}}async function handleMessageJob(_0xa8f404){const _0x56bfa2=a308_0x23c085,{data:_0x3402a8}=_0xa8f404;var _0x1069be=_0x3402a8[_0x56bfa2(0x22e)],_0x5ae1ca=_0x3402a8[_0x56bfa2(0x1d7)];const _0x314061=(0x0,wbot_1[_0x56bfa2(0x210)])(_0x3402a8['whatsappId']);for(const _0x4b18b1 of _0x1069be){await(0x0,wbotMessageListener_1[_0x56bfa2(0x21d)])(_0x4b18b1,_0x314061,_0x5ae1ca),await(0x0,wbotMessageListener_1['verifyRecentCampaign'])(_0x4b18b1,_0x5ae1ca),await(0x0,wbotMessageListener_1['verifyCampaignMessageAndCloseTicket'])(_0x4b18b1,_0x5ae1ca),_0x4b18b1['key'][_0x56bfa2(0x24d)]?.[_0x56bfa2(0x226)](_0x56bfa2(0x1f3))&&await(0x0,wbotMessageListener_1[_0x56bfa2(0x247)])(_0x4b18b1,0x2);}}async function handleSendMessage(_0x5658d7){const _0x5d3079=a308_0x23c085;console[_0x5d3079(0x1ed)](_0x5d3079(0x202));try{const {data:_0x2bcd48}=_0x5658d7,_0x312429=await Whatsapp_1[_0x5d3079(0x265)][_0x5d3079(0x24a)](_0x2bcd48[_0x5d3079(0x1e3)]);if(_0x312429==null)throw new sequelize_1[(_0x5d3079(0x1e5))](_0x5d3079(0x216));const _0xdf268a=_0x2bcd48[_0x5d3079(0x20c)];await(0x0,SendMessage_1[_0x5d3079(0x23c)])(_0x312429,_0xdf268a);}catch(_0x14faf1){Sentry[_0x5d3079(0x231)](_0x14faf1),logger_1[_0x5d3079(0x258)][_0x5d3079(0x1d8)](_0x5d3079(0x1ee),_0x14faf1[_0x5d3079(0x244)]);throw _0x14faf1;}}function parseToMilliseconds(_0x1459e0){return _0x1459e0*0x3e8;}exports[a308_0x23c085(0x229)]=parseToMilliseconds;async function sleep(_0x1ce02c){const _0x5a5d7a=a308_0x23c085;return logger_1['logger']['info'](_0x5a5d7a(0x1cc)+_0x1ce02c+_0x5a5d7a(0x1f0)+(0x0,moment_1[_0x5a5d7a(0x265)])()[_0x5a5d7a(0x232)]('HH:mm:ss')),new Promise(_0x52ec9b=>{setTimeout(()=>{const _0x2ea77c=a308_0x28a5;logger_1[_0x2ea77c(0x258)][_0x2ea77c(0x25f)](_0x2ea77c(0x1cc)+_0x1ce02c+_0x2ea77c(0x200)+(0x0,moment_1[_0x2ea77c(0x265)])()[_0x2ea77c(0x232)](_0x2ea77c(0x1e2))),_0x52ec9b(!![]);},parseToMilliseconds(_0x1ce02c));});}exports[a308_0x23c085(0x21c)]=sleep;function a308_0x28a5(_0x58922e,_0x3d17ee){const _0x120b38=a308_0x1d54();return a308_0x28a5=function(_0x29c45d,_0x374e7a){_0x29c45d=_0x29c45d-0x1c9;let _0x1d546b=_0x120b38[_0x29c45d];return _0x1d546b;},a308_0x28a5(_0x58922e,_0x3d17ee);}function randomValue(_0x3c538e,_0x191a69){const _0x1aea44=a308_0x23c085;return Math[_0x1aea44(0x1ca)](Math[_0x1aea44(0x1ce)]()*_0x191a69)+_0x3c538e;}exports[a308_0x23c085(0x246)]=randomValue;function a308_0x1d54(){const _0x33a6ba=['\x20segundos\x20iniciado:\x20','./models/Ticket','contact','@g.us','setHours','moment','userMonitor','diff','apply','update','subtract','__importDefault','ClosedAllOpenTickets','number','3864973rkkAAC','duration','\x20segundos\x20finalizado:\x20','findAndCountAll','HANDLE\x20SEND\x20MESSAGE','value','REDIS_HOST','\x20-\x20Empresa:\x20','timeSendQueue','setMinutes','127.0.0.1','CONNECTED','\x20completed','UserMonitor','data','emit','Sequelize','4932FMIVXL','getWbot','DD/MM/yyyy','messageUpdate','5hljIci','getQueue','REDIS_OPT_LIMITER_MAX','Whatsapp\x20não\x20identificado','add','profilePicUrl','planId','CloseTicketsAutomatic','REDIS_PASSWORD','sleep','handleMessage','getIO','__setModuleDefault','literal','isInteger','__esModule','QueueMonitor','./workers/campaingJob','getOwnPropertyDescriptor','endsWith','./models/Contact','Queue','parseToMilliseconds','get','whatsapps','hasOwnProperty','1128849FEZLyM','messages','Worker','bullmq','captureException','format','-notification','extraInfo','CampaignQueue','readMessages','email','pending','ScheduleMonitor','reload','name','SendMessage','1546320ppRNrZ','writable','findAll','generalMonitor','@sentry/node','40814Ycklyr','env','message','Job\x20','randomValue','handleMsgAck','27zFqWad','minutes','findByPk','toString','queueMonitor','remoteJid','./models/User','\x20failed\x20with\x20error:\x20','./models/Plan','campaignQueue','company-','verify','getMinutes','prototype','VerifyQueueStatus','messageQueue','logger','completed','./models/Invoices','5120PTzGXF','11RACXul','Atendimento\x20Perdido:\x20','handle\x20login','info','scheduleMonitor','23121276heOyLR','open','map','call','default','(((.+)+)+)+$','status@broadcast','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','CURRENT_DATE','1448196LyIfAu','./utils/logger','InvoiceCreate','ClosedAllOpenTickets\x20->\x20Verify:\x20error','floor','defineProperty','Sleep\x20de\x20','utc','random','./services/WbotServices/MarkDeleteWhatsAppMessage','like','GeneralMonitor','MessageQueue','key','HandleMessageJob','startQueueProcess','status','companyId','error','./models/Company','./libs/wbot','./libs/socket','sequelize','./workers/scheduledMessageJob','VerifyLoginStatus','REDIS_OPT_LIMITER_DURATION','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','messageStubType','HH:mm:ss','whatsappId','sendIdQueue','Error','4XRKfsM','./services/WbotServices/wbotClosedTickets','__createBinding','./services/WbotServices/wbotMessageListener','Iniciando\x20geração\x20de\x20boletos','create','ioredis','log','MessageQueue\x20->\x20SendMessage:\x20error','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20'];a308_0x1d54=function(){return _0x33a6ba;};return a308_0x1d54();}async function handleLoginStatus(){const _0xc81126=a308_0x23c085;console[_0xc81126(0x1ed)](_0xc81126(0x25e));const _0x147bbc=new Date();_0x147bbc[_0xc81126(0x207)](_0x147bbc[_0xc81126(0x254)]()-0x5),await User_1[_0xc81126(0x265)]['update']({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x147bbc},'online':!![]}});}async function handleInvoiceCreate(){const _0x22c169=a308_0x23c085;logger_1['logger']['info'](_0x22c169(0x1ea));const _0x273985=await Company_1[_0x22c169(0x265)][_0x22c169(0x23f)]({'where':{'status':!![]}});_0x273985['map'](async _0x3c6299=>{const _0x524561=_0x22c169,{dueDate:_0x26f76b}=_0x3c6299,_0x2a1d19=new Date(_0x26f76b)['setHours'](0x0,0x0,0x0,0x0),_0x30ad30=new Date(_0x26f76b)[_0x524561(0x1f4)](0x17,0x3b,0x3b,0x3e7),_0x4c021a=(0x0,moment_1[_0x524561(0x265)])((0x0,moment_1[_0x524561(0x265)])())['format'](_0x524561(0x211)),_0x237134=(0x0,moment_1['default'])(_0x26f76b)[_0x524561(0x232)](_0x524561(0x211)),_0x119ef2=(0x0,moment_1[_0x524561(0x265)])(_0x237134,_0x524561(0x211))[_0x524561(0x1f7)]((0x0,moment_1[_0x524561(0x265)])(_0x4c021a,_0x524561(0x211))),_0x1db849=moment_1[_0x524561(0x265)][_0x524561(0x1ff)](_0x119ef2)['asDays']();if(_0x1db849<0x14){const _0x2d280c=await Plan_1['default'][_0x524561(0x24a)](_0x3c6299[_0x524561(0x219)]);let _0x415fab=await Invoices_1[_0x524561(0x265)]['count']({'where':{'companyId':_0x3c6299['id'],'dueDate':{[sequelize_1['Op'][_0x524561(0x1d0)]]:(0x0,moment_1['default'])(_0x26f76b)[_0x524561(0x232)]('YYYY-MM-DD')}}});if(+_0x415fab===0x0){const _0x455b3c=(0x0,moment_1[_0x524561(0x265)])()[_0x524561(0x232)]();await Invoices_1[_0x524561(0x265)][_0x524561(0x1eb)]({'detail':_0x2d280c[_0x524561(0x23b)],'status':_0x524561(0x262),'value':_0x2d280c[_0x524561(0x203)],'updatedAt':_0x455b3c,'createdAt':_0x455b3c,'dueDate':(0x0,moment_1['default'])(_0x26f76b)[_0x524561(0x232)]('YYYY-MM-DD'),'companyId':_0x3c6299['id']});}}});}async function startQueueProcess(){const _0x2e4428=a308_0x23c085;logger_1[_0x2e4428(0x258)][_0x2e4428(0x25f)]('Iniciando\x20processamento\x20de\x20filas'),await exports[_0x2e4428(0x1f6)][_0x2e4428(0x217)]('VerifyLoginStatus',{},{'repeat':{'every':0xea60*0x5,'key':_0x2e4428(0x1de)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x24a861=new bullmq_1[(_0x2e4428(0x22f))](exports[_0x2e4428(0x1f6)][_0x2e4428(0x23b)],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x24a861['on'](_0x2e4428(0x259),async _0x2335d9=>{const _0x25fd27=_0x2e4428;logger_1['logger'][_0x25fd27(0x25f)](_0x25fd27(0x245)+_0x2335d9[_0x25fd27(0x23b)]+_0x25fd27(0x20a));}),await exports[_0x2e4428(0x240)]['add'](_0x2e4428(0x21a),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x2e4428(0x21a)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x2e4428(0x240)]['add'](_0x2e4428(0x26c),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':'InvoiceCreate'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x34e645=new bullmq_1[(_0x2e4428(0x22f))](exports['generalMonitor']['name'],async _0x4a93e4=>{if(_0x4a93e4['name']=='CloseTicketsAutomatic')await handleCloseTicketsAutomatic();else _0x4a93e4['name']=='InvoiceCreate'&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports[_0x2e4428(0x251)][_0x2e4428(0x217)]('VerifyCampaigns',{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':'VerifyCampaigns'},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1[(_0x2e4428(0x265))](exports[_0x2e4428(0x251)][_0x2e4428(0x23b)],connection);const _0x34c21b=new bullmq_1['Worker'](exports['messageQueue'][_0x2e4428(0x23b)],async _0x68bf60=>{const _0x563da4=_0x2e4428;if(_0x68bf60[_0x563da4(0x23b)]==_0x563da4(0x1d4))await handleMessageJob(_0x68bf60);else{if(_0x68bf60[_0x563da4(0x23b)]=='MessageUpdateJob')await messageUpdateJob(_0x68bf60);else _0x68bf60[_0x563da4(0x23b)]=='SendMessage'&&await handleSendMessage(_0x68bf60);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x34c21b['on'](_0x2e4428(0x259),async _0x107af4=>{const _0x157031=_0x2e4428;logger_1[_0x157031(0x258)]['info']('Job\x20'+_0x107af4[_0x157031(0x23b)]+'\x20completed');}),_0x34c21b['on']('failed',async(_0x4ecabc,_0x47a8f2)=>{const _0x470d75=_0x2e4428;logger_1[_0x470d75(0x258)][_0x470d75(0x1d8)]('Job\x20'+_0x4ecabc[_0x470d75(0x23b)]+_0x470d75(0x24f)+_0x47a8f2[_0x470d75(0x244)]);}),await exports['queueMonitor'][_0x2e4428(0x217)](_0x2e4428(0x256),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x2e4428(0x256)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x3c7d23=new bullmq_1[(_0x2e4428(0x22f))](exports[_0x2e4428(0x24c)]['name'],async _0x14333c=>{const _0x56c165=_0x2e4428;_0x14333c[_0x56c165(0x23b)]=='VerifyQueueStatus'&&await handleVerifyQueue(_0x14333c);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x3c7d23['on'](_0x2e4428(0x259),async _0x55db0f=>{const _0x15d88e=_0x2e4428;logger_1[_0x15d88e(0x258)][_0x15d88e(0x25f)](_0x15d88e(0x245)+_0x55db0f['id']+_0x15d88e(0x20a));});let _0x4d2264=new scheduledMessageJob_1[(_0x2e4428(0x265))](exports[_0x2e4428(0x260)],connection);await _0x4d2264[_0x2e4428(0x214)]()['add']('VerifySchedules',{},{'repeat':{'every':0xea60*0x5,'key':_0x2e4428(0x253)},'removeOnComplete':!![],'removeOnFail':!![]});}exports[a308_0x23c085(0x1d5)]=startQueueProcess;