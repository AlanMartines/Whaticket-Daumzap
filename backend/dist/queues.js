const a308_0x140d13=a308_0x33e3;(function(_0x2f5b5a,_0x52c327){const _0x38b6bc=a308_0x33e3,_0x5c14dd=_0x2f5b5a();while(!![]){try{const _0x3c217b=-parseInt(_0x38b6bc(0x248))/0x1+-parseInt(_0x38b6bc(0x25d))/0x2+parseInt(_0x38b6bc(0x1db))/0x3*(-parseInt(_0x38b6bc(0x1e4))/0x4)+-parseInt(_0x38b6bc(0x213))/0x5+parseInt(_0x38b6bc(0x256))/0x6*(parseInt(_0x38b6bc(0x1dd))/0x7)+-parseInt(_0x38b6bc(0x214))/0x8+parseInt(_0x38b6bc(0x1d2))/0x9*(parseInt(_0x38b6bc(0x23e))/0xa);if(_0x3c217b===_0x52c327)break;else _0x5c14dd['push'](_0x5c14dd['shift']());}catch(_0x82a273){_0x5c14dd['push'](_0x5c14dd['shift']());}}}(a308_0x40e6,0x514d6));const a308_0x3a36b3=(function(){let _0xa532a5=!![];return function(_0x5b948c,_0x4dd4c4){const _0x2855eb=_0xa532a5?function(){const _0x1162c2=a308_0x33e3;if(_0x4dd4c4){const _0x36d120=_0x4dd4c4[_0x1162c2(0x1f2)](_0x5b948c,arguments);return _0x4dd4c4=null,_0x36d120;}}:function(){};return _0xa532a5=![],_0x2855eb;};}()),a308_0x548fc9=a308_0x3a36b3(this,function(){const _0x518618=a308_0x33e3;return a308_0x548fc9[_0x518618(0x265)]()[_0x518618(0x229)]('(((.+)+)+)+$')['toString']()[_0x518618(0x231)](a308_0x548fc9)[_0x518618(0x229)]('(((.+)+)+)+$');});a308_0x548fc9();'use strict';var __createBinding=this&&this[a308_0x140d13(0x22b)]||(Object['create']?function(_0x4c0b1c,_0x2a3592,_0x134b50,_0x127e8a){const _0x3820e9=a308_0x140d13;if(_0x127e8a===undefined)_0x127e8a=_0x134b50;var _0x444a45=Object['getOwnPropertyDescriptor'](_0x2a3592,_0x134b50);(!_0x444a45||(_0x3820e9(0x264)in _0x444a45?!_0x2a3592[_0x3820e9(0x209)]:_0x444a45[_0x3820e9(0x1fa)]||_0x444a45['configurable']))&&(_0x444a45={'enumerable':!![],'get':function(){return _0x2a3592[_0x134b50];}}),Object[_0x3820e9(0x1f4)](_0x4c0b1c,_0x127e8a,_0x444a45);}:function(_0x4199fc,_0x41e3bf,_0x176fcd,_0x41cb91){if(_0x41cb91===undefined)_0x41cb91=_0x176fcd;_0x4199fc[_0x41cb91]=_0x41e3bf[_0x176fcd];}),__setModuleDefault=this&&this[a308_0x140d13(0x233)]||(Object[a308_0x140d13(0x219)]?function(_0x1880fb,_0x37fa26){const _0x53265a=a308_0x140d13;Object[_0x53265a(0x1f4)](_0x1880fb,'default',{'enumerable':!![],'value':_0x37fa26});}:function(_0x78674d,_0x1167ba){const _0x3fc670=a308_0x140d13;_0x78674d[_0x3fc670(0x217)]=_0x1167ba;}),__importStar=this&&this[a308_0x140d13(0x1f3)]||function(_0x524ffa){const _0x2978e2=a308_0x140d13;if(_0x524ffa&&_0x524ffa['__esModule'])return _0x524ffa;var _0x496ac0={};if(_0x524ffa!=null){for(var _0x15de74 in _0x524ffa)if(_0x15de74!=='default'&&Object[_0x2978e2(0x224)][_0x2978e2(0x1f9)]['call'](_0x524ffa,_0x15de74))__createBinding(_0x496ac0,_0x524ffa,_0x15de74);}return __setModuleDefault(_0x496ac0,_0x524ffa),_0x496ac0;},__importDefault=this&&this['__importDefault']||function(_0x2ad85c){const _0x3121e3=a308_0x140d13;return _0x2ad85c&&_0x2ad85c[_0x3121e3(0x209)]?_0x2ad85c:{'default':_0x2ad85c};};Object['defineProperty'](exports,a308_0x140d13(0x209),{'value':!![]}),exports['startQueueProcess']=exports[a308_0x140d13(0x20f)]=exports['sleep']=exports[a308_0x140d13(0x23f)]=exports['campaignQueue']=exports[a308_0x140d13(0x24c)]=exports[a308_0x140d13(0x25e)]=exports[a308_0x140d13(0x1d0)]=exports[a308_0x140d13(0x260)]=exports[a308_0x140d13(0x1ea)]=void 0x0;const Sentry=__importStar(require(a308_0x140d13(0x22e))),bullmq_1=require(a308_0x140d13(0x230)),SendMessage_1=require(a308_0x140d13(0x237)),Whatsapp_1=__importDefault(require('./models/Whatsapp')),logger_1=require(a308_0x140d13(0x210)),moment_1=__importDefault(require(a308_0x140d13(0x22d))),Contact_1=__importDefault(require(a308_0x140d13(0x1eb))),sequelize_1=require(a308_0x140d13(0x1fb)),socket_1=require(a308_0x140d13(0x21a)),User_1=__importDefault(require('./models/User')),Company_1=__importDefault(require(a308_0x140d13(0x1ff))),Plan_1=__importDefault(require('./models/Plan')),Ticket_1=__importDefault(require(a308_0x140d13(0x226))),wbotClosedTickets_1=require('./services/WbotServices/wbotClosedTickets'),Invoices_1=__importDefault(require(a308_0x140d13(0x25b))),wbotMessageListener_1=require(a308_0x140d13(0x23b)),wbot_1=require(a308_0x140d13(0x228)),MarkDeleteWhatsAppMessage_1=__importDefault(require(a308_0x140d13(0x238))),ioredis_1=__importDefault(require(a308_0x140d13(0x211))),campaingJob_1=__importDefault(require('./workers/campaingJob')),scheduledMessageJob_1=__importDefault(require('./workers/scheduledMessageJob')),connection={'port':parseInt(process['env'][a308_0x140d13(0x1df)]),'host':process[a308_0x140d13(0x236)][a308_0x140d13(0x21d)]||a308_0x140d13(0x1e9),'password':process['env'][a308_0x140d13(0x1de)]},limiterMax=process[a308_0x140d13(0x236)][a308_0x140d13(0x25a)]||0x1,limiterDuration=process[a308_0x140d13(0x236)][a308_0x140d13(0x257)]||0xbb8,redis=new ioredis_1[(a308_0x140d13(0x217))](process[a308_0x140d13(0x236)][a308_0x140d13(0x259)]);exports[a308_0x140d13(0x1ea)]=new bullmq_1[(a308_0x140d13(0x249))](a308_0x140d13(0x239),{'connection':connection}),exports[a308_0x140d13(0x260)]=new bullmq_1[(a308_0x140d13(0x249))](a308_0x140d13(0x261),{'connection':connection}),exports[a308_0x140d13(0x1d0)]=new bullmq_1['Queue'](a308_0x140d13(0x24a),{'connection':connection}),exports[a308_0x140d13(0x25e)]=new bullmq_1['Queue'](a308_0x140d13(0x1d5),{'connection':connection}),exports['scheduleMonitor']=new bullmq_1[(a308_0x140d13(0x249))](a308_0x140d13(0x218),{'connection':connection}),exports[a308_0x140d13(0x206)]=new bullmq_1[(a308_0x140d13(0x249))](a308_0x140d13(0x1d6),{'connection':connection});async function handleVerifyQueueOld(_0x4390c8){const _0xa18978=a308_0x140d13;logger_1[_0xa18978(0x24e)]['info'](_0xa18978(0x254));try{const _0x512bd9=await Company_1[_0xa18978(0x217)]['findAll']({'attributes':['id','name'],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0xa18978(0x203)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0xa18978(0x217)],'attributes':['id',_0xa18978(0x258),'status',_0xa18978(0x1f7),_0xa18978(0x252)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x512bd9[_0xa18978(0x251)](async _0x263577=>{const _0x36da97=_0xa18978;_0x263577[_0x36da97(0x246)][_0x36da97(0x251)](async _0x196f49=>{const _0x260e95=_0x36da97;if(_0x196f49[_0x260e95(0x23c)]===_0x260e95(0x1dc)){var _0x44a288=_0x263577['id'];const _0x416c80=_0x196f49[_0x260e95(0x1f7)]?_0x196f49['timeSendQueue']:0x0,_0x32bacf=_0x196f49[_0x260e95(0x252)],_0x2d4e79=_0x416c80,_0x5cf305=_0x32bacf,_0x16cb39=_0x2d4e79;if(_0x416c80>0x0){if(!isNaN(_0x5cf305)&&Number[_0x260e95(0x262)](_0x5cf305)&&!isNaN(_0x16cb39)&&Number[_0x260e95(0x262)](_0x16cb39)){const _0x4c9b17=(0x0,moment_1['default'])()[_0x260e95(0x247)](_0x16cb39,_0x260e95(0x253))[_0x260e95(0x1e3)]()[_0x260e95(0x232)](),{count:_0x12c162,rows:_0x1177ab}=await Ticket_1[_0x260e95(0x217)][_0x260e95(0x225)]({'where':{'status':_0x260e95(0x244),'queueId':null,'companyId':_0x44a288,'whatsappId':_0x196f49['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x4c9b17}},'include':[{'model':Contact_1['default'],'as':_0x260e95(0x205),'attributes':['id',_0x260e95(0x258),'number',_0x260e95(0x1fc),'profilePicUrl'],'include':[_0x260e95(0x223)]}]});_0x12c162>0x0?_0x1177ab[_0x260e95(0x251)](async _0x500025=>{const _0x139e3f=_0x260e95;await _0x500025[_0x139e3f(0x20b)]({'queueId':_0x5cf305}),await _0x500025[_0x139e3f(0x1d3)]();const _0x1e9e1e=(0x0,socket_1[_0x139e3f(0x242)])();_0x1e9e1e['to'](_0x139e3f(0x207)+_0x500025[_0x139e3f(0x22a)]+'-'+_0x500025['status'])['to']('company-'+_0x500025['companyId']+_0x139e3f(0x1ef))['to'](_0x500025['id'][_0x139e3f(0x265)]())['emit']('company-'+_0x44a288+'-ticket',{'action':_0x139e3f(0x20b),'ticket':_0x500025,'ticketId':_0x500025['id']}),logger_1[_0x139e3f(0x24e)][_0x139e3f(0x212)]('Atendimento\x20Perdido:\x20'+_0x500025['id']+_0x139e3f(0x263)+_0x44a288);}):logger_1[_0x260e95(0x24e)][_0x260e95(0x212)](_0x260e95(0x1e5)+_0x44a288);}else logger_1[_0x260e95(0x24e)]['info'](_0x260e95(0x235)+_0x44a288);}}});});}catch(_0x10648f){Sentry['captureException'](_0x10648f),logger_1[_0xa18978(0x24e)][_0xa18978(0x266)]('SearchForQueue\x20->\x20VerifyQueue:\x20error'+_0x10648f);throw _0x10648f;}};async function handleVerifyQueue(_0x21b2e6){const _0x16deb9=a308_0x140d13;logger_1['logger'][_0x16deb9(0x212)](_0x16deb9(0x254));try{const _0x30953b=await Company_1['default'][_0x16deb9(0x1e2)]({'attributes':['id',_0x16deb9(0x258)],'where':{'status':!![],'dueDate':{[sequelize_1['Op']['gt']]:sequelize_1['Sequelize'][_0x16deb9(0x203)]('CURRENT_DATE')}},'include':[{'model':Whatsapp_1[_0x16deb9(0x217)],'attributes':['id',_0x16deb9(0x258),'status',_0x16deb9(0x1f7),_0x16deb9(0x252)],'where':{'timeSendQueue':{[sequelize_1['Op']['gt']]:0x0}}}]});_0x30953b[_0x16deb9(0x251)](async _0x503a4d=>{const _0x52978b=_0x16deb9;_0x503a4d[_0x52978b(0x246)][_0x52978b(0x251)](async _0x29394c=>{const _0x182ce6=_0x52978b;if(_0x29394c[_0x182ce6(0x23c)]===_0x182ce6(0x1dc)){const _0x92d07d=_0x503a4d['id'],_0x3c2ea=_0x29394c[_0x182ce6(0x1f7)]?_0x29394c['timeSendQueue']:0x0,_0x5c5d9b=_0x29394c[_0x182ce6(0x252)],_0xe013be=_0x3c2ea,_0xb226b4=_0x5c5d9b,_0x51db11=_0xe013be;if(_0x3c2ea>0x0&&!isNaN(_0xb226b4)&&Number[_0x182ce6(0x262)](_0xb226b4)&&!isNaN(_0x51db11)&&Number['isInteger'](_0x51db11)){const _0x32ea42=(0x0,moment_1['default'])()[_0x182ce6(0x247)](_0x51db11,_0x182ce6(0x253))[_0x182ce6(0x1e3)]()[_0x182ce6(0x232)](),{count:_0x4a2e7c,rows:_0x5ebd7d}=await Ticket_1[_0x182ce6(0x217)][_0x182ce6(0x225)]({'where':{'status':'pending','queueId':null,'companyId':_0x92d07d,'whatsappId':_0x29394c['id'],'updatedAt':{[sequelize_1['Op']['lt']]:_0x32ea42}},'include':[{'model':Contact_1['default'],'as':'contact','attributes':['id',_0x182ce6(0x258),_0x182ce6(0x20e),'email',_0x182ce6(0x202)],'include':['extraInfo']}]});_0x4a2e7c>0x0?_0x5ebd7d[_0x182ce6(0x251)](async _0x59b404=>{const _0x329651=_0x182ce6;await _0x59b404[_0x329651(0x20b)]({'queueId':_0xb226b4}),await _0x59b404['reload']();const _0x48ec26=(0x0,socket_1[_0x329651(0x242)])();_0x48ec26['to'](_0x329651(0x207)+_0x59b404[_0x329651(0x22a)]+'-'+_0x59b404['status'])['to'](_0x329651(0x207)+_0x59b404[_0x329651(0x22a)]+_0x329651(0x1ef))['to'](_0x59b404['id'][_0x329651(0x265)]())[_0x329651(0x22f)](_0x329651(0x207)+_0x92d07d+_0x329651(0x1f1),{'action':'update','ticket':_0x59b404,'ticketId':_0x59b404['id']}),logger_1[_0x329651(0x24e)][_0x329651(0x212)](_0x329651(0x1e7)+_0x59b404['id']+_0x329651(0x263)+_0x92d07d);}):logger_1[_0x182ce6(0x24e)][_0x182ce6(0x212)](_0x182ce6(0x1e5)+_0x92d07d);}else logger_1[_0x182ce6(0x24e)][_0x182ce6(0x212)]('Condição\x20não\x20respeitada\x20-\x20Empresa:\x20'+_0x92d07d);}});});}catch(_0x2244a3){console['error'](_0x2244a3);}}async function handleCloseTicketsAutomatic(){const _0x58792c=a308_0x140d13,_0x56a08a=await Company_1[_0x58792c(0x217)][_0x58792c(0x1e2)]({'where':{'status':!![]}});_0x56a08a[_0x58792c(0x251)](async _0x5c399d=>{const _0x526fcc=_0x58792c;try{const _0x3699f8=_0x5c399d['id'];await(0x0,wbotClosedTickets_1[_0x526fcc(0x20a)])(_0x3699f8);}catch(_0x1984ff){Sentry[_0x526fcc(0x23a)](_0x1984ff),logger_1['logger']['error'](_0x526fcc(0x1f6),_0x1984ff[_0x526fcc(0x216)]);throw _0x1984ff;}});}async function messageUpdateJob(_0x30d568){const _0x134135=a308_0x140d13,{data:_0x165f7f}=_0x30d568;var _0x20b2bb=_0x165f7f[_0x134135(0x22a)],_0x512fcf=_0x165f7f[_0x134135(0x267)],_0x3eea73=_0x165f7f[_0x134135(0x1ec)];const _0xfdaeaa=(0x0,wbot_1[_0x134135(0x21c)])(_0x165f7f[_0x134135(0x1ec)]);for(const _0x44668a of _0x512fcf){await _0xfdaeaa['readMessages']([_0x44668a[_0x134135(0x250)]]);const _0x76436a={..._0x512fcf};_0x76436a['0']?.['update'][_0x134135(0x241)]===0x1&&_0x76436a['0']?.[_0x134135(0x250)][_0x134135(0x1e1)]!=='status@broadcast'&&await(0x0,MarkDeleteWhatsAppMessage_1[_0x134135(0x217)])(_0x76436a['0']?.[_0x134135(0x250)][_0x134135(0x1e1)],null,_0x76436a['0']?.[_0x134135(0x250)]['id'],_0x20b2bb),await(0x0,wbotMessageListener_1['handleMsgAck'])(_0x44668a,_0x44668a[_0x134135(0x20b)]['status']);}}async function handleMessageJob(_0x52b347){const _0x5bfb4d=a308_0x140d13,{data:_0x2d8620}=_0x52b347;var _0x219138=_0x2d8620[_0x5bfb4d(0x21b)],_0xf0f684=_0x2d8620[_0x5bfb4d(0x22a)];const _0x3471f1=(0x0,wbot_1[_0x5bfb4d(0x21c)])(_0x2d8620[_0x5bfb4d(0x1ec)]);for(const _0x949ba3 of _0x219138){await(0x0,wbotMessageListener_1['handleMessage'])(_0x949ba3,_0x3471f1,_0xf0f684),await(0x0,wbotMessageListener_1[_0x5bfb4d(0x1f0)])(_0x949ba3,_0xf0f684),await(0x0,wbotMessageListener_1['verifyCampaignMessageAndCloseTicket'])(_0x949ba3,_0xf0f684),_0x949ba3['key'][_0x5bfb4d(0x1e1)]?.[_0x5bfb4d(0x221)]('@g.us')&&await(0x0,wbotMessageListener_1[_0x5bfb4d(0x1d7)])(_0x949ba3,0x2);}}async function handleSendMessage(_0x5f18c4){const _0x3ad353=a308_0x140d13;console['log'](_0x3ad353(0x200));try{const {data:_0x38d67b}=_0x5f18c4,_0x353f1d=await Whatsapp_1[_0x3ad353(0x217)][_0x3ad353(0x25c)](_0x38d67b[_0x3ad353(0x1ec)]);if(_0x353f1d==null)throw new sequelize_1[(_0x3ad353(0x208))]('Whatsapp\x20não\x20identificado');const _0x5ed970=_0x38d67b[_0x3ad353(0x243)];await(0x0,SendMessage_1[_0x3ad353(0x204)])(_0x353f1d,_0x5ed970);}catch(_0x416cf1){Sentry[_0x3ad353(0x23a)](_0x416cf1),logger_1['logger']['error'](_0x3ad353(0x25f),_0x416cf1['message']);throw _0x416cf1;}}function parseToMilliseconds(_0x40e528){return _0x40e528*0x3e8;}function a308_0x33e3(_0x39490f,_0x2d0c60){const _0x4f3fd6=a308_0x40e6();return a308_0x33e3=function(_0x548fc9,_0x3a36b3){_0x548fc9=_0x548fc9-0x1d0;let _0x40e666=_0x4f3fd6[_0x548fc9];return _0x40e666;},a308_0x33e3(_0x39490f,_0x2d0c60);}function a308_0x40e6(){const _0x208722=['remoteJid','findAll','utc','198684yjFjGW','Nenhum\x20atendimento\x20perdido\x20encontrado\x20-\x20Empresa:\x20','setHours','Atendimento\x20Perdido:\x20','DD/MM/yyyy','127.0.0.1','userMonitor','./models/Contact','whatsappId','count','HH:mm:ss','-notification','verifyRecentCampaign','-ticket','apply','__importStar','defineProperty','sleep','ClosedAllOpenTickets\x20->\x20Verify:\x20error','timeSendQueue','\x20segundos\x20iniciado:\x20','hasOwnProperty','writable','sequelize','email','InvoiceCreate','floor','./models/Company','HANDLE\x20SEND\x20MESSAGE','CloseTicketsAutomatic','profilePicUrl','literal','SendMessage','contact','campaignQueue','company-','Error','__esModule','ClosedAllOpenTickets','update','open','getMinutes','number','randomValue','./utils/logger','ioredis','info','1842410ofaXcR','2918240aCyCOL','VerifySchedules','message','default','ScheduleMonitor','create','./libs/socket','messages','getWbot','REDIS_HOST','VerifyLoginStatus','Sleep\x20de\x20','Iniciando\x20geração\x20de\x20boletos','endsWith','\x20completed','extraInfo','prototype','findAndCountAll','./models/Ticket','asDays','./libs/wbot','search','companyId','__createBinding','completed','moment','@sentry/node','emit','bullmq','constructor','format','__setModuleDefault','\x20segundos\x20finalizado:\x20','Condição\x20não\x20respeitada\x20-\x20Empresa:\x20','env','./helpers/SendMessage','./services/WbotServices/MarkDeleteWhatsAppMessage','UserMonitor','captureException','./services/WbotServices/wbotMessageListener','status','planId','20212630mbmgzo','parseToMilliseconds','HandleMessageJob','messageStubType','getIO','data','pending','Iniciando\x20processamento\x20de\x20filas','whatsapps','subtract','406794zTGymv','Queue','MessageQueue','log','scheduleMonitor','duration','logger','value','key','map','sendIdQueue','minutes','Buscando\x20atendimentos\x20perdidos\x20nas\x20filas','add','29112DgQAaN','REDIS_OPT_LIMITER_DURATION','name','REDIS_URI','REDIS_OPT_LIMITER_MAX','./models/Invoices','findByPk','885696eAkGRm','queueMonitor','MessageQueue\x20->\x20SendMessage:\x20error','generalMonitor','GeneralMonitor','isInteger','\x20-\x20Empresa:\x20','get','toString','error','messageUpdate','YYYY-MM-DD','VerifyCampaigns','messageQueue','Worker','9oMshth','reload','VerifyQueueStatus','QueueMonitor','CampaignQueue','handleMsgAck','\x20failed\x20with\x20error:\x20','handle\x20login','Job\x20','9RmjNXd','CONNECTED','63RBycDu','REDIS_PASSWORD','REDIS_PORT','getQueue'];a308_0x40e6=function(){return _0x208722;};return a308_0x40e6();}exports[a308_0x140d13(0x23f)]=parseToMilliseconds;async function sleep(_0x969a0b){const _0x1bcdc4=a308_0x140d13;return logger_1[_0x1bcdc4(0x24e)][_0x1bcdc4(0x212)]('Sleep\x20de\x20'+_0x969a0b+_0x1bcdc4(0x1f8)+(0x0,moment_1['default'])()[_0x1bcdc4(0x232)]('HH:mm:ss')),new Promise(_0xfdee40=>{setTimeout(()=>{const _0x3067df=a308_0x33e3;logger_1[_0x3067df(0x24e)][_0x3067df(0x212)](_0x3067df(0x21f)+_0x969a0b+_0x3067df(0x234)+(0x0,moment_1['default'])()['format'](_0x3067df(0x1ee))),_0xfdee40(!![]);},parseToMilliseconds(_0x969a0b));});}exports[a308_0x140d13(0x1f5)]=sleep;function randomValue(_0x2a87b6,_0xc1a807){const _0x398003=a308_0x140d13;return Math[_0x398003(0x1fe)](Math['random']()*_0xc1a807)+_0x2a87b6;}exports[a308_0x140d13(0x20f)]=randomValue;async function handleLoginStatus(){const _0x5bd94c=a308_0x140d13;console[_0x5bd94c(0x24b)](_0x5bd94c(0x1d9));const _0x1abef1=new Date();_0x1abef1['setMinutes'](_0x1abef1[_0x5bd94c(0x20d)]()-0x5),await User_1[_0x5bd94c(0x217)]['update']({'online':![]},{'where':{'updatedAt':{[sequelize_1['Op']['lt']]:_0x1abef1},'online':!![]}});}async function handleInvoiceCreate(){const _0x16187a=a308_0x140d13;logger_1[_0x16187a(0x24e)][_0x16187a(0x212)](_0x16187a(0x220));const _0x23ac2b=await Company_1[_0x16187a(0x217)][_0x16187a(0x1e2)]({'where':{'status':!![]}});_0x23ac2b[_0x16187a(0x251)](async _0x479b7e=>{const _0x453c00=_0x16187a,{dueDate:_0x55d3ca}=_0x479b7e,_0x399d5c=new Date(_0x55d3ca)[_0x453c00(0x1e6)](0x0,0x0,0x0,0x0),_0x56264f=new Date(_0x55d3ca)[_0x453c00(0x1e6)](0x17,0x3b,0x3b,0x3e7),_0x18c931=(0x0,moment_1[_0x453c00(0x217)])((0x0,moment_1[_0x453c00(0x217)])())[_0x453c00(0x232)](_0x453c00(0x1e8)),_0x149979=(0x0,moment_1[_0x453c00(0x217)])(_0x55d3ca)['format']('DD/MM/yyyy'),_0x59fa5f=(0x0,moment_1[_0x453c00(0x217)])(_0x149979,_0x453c00(0x1e8))['diff']((0x0,moment_1[_0x453c00(0x217)])(_0x18c931,_0x453c00(0x1e8))),_0x301529=moment_1[_0x453c00(0x217)][_0x453c00(0x24d)](_0x59fa5f)[_0x453c00(0x227)]();if(_0x301529<0x14){const _0x482e05=await Plan_1[_0x453c00(0x217)][_0x453c00(0x25c)](_0x479b7e[_0x453c00(0x23d)]);let _0x35f25b=await Invoices_1['default'][_0x453c00(0x1ed)]({'where':{'companyId':_0x479b7e['id'],'dueDate':{[sequelize_1['Op']['like']]:(0x0,moment_1[_0x453c00(0x217)])(_0x55d3ca)[_0x453c00(0x232)](_0x453c00(0x268))}}});if(+_0x35f25b===0x0){const _0x22b8d8=(0x0,moment_1['default'])()[_0x453c00(0x232)]();await Invoices_1[_0x453c00(0x217)][_0x453c00(0x219)]({'detail':_0x482e05[_0x453c00(0x258)],'status':_0x453c00(0x20c),'value':_0x482e05[_0x453c00(0x24f)],'updatedAt':_0x22b8d8,'createdAt':_0x22b8d8,'dueDate':(0x0,moment_1[_0x453c00(0x217)])(_0x55d3ca)['format'](_0x453c00(0x268)),'companyId':_0x479b7e['id']});}}});}async function startQueueProcess(){const _0x5279f8=a308_0x140d13;logger_1[_0x5279f8(0x24e)][_0x5279f8(0x212)](_0x5279f8(0x245)),await exports[_0x5279f8(0x1ea)]['add'](_0x5279f8(0x21e),{},{'repeat':{'every':0xea60*0x5,'key':'VerifyLoginStatus'},'removeOnComplete':!![],'removeOnFail':!![]});const _0x4c815e=new bullmq_1[(_0x5279f8(0x1d1))](exports[_0x5279f8(0x1ea)]['name'],handleLoginStatus,{'connection':connection,'removeOnFail':{'count':0x0}});_0x4c815e['on'](_0x5279f8(0x22c),async _0x526de1=>{const _0x360336=_0x5279f8;logger_1[_0x360336(0x24e)][_0x360336(0x212)](_0x360336(0x1da)+_0x526de1[_0x360336(0x258)]+'\x20completed');}),await exports['generalMonitor'][_0x5279f8(0x255)](_0x5279f8(0x201),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x5279f8(0x201)},'removeOnComplete':!![],'removeOnFail':!![]}),await exports[_0x5279f8(0x260)][_0x5279f8(0x255)](_0x5279f8(0x1fd),{},{'repeat':{'every':0x3c*0x3e8*0x1e,'key':_0x5279f8(0x1fd)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x4574c6=new bullmq_1[(_0x5279f8(0x1d1))](exports[_0x5279f8(0x260)][_0x5279f8(0x258)],async _0x5b1668=>{const _0x4c8d85=_0x5279f8;if(_0x5b1668[_0x4c8d85(0x258)]==_0x4c8d85(0x201))await handleCloseTicketsAutomatic();else _0x5b1668['name']==_0x4c8d85(0x1fd)&&await handleInvoiceCreate();},{'connection':connection,'removeOnFail':{'count':0x0}});await exports['campaignQueue'][_0x5279f8(0x255)](_0x5279f8(0x269),{},{'repeat':{'every':0x3c*0x3e8*0x5,'key':_0x5279f8(0x269)},'removeOnComplete':!![],'removeOnFail':!![]}),new campaingJob_1['default'](exports[_0x5279f8(0x206)][_0x5279f8(0x258)],connection);const _0x3d326c=new bullmq_1['Worker'](exports['messageQueue'][_0x5279f8(0x258)],async _0x13178f=>{const _0x130e7a=_0x5279f8;if(_0x13178f[_0x130e7a(0x258)]==_0x130e7a(0x240))await handleMessageJob(_0x13178f);else{if(_0x13178f[_0x130e7a(0x258)]=='MessageUpdateJob')await messageUpdateJob(_0x13178f);else _0x13178f['name']=='SendMessage'&&await handleSendMessage(_0x13178f);}},{'connection':connection,'concurrency':0x64,'removeOnFail':{'count':0x0}});_0x3d326c['on'](_0x5279f8(0x22c),async _0xb941be=>{const _0x267950=_0x5279f8;logger_1[_0x267950(0x24e)][_0x267950(0x212)](_0x267950(0x1da)+_0xb941be[_0x267950(0x258)]+_0x267950(0x222));}),_0x3d326c['on']('failed',async(_0x203452,_0x55c39f)=>{const _0x2056c7=_0x5279f8;logger_1[_0x2056c7(0x24e)]['error']('Job\x20'+_0x203452[_0x2056c7(0x258)]+_0x2056c7(0x1d8)+_0x55c39f['message']);}),await exports['queueMonitor'][_0x5279f8(0x255)](_0x5279f8(0x1d4),{},{'repeat':{'every':0x3c*0x3e8*0x2,'key':_0x5279f8(0x1d4)},'removeOnComplete':!![],'removeOnFail':!![]});const _0x3b778e=new bullmq_1[(_0x5279f8(0x1d1))](exports[_0x5279f8(0x25e)][_0x5279f8(0x258)],async _0x2daa6f=>{const _0x3a5271=_0x5279f8;_0x2daa6f[_0x3a5271(0x258)]==_0x3a5271(0x1d4)&&await handleVerifyQueue(_0x2daa6f);},{'connection':connection,'removeOnFail':{'count':0x0}});_0x3b778e['on'](_0x5279f8(0x22c),async _0x254eca=>{const _0x4ba473=_0x5279f8;logger_1[_0x4ba473(0x24e)][_0x4ba473(0x212)](_0x4ba473(0x1da)+_0x254eca['id']+'\x20completed');});let _0x1bed27=new scheduledMessageJob_1[(_0x5279f8(0x217))](exports['scheduleMonitor'],connection);await _0x1bed27[_0x5279f8(0x1e0)]()[_0x5279f8(0x255)](_0x5279f8(0x215),{},{'repeat':{'every':0xea60*0x5,'key':'verify'},'removeOnComplete':!![],'removeOnFail':!![]});}exports['startQueueProcess']=startQueueProcess;