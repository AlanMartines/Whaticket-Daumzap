const a431_0x4ccc55=a431_0x287a;(function(_0x3c7179,_0x5dc2ed){const _0x3be795=a431_0x287a,_0x4031f2=_0x3c7179();while(!![]){try{const _0x150cb0=parseInt(_0x3be795(0x1ab))/0x1*(-parseInt(_0x3be795(0x1a8))/0x2)+-parseInt(_0x3be795(0x1ba))/0x3+parseInt(_0x3be795(0x1af))/0x4+parseInt(_0x3be795(0x1b2))/0x5*(parseInt(_0x3be795(0x1bd))/0x6)+parseInt(_0x3be795(0x1c2))/0x7+parseInt(_0x3be795(0x1c1))/0x8*(parseInt(_0x3be795(0x1c7))/0x9)+parseInt(_0x3be795(0x1b1))/0xa;if(_0x150cb0===_0x5dc2ed)break;else _0x4031f2['push'](_0x4031f2['shift']());}catch(_0x34eb34){_0x4031f2['push'](_0x4031f2['shift']());}}}(a431_0x2418,0x790df));const a431_0x2cee47=(function(){let _0x57f936=!![];return function(_0x3a08e7,_0x47551b){const _0x158da8=_0x57f936?function(){const _0x53f7c8=a431_0x287a;if(_0x47551b){const _0x312c32=_0x47551b[_0x53f7c8(0x1a9)](_0x3a08e7,arguments);return _0x47551b=null,_0x312c32;}}:function(){};return _0x57f936=![],_0x158da8;};}()),a431_0x1b1ce9=a431_0x2cee47(this,function(){const _0x4c8d96=a431_0x287a;return a431_0x1b1ce9[_0x4c8d96(0x1a3)]()[_0x4c8d96(0x1bc)]('(((.+)+)+)+$')['toString']()[_0x4c8d96(0x1a7)](a431_0x1b1ce9)['search'](_0x4c8d96(0x1b9));});a431_0x1b1ce9();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3605c4){const _0x4ebfbd=a431_0x287a;return _0x3605c4&&_0x3605c4[_0x4ebfbd(0x1c4)]?_0x3605c4:{'default':_0x3605c4};};Object[a431_0x4ccc55(0x1a6)](exports,a431_0x4ccc55(0x1c4),{'value':!![]});function a431_0x2418(){const _0xef117d=['clientsecretsmtpauth','length','toString','Erro\x20interno\x20do\x20servidor','default','defineProperty','constructor','94cHurQf','apply','findOne','10129bAXVNy','Não\x20foi\x20possível\x20inserir\x20o\x20token\x20de\x20redefinição','nodemailer','createTransport','1319760pYkuFA','sequelize','2275210MMJQME','40965jDBXHP','all','QueryTypes','Email\x20não\x20encontrado','error','value','UPDATE','(((.+)+)+)+$','2347683kJHxSa','smtpauth','search','636FqbUJJ','Configurações\x20SMTP\x20estão\x20incompletas','Erro\x20ao\x20enviar\x20e-mail:','Redefinição\x20de\x20Senha','73512hyWHge','177149MerFqR','usersmtpauth','__esModule','SELECT','query','297ahcneB','E-mail\x20enviado\x20com\x20sucesso'];a431_0x2418=function(){return _0xef117d;};return a431_0x2418();}function a431_0x287a(_0x126b90,_0x4586a6){const _0x2127c0=a431_0x2418();return a431_0x287a=function(_0x1b1ce9,_0x2cee47){_0x1b1ce9=_0x1b1ce9-0x1a0;let _0x24181c=_0x2127c0[_0x1b1ce9];return _0x24181c;},a431_0x287a(_0x126b90,_0x4586a6);}const nodemailer_1=__importDefault(require(a431_0x4ccc55(0x1ad))),sequelize_1=__importDefault(require(a431_0x4ccc55(0x1b0))),database_1=__importDefault(require('../../database')),Setting_1=__importDefault(require('../../models/Setting')),SendMail=async(_0x15c3a4,_0x318052)=>{const _0x28f704=a431_0x4ccc55;try{const _0xbc1b75=0x1,{hasResult:_0x11f2b8,data:_0x31ace2}=await filterEmail(_0x15c3a4);if(!_0x11f2b8)return{'status':0x194,'message':_0x28f704(0x1b5)};const _0x2f57bc=_0x31ace2[0x0];if(!_0x2f57bc||_0x2f57bc['companyId']===undefined)return{'status':0x194,'message':'Dados\x20do\x20usuário\x20não\x20encontrados'};const [_0x255364,_0x29660a,_0x3a40c6,_0x284faf]=await Promise[_0x28f704(0x1b3)]([Setting_1['default'][_0x28f704(0x1aa)]({'where':{'companyId':_0xbc1b75,'key':_0x28f704(0x1bb)}}),Setting_1['default'][_0x28f704(0x1aa)]({'where':{'companyId':_0xbc1b75,'key':_0x28f704(0x1c3)}}),Setting_1[_0x28f704(0x1a5)][_0x28f704(0x1aa)]({'where':{'companyId':_0xbc1b75,'key':_0x28f704(0x1a1)}}),Setting_1[_0x28f704(0x1a5)][_0x28f704(0x1aa)]({'where':{'companyId':_0xbc1b75,'key':'smtpport'}})]),_0x247525=_0x255364?.['value'],_0x1159a5=_0x29660a?.[_0x28f704(0x1b7)],_0x650a34=_0x3a40c6?.[_0x28f704(0x1b7)],_0x5deee6=_0x1159a5,_0x39e27b=_0x284faf?.[_0x28f704(0x1b7)];if(!_0x247525||!_0x1159a5||!_0x650a34||!_0x39e27b)throw new Error(_0x28f704(0x1be));const _0x2d8b3f=nodemailer_1['default'][_0x28f704(0x1ae)]({'host':_0x247525,'port':Number(_0x39e27b),'secure':![],'auth':{'user':_0x1159a5,'pass':_0x650a34}}),{hasResults:_0x29e65a}=await insertToken(_0x15c3a4,_0x318052);if(!_0x29e65a)return{'status':0x194,'message':_0x28f704(0x1ac)};const _0x253d27={'from':_0x5deee6,'to':_0x15c3a4,'subject':_0x28f704(0x1c0),'text':'Olá,\x0a\x0aVocê\x20solicitou\x20a\x20redefinição\x20de\x20senha\x20para\x20sua\x20conta,\x20utilize\x20o\x20seguinte\x20Código\x20de\x20Verificação\x20para\x20concluir\x20o\x20processo\x20de\x20redefinição\x20de\x20senha:\x0a\x0aCódigo\x20de\x20Verificação:\x20'+_0x318052+'\x0a\x0aPor\x20favor,\x20copie\x20e\x20cole\x20o\x20Código\x20de\x20Verificação\x20no\x20campo\x20\x27Código\x20de\x20Verificação\x27.\x0a\x0aSe\x20você\x20não\x20solicitou\x20esta\x20redefinição\x20de\x20senha,\x20por\x20favor,\x20ignore\x20este\x20e-mail.\x0a\x0a\x0aAtenciosamente'},_0x1023fa=await _0x2d8b3f['sendMail'](_0x253d27);return{'status':0xc8,'message':_0x28f704(0x1a0),'info':_0x1023fa};}catch(_0x4db709){return console[_0x28f704(0x1b6)](_0x28f704(0x1bf),_0x4db709),{'status':0x1f4,'message':_0x28f704(0x1a4)};}},filterEmail=async _0x2c7c8c=>{const _0x5e6194=a431_0x4ccc55,_0x49b43a='SELECT\x20*\x20FROM\x20\x22Users\x22\x20WHERE\x20email\x20=\x27'+_0x2c7c8c+'\x27',_0x502fb5=await database_1[_0x5e6194(0x1a5)][_0x5e6194(0x1c6)](_0x49b43a,{'type':sequelize_1[_0x5e6194(0x1a5)]['QueryTypes'][_0x5e6194(0x1c5)]});return{'hasResult':_0x502fb5[_0x5e6194(0x1a2)]>0x0,'data':_0x502fb5};},insertToken=async(_0x267746,_0x2de9c4)=>{const _0x775ac8=a431_0x4ccc55,_0x31d239='UPDATE\x20\x22Users\x22\x20SET\x20\x22resetPassword\x22=\x20\x27'+_0x2de9c4+'\x27\x20WHERE\x20email\x20=\x27'+_0x267746+'\x27',_0x1ef55a=await database_1['default'][_0x775ac8(0x1c6)](_0x31d239,{'type':sequelize_1['default'][_0x775ac8(0x1b4)][_0x775ac8(0x1b8)]});return{'hasResults':_0x1ef55a[0x1]>0x0,'datas':_0x1ef55a};};exports[a431_0x4ccc55(0x1a5)]=SendMail;