const a444_0x2ee6ff=a444_0x5397;(function(_0x392b73,_0x1cc7fb){const _0x5c6ef3=a444_0x5397,_0x4de09f=_0x392b73();while(!![]){try{const _0x5c97e1=parseInt(_0x5c6ef3(0x19a))/0x1+parseInt(_0x5c6ef3(0x17d))/0x2+parseInt(_0x5c6ef3(0x186))/0x3*(-parseInt(_0x5c6ef3(0x18a))/0x4)+-parseInt(_0x5c6ef3(0x17b))/0x5+-parseInt(_0x5c6ef3(0x187))/0x6+-parseInt(_0x5c6ef3(0x199))/0x7*(parseInt(_0x5c6ef3(0x198))/0x8)+parseInt(_0x5c6ef3(0x191))/0x9;if(_0x5c97e1===_0x1cc7fb)break;else _0x4de09f['push'](_0x4de09f['shift']());}catch(_0x4ff4dd){_0x4de09f['push'](_0x4de09f['shift']());}}}(a444_0x7047,0x2cc64));const a444_0x35bf3e=(function(){let _0x2daf91=!![];return function(_0x141e53,_0x1a2f73){const _0x5ee147=_0x2daf91?function(){if(_0x1a2f73){const _0x6b4992=_0x1a2f73['apply'](_0x141e53,arguments);return _0x1a2f73=null,_0x6b4992;}}:function(){};return _0x2daf91=![],_0x5ee147;};}()),a444_0x58504c=a444_0x35bf3e(this,function(){const _0x5a750e=a444_0x5397;return a444_0x58504c[_0x5a750e(0x179)]()[_0x5a750e(0x182)](_0x5a750e(0x190))[_0x5a750e(0x179)]()[_0x5a750e(0x180)](a444_0x58504c)[_0x5a750e(0x182)]('(((.+)+)+)+$');});a444_0x58504c();'use strict';var __importDefault=this&&this[a444_0x2ee6ff(0x188)]||function(_0x126675){const _0x310e29=a444_0x2ee6ff;return _0x126675&&_0x126675[_0x310e29(0x175)]?_0x126675:{'default':_0x126675};};Object['defineProperty'](exports,a444_0x2ee6ff(0x175),{'value':!![]});function a444_0x5397(_0x4116ee,_0x51d6e7){const _0x44ea14=a444_0x7047();return a444_0x5397=function(_0x58504c,_0x35bf3e){_0x58504c=_0x58504c-0x175;let _0x7047a5=_0x44ea14[_0x58504c];return _0x7047a5;},a444_0x5397(_0x4116ee,_0x51d6e7);}function a444_0x7047(){const _0x583539=['22020rhfrnv','__importDefault','queueId','126892fWhPOW','ticket','-appMessage','company-','reload','getIO','(((.+)+)+)+$','4392486atrwAp','status','../../models/Message','available','findByPk','quotedMsg','contact','1030616EzeTij','14vIoGWU','12921qCQacl','../../models/OldMessage','__esModule','-mainchannel','ERR_CREATING_MESSAGE','queue','toString','upsert','484855jpLVlB','update','398662YYsrgN','default','-notification','constructor','emit','search','whatsapp','oldMessages','queue-','15VkHddR'];a444_0x7047=function(){return _0x583539;};return a444_0x7047();}const socket_1=require('../../libs/socket'),Message_1=__importDefault(require(a444_0x2ee6ff(0x193))),Ticket_1=__importDefault(require('../../models/Ticket')),OldMessage_1=__importDefault(require(a444_0x2ee6ff(0x19b))),CreateMessageService=async({messageData:_0x20610e,ticket:_0x5d3a06,companyId:_0x1b071e})=>{const _0x46c3dc=a444_0x2ee6ff;await Message_1[_0x46c3dc(0x17e)][_0x46c3dc(0x17a)]({..._0x20610e,'companyId':_0x1b071e});const _0x329a17=await Message_1[_0x46c3dc(0x17e)][_0x46c3dc(0x195)](_0x20610e['id'],{'include':[_0x46c3dc(0x197),{'model':Ticket_1[_0x46c3dc(0x17e)],'as':_0x46c3dc(0x18b),'include':[_0x46c3dc(0x197),_0x46c3dc(0x178),_0x46c3dc(0x183)]},{'model':Message_1['default'],'as':_0x46c3dc(0x196),'include':[_0x46c3dc(0x197)]},{'model':OldMessage_1['default'],'as':_0x46c3dc(0x184)}]});if(_0x5d3a06[_0x46c3dc(0x197)])await _0x5d3a06['contact'][_0x46c3dc(0x17c)]({'presence':_0x46c3dc(0x194)}),await _0x5d3a06[_0x46c3dc(0x197)][_0x46c3dc(0x18e)](),_0x5d3a06[_0x46c3dc(0x189)]!==null&&_0x329a17[_0x46c3dc(0x189)]===null&&await _0x329a17[_0x46c3dc(0x17c)]({'queueId':_0x5d3a06[_0x46c3dc(0x189)]});else throw new Error(_0x46c3dc(0x177));if(!_0x329a17)throw new Error(_0x46c3dc(0x177));const _0x59b770=(0x0,socket_1[_0x46c3dc(0x18f)])();return _0x59b770['to'](_0x329a17['ticketId'][_0x46c3dc(0x179)]())['to'](_0x46c3dc(0x18d)+_0x1b071e+'-'+_0x5d3a06['status'])['to'](_0x46c3dc(0x18d)+_0x1b071e+_0x46c3dc(0x17f))['to'](_0x46c3dc(0x185)+_0x329a17[_0x46c3dc(0x189)]+_0x46c3dc(0x17f))['to'](_0x46c3dc(0x185)+_0x329a17['queueId']+'-'+_0x5d3a06[_0x46c3dc(0x192)])['emit'](_0x46c3dc(0x18d)+_0x1b071e+_0x46c3dc(0x18c),{'action':'create','message':_0x329a17,'ticket':_0x5d3a06,'contact':_0x5d3a06[_0x46c3dc(0x197)]}),_0x59b770['to']('company-'+_0x1b071e+_0x46c3dc(0x176))[_0x46c3dc(0x181)](_0x46c3dc(0x18d)+_0x1b071e+'-contact',{'action':_0x46c3dc(0x17c),'contact':_0x5d3a06[_0x46c3dc(0x197)]}),_0x329a17;};exports['default']=CreateMessageService;