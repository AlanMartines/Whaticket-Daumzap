const a444_0x279334=a444_0x2e2c;(function(_0x3face5,_0x507653){const _0x5ae469=a444_0x2e2c,_0x35dcab=_0x3face5();while(!![]){try{const _0x333244=-parseInt(_0x5ae469(0x101))/0x1*(parseInt(_0x5ae469(0x112))/0x2)+parseInt(_0x5ae469(0x116))/0x3+parseInt(_0x5ae469(0x11b))/0x4+-parseInt(_0x5ae469(0x113))/0x5+parseInt(_0x5ae469(0x111))/0x6*(parseInt(_0x5ae469(0x10f))/0x7)+-parseInt(_0x5ae469(0x104))/0x8*(parseInt(_0x5ae469(0x106))/0x9)+parseInt(_0x5ae469(0x10e))/0xa*(-parseInt(_0x5ae469(0xfb))/0xb);if(_0x333244===_0x507653)break;else _0x35dcab['push'](_0x35dcab['shift']());}catch(_0x33c218){_0x35dcab['push'](_0x35dcab['shift']());}}}(a444_0x4632,0xe8a4e));const a444_0x34b4dc=(function(){let _0x59c828=!![];return function(_0x24cc2b,_0x4c2fc1){const _0x3b8ccc=_0x59c828?function(){const _0x3a7d38=a444_0x2e2c;if(_0x4c2fc1){const _0x3de24e=_0x4c2fc1[_0x3a7d38(0xf9)](_0x24cc2b,arguments);return _0x4c2fc1=null,_0x3de24e;}}:function(){};return _0x59c828=![],_0x3b8ccc;};}()),a444_0x37d15a=a444_0x34b4dc(this,function(){const _0x419cb2=a444_0x2e2c;return a444_0x37d15a[_0x419cb2(0x114)]()[_0x419cb2(0x102)]('(((.+)+)+)+$')[_0x419cb2(0x114)]()['constructor'](a444_0x37d15a)[_0x419cb2(0x102)](_0x419cb2(0x103));});a444_0x37d15a();'use strict';function a444_0x4632(){const _0x2759a0=['ERR_CREATING_MESSAGE','oldMessages','quotedMsg','-appMessage','46696zQVbiN','emit','upsert','__esModule','-contact','apply','create','13650351HVWBIb','getIO','ticketId','available','company-','queue-','27bCEqkP','search','(((.+)+)+)+$','109096SGSVnG','default','261qrdSpZ','queue','ticket','status','contact','queueId','update','findByPk','10GgOTtS','1880459uyQacd','-mainchannel','42vYxujY','13996UTtBnW','3484045dicSSQ','toString','../../models/Message','4748838JQutKw'];a444_0x4632=function(){return _0x2759a0;};return a444_0x4632();}var __importDefault=this&&this['__importDefault']||function(_0xd3e3d3){const _0x25dff4=a444_0x2e2c;return _0xd3e3d3&&_0xd3e3d3[_0x25dff4(0xf7)]?_0xd3e3d3:{'default':_0xd3e3d3};};function a444_0x2e2c(_0x1e0d70,_0x3bc496){const _0x2a3e8c=a444_0x4632();return a444_0x2e2c=function(_0x37d15a,_0x34b4dc){_0x37d15a=_0x37d15a-0xf5;let _0x46329a=_0x2a3e8c[_0x37d15a];return _0x46329a;},a444_0x2e2c(_0x1e0d70,_0x3bc496);}Object['defineProperty'](exports,a444_0x279334(0xf7),{'value':!![]});const socket_1=require('../../libs/socket'),Message_1=__importDefault(require(a444_0x279334(0x115))),Ticket_1=__importDefault(require('../../models/Ticket')),OldMessage_1=__importDefault(require('../../models/OldMessage')),CreateMessageService=async({messageData:_0x87dc45,ticket:_0x446b39,companyId:_0x248f28})=>{const _0x3215f2=a444_0x279334;await Message_1[_0x3215f2(0x105)][_0x3215f2(0xf6)]({..._0x87dc45,'companyId':_0x248f28});const _0x420eb7=await Message_1[_0x3215f2(0x105)][_0x3215f2(0x10d)](_0x87dc45['id'],{'include':['contact',{'model':Ticket_1[_0x3215f2(0x105)],'as':_0x3215f2(0x108),'include':['contact',_0x3215f2(0x107),'whatsapp']},{'model':Message_1['default'],'as':_0x3215f2(0x119),'include':['contact']},{'model':OldMessage_1[_0x3215f2(0x105)],'as':_0x3215f2(0x118)}]});if(_0x446b39[_0x3215f2(0x10a)])await _0x446b39[_0x3215f2(0x10a)][_0x3215f2(0x10c)]({'presence':_0x3215f2(0xfe)}),await _0x446b39[_0x3215f2(0x10a)]['reload'](),_0x446b39[_0x3215f2(0x10b)]!==null&&_0x420eb7['queueId']===null&&await _0x420eb7[_0x3215f2(0x10c)]({'queueId':_0x446b39[_0x3215f2(0x10b)]});else throw new Error(_0x3215f2(0x117));if(!_0x420eb7)throw new Error(_0x3215f2(0x117));const _0x1fc93a=(0x0,socket_1[_0x3215f2(0xfc)])();return _0x1fc93a['to'](_0x420eb7[_0x3215f2(0xfd)][_0x3215f2(0x114)]())['to'](_0x3215f2(0xff)+_0x248f28+'-'+_0x446b39[_0x3215f2(0x109)])['to'](_0x3215f2(0xff)+_0x248f28+'-notification')['to'](_0x3215f2(0x100)+_0x420eb7[_0x3215f2(0x10b)]+'-notification')['to'](_0x3215f2(0x100)+_0x420eb7['queueId']+'-'+_0x446b39[_0x3215f2(0x109)])[_0x3215f2(0xf5)](_0x3215f2(0xff)+_0x248f28+_0x3215f2(0x11a),{'action':_0x3215f2(0xfa),'message':_0x420eb7,'ticket':_0x446b39,'contact':_0x446b39[_0x3215f2(0x10a)]}),_0x1fc93a['to'](_0x3215f2(0xff)+_0x248f28+_0x3215f2(0x110))['emit'](_0x3215f2(0xff)+_0x248f28+_0x3215f2(0xf8),{'action':_0x3215f2(0x10c),'contact':_0x446b39[_0x3215f2(0x10a)]}),_0x420eb7;};exports[a444_0x279334(0x105)]=CreateMessageService;