const a444_0x1c1008=a444_0x4017;(function(_0xad9529,_0x19141c){const _0x501a76=a444_0x4017,_0x20f7a8=_0xad9529();while(!![]){try{const _0x2af04f=parseInt(_0x501a76(0xe3))/0x1+-parseInt(_0x501a76(0xd9))/0x2+-parseInt(_0x501a76(0xee))/0x3+-parseInt(_0x501a76(0xf5))/0x4+-parseInt(_0x501a76(0xf3))/0x5+-parseInt(_0x501a76(0xeb))/0x6*(-parseInt(_0x501a76(0xe7))/0x7)+parseInt(_0x501a76(0xdd))/0x8*(parseInt(_0x501a76(0xf2))/0x9);if(_0x2af04f===_0x19141c)break;else _0x20f7a8['push'](_0x20f7a8['shift']());}catch(_0x463785){_0x20f7a8['push'](_0x20f7a8['shift']());}}}(a444_0xb6fd,0x4c445));function a444_0xb6fd(){const _0x5662d3=['2272nJSiuB','-appMessage','../../models/Ticket','getIO','contact','available','409301fzVQug','(((.+)+)+)+$','search','../../models/OldMessage','14BcDuHo','company-','../../models/Message','__esModule','1015650MVvYSp','emit','constructor','273270hACymZ','whatsapp','create','apply','25299AfiDwx','638900Muzzee','defineProperty','1811156Tkqpbm','toString','-contact','ticket','reload','status','__importDefault','ERR_CREATING_MESSAGE','update','queueId','quotedMsg','1124254vtgCQs','queue-','default','-notification'];a444_0xb6fd=function(){return _0x5662d3;};return a444_0xb6fd();}const a444_0xf8a21d=(function(){let _0x280a08=!![];return function(_0x2d96bf,_0x5bb8bb){const _0x594873=_0x280a08?function(){const _0x1a8f5a=a444_0x4017;if(_0x5bb8bb){const _0x2b598c=_0x5bb8bb[_0x1a8f5a(0xf1)](_0x2d96bf,arguments);return _0x5bb8bb=null,_0x2b598c;}}:function(){};return _0x280a08=![],_0x594873;};}()),a444_0x587057=a444_0xf8a21d(this,function(){const _0x1affaf=a444_0x4017;return a444_0x587057[_0x1affaf(0xf6)]()['search'](_0x1affaf(0xe4))['toString']()[_0x1affaf(0xed)](a444_0x587057)[_0x1affaf(0xe5)](_0x1affaf(0xe4));});a444_0x587057();'use strict';var __importDefault=this&&this[a444_0x1c1008(0xfb)]||function(_0x29c710){const _0x54e47e=a444_0x1c1008;return _0x29c710&&_0x29c710[_0x54e47e(0xea)]?_0x29c710:{'default':_0x29c710};};Object[a444_0x1c1008(0xf4)](exports,a444_0x1c1008(0xea),{'value':!![]});const socket_1=require('../../libs/socket'),Message_1=__importDefault(require(a444_0x1c1008(0xe9))),Ticket_1=__importDefault(require(a444_0x1c1008(0xdf))),OldMessage_1=__importDefault(require(a444_0x1c1008(0xe6))),CreateMessageService=async({messageData:_0x302d90,ticket:_0x3e5f05,companyId:_0x4d2839})=>{const _0x24f62c=a444_0x1c1008;await Message_1[_0x24f62c(0xdb)]['upsert']({..._0x302d90,'companyId':_0x4d2839});const _0x41e52e=await Message_1['default']['findByPk'](_0x302d90['id'],{'include':[_0x24f62c(0xe1),{'model':Ticket_1[_0x24f62c(0xdb)],'as':_0x24f62c(0xf8),'include':[_0x24f62c(0xe1),'queue',_0x24f62c(0xef)]},{'model':Message_1[_0x24f62c(0xdb)],'as':_0x24f62c(0xd8),'include':[_0x24f62c(0xe1)]},{'model':OldMessage_1[_0x24f62c(0xdb)],'as':'oldMessages'}]});if(_0x3e5f05['contact'])await _0x3e5f05[_0x24f62c(0xe1)]['update']({'presence':_0x24f62c(0xe2)}),await _0x3e5f05['contact'][_0x24f62c(0xf9)](),_0x3e5f05[_0x24f62c(0xd7)]!==null&&_0x41e52e[_0x24f62c(0xd7)]===null&&await _0x41e52e[_0x24f62c(0xd6)]({'queueId':_0x3e5f05[_0x24f62c(0xd7)]});else throw new Error('ERR_CREATING_MESSAGE');if(!_0x41e52e)throw new Error(_0x24f62c(0xd5));const _0x285a07=(0x0,socket_1[_0x24f62c(0xe0)])();return _0x285a07['to'](_0x41e52e['ticketId']['toString']())['to'](_0x24f62c(0xe8)+_0x4d2839+'-'+_0x3e5f05[_0x24f62c(0xfa)])['to'](_0x24f62c(0xe8)+_0x4d2839+_0x24f62c(0xdc))['to'](_0x24f62c(0xda)+_0x41e52e[_0x24f62c(0xd7)]+_0x24f62c(0xdc))['to'](_0x24f62c(0xda)+_0x41e52e[_0x24f62c(0xd7)]+'-'+_0x3e5f05['status'])[_0x24f62c(0xec)]('company-'+_0x4d2839+_0x24f62c(0xde),{'action':_0x24f62c(0xf0),'message':_0x41e52e,'ticket':_0x3e5f05,'contact':_0x3e5f05['contact']}),_0x285a07['to'](_0x24f62c(0xe8)+_0x4d2839+'-mainchannel')[_0x24f62c(0xec)]('company-'+_0x4d2839+_0x24f62c(0xf7),{'action':_0x24f62c(0xd6),'contact':_0x3e5f05['contact']}),_0x41e52e;};function a444_0x4017(_0x1a4392,_0xe78e1d){const _0x40f3ba=a444_0xb6fd();return a444_0x4017=function(_0x587057,_0xf8a21d){_0x587057=_0x587057-0xd5;let _0xb6fdaf=_0x40f3ba[_0x587057];return _0xb6fdaf;},a444_0x4017(_0x1a4392,_0xe78e1d);}exports[a444_0x1c1008(0xdb)]=CreateMessageService;