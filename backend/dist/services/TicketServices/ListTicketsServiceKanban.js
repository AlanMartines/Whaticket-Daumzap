const a525_0x51f2be=a525_0x5e5f;(function(_0x2e0a33,_0x5dead5){const _0x25f00b=a525_0x5e5f,_0xf3bcf1=_0x2e0a33();while(!![]){try{const _0x55ea2a=parseInt(_0x25f00b(0x1c8))/0x1*(-parseInt(_0x25f00b(0x1d4))/0x2)+parseInt(_0x25f00b(0x1f3))/0x3*(-parseInt(_0x25f00b(0x1c2))/0x4)+-parseInt(_0x25f00b(0x1bd))/0x5*(-parseInt(_0x25f00b(0x1ef))/0x6)+parseInt(_0x25f00b(0x1f5))/0x7*(parseInt(_0x25f00b(0x1db))/0x8)+parseInt(_0x25f00b(0x1e1))/0x9+-parseInt(_0x25f00b(0x1dd))/0xa*(parseInt(_0x25f00b(0x1df))/0xb)+-parseInt(_0x25f00b(0x1e8))/0xc;if(_0x55ea2a===_0x5dead5)break;else _0xf3bcf1['push'](_0xf3bcf1['shift']());}catch(_0x627dd0){_0xf3bcf1['push'](_0xf3bcf1['shift']());}}}(a525_0x12b1,0x5f979));const a525_0x93b953=(function(){let _0x283311=!![];return function(_0x3261dc,_0x12deac){const _0x392169=_0x283311?function(){const _0x41f7e8=a525_0x5e5f;if(_0x12deac){const _0x2c4a21=_0x12deac[_0x41f7e8(0x1cc)](_0x3261dc,arguments);return _0x12deac=null,_0x2c4a21;}}:function(){};return _0x283311=![],_0x392169;};}()),a525_0x4aab43=a525_0x93b953(this,function(){const _0x231bb7=a525_0x5e5f;return a525_0x4aab43[_0x231bb7(0x1f0)]()[_0x231bb7(0x1e9)]('(((.+)+)+)+$')[_0x231bb7(0x1f0)]()[_0x231bb7(0x1c0)](a525_0x4aab43)[_0x231bb7(0x1e9)](_0x231bb7(0x1eb));});a525_0x4aab43();'use strict';function a525_0x5e5f(_0x1f0c69,_0x543a0e){const _0x154e10=a525_0x12b1();return a525_0x5e5f=function(_0x4aab43,_0x93b953){_0x4aab43=_0x4aab43-0x1bb;let _0x12b11c=_0x154e10[_0x4aab43];return _0x12b11c;},a525_0x5e5f(_0x1f0c69,_0x543a0e);}var __importDefault=this&&this[a525_0x51f2be(0x1f6)]||function(_0x9f34f2){const _0x4745a6=a525_0x51f2be;return _0x9f34f2&&_0x9f34f2[_0x4745a6(0x1d2)]?_0x9f34f2:{'default':_0x9f34f2};};function a525_0x12b1(){const _0x27e5ed=['../../models/Queue','LIKE','name','2696gKmKWD','../../models/Whatsapp','3200VnpzhG','open','5093VxYSBa','../../models/Tag','3511881nxiZPj','startOfDay','body','push','default','where','date-fns','350760OHZbPu','search','../../models/Ticket','(((.+)+)+)+$','../../models/Message','../UserServices/ShowUserService','LOWER','6muPlKq','toString','../../models/TicketTag','parseISO','193194nsBZqX','contact.name','15225bEYGNw','__importDefault','between','toLocaleLowerCase','findAndCountAll','intersection','endOfDay','2980245hWzrdU','sequelize','length','constructor','queues','36lNBZqs','true','col','updatedAt','lodash','whatsapp','4qrwkjc','presence','like','findAll','apply','contact','color','isArray','pending','number','__esModule','map','285358MNGIGX','ticketId','tags','defineProperty'];a525_0x12b1=function(){return _0x27e5ed;};return a525_0x12b1();}Object[a525_0x51f2be(0x1d7)](exports,a525_0x51f2be(0x1d2),{'value':!![]});const sequelize_1=require(a525_0x51f2be(0x1be)),date_fns_1=require(a525_0x51f2be(0x1e7)),Ticket_1=__importDefault(require(a525_0x51f2be(0x1ea))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a525_0x51f2be(0x1ec))),Queue_1=__importDefault(require(a525_0x51f2be(0x1d8))),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require(a525_0x51f2be(0x1ed))),Tag_1=__importDefault(require(a525_0x51f2be(0x1e0))),TicketTag_1=__importDefault(require(a525_0x51f2be(0x1f1))),lodash_1=require(a525_0x51f2be(0x1c6)),Whatsapp_1=__importDefault(require(a525_0x51f2be(0x1dc))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1dce10,tags:_0x401f4c,users:_0x4d9689,status:_0x2a1c87,date:_0x2c671e,updatedAt:_0x2f15ae,showAll:_0xa01a63,userId:_0x42173a,withUnreadMessages:_0x207d03,companyId:_0x5ec2ed})=>{const _0x23d807=a525_0x51f2be;let _0x56aa0f={[sequelize_1['Op']['or']]:[{'userId':_0x42173a},{'status':_0x23d807(0x1d0)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1dce10,null]}},_0x158c53;_0x158c53=[{'model':Contact_1[_0x23d807(0x1e5)],'as':_0x23d807(0x1cd),'attributes':['id',_0x23d807(0x1da),_0x23d807(0x1d1),'email',_0x23d807(0x1c9)]},{'model':Queue_1['default'],'as':'queue','attributes':['id',_0x23d807(0x1da),_0x23d807(0x1ce)]},{'model':User_1[_0x23d807(0x1e5)],'as':'user','attributes':['id','name']},{'model':Tag_1[_0x23d807(0x1e5)],'as':_0x23d807(0x1d6),'attributes':['id',_0x23d807(0x1da),_0x23d807(0x1ce)]},{'model':Whatsapp_1[_0x23d807(0x1e5)],'as':_0x23d807(0x1c7),'attributes':['name']}];_0xa01a63===_0x23d807(0x1c3)&&(_0x56aa0f={'queueId':{[sequelize_1['Op']['or']]:[_0x1dce10,null]},'userId':_0x42173a});_0x56aa0f={..._0x56aa0f,'status':{[sequelize_1['Op']['or']]:['pending',_0x23d807(0x1de)]}};if(searchParam){const _0xef38c=searchParam[_0x23d807(0x1f8)]()['trim']();_0x158c53=[..._0x158c53,{'model':Message_1[_0x23d807(0x1e5)],'as':'messages','attributes':['id',_0x23d807(0x1e3)],'where':{'body':(0x0,sequelize_1[_0x23d807(0x1e6)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x23d807(0x1c4)])(_0x23d807(0x1e3))),_0x23d807(0x1d9),'%'+_0xef38c+'%')},'required':![],'duplicating':![]}],_0x56aa0f={..._0x56aa0f,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x23d807(0x1e6)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x23d807(0x1f4))),_0x23d807(0x1d9),'%'+_0xef38c+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x23d807(0x1ca)]]:'%'+_0xef38c+'%'}},{'$message.body$':(0x0,sequelize_1[_0x23d807(0x1e6)])((0x0,sequelize_1['fn'])(_0x23d807(0x1ee),(0x0,sequelize_1[_0x23d807(0x1c4)])('body')),_0x23d807(0x1d9),'%'+_0xef38c+'%')}]};}_0x2c671e&&(_0x56aa0f={'createdAt':{[sequelize_1['Op'][_0x23d807(0x1f7)]]:[+(0x0,date_fns_1[_0x23d807(0x1e2)])((0x0,date_fns_1[_0x23d807(0x1f2)])(_0x2c671e)),+(0x0,date_fns_1[_0x23d807(0x1bc)])((0x0,date_fns_1[_0x23d807(0x1f2)])(_0x2c671e))]}});_0x2f15ae&&(_0x56aa0f={'updatedAt':{[sequelize_1['Op'][_0x23d807(0x1f7)]]:[+(0x0,date_fns_1[_0x23d807(0x1e2)])((0x0,date_fns_1['parseISO'])(_0x2f15ae)),+(0x0,date_fns_1[_0x23d807(0x1bc)])((0x0,date_fns_1['parseISO'])(_0x2f15ae))]}});if(_0x207d03===_0x23d807(0x1c3)){const _0x4d461a=await(0x0,ShowUserService_1[_0x23d807(0x1e5)])(_0x42173a),_0x114e27=_0x4d461a[_0x23d807(0x1c1)][_0x23d807(0x1d3)](_0x2149df=>_0x2149df['id']);_0x56aa0f={[sequelize_1['Op']['or']]:[{'userId':_0x42173a},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x114e27,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x23d807(0x1cf)](_0x401f4c)&&_0x401f4c[_0x23d807(0x1bf)]>0x0){const _0x288ecb=[];for(let _0x478cd0 of _0x401f4c){const _0x223ba3=await TicketTag_1[_0x23d807(0x1e5)][_0x23d807(0x1cb)]({'where':{'tagId':_0x478cd0}});_0x223ba3&&_0x288ecb[_0x23d807(0x1e4)](_0x223ba3[_0x23d807(0x1d3)](_0x365bf9=>_0x365bf9[_0x23d807(0x1d5)]));}const _0x2cd493=(0x0,lodash_1['intersection'])(..._0x288ecb);_0x56aa0f={..._0x56aa0f,'id':{[sequelize_1['Op']['in']]:_0x2cd493}};}if(Array[_0x23d807(0x1cf)](_0x4d9689)&&_0x4d9689[_0x23d807(0x1bf)]>0x0){const _0x3588d2=[];for(let _0x1739bc of _0x4d9689){const _0x163d34=await Ticket_1[_0x23d807(0x1e5)][_0x23d807(0x1cb)]({'where':{'userId':_0x1739bc}});_0x163d34&&_0x3588d2[_0x23d807(0x1e4)](_0x163d34[_0x23d807(0x1d3)](_0x1e3eb9=>_0x1e3eb9['id']));}const _0x4fc696=(0x0,lodash_1[_0x23d807(0x1bb)])(..._0x3588d2);_0x56aa0f={..._0x56aa0f,'id':{[sequelize_1['Op']['in']]:_0x4fc696}};}const _0x13f1c6=0x28,_0x3bfb7c=_0x13f1c6*(+pageNumber-0x1);_0x56aa0f={..._0x56aa0f,'companyId':_0x5ec2ed};const {count:_0x353a6c,rows:_0x1882ee}=await Ticket_1['default'][_0x23d807(0x1f9)]({'where':_0x56aa0f,'include':_0x158c53,'distinct':!![],'limit':_0x13f1c6,'offset':_0x3bfb7c,'order':[[_0x23d807(0x1c5),'DESC']],'subQuery':![]}),_0x1dd088=_0x353a6c>_0x3bfb7c+_0x1882ee['length'];return{'tickets':_0x1882ee,'count':_0x353a6c,'hasMore':_0x1dd088};};exports['default']=ListTicketsServiceKanban;