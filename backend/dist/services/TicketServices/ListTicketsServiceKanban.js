const a525_0x2be055=a525_0x25fd;function a525_0x21f4(){const _0x223e23=['6259680dVwkph','presence','color','3618MhUrbm','date-fns','body','like','messages','../../models/User','queue','../../models/Contact','startOfDay','../../models/Whatsapp','defineProperty','7RXMThu','isArray','queues','endOfDay','(((.+)+)+)+$','between','__esModule','col','528LYOwyu','106WSUepz','contact.name','length','../../models/Message','__importDefault','58410VppjVv','parseISO','where','trim','number','pending','toLocaleLowerCase','findAndCountAll','DESC','name','toString','ticketId','default','user','tags','sequelize','lodash','1480lAjejN','../UserServices/ShowUserService','true','4zHwrHL','LOWER','14004mcyVkp','push','127002wEcWnH','map','../../models/Tag','intersection','91050sbboFL','search','5819GGwbjQ','LIKE','constructor'];a525_0x21f4=function(){return _0x223e23;};return a525_0x21f4();}(function(_0x2c0d2e,_0x3301b2){const _0x600086=a525_0x25fd,_0x7f41b0=_0x2c0d2e();while(!![]){try{const _0x35a031=parseInt(_0x600086(0x112))/0x1*(-parseInt(_0x600086(0xfe))/0x2)+-parseInt(_0x600086(0xf2))/0x3*(parseInt(_0x600086(0xee))/0x4)+-parseInt(_0x600086(0xda))/0x5+-parseInt(_0x600086(0xf6))/0x6*(-parseInt(_0x600086(0x109))/0x7)+parseInt(_0x600086(0x111))/0x8*(-parseInt(_0x600086(0xf0))/0x9)+-parseInt(_0x600086(0xeb))/0xa*(parseInt(_0x600086(0xf8))/0xb)+parseInt(_0x600086(0xfb))/0xc;if(_0x35a031===_0x3301b2)break;else _0x7f41b0['push'](_0x7f41b0['shift']());}catch(_0x213a10){_0x7f41b0['push'](_0x7f41b0['shift']());}}}(a525_0x21f4,0x1ade9));const a525_0x32fc6c=(function(){let _0x31e4b5=!![];return function(_0xd53ff8,_0x5c939e){const _0x78677b=_0x31e4b5?function(){if(_0x5c939e){const _0x295a99=_0x5c939e['apply'](_0xd53ff8,arguments);return _0x5c939e=null,_0x295a99;}}:function(){};return _0x31e4b5=![],_0x78677b;};}()),a525_0x18d2dd=a525_0x32fc6c(this,function(){const _0x3e666b=a525_0x25fd;return a525_0x18d2dd['toString']()[_0x3e666b(0xf7)](_0x3e666b(0x10d))[_0x3e666b(0xe4)]()[_0x3e666b(0xfa)](a525_0x18d2dd)['search'](_0x3e666b(0x10d));});a525_0x18d2dd();function a525_0x25fd(_0x202049,_0x60a83c){const _0x276d20=a525_0x21f4();return a525_0x25fd=function(_0x18d2dd,_0x32fc6c){_0x18d2dd=_0x18d2dd-0xd8;let _0x21f4a8=_0x276d20[_0x18d2dd];return _0x21f4a8;},a525_0x25fd(_0x202049,_0x60a83c);}'use strict';var __importDefault=this&&this[a525_0x2be055(0xd9)]||function(_0x3c91cf){return _0x3c91cf&&_0x3c91cf['__esModule']?_0x3c91cf:{'default':_0x3c91cf};};Object[a525_0x2be055(0x108)](exports,a525_0x2be055(0x10f),{'value':!![]});const sequelize_1=require(a525_0x2be055(0xe9)),date_fns_1=require(a525_0x2be055(0xff)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a525_0x2be055(0x105))),Message_1=__importDefault(require(a525_0x2be055(0xd8))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a525_0x2be055(0x103))),ShowUserService_1=__importDefault(require(a525_0x2be055(0xec))),Tag_1=__importDefault(require(a525_0x2be055(0xf4))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a525_0x2be055(0xea)),Whatsapp_1=__importDefault(require(a525_0x2be055(0x107))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x174ef4,tags:_0x57749,users:_0x23d30c,status:_0x41e1a9,date:_0x48dd34,updatedAt:_0x4a0dd3,showAll:_0x29b12d,userId:_0xdb383b,withUnreadMessages:_0x492dd3,companyId:_0x4b99f4})=>{const _0x2f23b6=a525_0x2be055;let _0x3cd603={[sequelize_1['Op']['or']]:[{'userId':_0xdb383b},{'status':_0x2f23b6(0xdf)}],'queueId':{[sequelize_1['Op']['or']]:[_0x174ef4,null]}},_0x44c6a9;_0x44c6a9=[{'model':Contact_1[_0x2f23b6(0xe6)],'as':'contact','attributes':['id',_0x2f23b6(0xe3),_0x2f23b6(0xde),'email',_0x2f23b6(0xfc)]},{'model':Queue_1['default'],'as':_0x2f23b6(0x104),'attributes':['id','name','color']},{'model':User_1[_0x2f23b6(0xe6)],'as':_0x2f23b6(0xe7),'attributes':['id',_0x2f23b6(0xe3)]},{'model':Tag_1[_0x2f23b6(0xe6)],'as':_0x2f23b6(0xe8),'attributes':['id',_0x2f23b6(0xe3),_0x2f23b6(0xfd)]},{'model':Whatsapp_1[_0x2f23b6(0xe6)],'as':'whatsapp','attributes':[_0x2f23b6(0xe3)]}];_0x29b12d==='true'&&(_0x3cd603={'queueId':{[sequelize_1['Op']['or']]:[_0x174ef4,null]},'userId':_0xdb383b});_0x3cd603={..._0x3cd603,'status':{[sequelize_1['Op']['or']]:[_0x2f23b6(0xdf),'open']}};if(searchParam){const _0x4327f2=searchParam[_0x2f23b6(0xe0)]()[_0x2f23b6(0xdd)]();_0x44c6a9=[..._0x44c6a9,{'model':Message_1[_0x2f23b6(0xe6)],'as':_0x2f23b6(0x102),'attributes':['id','body'],'where':{'body':(0x0,sequelize_1[_0x2f23b6(0xdc)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1[_0x2f23b6(0x110)])(_0x2f23b6(0x100))),_0x2f23b6(0xf9),'%'+_0x4327f2+'%')},'required':![],'duplicating':![]}],_0x3cd603={..._0x3cd603,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x2f23b6(0xdc)])((0x0,sequelize_1['fn'])(_0x2f23b6(0xef),(0x0,sequelize_1[_0x2f23b6(0x110)])(_0x2f23b6(0x113))),_0x2f23b6(0xf9),'%'+_0x4327f2+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x2f23b6(0x101)]]:'%'+_0x4327f2+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x2f23b6(0xef),(0x0,sequelize_1['col'])(_0x2f23b6(0x100))),_0x2f23b6(0xf9),'%'+_0x4327f2+'%')}]};}_0x48dd34&&(_0x3cd603={'createdAt':{[sequelize_1['Op'][_0x2f23b6(0x10e)]]:[+(0x0,date_fns_1[_0x2f23b6(0x106)])((0x0,date_fns_1[_0x2f23b6(0xdb)])(_0x48dd34)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x2f23b6(0xdb)])(_0x48dd34))]}});_0x4a0dd3&&(_0x3cd603={'updatedAt':{[sequelize_1['Op'][_0x2f23b6(0x10e)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x2f23b6(0xdb)])(_0x4a0dd3)),+(0x0,date_fns_1[_0x2f23b6(0x10c)])((0x0,date_fns_1[_0x2f23b6(0xdb)])(_0x4a0dd3))]}});if(_0x492dd3===_0x2f23b6(0xed)){const _0x5ddd9d=await(0x0,ShowUserService_1['default'])(_0xdb383b),_0xde226e=_0x5ddd9d[_0x2f23b6(0x10b)][_0x2f23b6(0xf3)](_0x2494b0=>_0x2494b0['id']);_0x3cd603={[sequelize_1['Op']['or']]:[{'userId':_0xdb383b},{'status':_0x2f23b6(0xdf)}],'queueId':{[sequelize_1['Op']['or']]:[_0xde226e,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x2f23b6(0x10a)](_0x57749)&&_0x57749[_0x2f23b6(0x114)]>0x0){const _0x3dc56b=[];for(let _0x1b61fb of _0x57749){const _0x1a4729=await TicketTag_1['default']['findAll']({'where':{'tagId':_0x1b61fb}});_0x1a4729&&_0x3dc56b['push'](_0x1a4729[_0x2f23b6(0xf3)](_0x31d285=>_0x31d285[_0x2f23b6(0xe5)]));}const _0x55cd04=(0x0,lodash_1[_0x2f23b6(0xf5)])(..._0x3dc56b);_0x3cd603={..._0x3cd603,'id':{[sequelize_1['Op']['in']]:_0x55cd04}};}if(Array['isArray'](_0x23d30c)&&_0x23d30c[_0x2f23b6(0x114)]>0x0){const _0x3ff86e=[];for(let _0x1c9e2e of _0x23d30c){const _0xba7217=await Ticket_1[_0x2f23b6(0xe6)]['findAll']({'where':{'userId':_0x1c9e2e}});_0xba7217&&_0x3ff86e[_0x2f23b6(0xf1)](_0xba7217[_0x2f23b6(0xf3)](_0x1c8f90=>_0x1c8f90['id']));}const _0x409f70=(0x0,lodash_1[_0x2f23b6(0xf5)])(..._0x3ff86e);_0x3cd603={..._0x3cd603,'id':{[sequelize_1['Op']['in']]:_0x409f70}};}const _0x309ef4=0x28,_0x120443=_0x309ef4*(+pageNumber-0x1);_0x3cd603={..._0x3cd603,'companyId':_0x4b99f4};const {count:_0x229164,rows:_0x56b6f1}=await Ticket_1['default'][_0x2f23b6(0xe1)]({'where':_0x3cd603,'include':_0x44c6a9,'distinct':!![],'limit':_0x309ef4,'offset':_0x120443,'order':[['updatedAt',_0x2f23b6(0xe2)]],'subQuery':![]}),_0x7afa3=_0x229164>_0x120443+_0x56b6f1['length'];return{'tickets':_0x56b6f1,'count':_0x229164,'hasMore':_0x7afa3};};exports[a525_0x2be055(0xe6)]=ListTicketsServiceKanban;