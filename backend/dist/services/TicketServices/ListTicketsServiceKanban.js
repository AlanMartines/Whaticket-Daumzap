const a525_0xd21ce0=a525_0x17ab;(function(_0x5512cb,_0x4f5b88){const _0x2abff1=a525_0x17ab,_0x5976d7=_0x5512cb();while(!![]){try{const _0x126e80=parseInt(_0x2abff1(0x1ce))/0x1*(-parseInt(_0x2abff1(0x1d2))/0x2)+parseInt(_0x2abff1(0x1b3))/0x3+-parseInt(_0x2abff1(0x1c9))/0x4+parseInt(_0x2abff1(0x1d6))/0x5+-parseInt(_0x2abff1(0x1e9))/0x6+-parseInt(_0x2abff1(0x1e8))/0x7*(parseInt(_0x2abff1(0x1d8))/0x8)+-parseInt(_0x2abff1(0x1e2))/0x9*(-parseInt(_0x2abff1(0x1ca))/0xa);if(_0x126e80===_0x4f5b88)break;else _0x5976d7['push'](_0x5976d7['shift']());}catch(_0x2f9cf9){_0x5976d7['push'](_0x5976d7['shift']());}}}(a525_0x54b7,0x5ef3d));function a525_0x17ab(_0x2109cd,_0x3b0060){const _0x256e39=a525_0x54b7();return a525_0x17ab=function(_0x1e49b2,_0x94ceda){_0x1e49b2=_0x1e49b2-0x1b2;let _0x54b7cf=_0x256e39[_0x1e49b2];return _0x54b7cf;},a525_0x17ab(_0x2109cd,_0x3b0060);}const a525_0x94ceda=(function(){let _0x3b414c=!![];return function(_0x5abbda,_0x4f877c){const _0xa6337=_0x3b414c?function(){if(_0x4f877c){const _0x425e11=_0x4f877c['apply'](_0x5abbda,arguments);return _0x4f877c=null,_0x425e11;}}:function(){};return _0x3b414c=![],_0xa6337;};}()),a525_0x1e49b2=a525_0x94ceda(this,function(){const _0x91b850=a525_0x17ab;return a525_0x1e49b2[_0x91b850(0x1e5)]()['search'](_0x91b850(0x1b6))['toString']()[_0x91b850(0x1bb)](a525_0x1e49b2)['search'](_0x91b850(0x1b6));});a525_0x1e49b2();'use strict';function a525_0x54b7(){const _0x1a4cee=['intersection','like','toString','../../models/Tag','user','7aMMjaT','739614lJIJFA','endOfDay','pending','1590828kmyrqV','findAndCountAll','name','(((.+)+)+)+$','../../models/Message','default','updatedAt','date-fns','constructor','open','body','startOfDay','ticketId','defineProperty','email','map','queues','messages','presence','color','parseISO','toLocaleLowerCase','594152iWVlrR','6198940yiiHqn','queue','__importDefault','LOWER','1DaZCzq','where','LIKE','whatsapp','1320854eWsxUs','tags','../../models/Ticket','col','2977000scUazj','true','3395288KEamhL','__esModule','push','../../models/User','../../models/Whatsapp','isArray','length','../UserServices/ShowUserService','DESC','between','9RufaTw'];a525_0x54b7=function(){return _0x1a4cee;};return a525_0x54b7();}var __importDefault=this&&this[a525_0xd21ce0(0x1cc)]||function(_0x3f730d){const _0x58b035=a525_0xd21ce0;return _0x3f730d&&_0x3f730d[_0x58b035(0x1d9)]?_0x3f730d:{'default':_0x3f730d};};Object[a525_0xd21ce0(0x1c0)](exports,a525_0xd21ce0(0x1d9),{'value':!![]});const sequelize_1=require('sequelize'),date_fns_1=require(a525_0xd21ce0(0x1ba)),Ticket_1=__importDefault(require(a525_0xd21ce0(0x1d4))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require(a525_0xd21ce0(0x1b7))),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require(a525_0xd21ce0(0x1db))),ShowUserService_1=__importDefault(require(a525_0xd21ce0(0x1df))),Tag_1=__importDefault(require(a525_0xd21ce0(0x1e6))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require('lodash'),Whatsapp_1=__importDefault(require(a525_0xd21ce0(0x1dc))),ListTicketsServiceKanban=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1e2a18,tags:_0x4f5e5a,users:_0x137d11,status:_0x4da5b2,date:_0x54f0a1,updatedAt:_0x1f5879,showAll:_0x57ef66,userId:_0xc6e84,withUnreadMessages:_0x3fc4f8,companyId:_0x11d407})=>{const _0x20d755=a525_0xd21ce0;let _0xe4261f={[sequelize_1['Op']['or']]:[{'userId':_0xc6e84},{'status':_0x20d755(0x1b2)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1e2a18,null]}},_0xdbfe70;_0xdbfe70=[{'model':Contact_1[_0x20d755(0x1b8)],'as':'contact','attributes':['id',_0x20d755(0x1b5),'number',_0x20d755(0x1c1),_0x20d755(0x1c5)]},{'model':Queue_1['default'],'as':_0x20d755(0x1cb),'attributes':['id',_0x20d755(0x1b5),_0x20d755(0x1c6)]},{'model':User_1[_0x20d755(0x1b8)],'as':_0x20d755(0x1e7),'attributes':['id','name']},{'model':Tag_1[_0x20d755(0x1b8)],'as':_0x20d755(0x1d3),'attributes':['id',_0x20d755(0x1b5),_0x20d755(0x1c6)]},{'model':Whatsapp_1[_0x20d755(0x1b8)],'as':_0x20d755(0x1d1),'attributes':[_0x20d755(0x1b5)]}];_0x57ef66==='true'&&(_0xe4261f={'queueId':{[sequelize_1['Op']['or']]:[_0x1e2a18,null]},'userId':_0xc6e84});_0xe4261f={..._0xe4261f,'status':{[sequelize_1['Op']['or']]:[_0x20d755(0x1b2),_0x20d755(0x1bc)]}};if(searchParam){const _0x5c74cb=searchParam[_0x20d755(0x1c8)]()['trim']();_0xdbfe70=[..._0xdbfe70,{'model':Message_1[_0x20d755(0x1b8)],'as':_0x20d755(0x1c4),'attributes':['id',_0x20d755(0x1bd)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x20d755(0x1cd),(0x0,sequelize_1[_0x20d755(0x1d5)])(_0x20d755(0x1bd))),'LIKE','%'+_0x5c74cb+'%')},'required':![],'duplicating':![]}],_0xe4261f={..._0xe4261f,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x20d755(0x1cf)])((0x0,sequelize_1['fn'])(_0x20d755(0x1cd),(0x0,sequelize_1[_0x20d755(0x1d5)])('contact.name')),_0x20d755(0x1d0),'%'+_0x5c74cb+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x20d755(0x1e4)]]:'%'+_0x5c74cb+'%'}},{'$message.body$':(0x0,sequelize_1[_0x20d755(0x1cf)])((0x0,sequelize_1['fn'])(_0x20d755(0x1cd),(0x0,sequelize_1[_0x20d755(0x1d5)])('body')),'LIKE','%'+_0x5c74cb+'%')}]};}_0x54f0a1&&(_0xe4261f={'createdAt':{[sequelize_1['Op'][_0x20d755(0x1e1)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1['parseISO'])(_0x54f0a1)),+(0x0,date_fns_1[_0x20d755(0x1ea)])((0x0,date_fns_1[_0x20d755(0x1c7)])(_0x54f0a1))]}});_0x1f5879&&(_0xe4261f={'updatedAt':{[sequelize_1['Op'][_0x20d755(0x1e1)]]:[+(0x0,date_fns_1[_0x20d755(0x1be)])((0x0,date_fns_1[_0x20d755(0x1c7)])(_0x1f5879)),+(0x0,date_fns_1[_0x20d755(0x1ea)])((0x0,date_fns_1[_0x20d755(0x1c7)])(_0x1f5879))]}});if(_0x3fc4f8===_0x20d755(0x1d7)){const _0x18ce70=await(0x0,ShowUserService_1[_0x20d755(0x1b8)])(_0xc6e84),_0x1061ac=_0x18ce70[_0x20d755(0x1c3)][_0x20d755(0x1c2)](_0x3ab4f2=>_0x3ab4f2['id']);_0xe4261f={[sequelize_1['Op']['or']]:[{'userId':_0xc6e84},{'status':_0x20d755(0x1b2)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1061ac,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x4f5e5a)&&_0x4f5e5a['length']>0x0){const _0x3cc623=[];for(let _0x16e4d2 of _0x4f5e5a){const _0x46c1ad=await TicketTag_1[_0x20d755(0x1b8)]['findAll']({'where':{'tagId':_0x16e4d2}});_0x46c1ad&&_0x3cc623['push'](_0x46c1ad[_0x20d755(0x1c2)](_0x4c5085=>_0x4c5085[_0x20d755(0x1bf)]));}const _0x4049f8=(0x0,lodash_1[_0x20d755(0x1e3)])(..._0x3cc623);_0xe4261f={..._0xe4261f,'id':{[sequelize_1['Op']['in']]:_0x4049f8}};}if(Array[_0x20d755(0x1dd)](_0x137d11)&&_0x137d11[_0x20d755(0x1de)]>0x0){const _0x4826a2=[];for(let _0x3f4fe2 of _0x137d11){const _0x71ff13=await Ticket_1[_0x20d755(0x1b8)]['findAll']({'where':{'userId':_0x3f4fe2}});_0x71ff13&&_0x4826a2[_0x20d755(0x1da)](_0x71ff13[_0x20d755(0x1c2)](_0x284e68=>_0x284e68['id']));}const _0x3d82ba=(0x0,lodash_1[_0x20d755(0x1e3)])(..._0x4826a2);_0xe4261f={..._0xe4261f,'id':{[sequelize_1['Op']['in']]:_0x3d82ba}};}const _0x50700a=0x28,_0x46bcb5=_0x50700a*(+pageNumber-0x1);_0xe4261f={..._0xe4261f,'companyId':_0x11d407};const {count:_0x2ab680,rows:_0x249ea7}=await Ticket_1['default'][_0x20d755(0x1b4)]({'where':_0xe4261f,'include':_0xdbfe70,'distinct':!![],'limit':_0x50700a,'offset':_0x46bcb5,'order':[[_0x20d755(0x1b9),_0x20d755(0x1e0)]],'subQuery':![]}),_0x19a345=_0x2ab680>_0x46bcb5+_0x249ea7['length'];return{'tickets':_0x249ea7,'count':_0x2ab680,'hasMore':_0x19a345};};exports[a525_0xd21ce0(0x1b8)]=ListTicketsServiceKanban;