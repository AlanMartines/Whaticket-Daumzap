const a523_0x187a1d=a523_0x3c72;(function(_0x3d85f4,_0x251a66){const _0x37bc9d=a523_0x3c72,_0x4b20e0=_0x3d85f4();while(!![]){try{const _0x768eb2=parseInt(_0x37bc9d(0x172))/0x1*(-parseInt(_0x37bc9d(0x181))/0x2)+-parseInt(_0x37bc9d(0x185))/0x3+parseInt(_0x37bc9d(0x171))/0x4*(parseInt(_0x37bc9d(0x17a))/0x5)+parseInt(_0x37bc9d(0x165))/0x6*(-parseInt(_0x37bc9d(0x16c))/0x7)+parseInt(_0x37bc9d(0x180))/0x8+-parseInt(_0x37bc9d(0x169))/0x9+parseInt(_0x37bc9d(0x176))/0xa;if(_0x768eb2===_0x251a66)break;else _0x4b20e0['push'](_0x4b20e0['shift']());}catch(_0x3b9153){_0x4b20e0['push'](_0x4b20e0['shift']());}}}(a523_0x2eda,0xe3ca0));const a523_0x44475b=(function(){let _0x3429f1=!![];return function(_0x37fed8,_0x259520){const _0x23e659=_0x3429f1?function(){const _0xb2ea52=a523_0x3c72;if(_0x259520){const _0x3cd2ea=_0x259520[_0xb2ea52(0x167)](_0x37fed8,arguments);return _0x259520=null,_0x3cd2ea;}}:function(){};return _0x3429f1=![],_0x23e659;};}()),a523_0x15d414=a523_0x44475b(this,function(){const _0x3f1ab3=a523_0x3c72;return a523_0x15d414[_0x3f1ab3(0x17c)]()['search']('(((.+)+)+)+$')[_0x3f1ab3(0x17c)]()[_0x3f1ab3(0x17e)](a523_0x15d414)[_0x3f1ab3(0x188)]('(((.+)+)+)+$');});a523_0x15d414();'use strict';var __importDefault=this&&this[a523_0x187a1d(0x168)]||function(_0x3796f2){return _0x3796f2&&_0x3796f2['__esModule']?_0x3796f2:{'default':_0x3796f2};};Object['defineProperty'](exports,a523_0x187a1d(0x174),{'value':!![]});function a523_0x3c72(_0xaa0c13,_0x4fa7ae){const _0x50507a=a523_0x2eda();return a523_0x3c72=function(_0x15d414,_0x44475b){_0x15d414=_0x15d414-0x165;let _0x2eda91=_0x50507a[_0x15d414];return _0x2eda91;},a523_0x3c72(_0xaa0c13,_0x4fa7ae);}const date_fns_1=require(a523_0x187a1d(0x170)),sequelize_1=require(a523_0x187a1d(0x166)),Ticket_1=__importDefault(require(a523_0x187a1d(0x16b))),ShowTicketService_1=__importDefault(require(a523_0x187a1d(0x173))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),Setting_1=__importDefault(require(a523_0x187a1d(0x16e))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),FindOrCreateTicketService=async(_0x34562f,_0x1a6448,_0x1b47b2,_0x37864a,_0x5c854a,_0x569f2d)=>{const _0x214884=a523_0x187a1d;let _0x507763=await Ticket_1[_0x214884(0x16a)][_0x214884(0x186)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x214884(0x183),_0x214884(0x17d),_0x214884(0x178)]},'contactId':_0x5c854a?_0x5c854a['id']:_0x34562f['id'],'companyId':_0x37864a,'whatsappId':_0x1a6448},'order':[['id',_0x214884(0x184)]]});_0x507763&&(_0x507763[_0x214884(0x177)]===_0x214884(0x178)?await _0x507763[_0x214884(0x175)]({'unreadMessages':_0x1b47b2,'whatsappId':_0x1a6448,'queueId':null,'userId':null,'status':'pending','imported':_0x569f2d?new Date():null}):await _0x507763[_0x214884(0x175)]({'unreadMessages':_0x1b47b2,'whatsappId':_0x1a6448,'imported':_0x569f2d?new Date():null}));if(!_0x507763&&_0x5c854a){_0x507763=await Ticket_1[_0x214884(0x16a)][_0x214884(0x186)]({'where':{'contactId':_0x5c854a['id'],'whatsappId':_0x1a6448},'order':[[_0x214884(0x179),_0x214884(0x184)]]});_0x507763&&(await _0x507763[_0x214884(0x175)]({'status':_0x214884(0x17d),'imported':_0x569f2d?new Date():null,'userId':null,'unreadMessages':_0x1b47b2,'isGroup':_0x34562f['isGroup'],'whatsappId':_0x1a6448,'queueId':null,'companyId':_0x37864a}),await(0x0,FindOrCreateATicketTrakingService_1[_0x214884(0x16a)])({'ticketId':_0x507763['id'],'companyId':_0x37864a,'whatsappId':_0x507763[_0x214884(0x17b)],'userId':_0x507763[_0x214884(0x187)]}));const _0x1046a2=await Setting_1[_0x214884(0x16a)]['findOne']({'where':{'key':'timeCreateNewTicket'}}),_0x24a579=_0x1046a2?parseInt(_0x1046a2[_0x214884(0x16d)],0xa):0x1c20;}!_0x507763&&!_0x5c854a&&(_0x507763=await Ticket_1[_0x214884(0x16a)][_0x214884(0x186)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x214884(0x189)]]:[+(0x0,date_fns_1[_0x214884(0x182)])(new Date(),0x2),+new Date()]},'contactId':_0x34562f['id'],'whatsappId':_0x1a6448},'order':[[_0x214884(0x179),'DESC']]}),_0x507763&&(await _0x507763[_0x214884(0x175)]({'status':_0x214884(0x17d),'imported':_0x569f2d?new Date():null,'userId':null,'isGroup':_0x34562f['isGroup'],'unreadMessages':_0x1b47b2,'whatsappId':_0x1a6448,'queueId':null,'companyId':_0x37864a}),await(0x0,FindOrCreateATicketTrakingService_1[_0x214884(0x16a)])({'ticketId':_0x507763['id'],'companyId':_0x37864a,'whatsappId':_0x507763[_0x214884(0x17b)],'userId':_0x507763[_0x214884(0x187)]})));if(!_0x507763){const _0x970a28=await Whatsapp_1[_0x214884(0x16a)]['findOne']({'where':{'id':_0x1a6448}});_0x507763=await Ticket_1[_0x214884(0x16a)][_0x214884(0x17f)]({'imported':_0x569f2d?new Date():null,'contactId':_0x5c854a?_0x5c854a['id']:_0x34562f['id'],'status':_0x214884(0x17d),'isGroup':!!_0x5c854a||_0x34562f[_0x214884(0x16f)],'unreadMessages':_0x1b47b2,'whatsappId':_0x1a6448,'whatsapp':_0x970a28,'companyId':_0x37864a}),await(0x0,FindOrCreateATicketTrakingService_1[_0x214884(0x16a)])({'ticketId':_0x507763['id'],'companyId':_0x37864a,'whatsappId':_0x1a6448,'userId':_0x507763[_0x214884(0x187)]});}return _0x507763=await(0x0,ShowTicketService_1[_0x214884(0x16a)])(_0x507763['id'],_0x37864a),_0x507763;};exports[a523_0x187a1d(0x16a)]=FindOrCreateTicketService;function a523_0x2eda(){const _0x419f14=['14472603NNBQgD','default','../../models/Ticket','47579XBFzfO','value','../../models/Setting','isGroup','date-fns','45412fzIwcT','65avmKhq','./ShowTicketService','__esModule','update','15513470tlzqqm','status','closed','updatedAt','500HvrWoZ','whatsappId','toString','pending','constructor','create','11463368bcfRhl','17670PAnlaG','subHours','open','DESC','688032AZdSKL','findOne','userId','search','between','684cbXLfM','sequelize','apply','__importDefault'];a523_0x2eda=function(){return _0x419f14;};return a523_0x2eda();}