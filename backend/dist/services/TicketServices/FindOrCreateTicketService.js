function a523_0x32f8(){const _0x7d8ba8=['default','create','__importDefault','toString','findOne','(((.+)+)+)+$','8VjvzZi','./ShowTicketService','whatsappId','status','closed','1143467UQZuFI','isGroup','open','1256730stsqAl','constructor','sequelize','38176011dBzqyy','3139086zwZFvD','updatedAt','78wBxaze','8358375ARrOVs','defineProperty','__esModule','update','userId','search','../../models/Whatsapp','./FindOrCreateATicketTrakingService','pending','DESC','timeCreateNewTicket','5106542hDzwpZ','85088Jhksqp'];a523_0x32f8=function(){return _0x7d8ba8;};return a523_0x32f8();}const a523_0x397e08=a523_0x3aa9;function a523_0x3aa9(_0x2987b7,_0x1cc490){const _0x4bc8ec=a523_0x32f8();return a523_0x3aa9=function(_0x38ac7a,_0x2b3abb){_0x38ac7a=_0x38ac7a-0xde;let _0x32f8d1=_0x4bc8ec[_0x38ac7a];return _0x32f8d1;},a523_0x3aa9(_0x2987b7,_0x1cc490);}(function(_0x1780f4,_0x482201){const _0x58eaa5=a523_0x3aa9,_0xde9056=_0x1780f4();while(!![]){try{const _0x2dfb16=-parseInt(_0x58eaa5(0xfb))/0x1+-parseInt(_0x58eaa5(0xe0))/0x2+parseInt(_0x58eaa5(0xe2))/0x3*(parseInt(_0x58eaa5(0xef))/0x4)+-parseInt(_0x58eaa5(0xe3))/0x5+-parseInt(_0x58eaa5(0xfe))/0x6+parseInt(_0x58eaa5(0xee))/0x7*(parseInt(_0x58eaa5(0xf6))/0x8)+parseInt(_0x58eaa5(0xdf))/0x9;if(_0x2dfb16===_0x482201)break;else _0xde9056['push'](_0xde9056['shift']());}catch(_0x37806b){_0xde9056['push'](_0xde9056['shift']());}}}(a523_0x32f8,0xe31a9));const a523_0x2b3abb=(function(){let _0x16c128=!![];return function(_0x2cc729,_0x630e56){const _0x321827=_0x16c128?function(){if(_0x630e56){const _0x52050f=_0x630e56['apply'](_0x2cc729,arguments);return _0x630e56=null,_0x52050f;}}:function(){};return _0x16c128=![],_0x321827;};}()),a523_0x38ac7a=a523_0x2b3abb(this,function(){const _0x3f7163=a523_0x3aa9;return a523_0x38ac7a[_0x3f7163(0xf3)]()[_0x3f7163(0xe8)](_0x3f7163(0xf5))[_0x3f7163(0xf3)]()[_0x3f7163(0xff)](a523_0x38ac7a)[_0x3f7163(0xe8)](_0x3f7163(0xf5));});a523_0x38ac7a();'use strict';var __importDefault=this&&this[a523_0x397e08(0xf2)]||function(_0x145ac0){const _0x43e8cc=a523_0x397e08;return _0x145ac0&&_0x145ac0[_0x43e8cc(0xe5)]?_0x145ac0:{'default':_0x145ac0};};Object[a523_0x397e08(0xe4)](exports,'__esModule',{'value':!![]});const date_fns_1=require('date-fns'),sequelize_1=require(a523_0x397e08(0xde)),Ticket_1=__importDefault(require('../../models/Ticket')),ShowTicketService_1=__importDefault(require(a523_0x397e08(0xf7))),FindOrCreateATicketTrakingService_1=__importDefault(require(a523_0x397e08(0xea))),Setting_1=__importDefault(require('../../models/Setting')),Whatsapp_1=__importDefault(require(a523_0x397e08(0xe9))),FindOrCreateTicketService=async(_0x801859,_0x1517a2,_0x550d44,_0x1a86a0,_0x2134d4,_0x2ccb0a)=>{const _0x2a7f2c=a523_0x397e08;let _0x5ba049=await Ticket_1[_0x2a7f2c(0xf0)][_0x2a7f2c(0xf4)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x2a7f2c(0xfd),_0x2a7f2c(0xeb),_0x2a7f2c(0xfa)]},'contactId':_0x2134d4?_0x2134d4['id']:_0x801859['id'],'companyId':_0x1a86a0,'whatsappId':_0x1517a2},'order':[['id',_0x2a7f2c(0xec)]]});_0x5ba049&&(_0x5ba049[_0x2a7f2c(0xf9)]===_0x2a7f2c(0xfa)?await _0x5ba049[_0x2a7f2c(0xe6)]({'unreadMessages':_0x550d44,'whatsappId':_0x1517a2,'queueId':null,'userId':null,'status':_0x2a7f2c(0xeb),'imported':_0x2ccb0a?new Date():null}):await _0x5ba049['update']({'unreadMessages':_0x550d44,'whatsappId':_0x1517a2,'imported':_0x2ccb0a?new Date():null}));if(!_0x5ba049&&_0x2134d4){_0x5ba049=await Ticket_1[_0x2a7f2c(0xf0)][_0x2a7f2c(0xf4)]({'where':{'contactId':_0x2134d4['id'],'whatsappId':_0x1517a2},'order':[[_0x2a7f2c(0xe1),'DESC']]});_0x5ba049&&(await _0x5ba049[_0x2a7f2c(0xe6)]({'status':'pending','imported':_0x2ccb0a?new Date():null,'userId':null,'unreadMessages':_0x550d44,'isGroup':_0x801859['isGroup'],'whatsappId':_0x1517a2,'queueId':null,'companyId':_0x1a86a0}),await(0x0,FindOrCreateATicketTrakingService_1[_0x2a7f2c(0xf0)])({'ticketId':_0x5ba049['id'],'companyId':_0x1a86a0,'whatsappId':_0x5ba049['whatsappId'],'userId':_0x5ba049[_0x2a7f2c(0xe7)]}));const _0x54566c=await Setting_1['default'][_0x2a7f2c(0xf4)]({'where':{'key':_0x2a7f2c(0xed)}}),_0x1fa031=_0x54566c?parseInt(_0x54566c['value'],0xa):0x1c20;}!_0x5ba049&&!_0x2134d4&&(_0x5ba049=await Ticket_1[_0x2a7f2c(0xf0)]['findOne']({'where':{'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1['subHours'])(new Date(),0x2),+new Date()]},'contactId':_0x801859['id'],'whatsappId':_0x1517a2},'order':[[_0x2a7f2c(0xe1),_0x2a7f2c(0xec)]]}),_0x5ba049&&(await _0x5ba049[_0x2a7f2c(0xe6)]({'status':_0x2a7f2c(0xeb),'imported':_0x2ccb0a?new Date():null,'userId':null,'isGroup':_0x801859[_0x2a7f2c(0xfc)],'unreadMessages':_0x550d44,'whatsappId':_0x1517a2,'queueId':null,'companyId':_0x1a86a0}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x5ba049['id'],'companyId':_0x1a86a0,'whatsappId':_0x5ba049[_0x2a7f2c(0xf8)],'userId':_0x5ba049['userId']})));if(!_0x5ba049){const _0x24dd5f=await Whatsapp_1[_0x2a7f2c(0xf0)][_0x2a7f2c(0xf4)]({'where':{'id':_0x1517a2}});_0x5ba049=await Ticket_1[_0x2a7f2c(0xf0)][_0x2a7f2c(0xf1)]({'imported':_0x2ccb0a?new Date():null,'contactId':_0x2134d4?_0x2134d4['id']:_0x801859['id'],'status':_0x2a7f2c(0xeb),'isGroup':!!_0x2134d4||_0x801859[_0x2a7f2c(0xfc)],'unreadMessages':_0x550d44,'whatsappId':_0x1517a2,'whatsapp':_0x24dd5f,'companyId':_0x1a86a0}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x5ba049['id'],'companyId':_0x1a86a0,'whatsappId':_0x1517a2,'userId':_0x5ba049['userId']});}return _0x5ba049=await(0x0,ShowTicketService_1[_0x2a7f2c(0xf0)])(_0x5ba049['id'],_0x1a86a0),_0x5ba049;};exports[a523_0x397e08(0xf0)]=FindOrCreateTicketService;