const a523_0x54628f=a523_0x300c;function a523_0x300c(_0x5c1621,_0x5e9aa2){const _0x1ce930=a523_0x28b0();return a523_0x300c=function(_0x29c963,_0x441bba){_0x29c963=_0x29c963-0xa3;let _0x28b0b4=_0x1ce930[_0x29c963];return _0x28b0b4;},a523_0x300c(_0x5c1621,_0x5e9aa2);}(function(_0x36870c,_0x219666){const _0x188201=a523_0x300c,_0x25d213=_0x36870c();while(!![]){try{const _0x49d304=parseInt(_0x188201(0xca))/0x1*(-parseInt(_0x188201(0xbc))/0x2)+parseInt(_0x188201(0xb5))/0x3*(-parseInt(_0x188201(0xae))/0x4)+-parseInt(_0x188201(0xc9))/0x5*(parseInt(_0x188201(0xb0))/0x6)+parseInt(_0x188201(0xc1))/0x7+-parseInt(_0x188201(0xa8))/0x8+parseInt(_0x188201(0xa7))/0x9+parseInt(_0x188201(0xc4))/0xa*(parseInt(_0x188201(0xb4))/0xb);if(_0x49d304===_0x219666)break;else _0x25d213['push'](_0x25d213['shift']());}catch(_0xb3c29){_0x25d213['push'](_0x25d213['shift']());}}}(a523_0x28b0,0x8c57b));const a523_0x441bba=(function(){let _0x4c3399=!![];return function(_0x57f51e,_0x3ffad5){const _0x39f997=_0x4c3399?function(){const _0x5b0c3e=a523_0x300c;if(_0x3ffad5){const _0x594a9b=_0x3ffad5[_0x5b0c3e(0xc5)](_0x57f51e,arguments);return _0x3ffad5=null,_0x594a9b;}}:function(){};return _0x4c3399=![],_0x39f997;};}()),a523_0x29c963=a523_0x441bba(this,function(){const _0xf470b1=a523_0x300c;return a523_0x29c963[_0xf470b1(0xac)]()[_0xf470b1(0xb1)](_0xf470b1(0xa6))[_0xf470b1(0xac)]()[_0xf470b1(0xc7)](a523_0x29c963)[_0xf470b1(0xb1)](_0xf470b1(0xa6));});a523_0x29c963();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x213c95){return _0x213c95&&_0x213c95['__esModule']?_0x213c95:{'default':_0x213c95};};Object[a523_0x54628f(0xbf)](exports,a523_0x54628f(0xbb),{'value':!![]});function a523_0x28b0(){const _0x27c7a5=['../../models/Whatsapp','updatedAt','../../models/Ticket','toString','subHours','2632KKQeov','pending','18HeMYlB','search','userId','between','3454TvAuox','600xzLvYx','findOne','status','default','update','date-fns','__esModule','22286XxhnyO','sequelize','create','defineProperty','timeCreateNewTicket','4390792brErRq','DESC','whatsappId','45070uEJNrr','apply','isGroup','constructor','../../models/Setting','1504930RzUSpx','37iXfdxq','./FindOrCreateATicketTrakingService','open','closed','(((.+)+)+)+$','2041011JnWEZr','1980328aIhcgr'];a523_0x28b0=function(){return _0x27c7a5;};return a523_0x28b0();}const date_fns_1=require(a523_0x54628f(0xba)),sequelize_1=require(a523_0x54628f(0xbd)),Ticket_1=__importDefault(require(a523_0x54628f(0xab))),ShowTicketService_1=__importDefault(require('./ShowTicketService')),FindOrCreateATicketTrakingService_1=__importDefault(require(a523_0x54628f(0xa3))),Setting_1=__importDefault(require(a523_0x54628f(0xc8))),Whatsapp_1=__importDefault(require(a523_0x54628f(0xa9))),FindOrCreateTicketService=async(_0x3d5317,_0x461066,_0x139ab1,_0x11a35b,_0x41281a,_0x491ed3)=>{const _0x65bb1a=a523_0x54628f;let _0x2c9318=await Ticket_1[_0x65bb1a(0xb8)][_0x65bb1a(0xb6)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x65bb1a(0xa4),_0x65bb1a(0xaf),'closed']},'contactId':_0x41281a?_0x41281a['id']:_0x3d5317['id'],'companyId':_0x11a35b,'whatsappId':_0x461066},'order':[['id',_0x65bb1a(0xc2)]]});_0x2c9318&&(_0x2c9318[_0x65bb1a(0xb7)]===_0x65bb1a(0xa5)?await _0x2c9318[_0x65bb1a(0xb9)]({'unreadMessages':_0x139ab1,'whatsappId':_0x461066,'queueId':null,'userId':null,'status':_0x65bb1a(0xaf),'imported':_0x491ed3?new Date():null}):await _0x2c9318[_0x65bb1a(0xb9)]({'unreadMessages':_0x139ab1,'whatsappId':_0x461066,'imported':_0x491ed3?new Date():null}));if(!_0x2c9318&&_0x41281a){_0x2c9318=await Ticket_1['default'][_0x65bb1a(0xb6)]({'where':{'contactId':_0x41281a['id'],'whatsappId':_0x461066},'order':[[_0x65bb1a(0xaa),'DESC']]});_0x2c9318&&(await _0x2c9318[_0x65bb1a(0xb9)]({'status':_0x65bb1a(0xaf),'imported':_0x491ed3?new Date():null,'userId':null,'unreadMessages':_0x139ab1,'isGroup':_0x3d5317['isGroup'],'whatsappId':_0x461066,'queueId':null,'companyId':_0x11a35b}),await(0x0,FindOrCreateATicketTrakingService_1[_0x65bb1a(0xb8)])({'ticketId':_0x2c9318['id'],'companyId':_0x11a35b,'whatsappId':_0x2c9318[_0x65bb1a(0xc3)],'userId':_0x2c9318[_0x65bb1a(0xb2)]}));const _0xdc0de0=await Setting_1[_0x65bb1a(0xb8)][_0x65bb1a(0xb6)]({'where':{'key':_0x65bb1a(0xc0)}}),_0x21e9d8=_0xdc0de0?parseInt(_0xdc0de0['value'],0xa):0x1c20;}!_0x2c9318&&!_0x41281a&&(_0x2c9318=await Ticket_1[_0x65bb1a(0xb8)][_0x65bb1a(0xb6)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x65bb1a(0xb3)]]:[+(0x0,date_fns_1[_0x65bb1a(0xad)])(new Date(),0x2),+new Date()]},'contactId':_0x3d5317['id'],'whatsappId':_0x461066},'order':[[_0x65bb1a(0xaa),'DESC']]}),_0x2c9318&&(await _0x2c9318['update']({'status':_0x65bb1a(0xaf),'imported':_0x491ed3?new Date():null,'userId':null,'isGroup':_0x3d5317['isGroup'],'unreadMessages':_0x139ab1,'whatsappId':_0x461066,'queueId':null,'companyId':_0x11a35b}),await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x2c9318['id'],'companyId':_0x11a35b,'whatsappId':_0x2c9318[_0x65bb1a(0xc3)],'userId':_0x2c9318[_0x65bb1a(0xb2)]})));if(!_0x2c9318){const _0x56f7a9=await Whatsapp_1[_0x65bb1a(0xb8)][_0x65bb1a(0xb6)]({'where':{'id':_0x461066}});_0x2c9318=await Ticket_1['default'][_0x65bb1a(0xbe)]({'imported':_0x491ed3?new Date():null,'contactId':_0x41281a?_0x41281a['id']:_0x3d5317['id'],'status':_0x65bb1a(0xaf),'isGroup':!!_0x41281a||_0x3d5317[_0x65bb1a(0xc6)],'unreadMessages':_0x139ab1,'whatsappId':_0x461066,'whatsapp':_0x56f7a9,'companyId':_0x11a35b}),await(0x0,FindOrCreateATicketTrakingService_1[_0x65bb1a(0xb8)])({'ticketId':_0x2c9318['id'],'companyId':_0x11a35b,'whatsappId':_0x461066,'userId':_0x2c9318[_0x65bb1a(0xb2)]});}return _0x2c9318=await(0x0,ShowTicketService_1[_0x65bb1a(0xb8)])(_0x2c9318['id'],_0x11a35b),_0x2c9318;};exports[a523_0x54628f(0xb8)]=FindOrCreateTicketService;