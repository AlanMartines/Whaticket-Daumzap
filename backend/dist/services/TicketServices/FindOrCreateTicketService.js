const a523_0x5245=a523_0x395a;function a523_0x395a(_0x20dea4,_0x49711f){const _0x218431=a523_0x4ec3();return a523_0x395a=function(_0x536bf0,_0x26f368){_0x536bf0=_0x536bf0-0x144;let _0x4ec337=_0x218431[_0x536bf0];return _0x4ec337;},a523_0x395a(_0x20dea4,_0x49711f);}(function(_0x1ca091,_0x5e031d){const _0x141318=a523_0x395a,_0x314599=_0x1ca091();while(!![]){try{const _0x44f724=parseInt(_0x141318(0x155))/0x1+parseInt(_0x141318(0x151))/0x2*(parseInt(_0x141318(0x14b))/0x3)+parseInt(_0x141318(0x15d))/0x4+parseInt(_0x141318(0x144))/0x5+parseInt(_0x141318(0x148))/0x6*(-parseInt(_0x141318(0x167))/0x7)+-parseInt(_0x141318(0x153))/0x8+-parseInt(_0x141318(0x149))/0x9*(parseInt(_0x141318(0x150))/0xa);if(_0x44f724===_0x5e031d)break;else _0x314599['push'](_0x314599['shift']());}catch(_0x408712){_0x314599['push'](_0x314599['shift']());}}}(a523_0x4ec3,0x47520));const a523_0x26f368=(function(){let _0x3d1192=!![];return function(_0x5f2d66,_0x54f549){const _0x28705b=_0x3d1192?function(){const _0x507881=a523_0x395a;if(_0x54f549){const _0x2370bb=_0x54f549[_0x507881(0x15c)](_0x5f2d66,arguments);return _0x54f549=null,_0x2370bb;}}:function(){};return _0x3d1192=![],_0x28705b;};}()),a523_0x536bf0=a523_0x26f368(this,function(){const _0x32c5f4=a523_0x395a;return a523_0x536bf0[_0x32c5f4(0x157)]()[_0x32c5f4(0x15a)](_0x32c5f4(0x146))[_0x32c5f4(0x157)]()[_0x32c5f4(0x162)](a523_0x536bf0)['search'](_0x32c5f4(0x146));});a523_0x536bf0();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x48a2b0){const _0x244ac4=a523_0x395a;return _0x48a2b0&&_0x48a2b0[_0x244ac4(0x163)]?_0x48a2b0:{'default':_0x48a2b0};};function a523_0x4ec3(){const _0x4045bc=['344147PUgRnD','./ShowTicketService','toString','sequelize','userId','search','findOne','apply','794232JKPVOH','between','closed','../../models/Setting','value','constructor','__esModule','pending','create','open','7diLJsT','updatedAt','2731225VKhEUA','update','(((.+)+)+)+$','DESC','1281492dnFMAU','12762VGzwkp','../../models/Ticket','9UbrIVk','date-fns','./FindOrCreateATicketTrakingService','isGroup','defineProperty','740JuGcJT','25294ZpbpCX','whatsappId','4129992ciVeAA','default'];a523_0x4ec3=function(){return _0x4045bc;};return a523_0x4ec3();}Object[a523_0x5245(0x14f)](exports,a523_0x5245(0x163),{'value':!![]});const date_fns_1=require(a523_0x5245(0x14c)),sequelize_1=require(a523_0x5245(0x158)),Ticket_1=__importDefault(require(a523_0x5245(0x14a))),ShowTicketService_1=__importDefault(require(a523_0x5245(0x156))),FindOrCreateATicketTrakingService_1=__importDefault(require(a523_0x5245(0x14d))),Setting_1=__importDefault(require(a523_0x5245(0x160))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),FindOrCreateTicketService=async(_0x2e609d,_0x364537,_0x4d4b66,_0x3b0b91,_0x5443ef,_0x184dde)=>{const _0x1c3f63=a523_0x5245;let _0x3bdf84=await Ticket_1[_0x1c3f63(0x154)][_0x1c3f63(0x15b)]({'where':{'status':{[sequelize_1['Op']['or']]:[_0x1c3f63(0x166),_0x1c3f63(0x164),'closed']},'contactId':_0x5443ef?_0x5443ef['id']:_0x2e609d['id'],'companyId':_0x3b0b91,'whatsappId':_0x364537},'order':[['id',_0x1c3f63(0x147)]]});_0x3bdf84&&(_0x3bdf84['status']===_0x1c3f63(0x15f)?await _0x3bdf84['update']({'unreadMessages':_0x4d4b66,'whatsappId':_0x364537,'queueId':null,'userId':null,'status':'pending','imported':_0x184dde?new Date():null}):await _0x3bdf84[_0x1c3f63(0x145)]({'unreadMessages':_0x4d4b66,'whatsappId':_0x364537,'imported':_0x184dde?new Date():null}));if(!_0x3bdf84&&_0x5443ef){_0x3bdf84=await Ticket_1['default'][_0x1c3f63(0x15b)]({'where':{'contactId':_0x5443ef['id'],'whatsappId':_0x364537},'order':[[_0x1c3f63(0x168),_0x1c3f63(0x147)]]});_0x3bdf84&&(await _0x3bdf84[_0x1c3f63(0x145)]({'status':'pending','imported':_0x184dde?new Date():null,'userId':null,'unreadMessages':_0x4d4b66,'isGroup':_0x2e609d[_0x1c3f63(0x14e)],'whatsappId':_0x364537,'queueId':null,'companyId':_0x3b0b91}),await(0x0,FindOrCreateATicketTrakingService_1[_0x1c3f63(0x154)])({'ticketId':_0x3bdf84['id'],'companyId':_0x3b0b91,'whatsappId':_0x3bdf84[_0x1c3f63(0x152)],'userId':_0x3bdf84['userId']}));const _0x8186a4=await Setting_1[_0x1c3f63(0x154)]['findOne']({'where':{'key':'timeCreateNewTicket'}}),_0x5c658=_0x8186a4?parseInt(_0x8186a4[_0x1c3f63(0x161)],0xa):0x1c20;}!_0x3bdf84&&!_0x5443ef&&(_0x3bdf84=await Ticket_1[_0x1c3f63(0x154)][_0x1c3f63(0x15b)]({'where':{'updatedAt':{[sequelize_1['Op'][_0x1c3f63(0x15e)]]:[+(0x0,date_fns_1['subHours'])(new Date(),0x2),+new Date()]},'contactId':_0x2e609d['id'],'whatsappId':_0x364537},'order':[[_0x1c3f63(0x168),_0x1c3f63(0x147)]]}),_0x3bdf84&&(await _0x3bdf84['update']({'status':_0x1c3f63(0x164),'imported':_0x184dde?new Date():null,'userId':null,'isGroup':_0x2e609d[_0x1c3f63(0x14e)],'unreadMessages':_0x4d4b66,'whatsappId':_0x364537,'queueId':null,'companyId':_0x3b0b91}),await(0x0,FindOrCreateATicketTrakingService_1[_0x1c3f63(0x154)])({'ticketId':_0x3bdf84['id'],'companyId':_0x3b0b91,'whatsappId':_0x3bdf84[_0x1c3f63(0x152)],'userId':_0x3bdf84[_0x1c3f63(0x159)]})));if(!_0x3bdf84){const _0x506b88=await Whatsapp_1[_0x1c3f63(0x154)][_0x1c3f63(0x15b)]({'where':{'id':_0x364537}});_0x3bdf84=await Ticket_1['default'][_0x1c3f63(0x165)]({'imported':_0x184dde?new Date():null,'contactId':_0x5443ef?_0x5443ef['id']:_0x2e609d['id'],'status':_0x1c3f63(0x164),'isGroup':!!_0x5443ef||_0x2e609d['isGroup'],'unreadMessages':_0x4d4b66,'whatsappId':_0x364537,'whatsapp':_0x506b88,'companyId':_0x3b0b91}),await(0x0,FindOrCreateATicketTrakingService_1[_0x1c3f63(0x154)])({'ticketId':_0x3bdf84['id'],'companyId':_0x3b0b91,'whatsappId':_0x364537,'userId':_0x3bdf84[_0x1c3f63(0x159)]});}return _0x3bdf84=await(0x0,ShowTicketService_1[_0x1c3f63(0x154)])(_0x3bdf84['id'],_0x3b0b91),_0x3bdf84;};exports[a523_0x5245(0x154)]=FindOrCreateTicketService;