const a528_0x3fd3a6=a528_0x37d4;(function(_0x15f4dd,_0x55aeab){const _0x43e2d9=a528_0x37d4,_0x25e096=_0x15f4dd();while(!![]){try{const _0x3aae63=parseInt(_0x43e2d9(0x146))/0x1+parseInt(_0x43e2d9(0x154))/0x2+-parseInt(_0x43e2d9(0x141))/0x3+-parseInt(_0x43e2d9(0xee))/0x4*(parseInt(_0x43e2d9(0x132))/0x5)+-parseInt(_0x43e2d9(0xf5))/0x6*(parseInt(_0x43e2d9(0x13e))/0x7)+parseInt(_0x43e2d9(0x10c))/0x8*(-parseInt(_0x43e2d9(0xfb))/0x9)+parseInt(_0x43e2d9(0x11a))/0xa;if(_0x3aae63===_0x55aeab)break;else _0x25e096['push'](_0x25e096['shift']());}catch(_0x5e8c5b){_0x25e096['push'](_0x25e096['shift']());}}}(a528_0x4b4a,0x90ae1));const a528_0x3745d9=(function(){let _0x427f03=!![];return function(_0x3c4e21,_0x44d7d3){const _0x5b1cc0=_0x427f03?function(){const _0x2305d0=a528_0x37d4;if(_0x44d7d3){const _0x5c3b2b=_0x44d7d3[_0x2305d0(0xf2)](_0x3c4e21,arguments);return _0x44d7d3=null,_0x5c3b2b;}}:function(){};return _0x427f03=![],_0x5b1cc0;};}()),a528_0x6ad586=a528_0x3745d9(this,function(){const _0x2737d0=a528_0x37d4;return a528_0x6ad586[_0x2737d0(0x124)]()[_0x2737d0(0x122)]('(((.+)+)+)+$')['toString']()[_0x2737d0(0x131)](a528_0x6ad586)['search']('(((.+)+)+)+$');});a528_0x6ad586();'use strict';var __createBinding=this&&this[a528_0x3fd3a6(0x155)]||(Object['create']?function(_0x1bd8e7,_0x1aa290,_0x1b839c,_0x3d072c){const _0xca653d=a528_0x3fd3a6;if(_0x3d072c===undefined)_0x3d072c=_0x1b839c;var _0x3e45d9=Object[_0xca653d(0x12d)](_0x1aa290,_0x1b839c);(!_0x3e45d9||(_0xca653d(0x130)in _0x3e45d9?!_0x1aa290[_0xca653d(0x119)]:_0x3e45d9[_0xca653d(0x15a)]||_0x3e45d9[_0xca653d(0x147)]))&&(_0x3e45d9={'enumerable':!![],'get':function(){return _0x1aa290[_0x1b839c];}}),Object['defineProperty'](_0x1bd8e7,_0x3d072c,_0x3e45d9);}:function(_0x160026,_0x112d1f,_0xb72869,_0x54f9e7){if(_0x54f9e7===undefined)_0x54f9e7=_0xb72869;_0x160026[_0x54f9e7]=_0x112d1f[_0xb72869];}),__setModuleDefault=this&&this[a528_0x3fd3a6(0x12e)]||(Object[a528_0x3fd3a6(0xfe)]?function(_0x3656b7,_0x280c57){const _0x2b3ba7=a528_0x3fd3a6;Object[_0x2b3ba7(0x13a)](_0x3656b7,'default',{'enumerable':!![],'value':_0x280c57});}:function(_0x2b4c69,_0x53285d){const _0x4c9e24=a528_0x3fd3a6;_0x2b4c69[_0x4c9e24(0x105)]=_0x53285d;}),__importStar=this&&this[a528_0x3fd3a6(0xed)]||function(_0xca5410){const _0x2ba095=a528_0x3fd3a6;if(_0xca5410&&_0xca5410[_0x2ba095(0x119)])return _0xca5410;var _0x50a598={};if(_0xca5410!=null){for(var _0x2e5bbd in _0xca5410)if(_0x2e5bbd!==_0x2ba095(0x105)&&Object[_0x2ba095(0xe4)]['hasOwnProperty']['call'](_0xca5410,_0x2e5bbd))__createBinding(_0x50a598,_0xca5410,_0x2e5bbd);}return __setModuleDefault(_0x50a598,_0xca5410),_0x50a598;},__importDefault=this&&this[a528_0x3fd3a6(0x10e)]||function(_0x16cc4f){const _0x444318=a528_0x3fd3a6;return _0x16cc4f&&_0x16cc4f[_0x444318(0x119)]?_0x16cc4f:{'default':_0x16cc4f};};Object[a528_0x3fd3a6(0x13a)](exports,a528_0x3fd3a6(0x119),{'value':!![]}),exports[a528_0x3fd3a6(0xf1)]=void 0x0;function a528_0x4b4a(){const _0x51caaf=['../WbotServices/wbotMessageListener','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','status','length','value','g.us','8fChlWB','@sentry/node','__importDefault','pending','save','-notification','userRating','reload','findByPk','DD/MM/YYYY\x20HH:mm:ss','./ShowTicketService','rated','queueOptionId','__esModule','23122570wzsmuG','s.whatsapp.net','../../libs/socket','contact','toDate','sendMessage','../../helpers/GetTicketWbot','closed','search','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','toString','*5*\x20-\x20_Muito\x20Satisfeito_\x0a','isGroup','../WbotServices/SendWhatsAppMessage','-mainchannel','Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket','useIntegration','-open','find','getOwnPropertyDescriptor','__setModuleDefault','queuedAt','get','constructor','35ahfKHZ','../../models/Queue','removeFromList','number','getTime','disableBot','newTicketOnTransfer','../WhatsappService/ShowWhatsAppService','defineProperty','format','enabled','userId','35994Wdpqww','SendPresenceStatus','chatbot','1190511lUYaRg','finishedAt','update','\x20em\x20','queueId','694588zXCjkE','configurable','open','isNil','queue-','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','whatsappId','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','companyId','push','promptId','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','../../helpers/SetTicketMessagesAsRead','getWbot','925750rQJebz','__createBinding','../../libs/wbot','company-','trace','../../helpers/SendPresenceStatus','writable','emit','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','*\x20por\x20','integrationId','prototype','lodash','updateUnread','verifyMessage','ticketId','*4*\x20-\x20_Satisfeito_\x0a','delete','sendMsgTransfTicket','../UserServices/ShowUserService','__importStar','526312UflyCI','profile','admin','notifyUpdate','apply','Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a','username','1344cQMNhn','time','../../models/Ticket','filter','-ticket','name','3666780sqfEEq','*,\x20em\x20','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','create','Need\x20companyId\x20or\x20tokenData','../../errors/AppError','captureException','*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*','unreadMessages','ratingAt','default'];a528_0x4b4a=function(){return _0x51caaf;};return a528_0x4b4a();}const moment_1=__importDefault(require('moment')),Sentry=__importStar(require(a528_0x3fd3a6(0x10d))),CheckContactOpenTickets_1=__importDefault(require('../../helpers/CheckContactOpenTickets')),SetTicketMessagesAsRead_1=__importDefault(require(a528_0x3fd3a6(0x152))),socket_1=require(a528_0x3fd3a6(0x11c)),Ticket_1=__importDefault(require(a528_0x3fd3a6(0xf7))),Setting_1=__importDefault(require('../../models/Setting')),Queue_1=__importDefault(require(a528_0x3fd3a6(0x133))),ShowTicketService_1=__importDefault(require(a528_0x3fd3a6(0x116))),ShowWhatsAppService_1=__importDefault(require(a528_0x3fd3a6(0x139))),SendWhatsAppMessage_1=__importDefault(require(a528_0x3fd3a6(0x127))),FindOrCreateATicketTrakingService_1=__importDefault(require('./FindOrCreateATicketTrakingService')),GetTicketWbot_1=__importDefault(require(a528_0x3fd3a6(0x120))),wbotMessageListener_1=require(a528_0x3fd3a6(0x106)),ListSettingsServiceOne_1=__importDefault(require('../SettingServices/ListSettingsServiceOne')),ShowUserService_1=__importDefault(require(a528_0x3fd3a6(0xec))),lodash_1=require(a528_0x3fd3a6(0xe5)),AppError_1=__importDefault(require(a528_0x3fd3a6(0x100))),SendPresenceStatus_1=require(a528_0x3fd3a6(0x159)),wbot_1=require(a528_0x3fd3a6(0x156));let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x577a76,ticketId:_0x14682e,tokenData:_0x3d1c6f,companyId:_0x4bd67e})=>{const _0x535f64=a528_0x3fd3a6;try{if(!_0x4bd67e&&!_0x3d1c6f)throw new Error(_0x535f64(0xff));_0x3d1c6f&&(_0x4bd67e=_0x3d1c6f[_0x535f64(0x14e)]);let {status:_0x2cfef5}=_0x577a76,{queueId:_0xf1d239,userId:_0x35a759,whatsappId:_0x565a3a,sendFarewellMessage:_0x59a372}=_0x577a76;_0x59a372==null&&(_0x59a372=!![]);let _0x343245=_0x577a76['chatbot']||![],_0x535bc4=_0x577a76[_0x535f64(0x118)]||null,_0x5883e7=_0x577a76[_0x535f64(0x150)]||null,_0x160aff=_0x577a76[_0x535f64(0x12a)]||![],_0x43e58e=_0x577a76[_0x535f64(0xe3)]||null;const _0x4eda61=(0x0,socket_1['getIO'])(),_0x2c4254=_0x535f64(0x112),_0x38bfcc=await Setting_1['default']['findOne']({'where':{'companyId':_0x4bd67e,'key':_0x2c4254}});let _0x2afbd8=await(0x0,ShowTicketService_1[_0x535f64(0x105)])(_0x14682e,_0x4bd67e);if(_0x3d1c6f&&_0x2afbd8[_0x535f64(0x108)]!=='pending'){if(_0x3d1c6f[_0x535f64(0xef)]!==_0x535f64(0xf0)&&_0x2afbd8['userId']!==parseInt(_0x3d1c6f['id'],0xa))throw new AppError_1[(_0x535f64(0x105))](_0x535f64(0x129));}const _0x527f43=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x14682e,'companyId':_0x4bd67e,'whatsappId':_0x2afbd8['whatsappId']});(0x0,lodash_1[_0x535f64(0x149)])(_0x565a3a)&&(_0x565a3a=_0x2afbd8['whatsappId']['toString']());(_0x2cfef5===_0x535f64(0x121)||_0x2cfef5===_0x535f64(0x148))&&await(0x0,SetTicketMessagesAsRead_1[_0x535f64(0x105)])(_0x2afbd8);const _0x5b8f91=_0x2afbd8[_0x535f64(0x108)],_0x2d2bf7=_0x2afbd8['user']?.['id'],_0x47a793=_0x2afbd8[_0x535f64(0x145)];(_0x5b8f91===_0x535f64(0x121)||_0x565a3a!==undefined&&Number(_0x565a3a)!==_0x2afbd8['whatsappId'])&&(await(0x0,CheckContactOpenTickets_1[_0x535f64(0x105)])(_0x2afbd8[_0x535f64(0x11d)]['id'],_0x565a3a),_0x343245=null,_0x535bc4=null);if(_0x2cfef5===_0x535f64(0x121)){const {complationMessage:_0x2e31c5,ratingMessage:_0x5f4049}=await(0x0,ShowWhatsAppService_1[_0x535f64(0x105)])(_0x2afbd8[_0x535f64(0x14c)],_0x4bd67e);if(!_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x137)]&&_0x38bfcc?.['value']===_0x535f64(0x13c)&&_0x59a372&&!_0x2afbd8[_0x535f64(0x126)]){if(_0x527f43[_0x535f64(0x104)]==null&&!_0x2afbd8[_0x535f64(0x126)]){const _0x5a7424=_0x5f4049||'';let _0x161592='‎'+_0x5a7424+'\x0a\x0a';return _0x161592+=_0x535f64(0xf3)+'*1*\x20-\x20_Muito\x20Insatisfeito_\x0a'+'*2*\x20-\x20_Insatisfeito_\x0a'+'*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a'+_0x535f64(0xe9)+_0x535f64(0x125),await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1[_0x535f64(0x153)])(_0x2afbd8['whatsappId']),_0x2afbd8['contact'][_0x535f64(0x135)]+'@'+(_0x2afbd8['isGroup']?'g.us':_0x535f64(0x11b))),await(0x0,SendWhatsAppMessage_1[_0x535f64(0x105)])({'body':_0x161592,'ticket':_0x2afbd8}),await _0x527f43[_0x535f64(0x143)]({'rated':![],'ratingAt':(0x0,moment_1[_0x535f64(0x105)])()[_0x535f64(0x11e)]()}),await _0x2afbd8[_0x535f64(0x143)]({'amountUsedBotQueues':_0x577a76['amountUsedBotQueues']||0x0,'status':_0x2cfef5,'unreadMessages':_0x577a76['unreadMessages']||0x0,'queueId':_0xf1d239,'userId':_0x35a759,'whatsappId':_0x565a3a,'chatbot':_0x343245,'queueOptionId':_0x535bc4}),_0x4eda61['to'](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+_0x535f64(0x12b))['to'](_0x14682e[_0x535f64(0x124)]())[_0x535f64(0x15b)](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+'-ticket',{'action':_0x535f64(0xea),'ticketId':_0x2afbd8['id']}),{'ticket':_0x2afbd8,'oldStatus':_0x5b8f91,'oldUserId':_0x2d2bf7};}_0x527f43[_0x535f64(0x104)]=(0x0,moment_1[_0x535f64(0x105)])()[_0x535f64(0x11e)](),_0x527f43[_0x535f64(0x117)]=![];}if(completionMessageControl[_0x535f64(0x109)]>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1[_0x535f64(0x149)])(_0x2e31c5)&&_0x2e31c5!==''&&_0x59a372&&!_0x2afbd8[_0x535f64(0x126)]){let _0x4fab0b=completionMessageControl[_0x535f64(0x12c)](_0x310ac5=>_0x310ac5[_0x535f64(0xe8)]===_0x2afbd8['id']||_0x310ac5['dest']===_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]);if(!_0x4fab0b||_0x4fab0b&&_0x4fab0b[_0x535f64(0xf6)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x4fab0b&&(completionMessageControl=completionMessageControl[_0x535f64(0xf8)](_0xd386b3=>_0xd386b3[_0x535f64(0xe8)]!==_0x2afbd8['id']),_0x4fab0b=null);if(!_0x2afbd8['contact'][_0x535f64(0x137)]&&!(0x0,lodash_1[_0x535f64(0x149)])(_0x2e31c5)&&_0x2e31c5!==''){const _0x531a41='‎'+_0x2e31c5;await(0x0,SendPresenceStatus_1[_0x535f64(0x13f)])((0x0,wbot_1['getWbot'])(_0x2afbd8[_0x535f64(0x14c)]),_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?'g.us':_0x535f64(0x11b))),await(0x0,SendWhatsAppMessage_1[_0x535f64(0x105)])({'body':_0x531a41,'ticket':_0x2afbd8});}}!_0x4fab0b&&completionMessageControl[_0x535f64(0x14f)]({'ticketId':_0x2afbd8['id'],'dest':_0x2afbd8[_0x535f64(0x11d)]['number'],'time':new Date()[_0x535f64(0x136)]()});}await _0x2afbd8[_0x535f64(0x143)]({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x527f43[_0x535f64(0x142)]=(0x0,moment_1[_0x535f64(0x105)])()['toDate'](),_0x527f43[_0x535f64(0x14c)]=_0x2afbd8[_0x535f64(0x14c)],_0x527f43['userId']=_0x2afbd8[_0x535f64(0x13d)];}_0xf1d239!==undefined&&_0xf1d239!==null&&(_0x527f43[_0x535f64(0x12f)]=(0x0,moment_1['default'])()[_0x535f64(0x11e)]());const _0x3d7d51=await(0x0,ListSettingsServiceOne_1[_0x535f64(0x105)])({'companyId':_0x4bd67e,'key':_0x535f64(0xeb)}),_0x38bbd6=await Queue_1[_0x535f64(0x105)][_0x535f64(0x114)](_0xf1d239);if(_0x3d7d51?.[_0x535f64(0x10a)]===_0x535f64(0x13c)){if(_0x47a793!==_0xf1d239&&_0x2d2bf7===_0x35a759&&!(0x0,lodash_1[_0x535f64(0x149)])(_0x47a793)&&!(0x0,lodash_1['isNil'])(_0xf1d239)){const _0x3137e3=await(0x0,GetTicketWbot_1[_0x535f64(0x105)])(_0x2afbd8),_0x269739=_0x535f64(0x15c)+_0x38bbd6?.[_0x535f64(0xfa)]+_0x535f64(0x107);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x3137e3,_0x2afbd8[_0x535f64(0x11d)]['number']+'@'+(_0x2afbd8['isGroup']?_0x535f64(0x10b):_0x535f64(0x11b)));const _0x116386=await _0x3137e3[_0x535f64(0x11f)](_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?_0x535f64(0x10b):_0x535f64(0x11b)),{'text':_0x269739});await(0x0,wbotMessageListener_1[_0x535f64(0xe7)])(_0x116386,_0x2afbd8,_0x2afbd8[_0x535f64(0x11d)]);}else{if(_0x2d2bf7!==_0x35a759&&_0x47a793===_0xf1d239&&!(0x0,lodash_1[_0x535f64(0x149)])(_0x2d2bf7)&&!(0x0,lodash_1[_0x535f64(0x149)])(_0x35a759)){const _0x50a7f9=await(0x0,GetTicketWbot_1[_0x535f64(0x105)])(_0x2afbd8),_0x200b3e=await(0x0,ShowUserService_1[_0x535f64(0x105)])(_0x577a76[_0x535f64(0x13d)]),_0x334c4f=_0x535f64(0x151)+_0x200b3e[_0x535f64(0xfa)]+_0x535f64(0x15d)+_0x3d1c6f['username']+_0x535f64(0x144)+(0x0,moment_1['default'])()[_0x535f64(0x13b)](_0x535f64(0x115))+_0x535f64(0x14d);await(0x0,SendPresenceStatus_1[_0x535f64(0x13f)])(_0x50a7f9,_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?'g.us':'s.whatsapp.net'));const _0x1c2916=await _0x50a7f9[_0x535f64(0x11f)](_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?_0x535f64(0x10b):'s.whatsapp.net'),{'text':_0x334c4f});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x1c2916,_0x2afbd8,_0x2afbd8['contact']);}else{if(_0x2d2bf7!==_0x35a759&&!(0x0,lodash_1[_0x535f64(0x149)])(_0x2d2bf7)&&!(0x0,lodash_1[_0x535f64(0x149)])(_0x35a759)&&_0x47a793!==_0xf1d239&&!(0x0,lodash_1['isNil'])(_0x47a793)&&!(0x0,lodash_1[_0x535f64(0x149)])(_0xf1d239)){const _0x5f3bd5=await(0x0,GetTicketWbot_1[_0x535f64(0x105)])(_0x2afbd8),_0x5e5495=await(0x0,ShowUserService_1[_0x535f64(0x105)])(_0x577a76[_0x535f64(0x13d)]),_0x314f4d=await(0x0,ShowUserService_1[_0x535f64(0x105)])(_0x2d2bf7),_0x4e386c=_0x535f64(0x15c)+_0x38bbd6?.[_0x535f64(0xfa)]+_0x535f64(0x102)+_0x5e5495[_0x535f64(0xfa)]+'*\x20transferido\x20por\x20'+_0x3d1c6f[_0x535f64(0xf4)]+'\x20em\x20'+(0x0,moment_1[_0x535f64(0x105)])()[_0x535f64(0x13b)](_0x535f64(0x115))+_0x535f64(0x14b);await(0x0,SendPresenceStatus_1[_0x535f64(0x13f)])(_0x5f3bd5,_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?'g.us':_0x535f64(0x11b)));const _0x446101=await _0x5f3bd5['sendMessage'](_0x2afbd8[_0x535f64(0x11d)]['number']+'@'+(_0x2afbd8['isGroup']?_0x535f64(0x10b):_0x535f64(0x11b)),{'text':_0x4e386c});await(0x0,wbotMessageListener_1[_0x535f64(0xe7)])(_0x446101,_0x2afbd8,_0x2afbd8['contact']);const _0xe9e9ab=await(0x0,ShowUserService_1[_0x535f64(0x105)])(_0x35a759),_0x2f8999=_0x535f64(0xfd)+_0x314f4d[_0x535f64(0xfa)]+_0x535f64(0x123)+_0x5e5495['name']+_0x535f64(0xfc)+(0x0,moment_1['default'])()[_0x535f64(0x13b)](_0x535f64(0x115))+_0x535f64(0x14b);await(0x0,SendPresenceStatus_1[_0x535f64(0x13f)])(_0x5f3bd5,_0x2afbd8[_0x535f64(0x11d)]['number']+'@'+(_0x2afbd8[_0x535f64(0x126)]?_0x535f64(0x10b):_0x535f64(0x11b)));const _0x19f401=await _0x5f3bd5['sendMessage'](_0x2afbd8['contact'][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?'g.us':'s.whatsapp.net'),{'text':_0x2f8999});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x19f401,_0x2afbd8,_0x2afbd8[_0x535f64(0x11d)]);}else{if(_0x2d2bf7!==undefined&&(0x0,lodash_1[_0x535f64(0x149)])(_0x35a759)&&_0x47a793!==_0xf1d239&&!(0x0,lodash_1[_0x535f64(0x149)])(_0xf1d239)){const _0x1fcf48=await(0x0,GetTicketWbot_1[_0x535f64(0x105)])(_0x2afbd8),_0x21350a=_0x535f64(0x15c)+_0x38bbd6?.[_0x535f64(0xfa)]+_0x535f64(0x107);await(0x0,SendPresenceStatus_1[_0x535f64(0x13f)])(_0x1fcf48,_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?_0x535f64(0x10b):_0x535f64(0x11b)));const _0xfe5d7d=await _0x1fcf48[_0x535f64(0x11f)](_0x2afbd8[_0x535f64(0x11d)][_0x535f64(0x135)]+'@'+(_0x2afbd8[_0x535f64(0x126)]?_0x535f64(0x10b):_0x535f64(0x11b)),{'text':_0x21350a});await(0x0,wbotMessageListener_1['verifyMessage'])(_0xfe5d7d,_0x2afbd8,_0x2afbd8[_0x535f64(0x11d)]);}}}}}var _0x4b37f1=_0x47a793!==_0xf1d239;return _0x38bbd6&&(_0x4b37f1&&_0x38bbd6[_0x535f64(0x138)]&&(_0x2cfef5=_0x535f64(0x121))),await _0x2afbd8['update']({'amountUsedBotQueues':_0x577a76['amountUsedBotQueues']||0x0,'status':_0x2cfef5,'unreadMessages':_0x577a76[_0x535f64(0x103)]||0x0,'queueId':_0xf1d239,'userId':_0x35a759,'whatsappId':_0x565a3a,'chatbot':_0x343245,'queueOptionId':_0x535bc4}),await _0x2afbd8[_0x535f64(0x113)](),_0x38bbd6&&_0x4b37f1&&_0x38bbd6[_0x535f64(0x138)]&&!_0x2afbd8[_0x535f64(0x140)]&&!_0x2afbd8[_0x535f64(0x12a)]&&(_0x4eda61['to'](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+'-'+_0x5b8f91)['to']('queue-'+_0x2afbd8['queueId']+'-'+_0x5b8f91)['emit']('company-'+_0x4bd67e+'-ticket',{'action':'delete','ticketId':_0x2afbd8['id']}),_0x4eda61['to']('company-'+_0x2afbd8[_0x535f64(0x14e)]+'-'+_0x2afbd8[_0x535f64(0x108)])['to'](_0x535f64(0x157)+_0x2afbd8['companyId']+'-notification')['to'](_0x535f64(0x14a)+_0x2afbd8[_0x535f64(0x145)]+'-notification')['to']('queue-'+_0x2afbd8['queueId']+'-'+_0x2afbd8['status'])['to'](_0x14682e[_0x535f64(0x124)]())['emit']('company-'+_0x4bd67e+_0x535f64(0xf9),{'action':_0x535f64(0x143),'ticket':_0x2afbd8}),_0x2afbd8=await Ticket_1[_0x535f64(0x105)][_0x535f64(0xfe)]({'companyId':_0x4bd67e,'contactId':_0x2afbd8['contactId'],'userId':_0x35a759,'queueId':_0xf1d239,'status':_0x535f64(0x10f),'whatsappId':_0x2afbd8['whatsappId'],'chatbot':_0x343245,'queueOptionId':_0x535bc4,'promptId':_0x5883e7,'useIntegration':_0x160aff,'integrationId':_0x43e58e,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x2cfef5=_0x2afbd8[_0x535f64(0x108)],_0x2cfef5===_0x535f64(0x10f)&&(_0x527f43[_0x535f64(0x143)]({'whatsappId':_0x565a3a,'queuedAt':(0x0,moment_1['default'])()['toDate'](),'startedAt':null,'userId':null}),_0x4eda61['to'](_0x535f64(0x157)+_0x4bd67e+_0x535f64(0x128))['emit']('company-'+_0x4bd67e+'-ticket',{'action':_0x535f64(0x134),'ticketId':_0x2afbd8?.['id']})),_0x2cfef5===_0x535f64(0x148)&&(_0x527f43[_0x535f64(0x143)]({'startedAt':(0x0,moment_1[_0x535f64(0x105)])()[_0x535f64(0x11e)](),'ratingAt':null,'rated':![],'whatsappId':_0x565a3a,'userId':_0x2afbd8[_0x535f64(0x13d)]}),_0x4eda61['to'](_0x535f64(0x157)+_0x4bd67e+_0x535f64(0x128))[_0x535f64(0x15b)](_0x535f64(0x157)+_0x4bd67e+_0x535f64(0xf9),{'action':_0x535f64(0x134),'ticketId':_0x2afbd8?.['id']}),_0x4eda61['to']('company-'+_0x4bd67e+_0x535f64(0x128))['emit'](_0x535f64(0x157)+_0x4bd67e+_0x535f64(0xf9),{'action':_0x535f64(0xe6),'ticketId':_0x2afbd8?.['id']})),await _0x527f43[_0x535f64(0x110)](),(_0x2afbd8[_0x535f64(0x108)]!==_0x5b8f91||_0x2afbd8['user']?.['id']!==_0x2d2bf7||_0x4b37f1)&&_0x4eda61['to'](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+'-'+_0x5b8f91)['to'](_0x535f64(0x14a)+_0x2afbd8[_0x535f64(0x145)]+'-'+_0x5b8f91)['to'](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+_0x535f64(0x111))['to'](_0x535f64(0x14a)+_0x2afbd8[_0x535f64(0x145)]+_0x535f64(0x111))['to'](_0x14682e[_0x535f64(0x124)]())[_0x535f64(0x15b)](_0x535f64(0x157)+_0x4bd67e+'-ticket',{'action':'delete','ticketId':_0x2afbd8['id']}),_0x2afbd8[_0x535f64(0x108)]!==_0x535f64(0x121)&&_0x4eda61['to'](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+'-'+_0x2afbd8['status'])['to'](_0x535f64(0x157)+_0x2afbd8[_0x535f64(0x14e)]+_0x535f64(0x111))['to']('queue-'+_0x2afbd8[_0x535f64(0x145)]+_0x535f64(0x111))['to'](_0x535f64(0x14a)+_0x2afbd8[_0x535f64(0x145)]+'-'+_0x2afbd8['status'])['to'](_0x14682e[_0x535f64(0x124)]())[_0x535f64(0x15b)](_0x535f64(0x157)+_0x4bd67e+_0x535f64(0xf9),{'action':_0x535f64(0x143),'ticket':_0x2afbd8}),{'ticket':_0x2afbd8,'oldStatus':_0x5b8f91,'oldUserId':_0x2d2bf7};}catch(_0x123337){console[_0x535f64(0x158)](_0x123337),Sentry[_0x535f64(0x101)](_0x123337);}};exports[a528_0x3fd3a6(0x105)]=UpdateTicketService;function a528_0x37d4(_0x326b04,_0x37628f){const _0x3c2e94=a528_0x4b4a();return a528_0x37d4=function(_0x6ad586,_0x3745d9){_0x6ad586=_0x6ad586-0xe3;let _0x4b4a31=_0x3c2e94[_0x6ad586];return _0x4b4a31;},a528_0x37d4(_0x326b04,_0x37628f);}const notifyUpdate=(_0x59a975,_0x227a80,_0x5d2a3d,_0x2b84e2)=>{const _0x193bcf=a528_0x3fd3a6;_0x59a975['to'](_0x193bcf(0x157)+_0x227a80['companyId']+'-'+_0x227a80[_0x193bcf(0x108)])['to'](_0x193bcf(0x157)+_0x227a80['companyId']+'-notification')['to'](_0x5d2a3d[_0x193bcf(0x124)]())[_0x193bcf(0x15b)]('company-'+_0x2b84e2+_0x193bcf(0xf9),{'action':_0x193bcf(0x143),'ticket':_0x227a80});};exports[a528_0x3fd3a6(0xf1)]=notifyUpdate;