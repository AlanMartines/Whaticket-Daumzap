const a528_0x3a9aa7=a528_0x35c2;(function(_0x26d7e5,_0x36c560){const _0x3036fa=a528_0x35c2,_0x455c54=_0x26d7e5();while(!![]){try{const _0x3088d6=-parseInt(_0x3036fa(0x1dc))/0x1*(parseInt(_0x3036fa(0x19e))/0x2)+parseInt(_0x3036fa(0x1d2))/0x3+parseInt(_0x3036fa(0x1d3))/0x4*(-parseInt(_0x3036fa(0x1c7))/0x5)+-parseInt(_0x3036fa(0x211))/0x6*(-parseInt(_0x3036fa(0x1dd))/0x7)+-parseInt(_0x3036fa(0x215))/0x8+-parseInt(_0x3036fa(0x1f5))/0x9*(parseInt(_0x3036fa(0x1f6))/0xa)+parseInt(_0x3036fa(0x1b9))/0xb;if(_0x3088d6===_0x36c560)break;else _0x455c54['push'](_0x455c54['shift']());}catch(_0x13219a){_0x455c54['push'](_0x455c54['shift']());}}}(a528_0x7976,0xeab70));function a528_0x35c2(_0x5355d4,_0x2cae7d){const _0x423cdc=a528_0x7976();return a528_0x35c2=function(_0x1e6a09,_0x39431e){_0x1e6a09=_0x1e6a09-0x19a;let _0x797644=_0x423cdc[_0x1e6a09];return _0x797644;},a528_0x35c2(_0x5355d4,_0x2cae7d);}const a528_0x39431e=(function(){let _0x2e7548=!![];return function(_0x50844f,_0x4d7b17){const _0x477f4f=_0x2e7548?function(){const _0x4fee14=a528_0x35c2;if(_0x4d7b17){const _0x7ae1df=_0x4d7b17[_0x4fee14(0x1bd)](_0x50844f,arguments);return _0x4d7b17=null,_0x7ae1df;}}:function(){};return _0x2e7548=![],_0x477f4f;};}()),a528_0x1e6a09=a528_0x39431e(this,function(){const _0x1c71d0=a528_0x35c2;return a528_0x1e6a09[_0x1c71d0(0x206)]()[_0x1c71d0(0x1e4)](_0x1c71d0(0x1a8))[_0x1c71d0(0x206)]()[_0x1c71d0(0x1b4)](a528_0x1e6a09)[_0x1c71d0(0x1e4)](_0x1c71d0(0x1a8));});a528_0x1e6a09();'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x58dac5,_0x262433,_0x2f1484,_0x380307){const _0x2b765f=a528_0x35c2;if(_0x380307===undefined)_0x380307=_0x2f1484;var _0x273497=Object['getOwnPropertyDescriptor'](_0x262433,_0x2f1484);(!_0x273497||(_0x2b765f(0x1a4)in _0x273497?!_0x262433[_0x2b765f(0x19d)]:_0x273497[_0x2b765f(0x1ee)]||_0x273497[_0x2b765f(0x213)]))&&(_0x273497={'enumerable':!![],'get':function(){return _0x262433[_0x2f1484];}}),Object['defineProperty'](_0x58dac5,_0x380307,_0x273497);}:function(_0x2a7e45,_0x18f951,_0x422abe,_0x281f83){if(_0x281f83===undefined)_0x281f83=_0x422abe;_0x2a7e45[_0x281f83]=_0x18f951[_0x422abe];}),__setModuleDefault=this&&this[a528_0x3a9aa7(0x202)]||(Object[a528_0x3a9aa7(0x1cb)]?function(_0x299f80,_0x20b6cf){const _0x1f014b=a528_0x3a9aa7;Object[_0x1f014b(0x1b0)](_0x299f80,'default',{'enumerable':!![],'value':_0x20b6cf});}:function(_0x423d62,_0x4fde85){const _0x315422=a528_0x3a9aa7;_0x423d62[_0x315422(0x1b2)]=_0x4fde85;}),__importStar=this&&this[a528_0x3a9aa7(0x217)]||function(_0x148978){const _0x18f207=a528_0x3a9aa7;if(_0x148978&&_0x148978[_0x18f207(0x19d)])return _0x148978;var _0xdf3a4b={};if(_0x148978!=null){for(var _0x58a39a in _0x148978)if(_0x58a39a!==_0x18f207(0x1b2)&&Object[_0x18f207(0x208)][_0x18f207(0x1c6)][_0x18f207(0x1c2)](_0x148978,_0x58a39a))__createBinding(_0xdf3a4b,_0x148978,_0x58a39a);}return __setModuleDefault(_0xdf3a4b,_0x148978),_0xdf3a4b;},__importDefault=this&&this[a528_0x3a9aa7(0x1a0)]||function(_0xaecd7){const _0x5f2804=a528_0x3a9aa7;return _0xaecd7&&_0xaecd7[_0x5f2804(0x19d)]?_0xaecd7:{'default':_0xaecd7};};Object[a528_0x3a9aa7(0x1b0)](exports,'__esModule',{'value':!![]}),exports[a528_0x3a9aa7(0x1b6)]=void 0x0;const moment_1=__importDefault(require(a528_0x3a9aa7(0x203))),Sentry=__importStar(require(a528_0x3a9aa7(0x1ed))),CheckContactOpenTickets_1=__importDefault(require(a528_0x3a9aa7(0x1b5))),SetTicketMessagesAsRead_1=__importDefault(require(a528_0x3a9aa7(0x201))),socket_1=require(a528_0x3a9aa7(0x1d8)),Ticket_1=__importDefault(require('../../models/Ticket')),Setting_1=__importDefault(require('../../models/Setting')),Queue_1=__importDefault(require(a528_0x3a9aa7(0x1cd))),ShowTicketService_1=__importDefault(require(a528_0x3a9aa7(0x1e2))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),SendWhatsAppMessage_1=__importDefault(require(a528_0x3a9aa7(0x1ef))),FindOrCreateATicketTrakingService_1=__importDefault(require(a528_0x3a9aa7(0x20d))),GetTicketWbot_1=__importDefault(require(a528_0x3a9aa7(0x1d6))),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),ListSettingsServiceOne_1=__importDefault(require(a528_0x3a9aa7(0x1a7))),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),lodash_1=require(a528_0x3a9aa7(0x1b3)),AppError_1=__importDefault(require(a528_0x3a9aa7(0x1e9))),SendPresenceStatus_1=require(a528_0x3a9aa7(0x1e5)),wbot_1=require(a528_0x3a9aa7(0x200));let completionMessageControl=[];function a528_0x7976(){const _0xc35ebb=['../SettingServices/ListSettingsServiceOne','(((.+)+)+)+$','DD/MM/YYYY\x20HH:mm:ss','*\x20por\x20','*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*','Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a','sendMsgTransfTicket','*,\x20em\x20','*1*\x20-\x20_Muito\x20Insatisfeito_\x0a','defineProperty','userId','default','lodash','constructor','../../helpers/CheckContactOpenTickets','notifyUpdate','update','verifyMessage','27279516sDDWGf','-ticket','unreadMessages','updateUnread','apply','-open','admin','companyId','closed','call','getWbot','delete','userRating','hasOwnProperty','1325485ujxBJd','getIO','value','emit','create','user','../../models/Queue','format','isGroup','company-','Need\x20companyId\x20or\x20tokenData','960408bbsrsF','28vjUUxa','-notification','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','../../helpers/GetTicketWbot','find','../../libs/socket','-mainchannel','getTime','ratingAt','79966LGeexs','9373532aYwNUD','g.us','*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a','status','amountUsedBotQueues','./ShowTicketService','SendPresenceStatus','search','../../helpers/SendPresenceStatus','username','disableBot','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','../../errors/AppError','captureException','queueOptionId','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','@sentry/node','writable','../WbotServices/SendWhatsAppMessage','profile','open','queue-','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','6687zwKsjY','12370KGyGhB','length','finishedAt','toDate','number','name','save','*5*\x20-\x20_Muito\x20Satisfeito_\x0a','\x20em\x20','sendMessage','../../libs/wbot','../../helpers/SetTicketMessagesAsRead','__setModuleDefault','moment','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','queueId','toString','newTicketOnTransfer','prototype','promptId','rated','useIntegration','ticketId','./FindOrCreateATicketTrakingService','trace','pending','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','6pcORDa','removeFromList','configurable','*2*\x20-\x20_Insatisfeito_\x0a','2584320OwIbzy','dest','__importStar','contactId','enabled','isNil','findOne','findByPk','__esModule','2uEPUZJ','*4*\x20-\x20_Satisfeito_\x0a','__importDefault','chatbot','whatsappId','*\x20transferido\x20por\x20','get','contact','s.whatsapp.net'];a528_0x7976=function(){return _0xc35ebb;};return a528_0x7976();}const UpdateTicketService=async({ticketData:_0x33fd11,ticketId:_0x21ea43,tokenData:_0x271b5c,companyId:_0x7f2885})=>{const _0x42dc12=a528_0x3a9aa7;try{if(!_0x7f2885&&!_0x271b5c)throw new Error(_0x42dc12(0x1d1));_0x271b5c&&(_0x7f2885=_0x271b5c['companyId']);let {status:_0x1be695}=_0x33fd11,{queueId:_0xe8e1dd,userId:_0x461694,whatsappId:_0x1651f7,sendFarewellMessage:_0x5a6044}=_0x33fd11;_0x5a6044==null&&(_0x5a6044=!![]);let _0x291ec9=_0x33fd11[_0x42dc12(0x1a1)]||![],_0x2b9953=_0x33fd11[_0x42dc12(0x1eb)]||null,_0x9e03bb=_0x33fd11[_0x42dc12(0x209)]||null,_0xa37f1d=_0x33fd11[_0x42dc12(0x20b)]||![],_0x1ce1e9=_0x33fd11['integrationId']||null;const _0x243e5a=(0x0,socket_1[_0x42dc12(0x1c8)])(),_0x1d249e=_0x42dc12(0x1c5),_0xc14a3=await Setting_1[_0x42dc12(0x1b2)][_0x42dc12(0x19b)]({'where':{'companyId':_0x7f2885,'key':_0x1d249e}});let _0x32fd52=await(0x0,ShowTicketService_1[_0x42dc12(0x1b2)])(_0x21ea43,_0x7f2885);if(_0x271b5c&&_0x32fd52[_0x42dc12(0x1e0)]!==_0x42dc12(0x20f)){if(_0x271b5c[_0x42dc12(0x1f0)]!==_0x42dc12(0x1bf)&&_0x32fd52[_0x42dc12(0x1b1)]!==parseInt(_0x271b5c['id'],0xa))throw new AppError_1[(_0x42dc12(0x1b2))]('Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket');}const _0x27afa7=await(0x0,FindOrCreateATicketTrakingService_1[_0x42dc12(0x1b2)])({'ticketId':_0x21ea43,'companyId':_0x7f2885,'whatsappId':_0x32fd52['whatsappId']});(0x0,lodash_1[_0x42dc12(0x19a)])(_0x1651f7)&&(_0x1651f7=_0x32fd52[_0x42dc12(0x1a2)]['toString']());(_0x1be695==='closed'||_0x1be695===_0x42dc12(0x1f1))&&await(0x0,SetTicketMessagesAsRead_1[_0x42dc12(0x1b2)])(_0x32fd52);const _0x41cef9=_0x32fd52[_0x42dc12(0x1e0)],_0x48281e=_0x32fd52['user']?.['id'],_0x1ef275=_0x32fd52[_0x42dc12(0x205)];(_0x41cef9==='closed'||_0x1651f7!==undefined&&Number(_0x1651f7)!==_0x32fd52[_0x42dc12(0x1a2)])&&(await(0x0,CheckContactOpenTickets_1[_0x42dc12(0x1b2)])(_0x32fd52['contact']['id'],_0x1651f7),_0x291ec9=null,_0x2b9953=null);if(_0x1be695===_0x42dc12(0x1c1)){const {complationMessage:_0x3ae171,ratingMessage:_0x244a04}=await(0x0,ShowWhatsAppService_1[_0x42dc12(0x1b2)])(_0x32fd52[_0x42dc12(0x1a2)],_0x7f2885);if(!_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1e7)]&&_0xc14a3?.[_0x42dc12(0x1c9)]===_0x42dc12(0x219)&&_0x5a6044&&!_0x32fd52[_0x42dc12(0x1cf)]){if(_0x27afa7[_0x42dc12(0x1db)]==null&&!_0x32fd52[_0x42dc12(0x1cf)]){const _0x4ae6c3=_0x244a04||'';let _0x50896b='‎'+_0x4ae6c3+'\x0a\x0a';return _0x50896b+=_0x42dc12(0x1ac)+_0x42dc12(0x1af)+_0x42dc12(0x214)+_0x42dc12(0x1df)+_0x42dc12(0x19f)+_0x42dc12(0x1fd),await(0x0,SendPresenceStatus_1[_0x42dc12(0x1e3)])((0x0,wbot_1[_0x42dc12(0x1c3)])(_0x32fd52[_0x42dc12(0x1a2)]),_0x32fd52['contact']['number']+'@'+(_0x32fd52['isGroup']?_0x42dc12(0x1de):_0x42dc12(0x1a6))),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x50896b,'ticket':_0x32fd52}),await _0x27afa7[_0x42dc12(0x1b7)]({'rated':![],'ratingAt':(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1f9)]()}),await _0x32fd52['update']({'amountUsedBotQueues':_0x33fd11[_0x42dc12(0x1e1)]||0x0,'status':_0x1be695,'unreadMessages':_0x33fd11[_0x42dc12(0x1bb)]||0x0,'queueId':_0xe8e1dd,'userId':_0x461694,'whatsappId':_0x1651f7,'chatbot':_0x291ec9,'queueOptionId':_0x2b9953}),_0x243e5a['to'](_0x42dc12(0x1d0)+_0x32fd52['companyId']+_0x42dc12(0x1be))['to'](_0x21ea43[_0x42dc12(0x206)]())['emit'](_0x42dc12(0x1d0)+_0x32fd52[_0x42dc12(0x1c0)]+_0x42dc12(0x1ba),{'action':_0x42dc12(0x1c4),'ticketId':_0x32fd52['id']}),{'ticket':_0x32fd52,'oldStatus':_0x41cef9,'oldUserId':_0x48281e};}_0x27afa7[_0x42dc12(0x1db)]=(0x0,moment_1['default'])()[_0x42dc12(0x1f9)](),_0x27afa7[_0x42dc12(0x20a)]=![];}if(completionMessageControl[_0x42dc12(0x1f7)]>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1[_0x42dc12(0x19a)])(_0x3ae171)&&_0x3ae171!==''&&_0x5a6044&&!_0x32fd52[_0x42dc12(0x1cf)]){let _0x328885=completionMessageControl[_0x42dc12(0x1d7)](_0x3f16d6=>_0x3f16d6[_0x42dc12(0x20c)]===_0x32fd52['id']||_0x3f16d6[_0x42dc12(0x216)]===_0x32fd52[_0x42dc12(0x1a5)]['number']);if(!_0x328885||_0x328885&&_0x328885['time']+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x328885&&(completionMessageControl=completionMessageControl['filter'](_0x22eed5=>_0x22eed5['ticketId']!==_0x32fd52['id']),_0x328885=null);if(!_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1e7)]&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0x3ae171)&&_0x3ae171!==''){const _0x4cc995='‎'+_0x3ae171;await(0x0,SendPresenceStatus_1[_0x42dc12(0x1e3)])((0x0,wbot_1['getWbot'])(_0x32fd52['whatsappId']),_0x32fd52[_0x42dc12(0x1a5)]['number']+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?_0x42dc12(0x1de):_0x42dc12(0x1a6))),await(0x0,SendWhatsAppMessage_1[_0x42dc12(0x1b2)])({'body':_0x4cc995,'ticket':_0x32fd52});}}!_0x328885&&completionMessageControl['push']({'ticketId':_0x32fd52['id'],'dest':_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)],'time':new Date()[_0x42dc12(0x1da)]()});}await _0x32fd52['update']({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x27afa7[_0x42dc12(0x1f8)]=(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1f9)](),_0x27afa7['whatsappId']=_0x32fd52[_0x42dc12(0x1a2)],_0x27afa7['userId']=_0x32fd52[_0x42dc12(0x1b1)];}_0xe8e1dd!==undefined&&_0xe8e1dd!==null&&(_0x27afa7['queuedAt']=(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1f9)]());const _0x3f6d13=await(0x0,ListSettingsServiceOne_1[_0x42dc12(0x1b2)])({'companyId':_0x7f2885,'key':_0x42dc12(0x1ad)}),_0x5e675c=await Queue_1[_0x42dc12(0x1b2)][_0x42dc12(0x19c)](_0xe8e1dd);if(_0x3f6d13?.[_0x42dc12(0x1c9)]==='enabled'){if(_0x1ef275!==_0xe8e1dd&&_0x48281e===_0x461694&&!(0x0,lodash_1['isNil'])(_0x1ef275)&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0xe8e1dd)){const _0x360688=await(0x0,GetTicketWbot_1[_0x42dc12(0x1b2)])(_0x32fd52),_0x2dec33=_0x42dc12(0x1f3)+_0x5e675c?.['name']+'*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1[_0x42dc12(0x1e3)])(_0x360688,_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52['isGroup']?_0x42dc12(0x1de):_0x42dc12(0x1a6)));const _0x470b34=await _0x360688[_0x42dc12(0x1ff)](_0x32fd52[_0x42dc12(0x1a5)]['number']+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?'g.us':_0x42dc12(0x1a6)),{'text':_0x2dec33});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x470b34,_0x32fd52,_0x32fd52[_0x42dc12(0x1a5)]);}else{if(_0x48281e!==_0x461694&&_0x1ef275===_0xe8e1dd&&!(0x0,lodash_1['isNil'])(_0x48281e)&&!(0x0,lodash_1['isNil'])(_0x461694)){const _0x308c38=await(0x0,GetTicketWbot_1[_0x42dc12(0x1b2)])(_0x32fd52),_0x423caa=await(0x0,ShowUserService_1[_0x42dc12(0x1b2)])(_0x33fd11['userId']),_0x11c3c8=_0x42dc12(0x1f4)+_0x423caa[_0x42dc12(0x1fb)]+_0x42dc12(0x1aa)+_0x271b5c[_0x42dc12(0x1e6)]+_0x42dc12(0x1fe)+(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1ce)](_0x42dc12(0x1a9))+_0x42dc12(0x204);await(0x0,SendPresenceStatus_1[_0x42dc12(0x1e3)])(_0x308c38,_0x32fd52['contact'][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?_0x42dc12(0x1de):_0x42dc12(0x1a6)));const _0xba2899=await _0x308c38[_0x42dc12(0x1ff)](_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?_0x42dc12(0x1de):_0x42dc12(0x1a6)),{'text':_0x11c3c8});await(0x0,wbotMessageListener_1['verifyMessage'])(_0xba2899,_0x32fd52,_0x32fd52['contact']);}else{if(_0x48281e!==_0x461694&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0x48281e)&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0x461694)&&_0x1ef275!==_0xe8e1dd&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0x1ef275)&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0xe8e1dd)){const _0x4c5246=await(0x0,GetTicketWbot_1['default'])(_0x32fd52),_0x36fe74=await(0x0,ShowUserService_1[_0x42dc12(0x1b2)])(_0x33fd11[_0x42dc12(0x1b1)]),_0x126ba7=await(0x0,ShowUserService_1[_0x42dc12(0x1b2)])(_0x48281e),_0x2655fa=_0x42dc12(0x1f3)+_0x5e675c?.[_0x42dc12(0x1fb)]+_0x42dc12(0x1ab)+_0x36fe74[_0x42dc12(0x1fb)]+_0x42dc12(0x1a3)+_0x271b5c[_0x42dc12(0x1e6)]+_0x42dc12(0x1fe)+(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1ce)](_0x42dc12(0x1a9))+'\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x4c5246,_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?'g.us':'s.whatsapp.net'));const _0x37420a=await _0x4c5246[_0x42dc12(0x1ff)](_0x32fd52['contact'][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?'g.us':_0x42dc12(0x1a6)),{'text':_0x2655fa});await(0x0,wbotMessageListener_1[_0x42dc12(0x1b8)])(_0x37420a,_0x32fd52,_0x32fd52[_0x42dc12(0x1a5)]);const _0x36d136=await(0x0,ShowUserService_1[_0x42dc12(0x1b2)])(_0x461694),_0x2f8c70=_0x42dc12(0x1ec)+_0x126ba7['name']+_0x42dc12(0x210)+_0x36fe74[_0x42dc12(0x1fb)]+_0x42dc12(0x1ae)+(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1ce)]('DD/MM/YYYY\x20HH:mm:ss')+_0x42dc12(0x1d5);await(0x0,SendPresenceStatus_1[_0x42dc12(0x1e3)])(_0x4c5246,_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?'g.us':_0x42dc12(0x1a6)));const _0x1fbd3d=await _0x4c5246[_0x42dc12(0x1ff)](_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?_0x42dc12(0x1de):_0x42dc12(0x1a6)),{'text':_0x2f8c70});await(0x0,wbotMessageListener_1[_0x42dc12(0x1b8)])(_0x1fbd3d,_0x32fd52,_0x32fd52[_0x42dc12(0x1a5)]);}else{if(_0x48281e!==undefined&&(0x0,lodash_1[_0x42dc12(0x19a)])(_0x461694)&&_0x1ef275!==_0xe8e1dd&&!(0x0,lodash_1[_0x42dc12(0x19a)])(_0xe8e1dd)){const _0x4f1eb9=await(0x0,GetTicketWbot_1[_0x42dc12(0x1b2)])(_0x32fd52),_0x1edd35=_0x42dc12(0x1f3)+_0x5e675c?.[_0x42dc12(0x1fb)]+_0x42dc12(0x1e8);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x4f1eb9,_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?'g.us':_0x42dc12(0x1a6)));const _0x174259=await _0x4f1eb9[_0x42dc12(0x1ff)](_0x32fd52[_0x42dc12(0x1a5)][_0x42dc12(0x1fa)]+'@'+(_0x32fd52[_0x42dc12(0x1cf)]?_0x42dc12(0x1de):_0x42dc12(0x1a6)),{'text':_0x1edd35});await(0x0,wbotMessageListener_1[_0x42dc12(0x1b8)])(_0x174259,_0x32fd52,_0x32fd52[_0x42dc12(0x1a5)]);}}}}}var _0xcd0716=_0x1ef275!==_0xe8e1dd;return _0x5e675c&&(_0xcd0716&&_0x5e675c[_0x42dc12(0x207)]&&(_0x1be695=_0x42dc12(0x1c1))),await _0x32fd52[_0x42dc12(0x1b7)]({'amountUsedBotQueues':_0x33fd11['amountUsedBotQueues']||0x0,'status':_0x1be695,'unreadMessages':_0x33fd11[_0x42dc12(0x1bb)]||0x0,'queueId':_0xe8e1dd,'userId':_0x461694,'whatsappId':_0x1651f7,'chatbot':_0x291ec9,'queueOptionId':_0x2b9953}),await _0x32fd52['reload'](),_0x5e675c&&_0xcd0716&&_0x5e675c['newTicketOnTransfer']&&!_0x32fd52['chatbot']&&!_0x32fd52[_0x42dc12(0x20b)]&&(_0x243e5a['to']('company-'+_0x32fd52[_0x42dc12(0x1c0)]+'-'+_0x41cef9)['to'](_0x42dc12(0x1f2)+_0x32fd52['queueId']+'-'+_0x41cef9)[_0x42dc12(0x1ca)](_0x42dc12(0x1d0)+_0x7f2885+'-ticket',{'action':'delete','ticketId':_0x32fd52['id']}),_0x243e5a['to'](_0x42dc12(0x1d0)+_0x32fd52['companyId']+'-'+_0x32fd52[_0x42dc12(0x1e0)])['to']('company-'+_0x32fd52[_0x42dc12(0x1c0)]+_0x42dc12(0x1d4))['to'](_0x42dc12(0x1f2)+_0x32fd52['queueId']+_0x42dc12(0x1d4))['to'](_0x42dc12(0x1f2)+_0x32fd52[_0x42dc12(0x205)]+'-'+_0x32fd52[_0x42dc12(0x1e0)])['to'](_0x21ea43['toString']())[_0x42dc12(0x1ca)]('company-'+_0x7f2885+'-ticket',{'action':_0x42dc12(0x1b7),'ticket':_0x32fd52}),_0x32fd52=await Ticket_1[_0x42dc12(0x1b2)][_0x42dc12(0x1cb)]({'companyId':_0x7f2885,'contactId':_0x32fd52[_0x42dc12(0x218)],'userId':_0x461694,'queueId':_0xe8e1dd,'status':_0x42dc12(0x20f),'whatsappId':_0x32fd52[_0x42dc12(0x1a2)],'chatbot':_0x291ec9,'queueOptionId':_0x2b9953,'promptId':_0x9e03bb,'useIntegration':_0xa37f1d,'integrationId':_0x1ce1e9,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x1be695=_0x32fd52[_0x42dc12(0x1e0)],_0x1be695==='pending'&&(_0x27afa7['update']({'whatsappId':_0x1651f7,'queuedAt':(0x0,moment_1[_0x42dc12(0x1b2)])()['toDate'](),'startedAt':null,'userId':null}),_0x243e5a['to']('company-'+_0x7f2885+_0x42dc12(0x1d9))[_0x42dc12(0x1ca)](_0x42dc12(0x1d0)+_0x7f2885+_0x42dc12(0x1ba),{'action':_0x42dc12(0x212),'ticketId':_0x32fd52?.['id']})),_0x1be695===_0x42dc12(0x1f1)&&(_0x27afa7[_0x42dc12(0x1b7)]({'startedAt':(0x0,moment_1[_0x42dc12(0x1b2)])()[_0x42dc12(0x1f9)](),'ratingAt':null,'rated':![],'whatsappId':_0x1651f7,'userId':_0x32fd52[_0x42dc12(0x1b1)]}),_0x243e5a['to'](_0x42dc12(0x1d0)+_0x7f2885+_0x42dc12(0x1d9))[_0x42dc12(0x1ca)](_0x42dc12(0x1d0)+_0x7f2885+'-ticket',{'action':'removeFromList','ticketId':_0x32fd52?.['id']}),_0x243e5a['to'](_0x42dc12(0x1d0)+_0x7f2885+_0x42dc12(0x1d9))['emit'](_0x42dc12(0x1d0)+_0x7f2885+_0x42dc12(0x1ba),{'action':_0x42dc12(0x1bc),'ticketId':_0x32fd52?.['id']})),await _0x27afa7[_0x42dc12(0x1fc)](),(_0x32fd52[_0x42dc12(0x1e0)]!==_0x41cef9||_0x32fd52[_0x42dc12(0x1cc)]?.['id']!==_0x48281e||_0xcd0716)&&_0x243e5a['to'](_0x42dc12(0x1d0)+_0x32fd52[_0x42dc12(0x1c0)]+'-'+_0x41cef9)['to'](_0x42dc12(0x1f2)+_0x32fd52['queueId']+'-'+_0x41cef9)['to'](_0x42dc12(0x1d0)+_0x32fd52[_0x42dc12(0x1c0)]+_0x42dc12(0x1d4))['to'](_0x42dc12(0x1f2)+_0x32fd52['queueId']+_0x42dc12(0x1d4))['to'](_0x21ea43['toString']())[_0x42dc12(0x1ca)](_0x42dc12(0x1d0)+_0x7f2885+_0x42dc12(0x1ba),{'action':_0x42dc12(0x1c4),'ticketId':_0x32fd52['id']}),_0x32fd52[_0x42dc12(0x1e0)]!=='closed'&&_0x243e5a['to'](_0x42dc12(0x1d0)+_0x32fd52[_0x42dc12(0x1c0)]+'-'+_0x32fd52[_0x42dc12(0x1e0)])['to'](_0x42dc12(0x1d0)+_0x32fd52['companyId']+_0x42dc12(0x1d4))['to'](_0x42dc12(0x1f2)+_0x32fd52[_0x42dc12(0x205)]+'-notification')['to'](_0x42dc12(0x1f2)+_0x32fd52[_0x42dc12(0x205)]+'-'+_0x32fd52[_0x42dc12(0x1e0)])['to'](_0x21ea43['toString']())[_0x42dc12(0x1ca)](_0x42dc12(0x1d0)+_0x7f2885+_0x42dc12(0x1ba),{'action':'update','ticket':_0x32fd52}),{'ticket':_0x32fd52,'oldStatus':_0x41cef9,'oldUserId':_0x48281e};}catch(_0x459748){console[_0x42dc12(0x20e)](_0x459748),Sentry[_0x42dc12(0x1ea)](_0x459748);}};exports[a528_0x3a9aa7(0x1b2)]=UpdateTicketService;const notifyUpdate=(_0x26b67e,_0x31c31c,_0x350dcc,_0x2ba836)=>{const _0x32ddc5=a528_0x3a9aa7;_0x26b67e['to']('company-'+_0x31c31c[_0x32ddc5(0x1c0)]+'-'+_0x31c31c[_0x32ddc5(0x1e0)])['to'](_0x32ddc5(0x1d0)+_0x31c31c['companyId']+_0x32ddc5(0x1d4))['to'](_0x350dcc['toString']())[_0x32ddc5(0x1ca)](_0x32ddc5(0x1d0)+_0x2ba836+_0x32ddc5(0x1ba),{'action':'update','ticket':_0x31c31c});};exports[a528_0x3a9aa7(0x1b6)]=notifyUpdate;