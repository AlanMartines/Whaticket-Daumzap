const a528_0x31148f=a528_0x4dfb;(function(_0x438163,_0x24e7be){const _0x24dcdd=a528_0x4dfb,_0x54f744=_0x438163();while(!![]){try{const _0x24d70e=parseInt(_0x24dcdd(0xb4))/0x1+-parseInt(_0x24dcdd(0xce))/0x2+parseInt(_0x24dcdd(0xa8))/0x3+parseInt(_0x24dcdd(0x9f))/0x4*(-parseInt(_0x24dcdd(0xbc))/0x5)+parseInt(_0x24dcdd(0x90))/0x6*(-parseInt(_0x24dcdd(0xc1))/0x7)+parseInt(_0x24dcdd(0xa2))/0x8*(parseInt(_0x24dcdd(0xca))/0x9)+parseInt(_0x24dcdd(0xb3))/0xa;if(_0x24d70e===_0x24e7be)break;else _0x54f744['push'](_0x54f744['shift']());}catch(_0x13c22e){_0x54f744['push'](_0x54f744['shift']());}}}(a528_0x59e7,0x6e5df));const a528_0xb51f4d=(function(){let _0x19e0ea=!![];return function(_0x31adc9,_0x5c918c){const _0x37b541=_0x19e0ea?function(){if(_0x5c918c){const _0x7edf14=_0x5c918c['apply'](_0x31adc9,arguments);return _0x5c918c=null,_0x7edf14;}}:function(){};return _0x19e0ea=![],_0x37b541;};}()),a528_0x5a7b63=a528_0xb51f4d(this,function(){const _0x100998=a528_0x4dfb;return a528_0x5a7b63[_0x100998(0xb9)]()['search'](_0x100998(0xe5))[_0x100998(0xb9)]()[_0x100998(0xa7)](a528_0x5a7b63)[_0x100998(0xa9)](_0x100998(0xe5));});function a528_0x59e7(){const _0x338e0a=['__esModule','whatsappId','sendMessage','../../libs/socket','notifyUpdate','number','promptId','findOne','*2*\x20-\x20_Insatisfeito_\x0a','(((.+)+)+)+$','*\x20por\x20','./ShowTicketService','finishedAt','Need\x20companyId\x20or\x20tokenData','username','-ticket','integrationId','Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket','delete','value','push','queueOptionId','update','../../libs/wbot','queueId','*\x20transferido\x20por\x20','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','captureException','isNil','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','updateUnread','../../errors/AppError','Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a','./FindOrCreateATicketTrakingService','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','call','__importDefault','-notification','toDate','default','defineProperty','../WbotServices/wbotMessageListener','create','396258XHWTAA','admin','disableBot','-mainchannel','status','../../models/Setting','pending','@sentry/node','userId','../../helpers/SetTicketMessagesAsRead','\x20em\x20','ticketId','save','hasOwnProperty','findByPk','8392ENcVxN','moment','getIO','4760488TTXfQs','format','*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a','*5*\x20-\x20_Muito\x20Satisfeito_\x0a','-open','constructor','2571780ITKbvw','search','verifyMessage','trace','sendMsgTransfTicket','ratingAt','queue-','s.whatsapp.net','isGroup','rated','removeFromList','521870zhLdri','321024aEXxPv','enabled','userRating','getTime','time','toString','useIntegration','name','540hOZVjz','DD/MM/YYYY\x20HH:mm:ss','chatbot','../../helpers/GetTicketWbot','*4*\x20-\x20_Satisfeito_\x0a','56kLqRFX','company-','__createBinding','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','../WbotServices/SendWhatsAppMessage','companyId','contact','../../models/Queue','profile','9mTAxXw','contactId','user','amountUsedBotQueues','1237082xbGSRH','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','../../helpers/SendPresenceStatus','../../helpers/CheckContactOpenTickets','SendPresenceStatus','open','*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*','g.us','getWbot','*1*\x20-\x20_Muito\x20Insatisfeito_\x0a','unreadMessages','emit','closed','configurable'];a528_0x59e7=function(){return _0x338e0a;};return a528_0x59e7();}a528_0x5a7b63();'use strict';var __createBinding=this&&this[a528_0x31148f(0xc3)]||(Object['create']?function(_0x16768c,_0x56a78d,_0x23cf6a,_0x431321){const _0x9a19dd=a528_0x31148f;if(_0x431321===undefined)_0x431321=_0x23cf6a;var _0x1d38b3=Object['getOwnPropertyDescriptor'](_0x56a78d,_0x23cf6a);(!_0x1d38b3||('get'in _0x1d38b3?!_0x56a78d[_0x9a19dd(0xdc)]:_0x1d38b3['writable']||_0x1d38b3[_0x9a19dd(0xdb)]))&&(_0x1d38b3={'enumerable':!![],'get':function(){return _0x56a78d[_0x23cf6a];}}),Object['defineProperty'](_0x16768c,_0x431321,_0x1d38b3);}:function(_0x5f5c18,_0x1dca7f,_0x1f652c,_0x301aff){if(_0x301aff===undefined)_0x301aff=_0x1f652c;_0x5f5c18[_0x301aff]=_0x1dca7f[_0x1f652c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a528_0x31148f(0x8f)]?function(_0x90acb8,_0x1b41d7){const _0x320b4e=a528_0x31148f;Object[_0x320b4e(0x8d)](_0x90acb8,_0x320b4e(0x8c),{'enumerable':!![],'value':_0x1b41d7});}:function(_0x282c13,_0x5d12a9){const _0x371546=a528_0x31148f;_0x282c13[_0x371546(0x8c)]=_0x5d12a9;}),__importStar=this&&this['__importStar']||function(_0x5b5e54){const _0x225838=a528_0x31148f;if(_0x5b5e54&&_0x5b5e54[_0x225838(0xdc)])return _0x5b5e54;var _0xbef919={};if(_0x5b5e54!=null){for(var _0x61cb0b in _0x5b5e54)if(_0x61cb0b!==_0x225838(0x8c)&&Object['prototype'][_0x225838(0x9d)][_0x225838(0x88)](_0x5b5e54,_0x61cb0b))__createBinding(_0xbef919,_0x5b5e54,_0x61cb0b);}return __setModuleDefault(_0xbef919,_0x5b5e54),_0xbef919;},__importDefault=this&&this[a528_0x31148f(0x89)]||function(_0x4bcfa5){const _0xecfcab=a528_0x31148f;return _0x4bcfa5&&_0x4bcfa5[_0xecfcab(0xdc)]?_0x4bcfa5:{'default':_0x4bcfa5};};Object['defineProperty'](exports,a528_0x31148f(0xdc),{'value':!![]}),exports[a528_0x31148f(0xe0)]=void 0x0;const moment_1=__importDefault(require(a528_0x31148f(0xa0))),Sentry=__importStar(require(a528_0x31148f(0x97))),CheckContactOpenTickets_1=__importDefault(require(a528_0x31148f(0xd1))),SetTicketMessagesAsRead_1=__importDefault(require(a528_0x31148f(0x99))),socket_1=require(a528_0x31148f(0xdf)),Ticket_1=__importDefault(require('../../models/Ticket')),Setting_1=__importDefault(require(a528_0x31148f(0x95))),Queue_1=__importDefault(require(a528_0x31148f(0xc8))),ShowTicketService_1=__importDefault(require(a528_0x31148f(0xe7))),ShowWhatsAppService_1=__importDefault(require('../WhatsappService/ShowWhatsAppService')),SendWhatsAppMessage_1=__importDefault(require(a528_0x31148f(0xc5))),FindOrCreateATicketTrakingService_1=__importDefault(require(a528_0x31148f(0x85))),GetTicketWbot_1=__importDefault(require(a528_0x31148f(0xbf))),wbotMessageListener_1=require(a528_0x31148f(0x8e)),ListSettingsServiceOne_1=__importDefault(require('../SettingServices/ListSettingsServiceOne')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),lodash_1=require('lodash'),AppError_1=__importDefault(require(a528_0x31148f(0x83))),SendPresenceStatus_1=require(a528_0x31148f(0xd0)),wbot_1=require(a528_0x31148f(0x7b));let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x49e52f,ticketId:_0x542069,tokenData:_0x28c95b,companyId:_0x415f99})=>{const _0x5a710a=a528_0x31148f;try{if(!_0x415f99&&!_0x28c95b)throw new Error(_0x5a710a(0xe9));_0x28c95b&&(_0x415f99=_0x28c95b['companyId']);let {status:_0xf91b72}=_0x49e52f,{queueId:_0x116ea3,userId:_0x1671fd,whatsappId:_0xf982a3,sendFarewellMessage:_0x5b801d}=_0x49e52f;_0x5b801d==null&&(_0x5b801d=!![]);let _0x2a59e7=_0x49e52f[_0x5a710a(0xbe)]||![],_0x3bdd73=_0x49e52f[_0x5a710a(0x79)]||null,_0x3ac96d=_0x49e52f[_0x5a710a(0xe2)]||null,_0x3acb99=_0x49e52f['useIntegration']||![],_0x5a21de=_0x49e52f[_0x5a710a(0xec)]||null;const _0x3de9a0=(0x0,socket_1[_0x5a710a(0xa1)])(),_0x2e8621=_0x5a710a(0xb6),_0x98ddf2=await Setting_1[_0x5a710a(0x8c)][_0x5a710a(0xe3)]({'where':{'companyId':_0x415f99,'key':_0x2e8621}});let _0x4a4fb0=await(0x0,ShowTicketService_1[_0x5a710a(0x8c)])(_0x542069,_0x415f99);if(_0x28c95b&&_0x4a4fb0[_0x5a710a(0x94)]!==_0x5a710a(0x96)){if(_0x28c95b[_0x5a710a(0xc9)]!==_0x5a710a(0x91)&&_0x4a4fb0['userId']!==parseInt(_0x28c95b['id'],0xa))throw new AppError_1[(_0x5a710a(0x8c))](_0x5a710a(0xed));}const _0x414de5=await(0x0,FindOrCreateATicketTrakingService_1['default'])({'ticketId':_0x542069,'companyId':_0x415f99,'whatsappId':_0x4a4fb0[_0x5a710a(0xdd)]});(0x0,lodash_1['isNil'])(_0xf982a3)&&(_0xf982a3=_0x4a4fb0[_0x5a710a(0xdd)][_0x5a710a(0xb9)]());(_0xf91b72===_0x5a710a(0xda)||_0xf91b72==='open')&&await(0x0,SetTicketMessagesAsRead_1['default'])(_0x4a4fb0);const _0x14f108=_0x4a4fb0[_0x5a710a(0x94)],_0x1ffc24=_0x4a4fb0[_0x5a710a(0xcc)]?.['id'],_0x307769=_0x4a4fb0['queueId'];(_0x14f108===_0x5a710a(0xda)||_0xf982a3!==undefined&&Number(_0xf982a3)!==_0x4a4fb0[_0x5a710a(0xdd)])&&(await(0x0,CheckContactOpenTickets_1[_0x5a710a(0x8c)])(_0x4a4fb0[_0x5a710a(0xc7)]['id'],_0xf982a3),_0x2a59e7=null,_0x3bdd73=null);if(_0xf91b72===_0x5a710a(0xda)){const {complationMessage:_0x1c95c0,ratingMessage:_0x1b1350}=await(0x0,ShowWhatsAppService_1[_0x5a710a(0x8c)])(_0x4a4fb0[_0x5a710a(0xdd)],_0x415f99);if(!_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0x92)]&&_0x98ddf2?.[_0x5a710a(0x77)]==='enabled'&&_0x5b801d&&!_0x4a4fb0[_0x5a710a(0xb0)]){if(_0x414de5[_0x5a710a(0xad)]==null&&!_0x4a4fb0[_0x5a710a(0xb0)]){const _0x3bca46=_0x1b1350||'';let _0x3d9bb9='‎'+_0x3bca46+'\x0a\x0a';return _0x3d9bb9+=_0x5a710a(0x84)+_0x5a710a(0xd7)+_0x5a710a(0xe4)+_0x5a710a(0xa4)+_0x5a710a(0xc0)+_0x5a710a(0xa5),await(0x0,SendPresenceStatus_1[_0x5a710a(0xd2)])((0x0,wbot_1[_0x5a710a(0xd6)])(_0x4a4fb0[_0x5a710a(0xdd)]),_0x4a4fb0[_0x5a710a(0xc7)]['number']+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf))),await(0x0,SendWhatsAppMessage_1[_0x5a710a(0x8c)])({'body':_0x3d9bb9,'ticket':_0x4a4fb0}),await _0x414de5['update']({'rated':![],'ratingAt':(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0x8b)]()}),await _0x4a4fb0[_0x5a710a(0x7a)]({'amountUsedBotQueues':_0x49e52f[_0x5a710a(0xcd)]||0x0,'status':_0xf91b72,'unreadMessages':_0x49e52f[_0x5a710a(0xd8)]||0x0,'queueId':_0x116ea3,'userId':_0x1671fd,'whatsappId':_0xf982a3,'chatbot':_0x2a59e7,'queueOptionId':_0x3bdd73}),_0x3de9a0['to'](_0x5a710a(0xc2)+_0x4a4fb0[_0x5a710a(0xc6)]+_0x5a710a(0xa6))['to'](_0x542069[_0x5a710a(0xb9)]())[_0x5a710a(0xd9)](_0x5a710a(0xc2)+_0x4a4fb0['companyId']+'-ticket',{'action':'delete','ticketId':_0x4a4fb0['id']}),{'ticket':_0x4a4fb0,'oldStatus':_0x14f108,'oldUserId':_0x1ffc24};}_0x414de5[_0x5a710a(0xad)]=(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0x8b)](),_0x414de5[_0x5a710a(0xb1)]=![];}if(completionMessageControl['length']>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1[_0x5a710a(0x80)])(_0x1c95c0)&&_0x1c95c0!==''&&_0x5b801d&&!_0x4a4fb0['isGroup']){let _0x646de3=completionMessageControl['find'](_0x3b5f55=>_0x3b5f55[_0x5a710a(0x9b)]===_0x4a4fb0['id']||_0x3b5f55['dest']===_0x4a4fb0[_0x5a710a(0xc7)]['number']);if(!_0x646de3||_0x646de3&&_0x646de3[_0x5a710a(0xb8)]+0x3e8*0x3c*0x1e<new Date()[_0x5a710a(0xb7)]()){_0x646de3&&(completionMessageControl=completionMessageControl['filter'](_0x34daee=>_0x34daee['ticketId']!==_0x4a4fb0['id']),_0x646de3=null);if(!_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0x92)]&&!(0x0,lodash_1['isNil'])(_0x1c95c0)&&_0x1c95c0!==''){const _0x47acd7='‎'+_0x1c95c0;await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1[_0x5a710a(0xd6)])(_0x4a4fb0[_0x5a710a(0xdd)]),_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?'g.us':_0x5a710a(0xaf))),await(0x0,SendWhatsAppMessage_1[_0x5a710a(0x8c)])({'body':_0x47acd7,'ticket':_0x4a4fb0});}}!_0x646de3&&completionMessageControl[_0x5a710a(0x78)]({'ticketId':_0x4a4fb0['id'],'dest':_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)],'time':new Date()[_0x5a710a(0xb7)]()});}await _0x4a4fb0['update']({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x414de5[_0x5a710a(0xe8)]=(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0x8b)](),_0x414de5[_0x5a710a(0xdd)]=_0x4a4fb0[_0x5a710a(0xdd)],_0x414de5[_0x5a710a(0x98)]=_0x4a4fb0[_0x5a710a(0x98)];}_0x116ea3!==undefined&&_0x116ea3!==null&&(_0x414de5['queuedAt']=(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0x8b)]());const _0x22dcec=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x415f99,'key':_0x5a710a(0xac)}),_0x31b6c5=await Queue_1['default'][_0x5a710a(0x9e)](_0x116ea3);if(_0x22dcec?.[_0x5a710a(0x77)]===_0x5a710a(0xb5)){if(_0x307769!==_0x116ea3&&_0x1ffc24===_0x1671fd&&!(0x0,lodash_1['isNil'])(_0x307769)&&!(0x0,lodash_1['isNil'])(_0x116ea3)){const _0x25b0c2=await(0x0,GetTicketWbot_1[_0x5a710a(0x8c)])(_0x4a4fb0),_0x458dac=_0x5a710a(0x81)+_0x31b6c5?.[_0x5a710a(0xbb)]+_0x5a710a(0x87);await(0x0,SendPresenceStatus_1[_0x5a710a(0xd2)])(_0x25b0c2,_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0['isGroup']?'g.us':_0x5a710a(0xaf)));const _0x599544=await _0x25b0c2[_0x5a710a(0xde)](_0x4a4fb0[_0x5a710a(0xc7)]['number']+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf)),{'text':_0x458dac});await(0x0,wbotMessageListener_1[_0x5a710a(0xaa)])(_0x599544,_0x4a4fb0,_0x4a4fb0[_0x5a710a(0xc7)]);}else{if(_0x1ffc24!==_0x1671fd&&_0x307769===_0x116ea3&&!(0x0,lodash_1[_0x5a710a(0x80)])(_0x1ffc24)&&!(0x0,lodash_1['isNil'])(_0x1671fd)){const _0x15085b=await(0x0,GetTicketWbot_1[_0x5a710a(0x8c)])(_0x4a4fb0),_0x543b84=await(0x0,ShowUserService_1[_0x5a710a(0x8c)])(_0x49e52f['userId']),_0x158147=_0x5a710a(0xd4)+_0x543b84['name']+_0x5a710a(0xe6)+_0x28c95b[_0x5a710a(0xea)]+_0x5a710a(0x9a)+(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0xa3)](_0x5a710a(0xbd))+_0x5a710a(0x86);await(0x0,SendPresenceStatus_1[_0x5a710a(0xd2)])(_0x15085b,_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf)));const _0x6a5327=await _0x15085b['sendMessage'](_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf)),{'text':_0x158147});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x6a5327,_0x4a4fb0,_0x4a4fb0[_0x5a710a(0xc7)]);}else{if(_0x1ffc24!==_0x1671fd&&!(0x0,lodash_1[_0x5a710a(0x80)])(_0x1ffc24)&&!(0x0,lodash_1[_0x5a710a(0x80)])(_0x1671fd)&&_0x307769!==_0x116ea3&&!(0x0,lodash_1[_0x5a710a(0x80)])(_0x307769)&&!(0x0,lodash_1[_0x5a710a(0x80)])(_0x116ea3)){const _0x347b4f=await(0x0,GetTicketWbot_1[_0x5a710a(0x8c)])(_0x4a4fb0),_0x2babd7=await(0x0,ShowUserService_1['default'])(_0x49e52f[_0x5a710a(0x98)]),_0xb66ce7=await(0x0,ShowUserService_1[_0x5a710a(0x8c)])(_0x1ffc24),_0x48d6f6=_0x5a710a(0x81)+_0x31b6c5?.[_0x5a710a(0xbb)]+'*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*'+_0x2babd7[_0x5a710a(0xbb)]+_0x5a710a(0x7d)+_0x28c95b[_0x5a710a(0xea)]+_0x5a710a(0x9a)+(0x0,moment_1[_0x5a710a(0x8c)])()['format'](_0x5a710a(0xbd))+_0x5a710a(0xcf);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x347b4f,_0x4a4fb0[_0x5a710a(0xc7)]['number']+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf)));const _0x92930=await _0x347b4f[_0x5a710a(0xde)](_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf)),{'text':_0x48d6f6});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x92930,_0x4a4fb0,_0x4a4fb0[_0x5a710a(0xc7)]);const _0x565234=await(0x0,ShowUserService_1[_0x5a710a(0x8c)])(_0x1671fd),_0x27214e=_0x5a710a(0x7e)+_0xb66ce7[_0x5a710a(0xbb)]+_0x5a710a(0xc4)+_0x2babd7['name']+'*,\x20em\x20'+(0x0,moment_1[_0x5a710a(0x8c)])()['format'](_0x5a710a(0xbd))+_0x5a710a(0xcf);await(0x0,SendPresenceStatus_1[_0x5a710a(0xd2)])(_0x347b4f,_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0['isGroup']?'g.us':_0x5a710a(0xaf)));const _0x225c53=await _0x347b4f['sendMessage'](_0x4a4fb0['contact'][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?_0x5a710a(0xd5):_0x5a710a(0xaf)),{'text':_0x27214e});await(0x0,wbotMessageListener_1[_0x5a710a(0xaa)])(_0x225c53,_0x4a4fb0,_0x4a4fb0[_0x5a710a(0xc7)]);}else{if(_0x1ffc24!==undefined&&(0x0,lodash_1[_0x5a710a(0x80)])(_0x1671fd)&&_0x307769!==_0x116ea3&&!(0x0,lodash_1[_0x5a710a(0x80)])(_0x116ea3)){const _0x4a98d5=await(0x0,GetTicketWbot_1['default'])(_0x4a4fb0),_0x112974=_0x5a710a(0x81)+_0x31b6c5?.[_0x5a710a(0xbb)]+_0x5a710a(0x87);await(0x0,SendPresenceStatus_1[_0x5a710a(0xd2)])(_0x4a98d5,_0x4a4fb0[_0x5a710a(0xc7)][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0['isGroup']?_0x5a710a(0xd5):_0x5a710a(0xaf)));const _0x1d4cbb=await _0x4a98d5[_0x5a710a(0xde)](_0x4a4fb0['contact'][_0x5a710a(0xe1)]+'@'+(_0x4a4fb0[_0x5a710a(0xb0)]?'g.us':_0x5a710a(0xaf)),{'text':_0x112974});await(0x0,wbotMessageListener_1[_0x5a710a(0xaa)])(_0x1d4cbb,_0x4a4fb0,_0x4a4fb0[_0x5a710a(0xc7)]);}}}}}var _0x1f9cba=_0x307769!==_0x116ea3;return _0x31b6c5&&(_0x1f9cba&&_0x31b6c5['newTicketOnTransfer']&&(_0xf91b72='closed')),await _0x4a4fb0[_0x5a710a(0x7a)]({'amountUsedBotQueues':_0x49e52f[_0x5a710a(0xcd)]||0x0,'status':_0xf91b72,'unreadMessages':_0x49e52f[_0x5a710a(0xd8)]||0x0,'queueId':_0x116ea3,'userId':_0x1671fd,'whatsappId':_0xf982a3,'chatbot':_0x2a59e7,'queueOptionId':_0x3bdd73}),await _0x4a4fb0['reload'](),_0x31b6c5&&_0x1f9cba&&_0x31b6c5['newTicketOnTransfer']&&!_0x4a4fb0['chatbot']&&!_0x4a4fb0[_0x5a710a(0xba)]&&(_0x3de9a0['to'](_0x5a710a(0xc2)+_0x4a4fb0[_0x5a710a(0xc6)]+'-'+_0x14f108)['to'](_0x5a710a(0xae)+_0x4a4fb0[_0x5a710a(0x7c)]+'-'+_0x14f108)['emit'](_0x5a710a(0xc2)+_0x415f99+'-ticket',{'action':_0x5a710a(0xee),'ticketId':_0x4a4fb0['id']}),_0x3de9a0['to']('company-'+_0x4a4fb0[_0x5a710a(0xc6)]+'-'+_0x4a4fb0[_0x5a710a(0x94)])['to'](_0x5a710a(0xc2)+_0x4a4fb0[_0x5a710a(0xc6)]+_0x5a710a(0x8a))['to'](_0x5a710a(0xae)+_0x4a4fb0[_0x5a710a(0x7c)]+'-notification')['to'](_0x5a710a(0xae)+_0x4a4fb0[_0x5a710a(0x7c)]+'-'+_0x4a4fb0[_0x5a710a(0x94)])['to'](_0x542069[_0x5a710a(0xb9)]())[_0x5a710a(0xd9)](_0x5a710a(0xc2)+_0x415f99+'-ticket',{'action':_0x5a710a(0x7a),'ticket':_0x4a4fb0}),_0x4a4fb0=await Ticket_1[_0x5a710a(0x8c)][_0x5a710a(0x8f)]({'companyId':_0x415f99,'contactId':_0x4a4fb0[_0x5a710a(0xcb)],'userId':_0x1671fd,'queueId':_0x116ea3,'status':_0x5a710a(0x96),'whatsappId':_0x4a4fb0[_0x5a710a(0xdd)],'chatbot':_0x2a59e7,'queueOptionId':_0x3bdd73,'promptId':_0x3ac96d,'useIntegration':_0x3acb99,'integrationId':_0x5a21de,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0xf91b72=_0x4a4fb0[_0x5a710a(0x94)],_0xf91b72===_0x5a710a(0x96)&&(_0x414de5[_0x5a710a(0x7a)]({'whatsappId':_0xf982a3,'queuedAt':(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0x8b)](),'startedAt':null,'userId':null}),_0x3de9a0['to']('company-'+_0x415f99+_0x5a710a(0x93))[_0x5a710a(0xd9)](_0x5a710a(0xc2)+_0x415f99+_0x5a710a(0xeb),{'action':'removeFromList','ticketId':_0x4a4fb0?.['id']})),_0xf91b72===_0x5a710a(0xd3)&&(_0x414de5['update']({'startedAt':(0x0,moment_1[_0x5a710a(0x8c)])()[_0x5a710a(0x8b)](),'ratingAt':null,'rated':![],'whatsappId':_0xf982a3,'userId':_0x4a4fb0[_0x5a710a(0x98)]}),_0x3de9a0['to'](_0x5a710a(0xc2)+_0x415f99+_0x5a710a(0x93))['emit'](_0x5a710a(0xc2)+_0x415f99+_0x5a710a(0xeb),{'action':_0x5a710a(0xb2),'ticketId':_0x4a4fb0?.['id']}),_0x3de9a0['to'](_0x5a710a(0xc2)+_0x415f99+'-mainchannel')[_0x5a710a(0xd9)](_0x5a710a(0xc2)+_0x415f99+'-ticket',{'action':_0x5a710a(0x82),'ticketId':_0x4a4fb0?.['id']})),await _0x414de5[_0x5a710a(0x9c)](),(_0x4a4fb0[_0x5a710a(0x94)]!==_0x14f108||_0x4a4fb0[_0x5a710a(0xcc)]?.['id']!==_0x1ffc24||_0x1f9cba)&&_0x3de9a0['to'](_0x5a710a(0xc2)+_0x4a4fb0[_0x5a710a(0xc6)]+'-'+_0x14f108)['to'](_0x5a710a(0xae)+_0x4a4fb0[_0x5a710a(0x7c)]+'-'+_0x14f108)['to']('company-'+_0x4a4fb0['companyId']+_0x5a710a(0x8a))['to'](_0x5a710a(0xae)+_0x4a4fb0[_0x5a710a(0x7c)]+_0x5a710a(0x8a))['to'](_0x542069[_0x5a710a(0xb9)]())[_0x5a710a(0xd9)](_0x5a710a(0xc2)+_0x415f99+'-ticket',{'action':'delete','ticketId':_0x4a4fb0['id']}),_0x4a4fb0[_0x5a710a(0x94)]!==_0x5a710a(0xda)&&_0x3de9a0['to'](_0x5a710a(0xc2)+_0x4a4fb0[_0x5a710a(0xc6)]+'-'+_0x4a4fb0[_0x5a710a(0x94)])['to']('company-'+_0x4a4fb0[_0x5a710a(0xc6)]+_0x5a710a(0x8a))['to'](_0x5a710a(0xae)+_0x4a4fb0[_0x5a710a(0x7c)]+_0x5a710a(0x8a))['to']('queue-'+_0x4a4fb0[_0x5a710a(0x7c)]+'-'+_0x4a4fb0['status'])['to'](_0x542069['toString']())[_0x5a710a(0xd9)](_0x5a710a(0xc2)+_0x415f99+'-ticket',{'action':_0x5a710a(0x7a),'ticket':_0x4a4fb0}),{'ticket':_0x4a4fb0,'oldStatus':_0x14f108,'oldUserId':_0x1ffc24};}catch(_0x42fce1){console[_0x5a710a(0xab)](_0x42fce1),Sentry[_0x5a710a(0x7f)](_0x42fce1);}};exports[a528_0x31148f(0x8c)]=UpdateTicketService;const notifyUpdate=(_0x1461b4,_0x48e121,_0xb66937,_0x263ca6)=>{const _0x32e91c=a528_0x31148f;_0x1461b4['to'](_0x32e91c(0xc2)+_0x48e121[_0x32e91c(0xc6)]+'-'+_0x48e121[_0x32e91c(0x94)])['to'](_0x32e91c(0xc2)+_0x48e121[_0x32e91c(0xc6)]+_0x32e91c(0x8a))['to'](_0xb66937[_0x32e91c(0xb9)]())['emit'](_0x32e91c(0xc2)+_0x263ca6+'-ticket',{'action':_0x32e91c(0x7a),'ticket':_0x48e121});};function a528_0x4dfb(_0x15d9a6,_0x239b65){const _0x49c594=a528_0x59e7();return a528_0x4dfb=function(_0x5a7b63,_0xb51f4d){_0x5a7b63=_0x5a7b63-0x77;let _0x59e74d=_0x49c594[_0x5a7b63];return _0x59e74d;},a528_0x4dfb(_0x15d9a6,_0x239b65);}exports[a528_0x31148f(0xe0)]=notifyUpdate;