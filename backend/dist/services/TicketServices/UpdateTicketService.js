const a528_0x316e68=a528_0x3a5e;(function(_0x5e0b0e,_0x506854){const _0x3be903=a528_0x3a5e,_0x2b618d=_0x5e0b0e();while(!![]){try{const _0x554a56=parseInt(_0x3be903(0x1a8))/0x1+-parseInt(_0x3be903(0x171))/0x2+-parseInt(_0x3be903(0x1b9))/0x3*(-parseInt(_0x3be903(0x1b1))/0x4)+parseInt(_0x3be903(0x14f))/0x5*(parseInt(_0x3be903(0x179))/0x6)+parseInt(_0x3be903(0x17b))/0x7+parseInt(_0x3be903(0x173))/0x8+-parseInt(_0x3be903(0x167))/0x9;if(_0x554a56===_0x506854)break;else _0x2b618d['push'](_0x2b618d['shift']());}catch(_0xa31958){_0x2b618d['push'](_0x2b618d['shift']());}}}(a528_0xf021,0x6b0c3));const a528_0x5848c4=(function(){let _0x54a117=!![];return function(_0x524b99,_0x5684ae){const _0x2eca5e=_0x54a117?function(){const _0x41daec=a528_0x3a5e;if(_0x5684ae){const _0x5339ca=_0x5684ae[_0x41daec(0x19c)](_0x524b99,arguments);return _0x5684ae=null,_0x5339ca;}}:function(){};return _0x54a117=![],_0x2eca5e;};}()),a528_0x475dae=a528_0x5848c4(this,function(){const _0x16eb42=a528_0x3a5e;return a528_0x475dae['toString']()[_0x16eb42(0x162)](_0x16eb42(0x183))[_0x16eb42(0x185)]()[_0x16eb42(0x190)](a528_0x475dae)[_0x16eb42(0x162)](_0x16eb42(0x183));});a528_0x475dae();function a528_0x3a5e(_0x4bb772,_0x13c91c){const _0x1ae97f=a528_0xf021();return a528_0x3a5e=function(_0x475dae,_0x5848c4){_0x475dae=_0x475dae-0x14b;let _0xf0211=_0x1ae97f[_0x475dae];return _0xf0211;},a528_0x3a5e(_0x4bb772,_0x13c91c);}'use strict';var __createBinding=this&&this[a528_0x316e68(0x18a)]||(Object[a528_0x316e68(0x15f)]?function(_0x18ac83,_0x44aefa,_0x2ad6cc,_0x18f2ea){const _0x1ec2e8=a528_0x316e68;if(_0x18f2ea===undefined)_0x18f2ea=_0x2ad6cc;var _0x4f3d67=Object[_0x1ec2e8(0x182)](_0x44aefa,_0x2ad6cc);(!_0x4f3d67||(_0x1ec2e8(0x19e)in _0x4f3d67?!_0x44aefa[_0x1ec2e8(0x153)]:_0x4f3d67[_0x1ec2e8(0x17a)]||_0x4f3d67[_0x1ec2e8(0x169)]))&&(_0x4f3d67={'enumerable':!![],'get':function(){return _0x44aefa[_0x2ad6cc];}}),Object[_0x1ec2e8(0x177)](_0x18ac83,_0x18f2ea,_0x4f3d67);}:function(_0x348620,_0x1bf467,_0x4667f0,_0x3e1869){if(_0x3e1869===undefined)_0x3e1869=_0x4667f0;_0x348620[_0x3e1869]=_0x1bf467[_0x4667f0];}),__setModuleDefault=this&&this[a528_0x316e68(0x17e)]||(Object['create']?function(_0x4949bf,_0x48b0ea){const _0x39583e=a528_0x316e68;Object[_0x39583e(0x177)](_0x4949bf,_0x39583e(0x14e),{'enumerable':!![],'value':_0x48b0ea});}:function(_0x4e15ef,_0x545eff){const _0x2f8158=a528_0x316e68;_0x4e15ef[_0x2f8158(0x14e)]=_0x545eff;}),__importStar=this&&this[a528_0x316e68(0x1b3)]||function(_0x23336c){const _0x436006=a528_0x316e68;if(_0x23336c&&_0x23336c[_0x436006(0x153)])return _0x23336c;var _0x11331c={};if(_0x23336c!=null){for(var _0x105d4a in _0x23336c)if(_0x105d4a!==_0x436006(0x14e)&&Object[_0x436006(0x17c)][_0x436006(0x151)][_0x436006(0x181)](_0x23336c,_0x105d4a))__createBinding(_0x11331c,_0x23336c,_0x105d4a);}return __setModuleDefault(_0x11331c,_0x23336c),_0x11331c;},__importDefault=this&&this[a528_0x316e68(0x1ac)]||function(_0x3bcbb4){return _0x3bcbb4&&_0x3bcbb4['__esModule']?_0x3bcbb4:{'default':_0x3bcbb4};};function a528_0xf021(){const _0x39cfd1=['company-','__importDefault','SendPresenceStatus','*4*\x20-\x20_Satisfeito_\x0a','*,\x20em\x20','-mainchannel','2049928qLEcMo','profile','__importStar','integrationId','updateUnread','chatbot','../UserServices/ShowUserService','push','3LFCTRQ','*1*\x20-\x20_Muito\x20Insatisfeito_\x0a','name','delete','./FindOrCreateATicketTrakingService','queue-','\x20em\x20','contact','g.us','*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*','sendMsgTransfTicket','trace','emit','default','40surDYG','user','hasOwnProperty','length','__esModule','userId','amountUsedBotQueues','pending','*\x20e\x20contará\x20com\x20a\x20presença\x20de\x20*','*\x20por\x20','*3*\x20-\x20_Moderadamente\x20Satisfeito_\x0a','disableBot','../../helpers/GetTicketWbot','reload','find','removeFromList','create','finishedAt','rated','search','isNil','open','isGroup','verifyMessage','13109706qbOJJr','\x0aAguarde,\x20já\x20vamos\x20te\x20atender!','configurable','*\x20transferiu\x20o\x20ticket\x20para\x20você,\x20*','save','\x0aaguarde,\x20já\x20vamos\x20te\x20atender!','number','s.whatsapp.net','toDate','unreadMessages','1187606kEAAFj','getIO','5029800UdmZxk','ratingAt','../../helpers/SendPresenceStatus','*\x20transferido\x20por\x20','defineProperty','companyId','89634jGQvck','writable','6136823RbXWba','prototype','../../libs/wbot','__setModuleDefault','queueId','*2*\x20-\x20_Insatisfeito_\x0a','call','getOwnPropertyDescriptor','(((.+)+)+)+$','status','toString','-notification','queueOptionId','closed','findByPk','__createBinding','../../libs/socket','../../helpers/CheckContactOpenTickets','notifyUpdate','whatsappId','../WhatsappService/ShowWhatsAppService','constructor','./ShowTicketService','username','newTicketOnTransfer','useIntegration','value','format','../../models/Setting','*Mensagem\x20automática*:\x0aO\x20atendente\x20anterior\x20*','../SettingServices/ListSettingsServiceOne','ticketId','lodash','apply','update','get','Need\x20companyId\x20or\x20tokenData','-ticket','DD/MM/YYYY\x20HH:mm:ss','sendMessage','queuedAt','getWbot','enabled','time','../WbotServices/wbotMessageListener','351496Tparjt','contactId','userRating'];a528_0xf021=function(){return _0x39cfd1;};return a528_0xf021();}Object[a528_0x316e68(0x177)](exports,a528_0x316e68(0x153),{'value':!![]}),exports[a528_0x316e68(0x18d)]=void 0x0;const moment_1=__importDefault(require('moment')),Sentry=__importStar(require('@sentry/node')),CheckContactOpenTickets_1=__importDefault(require(a528_0x316e68(0x18c))),SetTicketMessagesAsRead_1=__importDefault(require('../../helpers/SetTicketMessagesAsRead')),socket_1=require(a528_0x316e68(0x18b)),Ticket_1=__importDefault(require('../../models/Ticket')),Setting_1=__importDefault(require(a528_0x316e68(0x197))),Queue_1=__importDefault(require('../../models/Queue')),ShowTicketService_1=__importDefault(require(a528_0x316e68(0x191))),ShowWhatsAppService_1=__importDefault(require(a528_0x316e68(0x18f))),SendWhatsAppMessage_1=__importDefault(require('../WbotServices/SendWhatsAppMessage')),FindOrCreateATicketTrakingService_1=__importDefault(require(a528_0x316e68(0x1bd))),GetTicketWbot_1=__importDefault(require(a528_0x316e68(0x15b))),wbotMessageListener_1=require(a528_0x316e68(0x1a7)),ListSettingsServiceOne_1=__importDefault(require(a528_0x316e68(0x199))),ShowUserService_1=__importDefault(require(a528_0x316e68(0x1b7))),lodash_1=require(a528_0x316e68(0x19b)),AppError_1=__importDefault(require('../../errors/AppError')),SendPresenceStatus_1=require(a528_0x316e68(0x175)),wbot_1=require(a528_0x316e68(0x17d));let completionMessageControl=[];const UpdateTicketService=async({ticketData:_0x384dc4,ticketId:_0x4c5007,tokenData:_0x436219,companyId:_0x41dda2})=>{const _0x29750b=a528_0x316e68;try{if(!_0x41dda2&&!_0x436219)throw new Error(_0x29750b(0x19f));_0x436219&&(_0x41dda2=_0x436219[_0x29750b(0x178)]);let {status:_0x2cd55c}=_0x384dc4,{queueId:_0x5a2015,userId:_0x2d673b,whatsappId:_0xa67b6d,sendFarewellMessage:_0x1e49cd}=_0x384dc4;_0x1e49cd==null&&(_0x1e49cd=!![]);let _0x126f44=_0x384dc4[_0x29750b(0x1b6)]||![],_0x4311c3=_0x384dc4[_0x29750b(0x187)]||null,_0x418897=_0x384dc4['promptId']||null,_0x159ac2=_0x384dc4[_0x29750b(0x194)]||![],_0x33a2b9=_0x384dc4[_0x29750b(0x1b4)]||null;const _0x213f59=(0x0,socket_1[_0x29750b(0x172)])(),_0x56c454=_0x29750b(0x1aa),_0x2ecacc=await Setting_1[_0x29750b(0x14e)]['findOne']({'where':{'companyId':_0x41dda2,'key':_0x56c454}});let _0x7091ba=await(0x0,ShowTicketService_1[_0x29750b(0x14e)])(_0x4c5007,_0x41dda2);if(_0x436219&&_0x7091ba[_0x29750b(0x184)]!==_0x29750b(0x156)){if(_0x436219[_0x29750b(0x1b2)]!=='admin'&&_0x7091ba['userId']!==parseInt(_0x436219['id'],0xa))throw new AppError_1[(_0x29750b(0x14e))]('Apenas\x20o\x20usuário\x20ativo\x20do\x20ticket\x20ou\x20o\x20Admin\x20podem\x20fazer\x20alterações\x20no\x20ticket');}const _0x3571a2=await(0x0,FindOrCreateATicketTrakingService_1[_0x29750b(0x14e)])({'ticketId':_0x4c5007,'companyId':_0x41dda2,'whatsappId':_0x7091ba['whatsappId']});(0x0,lodash_1[_0x29750b(0x163)])(_0xa67b6d)&&(_0xa67b6d=_0x7091ba[_0x29750b(0x18e)]['toString']());(_0x2cd55c===_0x29750b(0x188)||_0x2cd55c===_0x29750b(0x164))&&await(0x0,SetTicketMessagesAsRead_1['default'])(_0x7091ba);const _0x53e1e2=_0x7091ba[_0x29750b(0x184)],_0x442eb4=_0x7091ba[_0x29750b(0x150)]?.['id'],_0x3d32a8=_0x7091ba['queueId'];(_0x53e1e2===_0x29750b(0x188)||_0xa67b6d!==undefined&&Number(_0xa67b6d)!==_0x7091ba[_0x29750b(0x18e)])&&(await(0x0,CheckContactOpenTickets_1[_0x29750b(0x14e)])(_0x7091ba['contact']['id'],_0xa67b6d),_0x126f44=null,_0x4311c3=null);if(_0x2cd55c===_0x29750b(0x188)){const {complationMessage:_0x1239df,ratingMessage:_0x560750}=await(0x0,ShowWhatsAppService_1[_0x29750b(0x14e)])(_0x7091ba[_0x29750b(0x18e)],_0x41dda2);if(!_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x15a)]&&_0x2ecacc?.['value']===_0x29750b(0x1a5)&&_0x1e49cd&&!_0x7091ba[_0x29750b(0x165)]){if(_0x3571a2[_0x29750b(0x174)]==null&&!_0x7091ba[_0x29750b(0x165)]){const _0x474c64=_0x560750||'';let _0x438f6a='‎'+_0x474c64+'\x0a\x0a';return _0x438f6a+='Digite\x20de\x201\x20à\x205\x20para\x20qualificar\x20nosso\x20atendimento:\x0a'+_0x29750b(0x1ba)+_0x29750b(0x180)+_0x29750b(0x159)+_0x29750b(0x1ae)+'*5*\x20-\x20_Muito\x20Satisfeito_\x0a',await(0x0,SendPresenceStatus_1[_0x29750b(0x1ad)])((0x0,wbot_1[_0x29750b(0x1a4)])(_0x7091ba[_0x29750b(0x18e)]),_0x7091ba[_0x29750b(0x1c0)]['number']+'@'+(_0x7091ba['isGroup']?_0x29750b(0x1c1):_0x29750b(0x16e))),await(0x0,SendWhatsAppMessage_1[_0x29750b(0x14e)])({'body':_0x438f6a,'ticket':_0x7091ba}),await _0x3571a2[_0x29750b(0x19d)]({'rated':![],'ratingAt':(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x16f)]()}),await _0x7091ba[_0x29750b(0x19d)]({'amountUsedBotQueues':_0x384dc4['amountUsedBotQueues']||0x0,'status':_0x2cd55c,'unreadMessages':_0x384dc4[_0x29750b(0x170)]||0x0,'queueId':_0x5a2015,'userId':_0x2d673b,'whatsappId':_0xa67b6d,'chatbot':_0x126f44,'queueOptionId':_0x4311c3}),_0x213f59['to'](_0x29750b(0x1ab)+_0x7091ba[_0x29750b(0x178)]+'-open')['to'](_0x4c5007[_0x29750b(0x185)]())[_0x29750b(0x14d)](_0x29750b(0x1ab)+_0x7091ba['companyId']+_0x29750b(0x1a0),{'action':'delete','ticketId':_0x7091ba['id']}),{'ticket':_0x7091ba,'oldStatus':_0x53e1e2,'oldUserId':_0x442eb4};}_0x3571a2[_0x29750b(0x174)]=(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x16f)](),_0x3571a2[_0x29750b(0x161)]=![];}if(completionMessageControl[_0x29750b(0x152)]>=0x9c4)completionMessageControl=[];if(!(0x0,lodash_1['isNil'])(_0x1239df)&&_0x1239df!==''&&_0x1e49cd&&!_0x7091ba['isGroup']){let _0x106ab8=completionMessageControl[_0x29750b(0x15d)](_0xb55202=>_0xb55202[_0x29750b(0x19a)]===_0x7091ba['id']||_0xb55202['dest']===_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]);if(!_0x106ab8||_0x106ab8&&_0x106ab8[_0x29750b(0x1a6)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x106ab8&&(completionMessageControl=completionMessageControl['filter'](_0x32b44e=>_0x32b44e[_0x29750b(0x19a)]!==_0x7091ba['id']),_0x106ab8=null);if(!_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x15a)]&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x1239df)&&_0x1239df!==''){const _0x3f84b4='‎'+_0x1239df;await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1[_0x29750b(0x1a4)])(_0x7091ba[_0x29750b(0x18e)]),_0x7091ba[_0x29750b(0x1c0)]['number']+'@'+(_0x7091ba['isGroup']?_0x29750b(0x1c1):_0x29750b(0x16e))),await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x3f84b4,'ticket':_0x7091ba});}}!_0x106ab8&&completionMessageControl[_0x29750b(0x1b8)]({'ticketId':_0x7091ba['id'],'dest':_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)],'time':new Date()['getTime']()});}await _0x7091ba[_0x29750b(0x19d)]({'promptId':null,'integrationId':null,'useIntegration':![],'typebotStatus':![],'typebotSessionId':null}),_0x3571a2[_0x29750b(0x160)]=(0x0,moment_1['default'])()[_0x29750b(0x16f)](),_0x3571a2['whatsappId']=_0x7091ba[_0x29750b(0x18e)],_0x3571a2[_0x29750b(0x154)]=_0x7091ba['userId'];}_0x5a2015!==undefined&&_0x5a2015!==null&&(_0x3571a2[_0x29750b(0x1a3)]=(0x0,moment_1['default'])()['toDate']());const _0x142433=await(0x0,ListSettingsServiceOne_1['default'])({'companyId':_0x41dda2,'key':_0x29750b(0x14b)}),_0xdd76b1=await Queue_1[_0x29750b(0x14e)][_0x29750b(0x189)](_0x5a2015);if(_0x142433?.[_0x29750b(0x195)]===_0x29750b(0x1a5)){if(_0x3d32a8!==_0x5a2015&&_0x442eb4===_0x2d673b&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x3d32a8)&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x5a2015)){const _0x2be5dc=await(0x0,GetTicketWbot_1['default'])(_0x7091ba),_0x4498c3='*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*'+_0xdd76b1?.[_0x29750b(0x1bb)]+'*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x2be5dc,_0x7091ba['contact'][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?_0x29750b(0x1c1):'s.whatsapp.net'));const _0x3d6911=await _0x2be5dc[_0x29750b(0x1a2)](_0x7091ba['contact']['number']+'@'+(_0x7091ba[_0x29750b(0x165)]?_0x29750b(0x1c1):_0x29750b(0x16e)),{'text':_0x4498c3});await(0x0,wbotMessageListener_1[_0x29750b(0x166)])(_0x3d6911,_0x7091ba,_0x7091ba[_0x29750b(0x1c0)]);}else{if(_0x442eb4!==_0x2d673b&&_0x3d32a8===_0x5a2015&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x442eb4)&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x2d673b)){const _0x1b5e5e=await(0x0,GetTicketWbot_1[_0x29750b(0x14e)])(_0x7091ba),_0x376221=await(0x0,ShowUserService_1[_0x29750b(0x14e)])(_0x384dc4['userId']),_0x27efa0='*Mensagem\x20automática*:\x0aFoi\x20transferido\x20para\x20o\x20atendente\x20*'+_0x376221[_0x29750b(0x1bb)]+_0x29750b(0x158)+_0x436219[_0x29750b(0x192)]+_0x29750b(0x1bf)+(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x196)](_0x29750b(0x1a1))+_0x29750b(0x168);await(0x0,SendPresenceStatus_1[_0x29750b(0x1ad)])(_0x1b5e5e,_0x7091ba['contact']['number']+'@'+(_0x7091ba[_0x29750b(0x165)]?'g.us':_0x29750b(0x16e)));const _0x28dd12=await _0x1b5e5e['sendMessage'](_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?_0x29750b(0x1c1):_0x29750b(0x16e)),{'text':_0x27efa0});await(0x0,wbotMessageListener_1[_0x29750b(0x166)])(_0x28dd12,_0x7091ba,_0x7091ba['contact']);}else{if(_0x442eb4!==_0x2d673b&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x442eb4)&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x2d673b)&&_0x3d32a8!==_0x5a2015&&!(0x0,lodash_1[_0x29750b(0x163)])(_0x3d32a8)&&!(0x0,lodash_1['isNil'])(_0x5a2015)){const _0x587dcf=await(0x0,GetTicketWbot_1[_0x29750b(0x14e)])(_0x7091ba),_0x40d935=await(0x0,ShowUserService_1[_0x29750b(0x14e)])(_0x384dc4[_0x29750b(0x154)]),_0x6c29a5=await(0x0,ShowUserService_1[_0x29750b(0x14e)])(_0x442eb4),_0x42f5e2='*Mensagem\x20automática*:\x0aVocê\x20foi\x20transferido\x20para\x20o\x20departamento\x20*'+_0xdd76b1?.[_0x29750b(0x1bb)]+_0x29750b(0x157)+_0x40d935['name']+_0x29750b(0x176)+_0x436219[_0x29750b(0x192)]+_0x29750b(0x1bf)+(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x196)]('DD/MM/YYYY\x20HH:mm:ss')+_0x29750b(0x16c);await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x587dcf,_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?_0x29750b(0x1c1):_0x29750b(0x16e)));const _0x245b31=await _0x587dcf[_0x29750b(0x1a2)](_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?_0x29750b(0x1c1):_0x29750b(0x16e)),{'text':_0x42f5e2});await(0x0,wbotMessageListener_1[_0x29750b(0x166)])(_0x245b31,_0x7091ba,_0x7091ba[_0x29750b(0x1c0)]);const _0x49e0c9=await(0x0,ShowUserService_1[_0x29750b(0x14e)])(_0x2d673b),_0x2c7c93=_0x29750b(0x198)+_0x6c29a5[_0x29750b(0x1bb)]+_0x29750b(0x16a)+_0x40d935[_0x29750b(0x1bb)]+_0x29750b(0x1af)+(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x196)]('DD/MM/YYYY\x20HH:mm:ss')+_0x29750b(0x16c);await(0x0,SendPresenceStatus_1[_0x29750b(0x1ad)])(_0x587dcf,_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?'g.us':_0x29750b(0x16e)));const _0x1525ff=await _0x587dcf[_0x29750b(0x1a2)](_0x7091ba['contact'][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?_0x29750b(0x1c1):'s.whatsapp.net'),{'text':_0x2c7c93});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x1525ff,_0x7091ba,_0x7091ba[_0x29750b(0x1c0)]);}else{if(_0x442eb4!==undefined&&(0x0,lodash_1[_0x29750b(0x163)])(_0x2d673b)&&_0x3d32a8!==_0x5a2015&&!(0x0,lodash_1['isNil'])(_0x5a2015)){const _0x4310ac=await(0x0,GetTicketWbot_1[_0x29750b(0x14e)])(_0x7091ba),_0x3e49a8=_0x29750b(0x1c2)+_0xdd76b1?.[_0x29750b(0x1bb)]+'*\x0aaguarde,\x20já\x20vamos\x20te\x20atender!';await(0x0,SendPresenceStatus_1[_0x29750b(0x1ad)])(_0x4310ac,_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]+'@'+(_0x7091ba[_0x29750b(0x165)]?'g.us':'s.whatsapp.net'));const _0xdddde3=await _0x4310ac['sendMessage'](_0x7091ba[_0x29750b(0x1c0)][_0x29750b(0x16d)]+'@'+(_0x7091ba['isGroup']?'g.us':_0x29750b(0x16e)),{'text':_0x3e49a8});await(0x0,wbotMessageListener_1['verifyMessage'])(_0xdddde3,_0x7091ba,_0x7091ba[_0x29750b(0x1c0)]);}}}}}var _0x571fd6=_0x3d32a8!==_0x5a2015;return _0xdd76b1&&(_0x571fd6&&_0xdd76b1['newTicketOnTransfer']&&(_0x2cd55c='closed')),await _0x7091ba[_0x29750b(0x19d)]({'amountUsedBotQueues':_0x384dc4[_0x29750b(0x155)]||0x0,'status':_0x2cd55c,'unreadMessages':_0x384dc4['unreadMessages']||0x0,'queueId':_0x5a2015,'userId':_0x2d673b,'whatsappId':_0xa67b6d,'chatbot':_0x126f44,'queueOptionId':_0x4311c3}),await _0x7091ba[_0x29750b(0x15c)](),_0xdd76b1&&_0x571fd6&&_0xdd76b1[_0x29750b(0x193)]&&!_0x7091ba[_0x29750b(0x1b6)]&&!_0x7091ba[_0x29750b(0x194)]&&(_0x213f59['to']('company-'+_0x7091ba[_0x29750b(0x178)]+'-'+_0x53e1e2)['to'](_0x29750b(0x1be)+_0x7091ba['queueId']+'-'+_0x53e1e2)['emit']('company-'+_0x41dda2+_0x29750b(0x1a0),{'action':_0x29750b(0x1bc),'ticketId':_0x7091ba['id']}),_0x213f59['to']('company-'+_0x7091ba['companyId']+'-'+_0x7091ba[_0x29750b(0x184)])['to']('company-'+_0x7091ba[_0x29750b(0x178)]+'-notification')['to'](_0x29750b(0x1be)+_0x7091ba['queueId']+_0x29750b(0x186))['to'](_0x29750b(0x1be)+_0x7091ba[_0x29750b(0x17f)]+'-'+_0x7091ba[_0x29750b(0x184)])['to'](_0x4c5007[_0x29750b(0x185)]())[_0x29750b(0x14d)](_0x29750b(0x1ab)+_0x41dda2+_0x29750b(0x1a0),{'action':_0x29750b(0x19d),'ticket':_0x7091ba}),_0x7091ba=await Ticket_1['default']['create']({'companyId':_0x41dda2,'contactId':_0x7091ba[_0x29750b(0x1a9)],'userId':_0x2d673b,'queueId':_0x5a2015,'status':_0x29750b(0x156),'whatsappId':_0x7091ba['whatsappId'],'chatbot':_0x126f44,'queueOptionId':_0x4311c3,'promptId':_0x418897,'useIntegration':_0x159ac2,'integrationId':_0x33a2b9,'amountUsedBotQueues':0x0,'unreadMessages':0x0})),_0x2cd55c=_0x7091ba['status'],_0x2cd55c===_0x29750b(0x156)&&(_0x3571a2[_0x29750b(0x19d)]({'whatsappId':_0xa67b6d,'queuedAt':(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x16f)](),'startedAt':null,'userId':null}),_0x213f59['to']('company-'+_0x41dda2+_0x29750b(0x1b0))[_0x29750b(0x14d)]('company-'+_0x41dda2+_0x29750b(0x1a0),{'action':_0x29750b(0x15e),'ticketId':_0x7091ba?.['id']})),_0x2cd55c===_0x29750b(0x164)&&(_0x3571a2[_0x29750b(0x19d)]({'startedAt':(0x0,moment_1[_0x29750b(0x14e)])()[_0x29750b(0x16f)](),'ratingAt':null,'rated':![],'whatsappId':_0xa67b6d,'userId':_0x7091ba['userId']}),_0x213f59['to'](_0x29750b(0x1ab)+_0x41dda2+'-mainchannel')[_0x29750b(0x14d)](_0x29750b(0x1ab)+_0x41dda2+'-ticket',{'action':_0x29750b(0x15e),'ticketId':_0x7091ba?.['id']}),_0x213f59['to'](_0x29750b(0x1ab)+_0x41dda2+_0x29750b(0x1b0))[_0x29750b(0x14d)](_0x29750b(0x1ab)+_0x41dda2+_0x29750b(0x1a0),{'action':_0x29750b(0x1b5),'ticketId':_0x7091ba?.['id']})),await _0x3571a2[_0x29750b(0x16b)](),(_0x7091ba[_0x29750b(0x184)]!==_0x53e1e2||_0x7091ba[_0x29750b(0x150)]?.['id']!==_0x442eb4||_0x571fd6)&&_0x213f59['to']('company-'+_0x7091ba[_0x29750b(0x178)]+'-'+_0x53e1e2)['to']('queue-'+_0x7091ba['queueId']+'-'+_0x53e1e2)['to'](_0x29750b(0x1ab)+_0x7091ba['companyId']+_0x29750b(0x186))['to'](_0x29750b(0x1be)+_0x7091ba[_0x29750b(0x17f)]+_0x29750b(0x186))['to'](_0x4c5007['toString']())[_0x29750b(0x14d)](_0x29750b(0x1ab)+_0x41dda2+'-ticket',{'action':_0x29750b(0x1bc),'ticketId':_0x7091ba['id']}),_0x7091ba[_0x29750b(0x184)]!=='closed'&&_0x213f59['to'](_0x29750b(0x1ab)+_0x7091ba[_0x29750b(0x178)]+'-'+_0x7091ba[_0x29750b(0x184)])['to'](_0x29750b(0x1ab)+_0x7091ba[_0x29750b(0x178)]+_0x29750b(0x186))['to']('queue-'+_0x7091ba[_0x29750b(0x17f)]+_0x29750b(0x186))['to'](_0x29750b(0x1be)+_0x7091ba[_0x29750b(0x17f)]+'-'+_0x7091ba[_0x29750b(0x184)])['to'](_0x4c5007[_0x29750b(0x185)]())['emit']('company-'+_0x41dda2+_0x29750b(0x1a0),{'action':_0x29750b(0x19d),'ticket':_0x7091ba}),{'ticket':_0x7091ba,'oldStatus':_0x53e1e2,'oldUserId':_0x442eb4};}catch(_0x36f172){console[_0x29750b(0x14c)](_0x36f172),Sentry['captureException'](_0x36f172);}};exports[a528_0x316e68(0x14e)]=UpdateTicketService;const notifyUpdate=(_0x2dbffd,_0x538c5a,_0xf21a1c,_0x16206a)=>{const _0x77b51c=a528_0x316e68;_0x2dbffd['to'](_0x77b51c(0x1ab)+_0x538c5a['companyId']+'-'+_0x538c5a[_0x77b51c(0x184)])['to'](_0x77b51c(0x1ab)+_0x538c5a[_0x77b51c(0x178)]+'-notification')['to'](_0xf21a1c[_0x77b51c(0x185)]())[_0x77b51c(0x14d)](_0x77b51c(0x1ab)+_0x16206a+_0x77b51c(0x1a0),{'action':_0x77b51c(0x19d),'ticket':_0x538c5a});};exports[a528_0x316e68(0x18d)]=notifyUpdate;