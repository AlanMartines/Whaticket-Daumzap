const a524_0x3f168b=a524_0x5e21;(function(_0x38e2cd,_0x1cd36){const _0x441cd0=a524_0x5e21,_0x22b292=_0x38e2cd();while(!![]){try{const _0x30bb00=parseInt(_0x441cd0(0x14f))/0x1*(-parseInt(_0x441cd0(0x148))/0x2)+-parseInt(_0x441cd0(0x163))/0x3*(parseInt(_0x441cd0(0x16d))/0x4)+-parseInt(_0x441cd0(0x14a))/0x5+-parseInt(_0x441cd0(0x153))/0x6+parseInt(_0x441cd0(0x14d))/0x7+parseInt(_0x441cd0(0x144))/0x8+parseInt(_0x441cd0(0x16a))/0x9*(parseInt(_0x441cd0(0x154))/0xa);if(_0x30bb00===_0x1cd36)break;else _0x22b292['push'](_0x22b292['shift']());}catch(_0x52cbd2){_0x22b292['push'](_0x22b292['shift']());}}}(a524_0x3827,0xf2f68));const a524_0xa937dc=(function(){let _0x1084e6=!![];return function(_0x3b3077,_0x47adc1){const _0xc0e995=_0x1084e6?function(){const _0x3a1380=a524_0x5e21;if(_0x47adc1){const _0x22ae43=_0x47adc1[_0x3a1380(0x16f)](_0x3b3077,arguments);return _0x47adc1=null,_0x22ae43;}}:function(){};return _0x1084e6=![],_0xc0e995;};}()),a524_0x80d9c3=a524_0xa937dc(this,function(){const _0x223124=a524_0x5e21;return a524_0x80d9c3[_0x223124(0x15e)]()[_0x223124(0x169)]('(((.+)+)+)+$')['toString']()[_0x223124(0x14c)](a524_0x80d9c3)['search'](_0x223124(0x174));});function a524_0x5e21(_0x11b24e,_0x4f2758){const _0x24aea1=a524_0x3827();return a524_0x5e21=function(_0x80d9c3,_0xa937dc){_0x80d9c3=_0x80d9c3-0x13d;let _0x3827f5=_0x24aea1[_0x80d9c3];return _0x3827f5;},a524_0x5e21(_0x11b24e,_0x4f2758);}a524_0x80d9c3();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2df696){const _0xf276a9=a524_0x5e21;return _0x2df696&&_0x2df696[_0xf276a9(0x17c)]?_0x2df696:{'default':_0x2df696};};Object[a524_0x3f168b(0x15a)](exports,a524_0x3f168b(0x17c),{'value':!![]});function a524_0x3827(){const _0x324ffd=['true','profilePicUrl','queue','625302njFovX','trim','allTicket','findAndCountAll','endOfDay','body','search','207NZQKyN','name','lodash','12fRsoie','../../models/Message','apply','../../models/Contact','default','tags','../UserServices/ShowUserService','(((.+)+)+)+$','enabled','ticketId','LIKE','push','../../models/TicketTag','map','../../models/Tag','__esModule','between','updatedAt','findAll','disabled','col','number','presence','DESC','isArray','profile','parseISO','14557344vdKxzI','pending','contact','sequelize','204326YfXqlV','messages','7141035txSehO','../../models/User','constructor','12968284jiBeZZ','startOfDay','17xreobn','LOWER','where','contact.name','9684570KtJezA','1185770PZfJla','../../models/Ticket','queues','intersection','../../models/Queue','user','defineProperty','whatsapp','date-fns','color','toString','length'];a524_0x3827=function(){return _0x324ffd;};return a524_0x3827();}const sequelize_1=require(a524_0x3f168b(0x147)),date_fns_1=require(a524_0x3f168b(0x15c)),Ticket_1=__importDefault(require(a524_0x3f168b(0x155))),Contact_1=__importDefault(require(a524_0x3f168b(0x170))),Message_1=__importDefault(require(a524_0x3f168b(0x16e))),Queue_1=__importDefault(require(a524_0x3f168b(0x158))),User_1=__importDefault(require(a524_0x3f168b(0x14b))),ShowUserService_1=__importDefault(require(a524_0x3f168b(0x173))),Tag_1=__importDefault(require(a524_0x3f168b(0x17b))),TicketTag_1=__importDefault(require(a524_0x3f168b(0x179))),lodash_1=require(a524_0x3f168b(0x16c)),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x454f3d,tags:_0x2c4720,users:_0x4b8431,status:_0x37665d,date:_0xfbeae2,startDate:_0x39c66a,endDate:_0x8e0ee2,updatedAt:_0xd5b4e9,showAll:_0xf97ff0,userId:_0x5cfc5,withUnreadMessages:_0x21f471,companyId:_0x59675e})=>{const _0x5657e9=a524_0x3f168b,_0x242d5b=await(0x0,ShowUserService_1['default'])(_0x5cfc5),_0x2d7175=_0x242d5b[_0x5657e9(0x156)][_0x5657e9(0x17a)](_0x5bfb63=>_0x5bfb63['id']);let _0x31a360={[sequelize_1['Op']['or']]:[{'userId':_0x5cfc5},{'status':_0x5657e9(0x145)}],'queueId':{[sequelize_1['Op']['or']]:[_0x454f3d,null]}},_0x23d1cd;_0x23d1cd=[{'model':Contact_1[_0x5657e9(0x171)],'as':_0x5657e9(0x146),'attributes':['id',_0x5657e9(0x16b),_0x5657e9(0x13e),'email',_0x5657e9(0x161),_0x5657e9(0x13f)]},{'model':Queue_1[_0x5657e9(0x171)],'as':_0x5657e9(0x162),'attributes':['id','name',_0x5657e9(0x15d)]},{'model':User_1[_0x5657e9(0x171)],'as':_0x5657e9(0x159),'attributes':['id',_0x5657e9(0x16b)]},{'model':Tag_1[_0x5657e9(0x171)],'as':_0x5657e9(0x172),'attributes':['id',_0x5657e9(0x16b),_0x5657e9(0x15d)]},{'model':Whatsapp_1['default'],'as':_0x5657e9(0x15b),'attributes':[_0x5657e9(0x16b)]}];if(_0x242d5b[_0x5657e9(0x142)]===_0x5657e9(0x159)&&_0x242d5b[_0x5657e9(0x165)]===_0x5657e9(0x175)){const _0x3f7cfd=[];let _0x3192f6=[];_0x3192f6=await Ticket_1[_0x5657e9(0x171)][_0x5657e9(0x17f)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x242d5b['id'],null]},'companyId':_0x59675e}});_0x3192f6&&_0x3f7cfd['push'](_0x3192f6[_0x5657e9(0x17a)](_0x4d21b0=>_0x4d21b0['id']));const _0x5b044c=(0x0,lodash_1[_0x5657e9(0x157)])(..._0x3f7cfd);_0x31a360={..._0x31a360,'id':_0x5b044c};}if(_0x242d5b[_0x5657e9(0x142)]===_0x5657e9(0x159)&&_0x242d5b[_0x5657e9(0x165)]===_0x5657e9(0x180)){const _0x3e4693=[];let _0x4042d9=[];_0x4042d9=await Ticket_1[_0x5657e9(0x171)][_0x5657e9(0x17f)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x242d5b['id'],null]},'companyId':_0x59675e,'queueId':{[sequelize_1['Op']['not']]:null}}});_0x4042d9&&_0x3e4693[_0x5657e9(0x178)](_0x4042d9[_0x5657e9(0x17a)](_0x6e9cbb=>_0x6e9cbb['id']));const _0x4a8203=(0x0,lodash_1[_0x5657e9(0x157)])(..._0x3e4693);_0x31a360={..._0x31a360,'id':_0x4a8203};}_0xf97ff0===_0x5657e9(0x160)&&(_0x31a360={'queueId':{[sequelize_1['Op']['or']]:[_0x454f3d,null]}});_0x37665d&&(_0x31a360={..._0x31a360,'status':_0x37665d});_0x39c66a&&_0x8e0ee2&&(_0x31a360={..._0x31a360,'createdAt':{[sequelize_1['Op'][_0x5657e9(0x17d)]]:[+(0x0,date_fns_1[_0x5657e9(0x14e)])((0x0,date_fns_1[_0x5657e9(0x143)])(_0x39c66a)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x5657e9(0x143)])(_0x8e0ee2))]}});if(searchParam){const _0x3b0a71=searchParam['toLocaleLowerCase']()[_0x5657e9(0x164)]();_0x23d1cd=[..._0x23d1cd,{'model':Message_1[_0x5657e9(0x171)],'as':_0x5657e9(0x149),'attributes':['id',_0x5657e9(0x168)],'where':{'body':(0x0,sequelize_1[_0x5657e9(0x151)])((0x0,sequelize_1['fn'])(_0x5657e9(0x150),(0x0,sequelize_1[_0x5657e9(0x13d)])(_0x5657e9(0x168))),'LIKE','%'+_0x3b0a71+'%')},'required':![],'duplicating':![]}],_0x31a360={..._0x31a360,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x5657e9(0x150),(0x0,sequelize_1[_0x5657e9(0x13d)])(_0x5657e9(0x152))),_0x5657e9(0x177),'%'+_0x3b0a71+'%')},{'$contact.number$':{[sequelize_1['Op']['like']]:'%'+_0x3b0a71+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x5657e9(0x150),(0x0,sequelize_1[_0x5657e9(0x13d)])(_0x5657e9(0x168))),_0x5657e9(0x177),'%'+_0x3b0a71+'%')}]};}_0xfbeae2&&(_0x31a360={'createdAt':{[sequelize_1['Op'][_0x5657e9(0x17d)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x5657e9(0x143)])(_0xfbeae2)),+(0x0,date_fns_1[_0x5657e9(0x167)])((0x0,date_fns_1[_0x5657e9(0x143)])(_0xfbeae2))]}});_0xd5b4e9&&(_0x31a360={'updatedAt':{[sequelize_1['Op'][_0x5657e9(0x17d)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x5657e9(0x143)])(_0xd5b4e9)),+(0x0,date_fns_1[_0x5657e9(0x167)])((0x0,date_fns_1['parseISO'])(_0xd5b4e9))]}});if(_0x21f471===_0x5657e9(0x160)){const _0x32d62b=await(0x0,ShowUserService_1['default'])(_0x5cfc5),_0x18bf06=_0x32d62b[_0x5657e9(0x156)][_0x5657e9(0x17a)](_0x879708=>_0x879708['id']);_0x31a360={[sequelize_1['Op']['or']]:[{'userId':_0x5cfc5},{'status':_0x5657e9(0x145)}],'queueId':{[sequelize_1['Op']['or']]:[_0x18bf06,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x5657e9(0x141)](_0x2c4720)&&_0x2c4720['length']>0x0){const _0x142c0a=[];for(let _0x4e22ef of _0x2c4720){const _0x335957=await TicketTag_1[_0x5657e9(0x171)][_0x5657e9(0x17f)]({'where':{'tagId':_0x4e22ef}});_0x335957&&_0x142c0a[_0x5657e9(0x178)](_0x335957[_0x5657e9(0x17a)](_0x1c2388=>_0x1c2388[_0x5657e9(0x176)]));}const _0x536dde=(0x0,lodash_1[_0x5657e9(0x157)])(..._0x142c0a);_0x31a360={..._0x31a360,'id':{[sequelize_1['Op']['in']]:_0x536dde}};}if(Array['isArray'](_0x4b8431)&&_0x4b8431[_0x5657e9(0x15f)]>0x0){const _0x34f4c7=[];for(let _0x51b567 of _0x4b8431){const _0x335288=await Ticket_1[_0x5657e9(0x171)]['findAll']({'where':{'userId':_0x51b567}});_0x335288&&_0x34f4c7['push'](_0x335288[_0x5657e9(0x17a)](_0x3a96ed=>_0x3a96ed['id']));}const _0x561af5=(0x0,lodash_1[_0x5657e9(0x157)])(..._0x34f4c7);_0x31a360={..._0x31a360,'id':{[sequelize_1['Op']['in']]:_0x561af5}};}const _0x26e34f=0x28,_0x89e70d=_0x26e34f*(+pageNumber-0x1);_0x31a360={..._0x31a360,'companyId':_0x59675e};const {count:_0x5b6516,rows:_0x15417b}=await Ticket_1[_0x5657e9(0x171)][_0x5657e9(0x166)]({'where':_0x31a360,'include':_0x23d1cd,'distinct':!![],'limit':_0x26e34f,'offset':_0x89e70d,'order':[[_0x5657e9(0x17e),_0x5657e9(0x140)]],'subQuery':![]}),_0x1eac6f=_0x5b6516>_0x89e70d+_0x15417b[_0x5657e9(0x15f)];return{'tickets':_0x15417b,'count':_0x5b6516,'hasMore':_0x1eac6f};};exports['default']=ListTicketsService;