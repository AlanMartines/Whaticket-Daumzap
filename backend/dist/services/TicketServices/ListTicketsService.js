const a524_0x538012=a524_0x530d;(function(_0xc734c9,_0x4bb1b1){const _0x5a0275=a524_0x530d,_0x38e0bd=_0xc734c9();while(!![]){try{const _0xa20a58=-parseInt(_0x5a0275(0xdb))/0x1+parseInt(_0x5a0275(0xe6))/0x2*(parseInt(_0x5a0275(0xcf))/0x3)+parseInt(_0x5a0275(0xd6))/0x4*(parseInt(_0x5a0275(0xd8))/0x5)+-parseInt(_0x5a0275(0xaf))/0x6+parseInt(_0x5a0275(0xb2))/0x7+parseInt(_0x5a0275(0xdd))/0x8*(-parseInt(_0x5a0275(0xc3))/0x9)+-parseInt(_0x5a0275(0xed))/0xa*(parseInt(_0x5a0275(0xb3))/0xb);if(_0xa20a58===_0x4bb1b1)break;else _0x38e0bd['push'](_0x38e0bd['shift']());}catch(_0x2c0fb4){_0x38e0bd['push'](_0x38e0bd['shift']());}}}(a524_0x114a,0x23ffb));function a524_0x114a(){const _0x46ee36=['apply','../../models/Whatsapp','search','col','date-fns','../../models/Queue','../../models/Ticket','8358AmNUIV','whatsapp','__esModule','default','allTicket','tags','../../models/Contact','10564znndBy','color','5Ufenga','true','profile','137381tMRfrA','startOfDay','8qgjEhu','like','contact.name','../../models/Tag','between','queue','../../models/User','sequelize','enabled','186AgXCkf','queues','DESC','length','../UserServices/ShowUserService','toLocaleLowerCase','contact','20yYGzoI','body','endOfDay','parseISO','map','(((.+)+)+)+$','474096qDZOog','constructor','findAndCountAll','2004233hUuytf','363jvrRRz','push','defineProperty','email','ticketId','trim','LOWER','../../models/Message','profilePicUrl','name','where','user','pending','LIKE','intersection','disabled','1657296eRcuvg','number','findAll','not','lodash'];a524_0x114a=function(){return _0x46ee36;};return a524_0x114a();}const a524_0x31f884=(function(){let _0x32c7ce=!![];return function(_0x2ac002,_0x18db9d){const _0x184395=_0x32c7ce?function(){const _0x479ad0=a524_0x530d;if(_0x18db9d){const _0x19a2f7=_0x18db9d[_0x479ad0(0xc8)](_0x2ac002,arguments);return _0x18db9d=null,_0x19a2f7;}}:function(){};return _0x32c7ce=![],_0x184395;};}()),a524_0x3b4e20=a524_0x31f884(this,function(){const _0x23b405=a524_0x530d;return a524_0x3b4e20['toString']()[_0x23b405(0xca)](_0x23b405(0xae))['toString']()[_0x23b405(0xb0)](a524_0x3b4e20)[_0x23b405(0xca)]('(((.+)+)+)+$');});a524_0x3b4e20();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1ea2c1){const _0x1afa19=a524_0x530d;return _0x1ea2c1&&_0x1ea2c1[_0x1afa19(0xd1)]?_0x1ea2c1:{'default':_0x1ea2c1};};Object[a524_0x538012(0xb5)](exports,a524_0x538012(0xd1),{'value':!![]});const sequelize_1=require(a524_0x538012(0xe4)),date_fns_1=require(a524_0x538012(0xcc)),Ticket_1=__importDefault(require(a524_0x538012(0xce))),Contact_1=__importDefault(require(a524_0x538012(0xd5))),Message_1=__importDefault(require(a524_0x538012(0xba))),Queue_1=__importDefault(require(a524_0x538012(0xcd))),User_1=__importDefault(require(a524_0x538012(0xe3))),ShowUserService_1=__importDefault(require(a524_0x538012(0xea))),Tag_1=__importDefault(require(a524_0x538012(0xe0))),TicketTag_1=__importDefault(require('../../models/TicketTag')),lodash_1=require(a524_0x538012(0xc7)),Whatsapp_1=__importDefault(require(a524_0x538012(0xc9))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x1fa011,tags:_0x2cd7f9,users:_0x30cc68,status:_0x1c8385,date:_0x4209ff,startDate:_0x3acf1b,endDate:_0x22028f,updatedAt:_0x5158bb,showAll:_0x1c8fe4,userId:_0x58d4bd,withUnreadMessages:_0x5e5a72,companyId:_0xbe5175})=>{const _0x13bb2a=a524_0x538012,_0x1e8c24=await(0x0,ShowUserService_1[_0x13bb2a(0xd2)])(_0x58d4bd),_0x40f428=_0x1e8c24[_0x13bb2a(0xe7)]['map'](_0x52f4b9=>_0x52f4b9['id']);let _0x37131d={[sequelize_1['Op']['or']]:[{'userId':_0x58d4bd},{'status':_0x13bb2a(0xbf)}],'queueId':{[sequelize_1['Op']['or']]:[_0x1fa011,null]}},_0x3a330b;_0x3a330b=[{'model':Contact_1['default'],'as':_0x13bb2a(0xec),'attributes':['id',_0x13bb2a(0xbc),_0x13bb2a(0xc4),_0x13bb2a(0xb6),_0x13bb2a(0xbb),'presence']},{'model':Queue_1['default'],'as':_0x13bb2a(0xe2),'attributes':['id',_0x13bb2a(0xbc),'color']},{'model':User_1[_0x13bb2a(0xd2)],'as':_0x13bb2a(0xbe),'attributes':['id',_0x13bb2a(0xbc)]},{'model':Tag_1['default'],'as':_0x13bb2a(0xd4),'attributes':['id','name',_0x13bb2a(0xd7)]},{'model':Whatsapp_1[_0x13bb2a(0xd2)],'as':_0x13bb2a(0xd0),'attributes':[_0x13bb2a(0xbc)]}];if(_0x1e8c24[_0x13bb2a(0xda)]===_0x13bb2a(0xbe)&&_0x1e8c24['allTicket']===_0x13bb2a(0xe5)){const _0x29dc91=[];let _0x5863a5=[];_0x5863a5=await Ticket_1[_0x13bb2a(0xd2)][_0x13bb2a(0xc5)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x1e8c24['id'],null]},'companyId':_0xbe5175}});_0x5863a5&&_0x29dc91[_0x13bb2a(0xb4)](_0x5863a5[_0x13bb2a(0xad)](_0x25147b=>_0x25147b['id']));const _0x30297e=(0x0,lodash_1['intersection'])(..._0x29dc91);_0x37131d={..._0x37131d,'id':_0x30297e};}if(_0x1e8c24['profile']===_0x13bb2a(0xbe)&&_0x1e8c24[_0x13bb2a(0xd3)]===_0x13bb2a(0xc2)){const _0x1c24f9=[];let _0x35aa0f=[];_0x35aa0f=await Ticket_1[_0x13bb2a(0xd2)][_0x13bb2a(0xc5)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x1e8c24['id'],null]},'companyId':_0xbe5175,'queueId':{[sequelize_1['Op'][_0x13bb2a(0xc6)]]:null}}});_0x35aa0f&&_0x1c24f9[_0x13bb2a(0xb4)](_0x35aa0f[_0x13bb2a(0xad)](_0x129611=>_0x129611['id']));const _0x293d0e=(0x0,lodash_1[_0x13bb2a(0xc1)])(..._0x1c24f9);_0x37131d={..._0x37131d,'id':_0x293d0e};}_0x1c8fe4===_0x13bb2a(0xd9)&&(_0x37131d={'queueId':{[sequelize_1['Op']['or']]:[_0x1fa011,null]}});_0x1c8385&&(_0x37131d={..._0x37131d,'status':_0x1c8385});_0x3acf1b&&_0x22028f&&(_0x37131d={..._0x37131d,'createdAt':{[sequelize_1['Op'][_0x13bb2a(0xe1)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x13bb2a(0xac)])(_0x3acf1b)),+(0x0,date_fns_1[_0x13bb2a(0xab)])((0x0,date_fns_1[_0x13bb2a(0xac)])(_0x22028f))]}});if(searchParam){const _0x2e76f0=searchParam[_0x13bb2a(0xeb)]()[_0x13bb2a(0xb8)]();_0x3a330b=[..._0x3a330b,{'model':Message_1[_0x13bb2a(0xd2)],'as':'messages','attributes':['id',_0x13bb2a(0xee)],'where':{'body':(0x0,sequelize_1[_0x13bb2a(0xbd)])((0x0,sequelize_1['fn'])(_0x13bb2a(0xb9),(0x0,sequelize_1[_0x13bb2a(0xcb)])(_0x13bb2a(0xee))),_0x13bb2a(0xc0),'%'+_0x2e76f0+'%')},'required':![],'duplicating':![]}],_0x37131d={..._0x37131d,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x13bb2a(0xbd)])((0x0,sequelize_1['fn'])(_0x13bb2a(0xb9),(0x0,sequelize_1[_0x13bb2a(0xcb)])(_0x13bb2a(0xdf))),'LIKE','%'+_0x2e76f0+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x13bb2a(0xde)]]:'%'+_0x2e76f0+'%'}},{'$message.body$':(0x0,sequelize_1[_0x13bb2a(0xbd)])((0x0,sequelize_1['fn'])(_0x13bb2a(0xb9),(0x0,sequelize_1[_0x13bb2a(0xcb)])(_0x13bb2a(0xee))),'LIKE','%'+_0x2e76f0+'%')}]};}_0x4209ff&&(_0x37131d={'createdAt':{[sequelize_1['Op'][_0x13bb2a(0xe1)]]:[+(0x0,date_fns_1[_0x13bb2a(0xdc)])((0x0,date_fns_1[_0x13bb2a(0xac)])(_0x4209ff)),+(0x0,date_fns_1[_0x13bb2a(0xab)])((0x0,date_fns_1[_0x13bb2a(0xac)])(_0x4209ff))]}});_0x5158bb&&(_0x37131d={'updatedAt':{[sequelize_1['Op']['between']]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1['parseISO'])(_0x5158bb)),+(0x0,date_fns_1[_0x13bb2a(0xab)])((0x0,date_fns_1['parseISO'])(_0x5158bb))]}});if(_0x5e5a72===_0x13bb2a(0xd9)){const _0x1d8800=await(0x0,ShowUserService_1[_0x13bb2a(0xd2)])(_0x58d4bd),_0x32eba7=_0x1d8800[_0x13bb2a(0xe7)][_0x13bb2a(0xad)](_0x149f0d=>_0x149f0d['id']);_0x37131d={[sequelize_1['Op']['or']]:[{'userId':_0x58d4bd},{'status':_0x13bb2a(0xbf)}],'queueId':{[sequelize_1['Op']['or']]:[_0x32eba7,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array['isArray'](_0x2cd7f9)&&_0x2cd7f9[_0x13bb2a(0xe9)]>0x0){const _0x190c84=[];for(let _0x7d2d66 of _0x2cd7f9){const _0x500795=await TicketTag_1[_0x13bb2a(0xd2)][_0x13bb2a(0xc5)]({'where':{'tagId':_0x7d2d66}});_0x500795&&_0x190c84[_0x13bb2a(0xb4)](_0x500795[_0x13bb2a(0xad)](_0x38cbda=>_0x38cbda[_0x13bb2a(0xb7)]));}const _0x373cf3=(0x0,lodash_1['intersection'])(..._0x190c84);_0x37131d={..._0x37131d,'id':{[sequelize_1['Op']['in']]:_0x373cf3}};}if(Array['isArray'](_0x30cc68)&&_0x30cc68[_0x13bb2a(0xe9)]>0x0){const _0x1744ed=[];for(let _0x2f48c9 of _0x30cc68){const _0x389087=await Ticket_1[_0x13bb2a(0xd2)][_0x13bb2a(0xc5)]({'where':{'userId':_0x2f48c9}});_0x389087&&_0x1744ed[_0x13bb2a(0xb4)](_0x389087[_0x13bb2a(0xad)](_0x6c7598=>_0x6c7598['id']));}const _0x1aca1d=(0x0,lodash_1['intersection'])(..._0x1744ed);_0x37131d={..._0x37131d,'id':{[sequelize_1['Op']['in']]:_0x1aca1d}};}const _0x3619f5=0x28,_0x10fd0a=_0x3619f5*(+pageNumber-0x1);_0x37131d={..._0x37131d,'companyId':_0xbe5175};const {count:_0x187616,rows:_0x39564a}=await Ticket_1[_0x13bb2a(0xd2)][_0x13bb2a(0xb1)]({'where':_0x37131d,'include':_0x3a330b,'distinct':!![],'limit':_0x3619f5,'offset':_0x10fd0a,'order':[['updatedAt',_0x13bb2a(0xe8)]],'subQuery':![]}),_0x2e494=_0x187616>_0x10fd0a+_0x39564a['length'];return{'tickets':_0x39564a,'count':_0x187616,'hasMore':_0x2e494};};function a524_0x530d(_0x5e8bc9,_0x55d5c1){const _0x3943a7=a524_0x114a();return a524_0x530d=function(_0x3b4e20,_0x31f884){_0x3b4e20=_0x3b4e20-0xab;let _0x114ac3=_0x3943a7[_0x3b4e20];return _0x114ac3;},a524_0x530d(_0x5e8bc9,_0x55d5c1);}exports['default']=ListTicketsService;