const a524_0x3ed55f=a524_0x28b3;(function(_0x586bde,_0x56982e){const _0x1376f2=a524_0x28b3,_0x3273b9=_0x586bde();while(!![]){try{const _0x4bb524=-parseInt(_0x1376f2(0x13c))/0x1+parseInt(_0x1376f2(0x154))/0x2+-parseInt(_0x1376f2(0x159))/0x3*(-parseInt(_0x1376f2(0x14d))/0x4)+-parseInt(_0x1376f2(0x158))/0x5+-parseInt(_0x1376f2(0x165))/0x6*(-parseInt(_0x1376f2(0x15a))/0x7)+parseInt(_0x1376f2(0x148))/0x8+parseInt(_0x1376f2(0x144))/0x9*(-parseInt(_0x1376f2(0x14a))/0xa);if(_0x4bb524===_0x56982e)break;else _0x3273b9['push'](_0x3273b9['shift']());}catch(_0x140d8a){_0x3273b9['push'](_0x3273b9['shift']());}}}(a524_0x3bf3,0xc0ab0));function a524_0x28b3(_0x4ed73d,_0x457e06){const _0x11cabc=a524_0x3bf3();return a524_0x28b3=function(_0x5dd998,_0x5b1576){_0x5dd998=_0x5dd998-0x131;let _0x3bf3e9=_0x11cabc[_0x5dd998];return _0x3bf3e9;},a524_0x28b3(_0x4ed73d,_0x457e06);}const a524_0x5b1576=(function(){let _0x4a406f=!![];return function(_0x5ebcfe,_0x4fa0a8){const _0x131454=_0x4a406f?function(){const _0x42b602=a524_0x28b3;if(_0x4fa0a8){const _0x1f7326=_0x4fa0a8[_0x42b602(0x151)](_0x5ebcfe,arguments);return _0x4fa0a8=null,_0x1f7326;}}:function(){};return _0x4a406f=![],_0x131454;};}()),a524_0x5dd998=a524_0x5b1576(this,function(){const _0x30e7f6=a524_0x28b3;return a524_0x5dd998[_0x30e7f6(0x140)]()['search'](_0x30e7f6(0x171))['toString']()['constructor'](a524_0x5dd998)[_0x30e7f6(0x161)](_0x30e7f6(0x171));});a524_0x5dd998();'use strict';var __importDefault=this&&this[a524_0x3ed55f(0x16e)]||function(_0x2acd17){const _0x2bec84=a524_0x3ed55f;return _0x2acd17&&_0x2acd17[_0x2bec84(0x13a)]?_0x2acd17:{'default':_0x2acd17};};Object[a524_0x3ed55f(0x150)](exports,a524_0x3ed55f(0x13a),{'value':!![]});const sequelize_1=require(a524_0x3ed55f(0x13b)),date_fns_1=require(a524_0x3ed55f(0x136)),Ticket_1=__importDefault(require('../../models/Ticket')),Contact_1=__importDefault(require(a524_0x3ed55f(0x152))),Message_1=__importDefault(require(a524_0x3ed55f(0x155))),Queue_1=__importDefault(require(a524_0x3ed55f(0x14f))),User_1=__importDefault(require(a524_0x3ed55f(0x16a))),ShowUserService_1=__importDefault(require(a524_0x3ed55f(0x170))),Tag_1=__importDefault(require(a524_0x3ed55f(0x15e))),TicketTag_1=__importDefault(require(a524_0x3ed55f(0x163))),lodash_1=require(a524_0x3ed55f(0x137)),Whatsapp_1=__importDefault(require(a524_0x3ed55f(0x13e))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x5bd0ad,tags:_0x44ef69,users:_0x1aa9a2,status:_0x208095,date:_0x3b9cc9,startDate:_0x9a4250,endDate:_0x43d8cc,updatedAt:_0x2859a6,showAll:_0x512e89,userId:_0x29cfbe,withUnreadMessages:_0x552894,companyId:_0x4d45cc})=>{const _0x385a05=a524_0x3ed55f,_0x2045b2=await(0x0,ShowUserService_1[_0x385a05(0x162)])(_0x29cfbe),_0x19f569=_0x2045b2[_0x385a05(0x15f)][_0x385a05(0x157)](_0x32aead=>_0x32aead['id']);let _0x3bcb5c={[sequelize_1['Op']['or']]:[{'userId':_0x29cfbe},{'status':_0x385a05(0x169)}],'queueId':{[sequelize_1['Op']['or']]:[_0x5bd0ad,null]}},_0x458a53;_0x458a53=[{'model':Contact_1[_0x385a05(0x162)],'as':'contact','attributes':['id',_0x385a05(0x133),'number','email','profilePicUrl',_0x385a05(0x156)]},{'model':Queue_1['default'],'as':_0x385a05(0x153),'attributes':['id','name',_0x385a05(0x167)]},{'model':User_1['default'],'as':_0x385a05(0x135),'attributes':['id',_0x385a05(0x133)]},{'model':Tag_1['default'],'as':_0x385a05(0x138),'attributes':['id','name',_0x385a05(0x167)]},{'model':Whatsapp_1[_0x385a05(0x162)],'as':_0x385a05(0x168),'attributes':['name']}];if(_0x2045b2[_0x385a05(0x141)]===_0x385a05(0x135)&&_0x2045b2['allTicket']===_0x385a05(0x134)){const _0x33ccca=[];let _0x2d04d3=[];_0x2d04d3=await Ticket_1[_0x385a05(0x162)][_0x385a05(0x149)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2045b2['id'],null]},'companyId':_0x4d45cc}});_0x2d04d3&&_0x33ccca[_0x385a05(0x15d)](_0x2d04d3[_0x385a05(0x157)](_0xe97028=>_0xe97028['id']));const _0x1b8980=(0x0,lodash_1['intersection'])(..._0x33ccca);_0x3bcb5c={..._0x3bcb5c,'id':_0x1b8980};}if(_0x2045b2[_0x385a05(0x141)]==='user'&&_0x2045b2[_0x385a05(0x143)]==='disabled'){const _0xe4e562=[];let _0x513ab1=[];_0x513ab1=await Ticket_1[_0x385a05(0x162)][_0x385a05(0x149)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2045b2['id'],null]},'companyId':_0x4d45cc,'queueId':{[sequelize_1['Op'][_0x385a05(0x14c)]]:null}}});_0x513ab1&&_0xe4e562[_0x385a05(0x15d)](_0x513ab1[_0x385a05(0x157)](_0x54d5c7=>_0x54d5c7['id']));const _0x2ac086=(0x0,lodash_1[_0x385a05(0x146)])(..._0xe4e562);_0x3bcb5c={..._0x3bcb5c,'id':_0x2ac086};}_0x512e89===_0x385a05(0x131)&&(_0x3bcb5c={'queueId':{[sequelize_1['Op']['or']]:[_0x5bd0ad,null]}});_0x208095&&(_0x3bcb5c={..._0x3bcb5c,'status':_0x208095});_0x9a4250&&_0x43d8cc&&(_0x3bcb5c={..._0x3bcb5c,'createdAt':{[sequelize_1['Op'][_0x385a05(0x142)]]:[+(0x0,date_fns_1[_0x385a05(0x166)])((0x0,date_fns_1[_0x385a05(0x13d)])(_0x9a4250)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x385a05(0x13d)])(_0x43d8cc))]}});if(searchParam){const _0x30de98=searchParam[_0x385a05(0x132)]()[_0x385a05(0x16c)]();_0x458a53=[..._0x458a53,{'model':Message_1['default'],'as':_0x385a05(0x139),'attributes':['id',_0x385a05(0x13f)],'where':{'body':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x385a05(0x16b),(0x0,sequelize_1[_0x385a05(0x172)])(_0x385a05(0x13f))),_0x385a05(0x160),'%'+_0x30de98+'%')},'required':![],'duplicating':![]}],_0x3bcb5c={..._0x3bcb5c,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x385a05(0x14e)])((0x0,sequelize_1['fn'])(_0x385a05(0x16b),(0x0,sequelize_1[_0x385a05(0x172)])(_0x385a05(0x147))),_0x385a05(0x160),'%'+_0x30de98+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x385a05(0x15b)]]:'%'+_0x30de98+'%'}},{'$message.body$':(0x0,sequelize_1['where'])((0x0,sequelize_1['fn'])(_0x385a05(0x16b),(0x0,sequelize_1[_0x385a05(0x172)])(_0x385a05(0x13f))),_0x385a05(0x160),'%'+_0x30de98+'%')}]};}_0x3b9cc9&&(_0x3bcb5c={'createdAt':{[sequelize_1['Op'][_0x385a05(0x142)]]:[+(0x0,date_fns_1[_0x385a05(0x166)])((0x0,date_fns_1[_0x385a05(0x13d)])(_0x3b9cc9)),+(0x0,date_fns_1['endOfDay'])((0x0,date_fns_1[_0x385a05(0x13d)])(_0x3b9cc9))]}});_0x2859a6&&(_0x3bcb5c={'updatedAt':{[sequelize_1['Op'][_0x385a05(0x142)]]:[+(0x0,date_fns_1[_0x385a05(0x166)])((0x0,date_fns_1['parseISO'])(_0x2859a6)),+(0x0,date_fns_1[_0x385a05(0x145)])((0x0,date_fns_1[_0x385a05(0x13d)])(_0x2859a6))]}});if(_0x552894==='true'){const _0x594d9d=await(0x0,ShowUserService_1[_0x385a05(0x162)])(_0x29cfbe),_0x1a4419=_0x594d9d[_0x385a05(0x15f)][_0x385a05(0x157)](_0x4bce43=>_0x4bce43['id']);_0x3bcb5c={[sequelize_1['Op']['or']]:[{'userId':_0x29cfbe},{'status':'pending'}],'queueId':{[sequelize_1['Op']['or']]:[_0x1a4419,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x385a05(0x16f)](_0x44ef69)&&_0x44ef69['length']>0x0){const _0x53a99c=[];for(let _0x19d9e8 of _0x44ef69){const _0x1dfa23=await TicketTag_1[_0x385a05(0x162)][_0x385a05(0x149)]({'where':{'tagId':_0x19d9e8}});_0x1dfa23&&_0x53a99c[_0x385a05(0x15d)](_0x1dfa23['map'](_0x5a4f5b=>_0x5a4f5b[_0x385a05(0x16d)]));}const _0x198adf=(0x0,lodash_1[_0x385a05(0x146)])(..._0x53a99c);_0x3bcb5c={..._0x3bcb5c,'id':{[sequelize_1['Op']['in']]:_0x198adf}};}if(Array[_0x385a05(0x16f)](_0x1aa9a2)&&_0x1aa9a2[_0x385a05(0x15c)]>0x0){const _0x4ec9ea=[];for(let _0x3cd521 of _0x1aa9a2){const _0x50fef3=await Ticket_1[_0x385a05(0x162)]['findAll']({'where':{'userId':_0x3cd521}});_0x50fef3&&_0x4ec9ea['push'](_0x50fef3[_0x385a05(0x157)](_0x2f1a81=>_0x2f1a81['id']));}const _0x88b411=(0x0,lodash_1[_0x385a05(0x146)])(..._0x4ec9ea);_0x3bcb5c={..._0x3bcb5c,'id':{[sequelize_1['Op']['in']]:_0x88b411}};}const _0xa5c23d=0x28,_0x3f0063=_0xa5c23d*(+pageNumber-0x1);_0x3bcb5c={..._0x3bcb5c,'companyId':_0x4d45cc};const {count:_0x396d0b,rows:_0x345d86}=await Ticket_1['default']['findAndCountAll']({'where':_0x3bcb5c,'include':_0x458a53,'distinct':!![],'limit':_0xa5c23d,'offset':_0x3f0063,'order':[[_0x385a05(0x14b),_0x385a05(0x164)]],'subQuery':![]}),_0x5b3d2d=_0x396d0b>_0x3f0063+_0x345d86[_0x385a05(0x15c)];return{'tickets':_0x345d86,'count':_0x396d0b,'hasMore':_0x5b3d2d};};function a524_0x3bf3(){const _0x2944ee=['enabled','user','date-fns','lodash','tags','messages','__esModule','sequelize','761852zQAJpl','parseISO','../../models/Whatsapp','body','toString','profile','between','allTicket','6706764xoouZM','endOfDay','intersection','contact.name','10282400NoiDae','findAll','20RICQhm','updatedAt','not','108fHQwAO','where','../../models/Queue','defineProperty','apply','../../models/Contact','queue','1080298HQMquZ','../../models/Message','presence','map','4394250ExuDbz','173688sHXUxV','1240449QGeDLU','like','length','push','../../models/Tag','queues','LIKE','search','default','../../models/TicketTag','DESC','18GAIMSb','startOfDay','color','whatsapp','pending','../../models/User','LOWER','trim','ticketId','__importDefault','isArray','../UserServices/ShowUserService','(((.+)+)+)+$','col','true','toLocaleLowerCase','name'];a524_0x3bf3=function(){return _0x2944ee;};return a524_0x3bf3();}exports[a524_0x3ed55f(0x162)]=ListTicketsService;