const a524_0x4a6da0=a524_0x21d2;(function(_0x1c0966,_0x5de217){const _0x2063f0=a524_0x21d2,_0x955793=_0x1c0966();while(!![]){try{const _0x32056d=-parseInt(_0x2063f0(0x1f6))/0x1*(parseInt(_0x2063f0(0x1f1))/0x2)+-parseInt(_0x2063f0(0x21e))/0x3*(-parseInt(_0x2063f0(0x1f8))/0x4)+parseInt(_0x2063f0(0x20d))/0x5*(-parseInt(_0x2063f0(0x212))/0x6)+parseInt(_0x2063f0(0x1ed))/0x7+-parseInt(_0x2063f0(0x1f7))/0x8*(parseInt(_0x2063f0(0x1f3))/0x9)+-parseInt(_0x2063f0(0x1fd))/0xa+-parseInt(_0x2063f0(0x218))/0xb;if(_0x32056d===_0x5de217)break;else _0x955793['push'](_0x955793['shift']());}catch(_0x368ac4){_0x955793['push'](_0x955793['shift']());}}}(a524_0x5989,0x268e9));function a524_0x21d2(_0x3ff7ff,_0x772f17){const _0x576d87=a524_0x5989();return a524_0x21d2=function(_0x2458f9,_0x17d9d){_0x2458f9=_0x2458f9-0x1e2;let _0x598908=_0x576d87[_0x2458f9];return _0x598908;},a524_0x21d2(_0x3ff7ff,_0x772f17);}const a524_0x17d9d=(function(){let _0x438fa1=!![];return function(_0x2f9efb,_0x5117f7){const _0x58ad44=_0x438fa1?function(){const _0x2ce70f=a524_0x21d2;if(_0x5117f7){const _0x17c42c=_0x5117f7[_0x2ce70f(0x204)](_0x2f9efb,arguments);return _0x5117f7=null,_0x17c42c;}}:function(){};return _0x438fa1=![],_0x58ad44;};}()),a524_0x2458f9=a524_0x17d9d(this,function(){const _0x1368b0=a524_0x21d2;return a524_0x2458f9['toString']()[_0x1368b0(0x20a)](_0x1368b0(0x1ea))[_0x1368b0(0x1f0)]()['constructor'](a524_0x2458f9)[_0x1368b0(0x20a)](_0x1368b0(0x1ea));});a524_0x2458f9();'use strict';var __importDefault=this&&this[a524_0x4a6da0(0x21d)]||function(_0x5dfc22){return _0x5dfc22&&_0x5dfc22['__esModule']?_0x5dfc22:{'default':_0x5dfc22};};Object[a524_0x4a6da0(0x20e)](exports,'__esModule',{'value':!![]});function a524_0x5989(){const _0x34a1da=['apply','length','contact','trim','parseISO','map','search','endOfDay','push','200980eVYRIq','defineProperty','body','contact.name','tags','6vLSqdm','queues','true','between','../../models/Whatsapp','queue','1263878RvzPIB','toLocaleLowerCase','pending','../../models/Ticket','intersection','__importDefault','280239cbIVig','default','ticketId','col','profilePicUrl','findAndCountAll','LIKE','startOfDay','where','color','(((.+)+)+)+$','messages','LOWER','1992725WrfWJR','findAll','profile','toString','80VUgrex','name','9BlYXTh','allTicket','sequelize','4127QTNWaj','3224BDQaZa','12FuHTlX','number','../../models/TicketTag','not','lodash','864080UMEWPE','isArray','date-fns','user','like','whatsapp','disabled'];a524_0x5989=function(){return _0x34a1da;};return a524_0x5989();}const sequelize_1=require(a524_0x4a6da0(0x1f5)),date_fns_1=require(a524_0x4a6da0(0x1ff)),Ticket_1=__importDefault(require(a524_0x4a6da0(0x21b))),Contact_1=__importDefault(require('../../models/Contact')),Message_1=__importDefault(require('../../models/Message')),Queue_1=__importDefault(require('../../models/Queue')),User_1=__importDefault(require('../../models/User')),ShowUserService_1=__importDefault(require('../UserServices/ShowUserService')),Tag_1=__importDefault(require('../../models/Tag')),TicketTag_1=__importDefault(require(a524_0x4a6da0(0x1fa))),lodash_1=require(a524_0x4a6da0(0x1fc)),Whatsapp_1=__importDefault(require(a524_0x4a6da0(0x216))),ListTicketsService=async({searchParam:searchParam='',pageNumber:pageNumber='1',queueIds:_0x3667fd,tags:_0x4fdb1e,users:_0x4c2377,status:_0x443ab7,date:_0x1bf3cf,startDate:_0x4c859c,endDate:_0x54a936,updatedAt:_0x19927f,showAll:_0x3829a7,userId:_0x2b664a,withUnreadMessages:_0x4a97e1,companyId:_0x47ca25})=>{const _0x5ec0e1=a524_0x4a6da0,_0x2d745b=await(0x0,ShowUserService_1['default'])(_0x2b664a),_0xfaa088=_0x2d745b['queues'][_0x5ec0e1(0x209)](_0x2a0952=>_0x2a0952['id']);let _0x4bc512={[sequelize_1['Op']['or']]:[{'userId':_0x2b664a},{'status':_0x5ec0e1(0x21a)}],'queueId':{[sequelize_1['Op']['or']]:[_0x3667fd,null]}},_0x505edc;_0x505edc=[{'model':Contact_1[_0x5ec0e1(0x21f)],'as':_0x5ec0e1(0x206),'attributes':['id',_0x5ec0e1(0x1f2),_0x5ec0e1(0x1f9),'email',_0x5ec0e1(0x1e4),'presence']},{'model':Queue_1[_0x5ec0e1(0x21f)],'as':_0x5ec0e1(0x217),'attributes':['id',_0x5ec0e1(0x1f2),'color']},{'model':User_1[_0x5ec0e1(0x21f)],'as':_0x5ec0e1(0x200),'attributes':['id',_0x5ec0e1(0x1f2)]},{'model':Tag_1[_0x5ec0e1(0x21f)],'as':_0x5ec0e1(0x211),'attributes':['id',_0x5ec0e1(0x1f2),_0x5ec0e1(0x1e9)]},{'model':Whatsapp_1['default'],'as':_0x5ec0e1(0x202),'attributes':[_0x5ec0e1(0x1f2)]}];if(_0x2d745b[_0x5ec0e1(0x1ef)]===_0x5ec0e1(0x200)&&_0x2d745b[_0x5ec0e1(0x1f4)]==='enabled'){const _0x220aa6=[];let _0x1f4e05=[];_0x1f4e05=await Ticket_1['default'][_0x5ec0e1(0x1ee)]({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2d745b['id'],null]},'companyId':_0x47ca25}});_0x1f4e05&&_0x220aa6[_0x5ec0e1(0x20c)](_0x1f4e05[_0x5ec0e1(0x209)](_0x3b3fbf=>_0x3b3fbf['id']));const _0x10996e=(0x0,lodash_1[_0x5ec0e1(0x21c)])(..._0x220aa6);_0x4bc512={..._0x4bc512,'id':_0x10996e};}if(_0x2d745b[_0x5ec0e1(0x1ef)]==='user'&&_0x2d745b[_0x5ec0e1(0x1f4)]===_0x5ec0e1(0x203)){const _0x51df3b=[];let _0x3613e6=[];_0x3613e6=await Ticket_1[_0x5ec0e1(0x21f)]['findAll']({'where':{'userId':{[sequelize_1['Op']['or']]:[_0x2d745b['id'],null]},'companyId':_0x47ca25,'queueId':{[sequelize_1['Op'][_0x5ec0e1(0x1fb)]]:null}}});_0x3613e6&&_0x51df3b[_0x5ec0e1(0x20c)](_0x3613e6[_0x5ec0e1(0x209)](_0x1e3b12=>_0x1e3b12['id']));const _0x4c33a5=(0x0,lodash_1['intersection'])(..._0x51df3b);_0x4bc512={..._0x4bc512,'id':_0x4c33a5};}_0x3829a7===_0x5ec0e1(0x214)&&(_0x4bc512={'queueId':{[sequelize_1['Op']['or']]:[_0x3667fd,null]}});_0x443ab7&&(_0x4bc512={..._0x4bc512,'status':_0x443ab7});_0x4c859c&&_0x54a936&&(_0x4bc512={..._0x4bc512,'createdAt':{[sequelize_1['Op'][_0x5ec0e1(0x215)]]:[+(0x0,date_fns_1['startOfDay'])((0x0,date_fns_1[_0x5ec0e1(0x208)])(_0x4c859c)),+(0x0,date_fns_1[_0x5ec0e1(0x20b)])((0x0,date_fns_1['parseISO'])(_0x54a936))]}});if(searchParam){const _0x5d8165=searchParam[_0x5ec0e1(0x219)]()[_0x5ec0e1(0x207)]();_0x505edc=[..._0x505edc,{'model':Message_1[_0x5ec0e1(0x21f)],'as':_0x5ec0e1(0x1eb),'attributes':['id',_0x5ec0e1(0x20f)],'where':{'body':(0x0,sequelize_1[_0x5ec0e1(0x1e8)])((0x0,sequelize_1['fn'])('LOWER',(0x0,sequelize_1['col'])(_0x5ec0e1(0x20f))),_0x5ec0e1(0x1e6),'%'+_0x5d8165+'%')},'required':![],'duplicating':![]}],_0x4bc512={..._0x4bc512,[sequelize_1['Op']['or']]:[{'$contact.name$':(0x0,sequelize_1[_0x5ec0e1(0x1e8)])((0x0,sequelize_1['fn'])(_0x5ec0e1(0x1ec),(0x0,sequelize_1['col'])(_0x5ec0e1(0x210))),_0x5ec0e1(0x1e6),'%'+_0x5d8165+'%')},{'$contact.number$':{[sequelize_1['Op'][_0x5ec0e1(0x201)]]:'%'+_0x5d8165+'%'}},{'$message.body$':(0x0,sequelize_1[_0x5ec0e1(0x1e8)])((0x0,sequelize_1['fn'])(_0x5ec0e1(0x1ec),(0x0,sequelize_1[_0x5ec0e1(0x1e3)])(_0x5ec0e1(0x20f))),_0x5ec0e1(0x1e6),'%'+_0x5d8165+'%')}]};}_0x1bf3cf&&(_0x4bc512={'createdAt':{[sequelize_1['Op'][_0x5ec0e1(0x215)]]:[+(0x0,date_fns_1[_0x5ec0e1(0x1e7)])((0x0,date_fns_1['parseISO'])(_0x1bf3cf)),+(0x0,date_fns_1[_0x5ec0e1(0x20b)])((0x0,date_fns_1[_0x5ec0e1(0x208)])(_0x1bf3cf))]}});_0x19927f&&(_0x4bc512={'updatedAt':{[sequelize_1['Op'][_0x5ec0e1(0x215)]]:[+(0x0,date_fns_1[_0x5ec0e1(0x1e7)])((0x0,date_fns_1[_0x5ec0e1(0x208)])(_0x19927f)),+(0x0,date_fns_1[_0x5ec0e1(0x20b)])((0x0,date_fns_1[_0x5ec0e1(0x208)])(_0x19927f))]}});if(_0x4a97e1===_0x5ec0e1(0x214)){const _0x508d81=await(0x0,ShowUserService_1[_0x5ec0e1(0x21f)])(_0x2b664a),_0x495e20=_0x508d81[_0x5ec0e1(0x213)][_0x5ec0e1(0x209)](_0x43d90b=>_0x43d90b['id']);_0x4bc512={[sequelize_1['Op']['or']]:[{'userId':_0x2b664a},{'status':_0x5ec0e1(0x21a)}],'queueId':{[sequelize_1['Op']['or']]:[_0x495e20,null]},'unreadMessages':{[sequelize_1['Op']['gt']]:0x0}};}if(Array[_0x5ec0e1(0x1fe)](_0x4fdb1e)&&_0x4fdb1e[_0x5ec0e1(0x205)]>0x0){const _0x453e2a=[];for(let _0xedefea of _0x4fdb1e){const _0x18ce96=await TicketTag_1['default']['findAll']({'where':{'tagId':_0xedefea}});_0x18ce96&&_0x453e2a[_0x5ec0e1(0x20c)](_0x18ce96[_0x5ec0e1(0x209)](_0x29aaa7=>_0x29aaa7[_0x5ec0e1(0x1e2)]));}const _0xe1e407=(0x0,lodash_1[_0x5ec0e1(0x21c)])(..._0x453e2a);_0x4bc512={..._0x4bc512,'id':{[sequelize_1['Op']['in']]:_0xe1e407}};}if(Array[_0x5ec0e1(0x1fe)](_0x4c2377)&&_0x4c2377[_0x5ec0e1(0x205)]>0x0){const _0x277cef=[];for(let _0x551267 of _0x4c2377){const _0x28564a=await Ticket_1['default'][_0x5ec0e1(0x1ee)]({'where':{'userId':_0x551267}});_0x28564a&&_0x277cef[_0x5ec0e1(0x20c)](_0x28564a[_0x5ec0e1(0x209)](_0x33c9cc=>_0x33c9cc['id']));}const _0x11aee=(0x0,lodash_1['intersection'])(..._0x277cef);_0x4bc512={..._0x4bc512,'id':{[sequelize_1['Op']['in']]:_0x11aee}};}const _0x3b0cdc=0x28,_0x23e111=_0x3b0cdc*(+pageNumber-0x1);_0x4bc512={..._0x4bc512,'companyId':_0x47ca25};const {count:_0xefef0a,rows:_0x42ced5}=await Ticket_1['default'][_0x5ec0e1(0x1e5)]({'where':_0x4bc512,'include':_0x505edc,'distinct':!![],'limit':_0x3b0cdc,'offset':_0x23e111,'order':[['updatedAt','DESC']],'subQuery':![]}),_0x58e8ad=_0xefef0a>_0x23e111+_0x42ced5[_0x5ec0e1(0x205)];return{'tickets':_0x42ced5,'count':_0xefef0a,'hasMore':_0x58e8ad};};exports[a524_0x4a6da0(0x21f)]=ListTicketsService;