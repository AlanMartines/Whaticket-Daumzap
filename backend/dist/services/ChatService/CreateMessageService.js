const a376_0x38d6fc=a376_0x177b;(function(_0x488942,_0x57efd8){const _0x4b3347=a376_0x177b,_0x1f060d=_0x488942();while(!![]){try{const _0x36fe5f=parseInt(_0x4b3347(0x182))/0x1*(parseInt(_0x4b3347(0x188))/0x2)+-parseInt(_0x4b3347(0x18e))/0x3+-parseInt(_0x4b3347(0x18f))/0x4*(parseInt(_0x4b3347(0x180))/0x5)+parseInt(_0x4b3347(0x176))/0x6*(-parseInt(_0x4b3347(0x18c))/0x7)+-parseInt(_0x4b3347(0x18a))/0x8+-parseInt(_0x4b3347(0x17a))/0x9*(-parseInt(_0x4b3347(0x186))/0xa)+parseInt(_0x4b3347(0x181))/0xb;if(_0x36fe5f===_0x57efd8)break;else _0x1f060d['push'](_0x1f060d['shift']());}catch(_0x2c61f0){_0x1f060d['push'](_0x1f060d['shift']());}}}(a376_0x2727,0x19645));const a376_0x15fbdb=(function(){let _0x22f36a=!![];return function(_0x5e4c59,_0x35547e){const _0x23eb6b=_0x22f36a?function(){const _0x8953cf=a376_0x177b;if(_0x35547e){const _0xe3418e=_0x35547e[_0x8953cf(0x185)](_0x5e4c59,arguments);return _0x35547e=null,_0xe3418e;}}:function(){};return _0x22f36a=![],_0x23eb6b;};}()),a376_0x569531=a376_0x15fbdb(this,function(){const _0x582b6d=a376_0x177b;return a376_0x569531[_0x582b6d(0x191)]()['search']('(((.+)+)+)+$')['toString']()['constructor'](a376_0x569531)[_0x582b6d(0x18b)](_0x582b6d(0x175));});a376_0x569531();'use strict';var __importDefault=this&&this[a376_0x38d6fc(0x179)]||function(_0x2a3c01){const _0x2df382=a376_0x38d6fc;return _0x2a3c01&&_0x2a3c01[_0x2df382(0x192)]?_0x2a3c01:{'default':_0x2a3c01};};Object[a376_0x38d6fc(0x17b)](exports,a376_0x38d6fc(0x192),{'value':!![]});function a376_0x177b(_0x13caac,_0x5586f9){const _0xc3cd30=a376_0x2727();return a376_0x177b=function(_0x569531,_0x15fbdb){_0x569531=_0x569531-0x174;let _0x272753=_0xc3cd30[_0x569531];return _0x272753;},a376_0x177b(_0x13caac,_0x5586f9);}function a376_0x2727(){const _0x26c228=['__importDefault','63bEwvxN','defineProperty','userId','create','findAll','default','5ODewOk','3560216gvloaD','307bndiMJ','name','../../models/Chat','apply','187420nqaaeB','../../models/ChatMessage','866uxKIFn','update','858088gneIya','search','7kaVaXg','unreads','525744kokhsI','201904xtCjuk','reload','toString','__esModule','sender','(((.+)+)+)+$','904746rAWGNo','chat','findByPk'];a376_0x2727=function(){return _0x26c228;};return a376_0x2727();}const Chat_1=__importDefault(require(a376_0x38d6fc(0x184))),ChatMessage_1=__importDefault(require(a376_0x38d6fc(0x187))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require('../../models/User'));async function CreateMessageService({senderId:_0x1a14f3,chatId:_0x3ca428,message:_0x20744c}){const _0x133d5b=a376_0x38d6fc,_0x4c7fff=await ChatMessage_1[_0x133d5b(0x17f)][_0x133d5b(0x17d)]({'senderId':_0x1a14f3,'chatId':_0x3ca428,'message':_0x20744c});await _0x4c7fff[_0x133d5b(0x190)]({'include':[{'model':User_1[_0x133d5b(0x17f)],'as':_0x133d5b(0x174),'attributes':['id','name']},{'model':Chat_1[_0x133d5b(0x17f)],'as':_0x133d5b(0x177),'include':[{'model':ChatUser_1[_0x133d5b(0x17f)],'as':'users'}]}]});const _0x4b7798=await User_1[_0x133d5b(0x17f)][_0x133d5b(0x178)](_0x1a14f3);await _0x4c7fff['chat']['update']({'lastMessage':_0x4b7798[_0x133d5b(0x183)]+':\x20'+_0x20744c});const _0x5da1ee=await ChatUser_1[_0x133d5b(0x17f)][_0x133d5b(0x17e)]({'where':{'chatId':_0x3ca428}});for(let _0x5e28d2 of _0x5da1ee){_0x5e28d2[_0x133d5b(0x17c)]===_0x1a14f3?await _0x5e28d2['update']({'unreads':0x0}):await _0x5e28d2[_0x133d5b(0x189)]({'unreads':_0x5e28d2[_0x133d5b(0x18d)]+0x1});}return _0x4c7fff;}exports[a376_0x38d6fc(0x17f)]=CreateMessageService;