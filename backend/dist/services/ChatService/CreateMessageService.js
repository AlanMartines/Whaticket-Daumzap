const a376_0x10400d=a376_0x20c5;(function(_0x53e02e,_0x21cfe7){const _0x38a7b1=a376_0x20c5,_0x4ce8d3=_0x53e02e();while(!![]){try{const _0x2b2244=parseInt(_0x38a7b1(0x1db))/0x1*(parseInt(_0x38a7b1(0x1df))/0x2)+parseInt(_0x38a7b1(0x1d1))/0x3*(-parseInt(_0x38a7b1(0x1cc))/0x4)+-parseInt(_0x38a7b1(0x1dc))/0x5*(-parseInt(_0x38a7b1(0x1cd))/0x6)+-parseInt(_0x38a7b1(0x1da))/0x7*(-parseInt(_0x38a7b1(0x1d2))/0x8)+parseInt(_0x38a7b1(0x1c5))/0x9+-parseInt(_0x38a7b1(0x1d6))/0xa+-parseInt(_0x38a7b1(0x1d3))/0xb;if(_0x2b2244===_0x21cfe7)break;else _0x4ce8d3['push'](_0x4ce8d3['shift']());}catch(_0x2813a3){_0x4ce8d3['push'](_0x4ce8d3['shift']());}}}(a376_0x39d8,0x76acc));const a376_0x343e37=(function(){let _0x92593b=!![];return function(_0x5a4d15,_0x17cb89){const _0x4e7e48=_0x92593b?function(){if(_0x17cb89){const _0x40faee=_0x17cb89['apply'](_0x5a4d15,arguments);return _0x17cb89=null,_0x40faee;}}:function(){};return _0x92593b=![],_0x4e7e48;};}()),a376_0x1b18cf=a376_0x343e37(this,function(){const _0xb136b6=a376_0x20c5;return a376_0x1b18cf[_0xb136b6(0x1ca)]()[_0xb136b6(0x1c7)]('(((.+)+)+)+$')[_0xb136b6(0x1ca)]()[_0xb136b6(0x1d4)](a376_0x1b18cf)[_0xb136b6(0x1c7)]('(((.+)+)+)+$');});a376_0x1b18cf();'use strict';function a376_0x20c5(_0x1b6b5b,_0x385732){const _0x18f2db=a376_0x39d8();return a376_0x20c5=function(_0x1b18cf,_0x343e37){_0x1b18cf=_0x1b18cf-0x1c4;let _0x39d8cb=_0x18f2db[_0x1b18cf];return _0x39d8cb;},a376_0x20c5(_0x1b6b5b,_0x385732);}function a376_0x39d8(){const _0x10a054=['toString','findAll','102640LAsKDc','9720cJytns','default','reload','update','75nvoUlX','488fFECuu','12580260gtECnn','constructor','../../models/ChatMessage','7813740WXmZZv','findByPk','chat','name','98336IvvBgG','29909HgTsDp','1125ggnTEl','userId','../../models/User','58mYQtXl','../../models/Chat','__esModule','8674533UDLuCe','defineProperty','search','create','unreads'];a376_0x39d8=function(){return _0x10a054;};return a376_0x39d8();}var __importDefault=this&&this['__importDefault']||function(_0x492a1e){const _0x1f676c=a376_0x20c5;return _0x492a1e&&_0x492a1e[_0x1f676c(0x1c4)]?_0x492a1e:{'default':_0x492a1e};};Object[a376_0x10400d(0x1c6)](exports,a376_0x10400d(0x1c4),{'value':!![]});const Chat_1=__importDefault(require(a376_0x10400d(0x1e0))),ChatMessage_1=__importDefault(require(a376_0x10400d(0x1d5))),ChatUser_1=__importDefault(require('../../models/ChatUser')),User_1=__importDefault(require(a376_0x10400d(0x1de)));async function CreateMessageService({senderId:_0x3a18e9,chatId:_0x230dfe,message:_0x2f215d}){const _0x35c485=a376_0x10400d,_0x154d6e=await ChatMessage_1['default'][_0x35c485(0x1c8)]({'senderId':_0x3a18e9,'chatId':_0x230dfe,'message':_0x2f215d});await _0x154d6e[_0x35c485(0x1cf)]({'include':[{'model':User_1[_0x35c485(0x1ce)],'as':'sender','attributes':['id',_0x35c485(0x1d9)]},{'model':Chat_1['default'],'as':_0x35c485(0x1d8),'include':[{'model':ChatUser_1[_0x35c485(0x1ce)],'as':'users'}]}]});const _0x520dc9=await User_1[_0x35c485(0x1ce)][_0x35c485(0x1d7)](_0x3a18e9);await _0x154d6e[_0x35c485(0x1d8)][_0x35c485(0x1d0)]({'lastMessage':_0x520dc9[_0x35c485(0x1d9)]+':\x20'+_0x2f215d});const _0x15d4fd=await ChatUser_1[_0x35c485(0x1ce)][_0x35c485(0x1cb)]({'where':{'chatId':_0x230dfe}});for(let _0x34e84c of _0x15d4fd){_0x34e84c[_0x35c485(0x1dd)]===_0x3a18e9?await _0x34e84c['update']({'unreads':0x0}):await _0x34e84c['update']({'unreads':_0x34e84c[_0x35c485(0x1c9)]+0x1});}return _0x154d6e;}exports[a376_0x10400d(0x1ce)]=CreateMessageService;