function a530_0x5315(){const _0x3a4f78=['stringify','application/json','closed','constructor','../WbotServices/wbotMessageListener','parse','info','defineProperty','status@broadcast','6EDlnqB','request','(((.+)+)+)+$','remoteJid','typebotStatus','length','reload','/continueChat','sendMessage','children','SendPresenceStatus','audio/mp4','content','1143570cVcBcS','bold','input','update','choice\x20input','userId','underline','logger','queueId','default','77FKMiYD','url','post','startsWith','isNil','/startChat','typebotSessionId','updatedAt','stopBot','italic','getMinutes','items','36234fymeNY','toString','9kFczxu','216372ZvzQcN','messages','axios','▶️\x20','companyId','replace','type','key','301yqkSEL','../TicketServices/UpdateTicketService','__esModule','text','@c.us','image','string','Invalid\x20message.\x20Please,\x20try\x20again.','apply','sessionId','lodash','/api/v1/typebots/','804790vAbyzk','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20','24336fGTvae','__importDefault','38119wTMcJF','826096lSKAmH','/api/v1/sessions/'];a530_0x5315=function(){return _0x3a4f78;};return a530_0x5315();}const a530_0x4a51cc=a530_0x3655;(function(_0x570968,_0x55cb9a){const _0x579fdf=a530_0x3655,_0x5056e6=_0x570968();while(!![]){try{const _0x5d40e6=parseInt(_0x579fdf(0x154))/0x1*(parseInt(_0x579fdf(0x116))/0x2)+-parseInt(_0x579fdf(0x13c))/0x3+parseInt(_0x579fdf(0x155))/0x4+parseInt(_0x579fdf(0x123))/0x5+-parseInt(_0x579fdf(0x139))/0x6*(-parseInt(_0x579fdf(0x144))/0x7)+parseInt(_0x579fdf(0x152))/0x8*(parseInt(_0x579fdf(0x13b))/0x9)+-parseInt(_0x579fdf(0x150))/0xa*(parseInt(_0x579fdf(0x12d))/0xb);if(_0x5d40e6===_0x55cb9a)break;else _0x5056e6['push'](_0x5056e6['shift']());}catch(_0x9494bf){_0x5056e6['push'](_0x5056e6['shift']());}}}(a530_0x5315,0x2b2c5));const a530_0xf408f1=(function(){let _0x3054ea=!![];return function(_0x393558,_0x4f7742){const _0x4c365a=_0x3054ea?function(){const _0x2b3469=a530_0x3655;if(_0x4f7742){const _0x517324=_0x4f7742[_0x2b3469(0x14c)](_0x393558,arguments);return _0x4f7742=null,_0x517324;}}:function(){};return _0x3054ea=![],_0x4c365a;};}()),a530_0x3d10d4=a530_0xf408f1(this,function(){const _0x473370=a530_0x3655;return a530_0x3d10d4[_0x473370(0x13a)]()['search']('(((.+)+)+)+$')[_0x473370(0x13a)]()[_0x473370(0x110)](a530_0x3d10d4)['search'](_0x473370(0x118));});a530_0x3d10d4();'use strict';function a530_0x3655(_0x58b987,_0x5b4be5){const _0x3de100=a530_0x5315();return a530_0x3655=function(_0x3d10d4,_0xf408f1){_0x3d10d4=_0x3d10d4-0x10e;let _0x53158c=_0x3de100[_0x3d10d4];return _0x53158c;},a530_0x3655(_0x58b987,_0x5b4be5);}var __importDefault=this&&this[a530_0x4a51cc(0x153)]||function(_0x4f3d27){const _0x531fb9=a530_0x4a51cc;return _0x4f3d27&&_0x4f3d27[_0x531fb9(0x146)]?_0x4f3d27:{'default':_0x4f3d27};};Object[a530_0x4a51cc(0x114)](exports,a530_0x4a51cc(0x146),{'value':!![]});const axios_1=__importDefault(require(a530_0x4a51cc(0x13e))),wbotMessageListener_1=require(a530_0x4a51cc(0x111)),logger_1=require('../../utils/logger'),lodash_1=require(a530_0x4a51cc(0x14e)),UpdateTicketService_1=__importDefault(require(a530_0x4a51cc(0x145))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),typebotListener=async({wbot:_0x2a8dd7,msg:_0x138f7b,ticket:_0x29c13a,typebot:_0x328dfc})=>{const _0x36191d=a530_0x4a51cc;if(_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)]===_0x36191d(0x115))return;const {urlN8N:_0x2252c6,typebotExpires:_0x554b39,typebotKeywordFinish:_0x10b240,typebotKeywordRestart:_0x5456ab,typebotUnknownMessage:_0xbb2744,typebotSlug:_0x47f8f6,typebotDelayMessage:_0x22f71d,typebotRestartMessage:_0x496318}=_0x328dfc,_0x3abcfc=_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)][_0x36191d(0x141)](/\D/g,'');let _0x26e3bd=(0x0,wbotMessageListener_1['getBodyMessage'])(_0x138f7b);async function _0x3a6daf(_0x313bd7,_0x5ab7fb,_0x558e5b){const _0x20ae5d=_0x36191d;try{const _0x514ffd=JSON[_0x20ae5d(0x157)]({'isStreamEnabled':!![],'message':_0x20ae5d(0x14a),'resultId':_0x20ae5d(0x14a),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x558e5b,'pushName':_0x313bd7['pushName']||'','remoteJid':_0x29c13a?.['contact']?.[_0x20ae5d(0x119)]}}),_0x47a39d={'method':_0x20ae5d(0x12f),'maxBodyLength':Infinity,'url':_0x2252c6+_0x20ae5d(0x14f)+_0x47f8f6+_0x20ae5d(0x132),'headers':{'Content-Type':_0x20ae5d(0x10e),'Accept':_0x20ae5d(0x10e)},'data':_0x514ffd},_0x1dba28=await axios_1[_0x20ae5d(0x12c)][_0x20ae5d(0x117)](_0x47a39d);return _0x1dba28['data'];}catch(_0x4a9973){logger_1['logger'][_0x20ae5d(0x113)](_0x20ae5d(0x151),_0x4a9973);throw _0x4a9973;}}let _0x10984e,_0x520c25,_0x2545c6=![];try{const _0x58fbee=new Date();_0x58fbee['setMinutes'](_0x58fbee[_0x36191d(0x137)]()-Number(_0x554b39));_0x554b39>0x0&&_0x29c13a[_0x36191d(0x134)]<_0x58fbee&&(await _0x29c13a[_0x36191d(0x126)]({'typebotSessionId':null,'chatbot':!![]}),await _0x29c13a['reload']());!_0x29c13a['typebotSessionId']?(_0x520c25=await _0x3a6daf(_0x138f7b,_0x328dfc,_0x3abcfc),_0x10984e=_0x520c25[_0x36191d(0x14d)],_0x2545c6=!![],await _0x29c13a[_0x36191d(0x126)]({'typebotSessionId':_0x10984e,'typebotStatus':!![],'useIntegration':!![],'integrationId':_0x328dfc['id']}),await _0x29c13a[_0x36191d(0x11c)]()):(_0x10984e=_0x29c13a[_0x36191d(0x133)],_0x2545c6=_0x29c13a[_0x36191d(0x11a)]);if(!_0x2545c6)return;;if(_0x26e3bd!==_0x10b240&&_0x26e3bd!==_0x5456ab){let _0x229a85,_0x2854c8,_0x51449d;if(_0x520c25?.['messages']['length']===0x0||_0x520c25===undefined){const _0x28da5b=JSON[_0x36191d(0x157)]({'message':_0x26e3bd});let _0x3b4a1a={'method':_0x36191d(0x12f),'maxBodyLength':Infinity,'url':_0x2252c6+_0x36191d(0x156)+_0x10984e+_0x36191d(0x11d),'headers':{'Content-Type':_0x36191d(0x10e),'Accept':_0x36191d(0x10e)},'data':_0x28da5b};_0x229a85=await axios_1[_0x36191d(0x12c)][_0x36191d(0x117)](_0x3b4a1a),_0x2854c8=_0x229a85['data']?.[_0x36191d(0x13d)],_0x51449d=_0x229a85['data']?.[_0x36191d(0x125)];}else _0x2854c8=_0x520c25?.[_0x36191d(0x13d)],_0x51449d=_0x520c25?.['input'];if(_0x2854c8?.[_0x36191d(0x11b)]===0x0)await _0x2a8dd7[_0x36191d(0x11e)](_0x3abcfc+_0x36191d(0x148),{'text':_0xbb2744});else{for(const _0x26ba4e of _0x2854c8){if(_0x26ba4e[_0x36191d(0x142)]===_0x36191d(0x147)){let _0x3d26c3='',_0x221d7a=![];for(const _0x5e89c9 of _0x26ba4e[_0x36191d(0x122)]['richText']){for(const _0x10da81 of _0x5e89c9[_0x36191d(0x11f)]){let _0x3d4f0f='';_0x10da81[_0x36191d(0x147)]&&(_0x3d4f0f=_0x10da81[_0x36191d(0x147)]);if(_0x10da81['type']&&_0x10da81[_0x36191d(0x11f)])for(const _0x19f4b0 of _0x10da81[_0x36191d(0x11f)]){let _0x1973b7='';_0x19f4b0[_0x36191d(0x147)]&&(_0x1973b7=_0x19f4b0['text']);if(_0x19f4b0[_0x36191d(0x142)]&&_0x19f4b0['children'])for(const _0x5cc7ae of _0x19f4b0[_0x36191d(0x11f)]){let _0x4fb6ac='';_0x5cc7ae['text']&&(_0x4fb6ac=_0x5cc7ae[_0x36191d(0x147)]);_0x5cc7ae[_0x36191d(0x124)]&&(_0x4fb6ac='*'+_0x4fb6ac+'*');_0x5cc7ae[_0x36191d(0x136)]&&(_0x4fb6ac='_'+_0x4fb6ac+'_');_0x5cc7ae['underline']&&(_0x4fb6ac='~'+_0x4fb6ac+'~');if(_0x5cc7ae[_0x36191d(0x12e)]){const _0x101e81=_0x5cc7ae[_0x36191d(0x11f)][0x0]['text'];_0x4fb6ac='['+_0x101e81+']('+_0x5cc7ae[_0x36191d(0x12e)]+')',_0x221d7a=!![];}_0x3d26c3+=_0x4fb6ac;}_0x19f4b0['bold']&&(_0x1973b7='*'+_0x1973b7+'*');_0x19f4b0[_0x36191d(0x136)]&&(_0x1973b7='_'+_0x1973b7+'_');_0x19f4b0['underline']&&(_0x1973b7='~'+_0x1973b7+'~');if(_0x19f4b0[_0x36191d(0x12e)]){const _0x1dd8c1=_0x19f4b0['children'][0x0][_0x36191d(0x147)];_0x1973b7='['+_0x1dd8c1+']('+_0x19f4b0[_0x36191d(0x12e)]+')',_0x221d7a=!![];}_0x3d26c3+=_0x1973b7;}_0x10da81[_0x36191d(0x124)]&&(_0x3d4f0f='*'+_0x3d4f0f+'*');_0x10da81[_0x36191d(0x136)]&&(_0x3d4f0f='_'+_0x3d4f0f+'_');_0x10da81[_0x36191d(0x129)]&&(_0x3d4f0f='~'+_0x3d4f0f+'~');if(_0x10da81[_0x36191d(0x12e)]){const _0x2ad76a=_0x10da81[_0x36191d(0x11f)][0x0][_0x36191d(0x147)];_0x3d4f0f='['+_0x2ad76a+']('+_0x10da81[_0x36191d(0x12e)]+')',_0x221d7a=!![];}_0x3d26c3+=_0x3d4f0f;}_0x3d26c3+='\x0a';}_0x3d26c3=_0x3d26c3[_0x36191d(0x141)]('**','')['replace'](/\n$/,'');_0x3d26c3===_0x36191d(0x14b)&&(_0x3d26c3=_0xbb2744);if(_0x3d26c3[_0x36191d(0x130)]('#')){let _0x3c48c2=_0x3d26c3[_0x36191d(0x141)]('#','');try{let _0x5e317d=JSON[_0x36191d(0x112)](_0x3c48c2);if(_0x5e317d[_0x36191d(0x135)]&&(0x0,lodash_1['isNil'])(_0x5e317d['userId'])&&(0x0,lodash_1[_0x36191d(0x131)])(_0x5e317d[_0x36191d(0x12b)])){await _0x29c13a['update']({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1[_0x36191d(0x131)])(_0x5e317d[_0x36191d(0x12b)])&&_0x5e317d[_0x36191d(0x12b)]>0x0&&(0x0,lodash_1[_0x36191d(0x131)])(_0x5e317d[_0x36191d(0x128)])){await(0x0,UpdateTicketService_1[_0x36191d(0x12c)])({'ticketData':{'queueId':_0x5e317d['queueId'],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x29c13a['id'],'companyId':_0x29c13a[_0x36191d(0x140)]});return;}if(!(0x0,lodash_1[_0x36191d(0x131)])(_0x5e317d[_0x36191d(0x12b)])&&_0x5e317d[_0x36191d(0x12b)]>0x0&&!(0x0,lodash_1['isNil'])(_0x5e317d[_0x36191d(0x128)])&&_0x5e317d[_0x36191d(0x128)]>0x0){await(0x0,UpdateTicketService_1[_0x36191d(0x12c)])({'ticketData':{'queueId':_0x5e317d[_0x36191d(0x12b)],'userId':_0x5e317d[_0x36191d(0x128)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x29c13a['id'],'companyId':_0x29c13a[_0x36191d(0x140)]});return;}}catch(_0x2a3425){throw _0x2a3425;}}await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x2a8dd7,_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)],_0x22f71d),await _0x2a8dd7[_0x36191d(0x11e)](_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)],{'text':_0x3d26c3});}if(_0x26ba4e[_0x36191d(0x142)]==='audio'){await(0x0,SendPresenceStatus_1[_0x36191d(0x120)])(_0x2a8dd7,_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)],_0x22f71d);const _0x560c33={'audio':{'url':_0x26ba4e['content']['url'],'mimetype':_0x36191d(0x121),'ptt':!![]}};await _0x2a8dd7[_0x36191d(0x11e)](_0x138f7b['key'][_0x36191d(0x119)],_0x560c33);}if(_0x26ba4e[_0x36191d(0x142)]===_0x36191d(0x149)){await(0x0,SendPresenceStatus_1[_0x36191d(0x120)])(_0x2a8dd7,_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)],_0x22f71d);const _0x46de9d={'image':{'url':_0x26ba4e[_0x36191d(0x122)]['url']}};await _0x2a8dd7['sendMessage'](_0x138f7b['key'][_0x36191d(0x119)],_0x46de9d);}}if(_0x51449d){if(_0x51449d[_0x36191d(0x142)]===_0x36191d(0x127)){let _0x514a6c='';const _0x38b19b=_0x51449d[_0x36191d(0x138)];for(const _0x5a99bf of _0x38b19b){_0x514a6c+=_0x36191d(0x13f)+_0x5a99bf['content']+'\x0a';}_0x514a6c=_0x514a6c[_0x36191d(0x141)](/\n$/,''),await(0x0,SendPresenceStatus_1[_0x36191d(0x120)])(_0x2a8dd7,_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)],_0x22f71d),await _0x2a8dd7[_0x36191d(0x11e)](_0x138f7b[_0x36191d(0x143)][_0x36191d(0x119)],{'text':_0x514a6c});}}}}_0x26e3bd===_0x5456ab&&(await _0x29c13a[_0x36191d(0x126)]({'chatbot':!![],'typebotSessionId':null}),await _0x29c13a['reload'](),await _0x2a8dd7[_0x36191d(0x11e)](_0x3abcfc+'@c.us',{'text':_0x496318}));if(_0x26e3bd===_0x10b240){await(0x0,UpdateTicketService_1[_0x36191d(0x12c)])({'ticketData':{'status':_0x36191d(0x10f),'useIntegration':![],'integrationId':null},'ticketId':_0x29c13a['id'],'companyId':_0x29c13a['companyId']});return;}}catch(_0x56d767){logger_1[_0x36191d(0x12a)][_0x36191d(0x113)]('Error\x20on\x20typebotListener:\x20',_0x56d767),await _0x29c13a[_0x36191d(0x126)]({'typebotSessionId':null});}};exports[a530_0x4a51cc(0x12c)]=typebotListener;