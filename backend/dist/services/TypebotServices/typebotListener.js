function a530_0x3aee(_0x31f04c,_0x22d7a9){const _0x292c5d=a530_0x2263();return a530_0x3aee=function(_0x2bb63c,_0x15a3fc){_0x2bb63c=_0x2bb63c-0x1be;let _0x22632f=_0x292c5d[_0x2bb63c];return _0x22632f;},a530_0x3aee(_0x31f04c,_0x22d7a9);}const a530_0x586acc=a530_0x3aee;(function(_0x5af8fa,_0x17d77a){const _0x32c7b7=a530_0x3aee,_0x5e1076=_0x5af8fa();while(!![]){try{const _0x1dfb09=parseInt(_0x32c7b7(0x1c0))/0x1+parseInt(_0x32c7b7(0x1ce))/0x2*(-parseInt(_0x32c7b7(0x1e3))/0x3)+parseInt(_0x32c7b7(0x1f9))/0x4+parseInt(_0x32c7b7(0x1e0))/0x5+parseInt(_0x32c7b7(0x1df))/0x6*(-parseInt(_0x32c7b7(0x1cd))/0x7)+parseInt(_0x32c7b7(0x1cc))/0x8*(parseInt(_0x32c7b7(0x1eb))/0x9)+-parseInt(_0x32c7b7(0x1c7))/0xa*(-parseInt(_0x32c7b7(0x1de))/0xb);if(_0x1dfb09===_0x17d77a)break;else _0x5e1076['push'](_0x5e1076['shift']());}catch(_0x1d8d7b){_0x5e1076['push'](_0x5e1076['shift']());}}}(a530_0x2263,0x9fd11));const a530_0x15a3fc=(function(){let _0x2337eb=!![];return function(_0x1dbfd5,_0x233055){const _0x4a15b0=_0x2337eb?function(){if(_0x233055){const _0x2ffede=_0x233055['apply'](_0x1dbfd5,arguments);return _0x233055=null,_0x2ffede;}}:function(){};return _0x2337eb=![],_0x4a15b0;};}()),a530_0x2bb63c=a530_0x15a3fc(this,function(){const _0x5f3c24=a530_0x3aee;return a530_0x2bb63c[_0x5f3c24(0x1c8)]()[_0x5f3c24(0x1fb)](_0x5f3c24(0x205))[_0x5f3c24(0x1c8)]()['constructor'](a530_0x2bb63c)[_0x5f3c24(0x1fb)](_0x5f3c24(0x205));});a530_0x2bb63c();'use strict';var __importDefault=this&&this[a530_0x586acc(0x1f4)]||function(_0x2d8998){const _0x5f0f3e=a530_0x586acc;return _0x2d8998&&_0x2d8998[_0x5f0f3e(0x1fa)]?_0x2d8998:{'default':_0x2d8998};};Object[a530_0x586acc(0x1ec)](exports,a530_0x586acc(0x1fa),{'value':!![]});function a530_0x2263(){const _0x6fc96c=['post','remoteJid','isNil','sessionId','1045ukNuoL','12aWvPdX','1893830GNtMPu','request','getMinutes','360849weJuzJ','setMinutes','queueId','stringify','input','Error\x20on\x20typebotListener:\x20','messages','../../utils/logger','235278AdILoa','defineProperty','closed','bold','../../helpers/SendPresenceStatus','▶️\x20','richText','startsWith','/startChat','__importDefault','typebotStatus','../WbotServices/wbotMessageListener','info','status@broadcast','2534736ewKwlN','__esModule','search','underline','/continueChat','type','audio/mp4','logger','../TicketServices/UpdateTicketService','string','typebotSessionId','replace','(((.+)+)+)+$','data','/api/v1/sessions/','choice\x20input','userId','stopBot','Invalid\x20message.\x20Please,\x20try\x20again.','application/json','getBodyMessage','1024123bJEHQA','length','url','SendPresenceStatus','text','content','key','23770Rgcnuz','toString','axios','italic','/api/v1/typebots/','104DrWdsX','3027773TMnjMG','18HEmYwC','sendMessage','lodash','children','companyId','audio','@c.us','Erro\x20ao\x20criar\x20sessão\x20do\x20typebot:\x20','default','reload','updatedAt','update'];a530_0x2263=function(){return _0x6fc96c;};return a530_0x2263();}const axios_1=__importDefault(require(a530_0x586acc(0x1c9))),wbotMessageListener_1=require(a530_0x586acc(0x1f6)),logger_1=require(a530_0x586acc(0x1ea)),lodash_1=require(a530_0x586acc(0x1d0)),UpdateTicketService_1=__importDefault(require(a530_0x586acc(0x201))),SendPresenceStatus_1=require(a530_0x586acc(0x1ef)),typebotListener=async({wbot:_0x41d17d,msg:_0x49b04c,ticket:_0x16f1ff,typebot:_0xbf7ebd})=>{const _0x1525f9=a530_0x586acc;if(_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)]===_0x1525f9(0x1f8))return;const {urlN8N:_0x3ffc19,typebotExpires:_0x425a88,typebotKeywordFinish:_0x4a4733,typebotKeywordRestart:_0x195fa2,typebotUnknownMessage:_0xc563e5,typebotSlug:_0x5c7472,typebotDelayMessage:_0x49c09f,typebotRestartMessage:_0x2914c7}=_0xbf7ebd,_0x590771=_0x49b04c[_0x1525f9(0x1c6)]['remoteJid'][_0x1525f9(0x204)](/\D/g,'');let _0x34b78d=(0x0,wbotMessageListener_1[_0x1525f9(0x1bf)])(_0x49b04c);async function _0x15c877(_0x275314,_0xbd39cf,_0x5c905b){const _0x2584f1=_0x1525f9;try{const _0x5c589c=JSON['stringify']({'isStreamEnabled':!![],'message':_0x2584f1(0x202),'resultId':_0x2584f1(0x202),'isOnlyRegistering':![],'prefilledVariables':{'number':_0x5c905b,'pushName':_0x275314['pushName']||'','remoteJid':_0x16f1ff?.['contact']?.[_0x2584f1(0x1db)]}}),_0x357203={'method':_0x2584f1(0x1da),'maxBodyLength':Infinity,'url':_0x3ffc19+_0x2584f1(0x1cb)+_0x5c7472+_0x2584f1(0x1f3),'headers':{'Content-Type':'application/json','Accept':_0x2584f1(0x1be)},'data':_0x5c589c},_0x3b1cb9=await axios_1[_0x2584f1(0x1d6)]['request'](_0x357203);return _0x3b1cb9['data'];}catch(_0x4cc73a){logger_1[_0x2584f1(0x200)][_0x2584f1(0x1f7)](_0x2584f1(0x1d5),_0x4cc73a);throw _0x4cc73a;}}let _0x5279c9,_0x1fee74,_0x1c86b8=![];try{const _0x29f2b5=new Date();_0x29f2b5[_0x1525f9(0x1e4)](_0x29f2b5[_0x1525f9(0x1e2)]()-Number(_0x425a88));_0x425a88>0x0&&_0x16f1ff[_0x1525f9(0x1d8)]<_0x29f2b5&&(await _0x16f1ff[_0x1525f9(0x1d9)]({'typebotSessionId':null,'chatbot':!![]}),await _0x16f1ff[_0x1525f9(0x1d7)]());!_0x16f1ff[_0x1525f9(0x203)]?(_0x1fee74=await _0x15c877(_0x49b04c,_0xbf7ebd,_0x590771),_0x5279c9=_0x1fee74[_0x1525f9(0x1dd)],_0x1c86b8=!![],await _0x16f1ff['update']({'typebotSessionId':_0x5279c9,'typebotStatus':!![],'useIntegration':!![],'integrationId':_0xbf7ebd['id']}),await _0x16f1ff[_0x1525f9(0x1d7)]()):(_0x5279c9=_0x16f1ff['typebotSessionId'],_0x1c86b8=_0x16f1ff[_0x1525f9(0x1f5)]);if(!_0x1c86b8)return;;if(_0x34b78d!==_0x4a4733&&_0x34b78d!==_0x195fa2){let _0x100236,_0x2a61c2,_0x2fcc66;if(_0x1fee74?.[_0x1525f9(0x1e9)][_0x1525f9(0x1c1)]===0x0||_0x1fee74===undefined){const _0x5db78e=JSON[_0x1525f9(0x1e6)]({'message':_0x34b78d});let _0x4d65bf={'method':'post','maxBodyLength':Infinity,'url':_0x3ffc19+_0x1525f9(0x207)+_0x5279c9+_0x1525f9(0x1fd),'headers':{'Content-Type':_0x1525f9(0x1be),'Accept':_0x1525f9(0x1be)},'data':_0x5db78e};_0x100236=await axios_1[_0x1525f9(0x1d6)][_0x1525f9(0x1e1)](_0x4d65bf),_0x2a61c2=_0x100236[_0x1525f9(0x206)]?.[_0x1525f9(0x1e9)],_0x2fcc66=_0x100236[_0x1525f9(0x206)]?.['input'];}else _0x2a61c2=_0x1fee74?.[_0x1525f9(0x1e9)],_0x2fcc66=_0x1fee74?.[_0x1525f9(0x1e7)];if(_0x2a61c2?.['length']===0x0)await _0x41d17d[_0x1525f9(0x1cf)](_0x590771+'@c.us',{'text':_0xc563e5});else{for(const _0x17b120 of _0x2a61c2){if(_0x17b120[_0x1525f9(0x1fe)]==='text'){let _0x1bd747='',_0x38fc71=![];for(const _0x3f7467 of _0x17b120['content'][_0x1525f9(0x1f1)]){for(const _0x182c32 of _0x3f7467[_0x1525f9(0x1d1)]){let _0x52e3d5='';_0x182c32[_0x1525f9(0x1c4)]&&(_0x52e3d5=_0x182c32[_0x1525f9(0x1c4)]);if(_0x182c32['type']&&_0x182c32[_0x1525f9(0x1d1)])for(const _0x5e7a7a of _0x182c32[_0x1525f9(0x1d1)]){let _0x3722e9='';_0x5e7a7a[_0x1525f9(0x1c4)]&&(_0x3722e9=_0x5e7a7a['text']);if(_0x5e7a7a[_0x1525f9(0x1fe)]&&_0x5e7a7a[_0x1525f9(0x1d1)])for(const _0x5c1fce of _0x5e7a7a[_0x1525f9(0x1d1)]){let _0xbab0a8='';_0x5c1fce[_0x1525f9(0x1c4)]&&(_0xbab0a8=_0x5c1fce[_0x1525f9(0x1c4)]);_0x5c1fce[_0x1525f9(0x1ee)]&&(_0xbab0a8='*'+_0xbab0a8+'*');_0x5c1fce[_0x1525f9(0x1ca)]&&(_0xbab0a8='_'+_0xbab0a8+'_');_0x5c1fce[_0x1525f9(0x1fc)]&&(_0xbab0a8='~'+_0xbab0a8+'~');if(_0x5c1fce[_0x1525f9(0x1c2)]){const _0x4a8521=_0x5c1fce[_0x1525f9(0x1d1)][0x0]['text'];_0xbab0a8='['+_0x4a8521+']('+_0x5c1fce[_0x1525f9(0x1c2)]+')',_0x38fc71=!![];}_0x1bd747+=_0xbab0a8;}_0x5e7a7a[_0x1525f9(0x1ee)]&&(_0x3722e9='*'+_0x3722e9+'*');_0x5e7a7a[_0x1525f9(0x1ca)]&&(_0x3722e9='_'+_0x3722e9+'_');_0x5e7a7a[_0x1525f9(0x1fc)]&&(_0x3722e9='~'+_0x3722e9+'~');if(_0x5e7a7a[_0x1525f9(0x1c2)]){const _0x2346cf=_0x5e7a7a[_0x1525f9(0x1d1)][0x0][_0x1525f9(0x1c4)];_0x3722e9='['+_0x2346cf+']('+_0x5e7a7a['url']+')',_0x38fc71=!![];}_0x1bd747+=_0x3722e9;}_0x182c32['bold']&&(_0x52e3d5='*'+_0x52e3d5+'*');_0x182c32[_0x1525f9(0x1ca)]&&(_0x52e3d5='_'+_0x52e3d5+'_');_0x182c32[_0x1525f9(0x1fc)]&&(_0x52e3d5='~'+_0x52e3d5+'~');if(_0x182c32[_0x1525f9(0x1c2)]){const _0x301adf=_0x182c32[_0x1525f9(0x1d1)][0x0][_0x1525f9(0x1c4)];_0x52e3d5='['+_0x301adf+']('+_0x182c32[_0x1525f9(0x1c2)]+')',_0x38fc71=!![];}_0x1bd747+=_0x52e3d5;}_0x1bd747+='\x0a';}_0x1bd747=_0x1bd747['replace']('**','')[_0x1525f9(0x204)](/\n$/,'');_0x1bd747===_0x1525f9(0x20b)&&(_0x1bd747=_0xc563e5);if(_0x1bd747[_0x1525f9(0x1f2)]('#')){let _0x3e4597=_0x1bd747[_0x1525f9(0x204)]('#','');try{let _0x13a828=JSON['parse'](_0x3e4597);if(_0x13a828[_0x1525f9(0x20a)]&&(0x0,lodash_1[_0x1525f9(0x1dc)])(_0x13a828[_0x1525f9(0x209)])&&(0x0,lodash_1[_0x1525f9(0x1dc)])(_0x13a828[_0x1525f9(0x1e5)])){await _0x16f1ff[_0x1525f9(0x1d9)]({'useIntegration':![],'chatbot':![]});return;}if(!(0x0,lodash_1['isNil'])(_0x13a828[_0x1525f9(0x1e5)])&&_0x13a828[_0x1525f9(0x1e5)]>0x0&&(0x0,lodash_1[_0x1525f9(0x1dc)])(_0x13a828[_0x1525f9(0x209)])){await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x13a828[_0x1525f9(0x1e5)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x16f1ff['id'],'companyId':_0x16f1ff[_0x1525f9(0x1d2)]});return;}if(!(0x0,lodash_1[_0x1525f9(0x1dc)])(_0x13a828[_0x1525f9(0x1e5)])&&_0x13a828[_0x1525f9(0x1e5)]>0x0&&!(0x0,lodash_1[_0x1525f9(0x1dc)])(_0x13a828[_0x1525f9(0x209)])&&_0x13a828[_0x1525f9(0x209)]>0x0){await(0x0,UpdateTicketService_1[_0x1525f9(0x1d6)])({'ticketData':{'queueId':_0x13a828[_0x1525f9(0x1e5)],'userId':_0x13a828[_0x1525f9(0x209)],'chatbot':![],'useIntegration':![],'integrationId':null},'ticketId':_0x16f1ff['id'],'companyId':_0x16f1ff[_0x1525f9(0x1d2)]});return;}}catch(_0x260365){throw _0x260365;}}await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x41d17d,_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)],_0x49c09f),await _0x41d17d[_0x1525f9(0x1cf)](_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)],{'text':_0x1bd747});}if(_0x17b120['type']===_0x1525f9(0x1d3)){await(0x0,SendPresenceStatus_1[_0x1525f9(0x1c3)])(_0x41d17d,_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)],_0x49c09f);const _0x588b0e={'audio':{'url':_0x17b120[_0x1525f9(0x1c5)][_0x1525f9(0x1c2)],'mimetype':_0x1525f9(0x1ff),'ptt':!![]}};await _0x41d17d[_0x1525f9(0x1cf)](_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)],_0x588b0e);}if(_0x17b120[_0x1525f9(0x1fe)]==='image'){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0x41d17d,_0x49b04c['key'][_0x1525f9(0x1db)],_0x49c09f);const _0x27db04={'image':{'url':_0x17b120['content'][_0x1525f9(0x1c2)]}};await _0x41d17d[_0x1525f9(0x1cf)](_0x49b04c[_0x1525f9(0x1c6)]['remoteJid'],_0x27db04);}}if(_0x2fcc66){if(_0x2fcc66[_0x1525f9(0x1fe)]===_0x1525f9(0x208)){let _0x44518f='';const _0x4be8b5=_0x2fcc66['items'];for(const _0xb4a937 of _0x4be8b5){_0x44518f+=_0x1525f9(0x1f0)+_0xb4a937[_0x1525f9(0x1c5)]+'\x0a';}_0x44518f=_0x44518f['replace'](/\n$/,''),await(0x0,SendPresenceStatus_1[_0x1525f9(0x1c3)])(_0x41d17d,_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)],_0x49c09f),await _0x41d17d['sendMessage'](_0x49b04c[_0x1525f9(0x1c6)][_0x1525f9(0x1db)],{'text':_0x44518f});}}}}_0x34b78d===_0x195fa2&&(await _0x16f1ff[_0x1525f9(0x1d9)]({'chatbot':!![],'typebotSessionId':null}),await _0x16f1ff[_0x1525f9(0x1d7)](),await _0x41d17d[_0x1525f9(0x1cf)](_0x590771+_0x1525f9(0x1d4),{'text':_0x2914c7}));if(_0x34b78d===_0x4a4733){await(0x0,UpdateTicketService_1[_0x1525f9(0x1d6)])({'ticketData':{'status':_0x1525f9(0x1ed),'useIntegration':![],'integrationId':null},'ticketId':_0x16f1ff['id'],'companyId':_0x16f1ff[_0x1525f9(0x1d2)]});return;}}catch(_0x312b94){logger_1['logger'][_0x1525f9(0x1f7)](_0x1525f9(0x1e8),_0x312b94),await _0x16f1ff['update']({'typebotSessionId':null});}};exports[a530_0x586acc(0x1d6)]=typebotListener;