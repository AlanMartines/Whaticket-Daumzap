const a556_0x14eb54=a556_0x25a3;(function(_0x505283,_0x4f7932){const _0x2f663d=a556_0x25a3,_0x1f45a4=_0x505283();while(!![]){try{const _0x2b77ea=-parseInt(_0x2f663d(0x125))/0x1+-parseInt(_0x2f663d(0x142))/0x2+-parseInt(_0x2f663d(0x118))/0x3+parseInt(_0x2f663d(0x148))/0x4+parseInt(_0x2f663d(0x116))/0x5*(parseInt(_0x2f663d(0x137))/0x6)+-parseInt(_0x2f663d(0x12c))/0x7*(parseInt(_0x2f663d(0x144))/0x8)+parseInt(_0x2f663d(0x11d))/0x9;if(_0x2b77ea===_0x4f7932)break;else _0x1f45a4['push'](_0x1f45a4['shift']());}catch(_0x3d949a){_0x1f45a4['push'](_0x1f45a4['shift']());}}}(a556_0x272e,0xc0ba3));const a556_0xce36ce=(function(){let _0x30f2e2=!![];return function(_0x2301df,_0x31bce3){const _0x418b3f=_0x30f2e2?function(){const _0x3f49e4=a556_0x25a3;if(_0x31bce3){const _0x58c2f5=_0x31bce3[_0x3f49e4(0x117)](_0x2301df,arguments);return _0x31bce3=null,_0x58c2f5;}}:function(){};return _0x30f2e2=![],_0x418b3f;};}()),a556_0x11549d=a556_0xce36ce(this,function(){const _0x46b441=a556_0x25a3;return a556_0x11549d[_0x46b441(0x124)]()[_0x46b441(0x133)]('(((.+)+)+)+$')[_0x46b441(0x124)]()[_0x46b441(0x131)](a556_0x11549d)[_0x46b441(0x133)](_0x46b441(0x120));});a556_0x11549d();'use strict';var __importDefault=this&&this[a556_0x14eb54(0x136)]||function(_0x4c7501){const _0x1b49c6=a556_0x14eb54;return _0x4c7501&&_0x4c7501[_0x1b49c6(0x11c)]?_0x4c7501:{'default':_0x4c7501};};Object['defineProperty'](exports,a556_0x14eb54(0x11c),{'value':!![]}),exports[a556_0x14eb54(0x11b)]=void 0x0;const sequelize_1=require(a556_0x14eb54(0x130)),Ticket_1=__importDefault(require(a556_0x14eb54(0x12a))),Whatsapp_1=__importDefault(require(a556_0x14eb54(0x146))),socket_1=require(a556_0x14eb54(0x139)),Mustache_1=__importDefault(require(a556_0x14eb54(0x11e))),SendWhatsAppMessage_1=__importDefault(require(a556_0x14eb54(0x11f))),moment_1=__importDefault(require(a556_0x14eb54(0x13c))),ShowTicketService_1=__importDefault(require(a556_0x14eb54(0x11a))),wbotMessageListener_1=require('./wbotMessageListener'),TicketTraking_1=__importDefault(require(a556_0x14eb54(0x127))),SendPresenceStatus_1=require(a556_0x14eb54(0x140)),wbot_1=require(a556_0x14eb54(0x12f)),ClosedAllOpenTickets=async _0x741b6=>{const _0xa63302=a556_0x14eb54,_0x48cfc2=async(_0x4efffe,_0x2e92d2,_0x5bb34e)=>{const _0x5d43be=a556_0x25a3;if(_0x2e92d2==='nps')typeof _0x5bb34e!=_0x5d43be(0x132)&&console['trace']('body\x20is\x20not\x20a\x20string',_0x5bb34e),await _0x4efffe[_0x5d43be(0x12d)]({'status':_0x5d43be(0x14b),'lastMessage':_0x5bb34e,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x2e92d2===_0x5d43be(0x12b)?(typeof _0x5bb34e!=_0x5d43be(0x132)&&console[_0x5d43be(0x135)]('body\x20is\x20not\x20a\x20string',_0x5bb34e),await _0x4efffe['update']({'status':'closed','lastMessage':_0x5bb34e,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x4efffe[_0x5d43be(0x12d)]({'status':_0x5d43be(0x14b),'unreadMessages':0x0});},_0x4f1345=(0x0,socket_1['getIO'])();try{const {rows:_0x9edd6b}=await Ticket_1[_0xa63302(0x141)][_0xa63302(0x13f)]({'where':{'status':{[sequelize_1['Op']['in']]:[_0xa63302(0x12b)]},'companyId':_0x741b6},'order':[[_0xa63302(0x13b),_0xa63302(0x128)]]});for(const _0x5982af of _0x9edd6b){const _0x1331ca=await(0x0,ShowTicketService_1[_0xa63302(0x141)])(_0x5982af['id'],_0x741b6),_0x4fc09e=await Whatsapp_1[_0xa63302(0x141)][_0xa63302(0x122)](_0x1331ca?.['whatsappId']);if(!_0x4fc09e)continue;const _0x8e6654=await TicketTraking_1['default'][_0xa63302(0x119)]({'where':{'ticketId':_0x5982af['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x5f0e24,expiresTicket:_0x1b95bb}=_0x4fc09e;if(_0x1b95bb&&_0x1b95bb!==''&&_0x1b95bb!=='0'&&Number(_0x1b95bb)>0x0){const _0x2a25c0=(0x0,Mustache_1[_0xa63302(0x141)])('â€Ž\x20'+_0x5f0e24,_0x1331ca),_0x3438d2=new Date();_0x3438d2[_0xa63302(0x138)](_0x3438d2[_0xa63302(0x13e)]()-Number(_0x1b95bb));if(_0x1331ca[_0xa63302(0x13a)]===_0xa63302(0x12b)&&!_0x1331ca[_0xa63302(0x14c)]){const _0x349fca=new Date(_0x1331ca[_0xa63302(0x13b)]);if(_0x349fca<_0x3438d2&&_0x1331ca[_0xa63302(0x145)]){await _0x48cfc2(_0x1331ca,_0x1331ca[_0xa63302(0x13a)],_0x2a25c0);if(_0x5f0e24!==''&&_0x5f0e24!==undefined){await(0x0,SendPresenceStatus_1['SendPresenceStatus'])((0x0,wbot_1[_0xa63302(0x12e)])(_0x5982af[_0xa63302(0x149)]),_0x5982af['contact']['number']+'@'+(_0x5982af[_0xa63302(0x14c)]?'g.us':_0xa63302(0x143)));const _0x609ee=await(0x0,SendWhatsAppMessage_1['default'])({'body':_0x2a25c0,'ticket':_0x1331ca});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x609ee,_0x1331ca,_0x1331ca[_0xa63302(0x121)]);}await _0x8e6654[_0xa63302(0x12d)]({'finishedAt':(0x0,moment_1[_0xa63302(0x141)])()['toDate'](),'closedAt':(0x0,moment_1['default'])()[_0xa63302(0x129)](),'whatsappId':_0x5982af[_0xa63302(0x149)],'userId':_0x5982af[_0xa63302(0x14d)]}),_0x4f1345['to'](_0xa63302(0x123)+_0x5982af[_0xa63302(0x134)]+_0xa63302(0x126))[_0xa63302(0x147)]('company-'+_0x741b6+_0xa63302(0x14a),{'action':'delete','ticketId':_0x1331ca['id']});}}}}}catch(_0x2737be){console[_0xa63302(0x13d)]('e',_0x2737be);}};exports[a556_0x14eb54(0x11b)]=ClosedAllOpenTickets;function a556_0x25a3(_0x3e4788,_0x3b2dde){const _0xb3ab01=a556_0x272e();return a556_0x25a3=function(_0x11549d,_0xce36ce){_0x11549d=_0x11549d-0x116;let _0x272e45=_0xb3ab01[_0x11549d];return _0x272e45;},a556_0x25a3(_0x3e4788,_0x3b2dde);}function a556_0x272e(){const _0x5f58dd=['../../helpers/Mustache','./SendWhatsAppMessage','(((.+)+)+)+$','contact','findByPk','company-','toString','709268dHUuMH','-open','../../models/TicketTraking','DESC','toDate','../../models/Ticket','open','3421698rbOaiL','update','getWbot','../../libs/wbot','sequelize','constructor','string','search','companyId','trace','__importDefault','12FQhKAZ','setMinutes','../../libs/socket','status','updatedAt','moment','log','getMinutes','findAndCountAll','../../helpers/SendPresenceStatus','default','1310078LmbJCT','s.whatsapp.net','16FtDTBe','fromMe','../../models/Whatsapp','emit','3952420gQutLQ','whatsappId','-ticket','closed','isGroup','userId','329435nXksvo','apply','4082658mXbNkg','findOne','../TicketServices/ShowTicketService','ClosedAllOpenTickets','__esModule','30351177VZXaAn'];a556_0x272e=function(){return _0x5f58dd;};return a556_0x272e();}