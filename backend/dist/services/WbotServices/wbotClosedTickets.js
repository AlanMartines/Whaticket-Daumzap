const a556_0x4a8920=a556_0x5932;(function(_0x3b2ce1,_0x2667b6){const _0x4d43b2=a556_0x5932,_0x5b5717=_0x3b2ce1();while(!![]){try{const _0x1e861f=parseInt(_0x4d43b2(0x148))/0x1*(-parseInt(_0x4d43b2(0x149))/0x2)+parseInt(_0x4d43b2(0x14b))/0x3*(parseInt(_0x4d43b2(0x128))/0x4)+parseInt(_0x4d43b2(0x156))/0x5+-parseInt(_0x4d43b2(0x15a))/0x6*(-parseInt(_0x4d43b2(0x158))/0x7)+-parseInt(_0x4d43b2(0x15d))/0x8+-parseInt(_0x4d43b2(0x153))/0x9*(-parseInt(_0x4d43b2(0x151))/0xa)+-parseInt(_0x4d43b2(0x127))/0xb*(parseInt(_0x4d43b2(0x13a))/0xc);if(_0x1e861f===_0x2667b6)break;else _0x5b5717['push'](_0x5b5717['shift']());}catch(_0x51f370){_0x5b5717['push'](_0x5b5717['shift']());}}}(a556_0x2dce,0x8616d));const a556_0x424054=(function(){let _0x36ac38=!![];return function(_0x41d186,_0x2da658){const _0x40a427=_0x36ac38?function(){const _0x5b211c=a556_0x5932;if(_0x2da658){const _0x5e03dd=_0x2da658[_0x5b211c(0x14c)](_0x41d186,arguments);return _0x2da658=null,_0x5e03dd;}}:function(){};return _0x36ac38=![],_0x40a427;};}()),a556_0x467b75=a556_0x424054(this,function(){const _0x495304=a556_0x5932;return a556_0x467b75['toString']()['search'](_0x495304(0x155))[_0x495304(0x14d)]()[_0x495304(0x136)](a556_0x467b75)['search']('(((.+)+)+)+$');});function a556_0x2dce(){const _0x593369=['whatsappId','-open','closed','findByPk','../TicketServices/ShowTicketService','DESC','body\x20is\x20not\x20a\x20string','2RCHoea','589618RmLZbA','ClosedAllOpenTickets','2682141VdDvDa','apply','toString','updatedAt','number','verifyMessage','30zlKuSl','./wbotMessageListener','2372157CVjNQA','status','(((.+)+)+)+$','5389805JUqsAV','trace','4901379vdHgJp','SendPresenceStatus','6uvzHxr','userId','../../models/Whatsapp','929968TpAuQR','string','11LgqLrl','4ciNLQn','open','update','../../libs/socket','findAndCountAll','getMinutes','-ticket','emit','nps','toDate','getIO','log','findOne','companyId','constructor','fromMe','../../helpers/Mustache','../../libs/wbot','26493972dEdZpP','default','company-','contact','__esModule','delete','setMinutes'];a556_0x2dce=function(){return _0x593369;};return a556_0x2dce();}a556_0x467b75();'use strict';function a556_0x5932(_0x286624,_0x123a4f){const _0x407cea=a556_0x2dce();return a556_0x5932=function(_0x467b75,_0x424054){_0x467b75=_0x467b75-0x127;let _0x2dce67=_0x407cea[_0x467b75];return _0x2dce67;},a556_0x5932(_0x286624,_0x123a4f);}var __importDefault=this&&this['__importDefault']||function(_0x46c204){return _0x46c204&&_0x46c204['__esModule']?_0x46c204:{'default':_0x46c204};};Object['defineProperty'](exports,a556_0x4a8920(0x13e),{'value':!![]}),exports[a556_0x4a8920(0x14a)]=void 0x0;const sequelize_1=require('sequelize'),Ticket_1=__importDefault(require('../../models/Ticket')),Whatsapp_1=__importDefault(require(a556_0x4a8920(0x15c))),socket_1=require(a556_0x4a8920(0x12b)),Mustache_1=__importDefault(require(a556_0x4a8920(0x138))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require('moment')),ShowTicketService_1=__importDefault(require(a556_0x4a8920(0x145))),wbotMessageListener_1=require(a556_0x4a8920(0x152)),TicketTraking_1=__importDefault(require('../../models/TicketTraking')),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),wbot_1=require(a556_0x4a8920(0x139)),ClosedAllOpenTickets=async _0x170978=>{const _0x436320=a556_0x4a8920,_0x36d41f=async(_0x2ed480,_0x44c91d,_0x15c465)=>{const _0x24ce58=a556_0x5932;if(_0x44c91d===_0x24ce58(0x130))typeof _0x15c465!=_0x24ce58(0x15e)&&console[_0x24ce58(0x157)](_0x24ce58(0x147),_0x15c465),await _0x2ed480[_0x24ce58(0x12a)]({'status':'closed','lastMessage':_0x15c465,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x44c91d===_0x24ce58(0x129)?(typeof _0x15c465!=_0x24ce58(0x15e)&&console['trace'](_0x24ce58(0x147),_0x15c465),await _0x2ed480[_0x24ce58(0x12a)]({'status':_0x24ce58(0x143),'lastMessage':_0x15c465,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x2ed480[_0x24ce58(0x12a)]({'status':'closed','unreadMessages':0x0});},_0x41f6b6=(0x0,socket_1[_0x436320(0x132)])();try{const {rows:_0x5ba245}=await Ticket_1[_0x436320(0x13b)][_0x436320(0x12c)]({'where':{'status':{[sequelize_1['Op']['in']]:[_0x436320(0x129)]},'companyId':_0x170978},'order':[['updatedAt',_0x436320(0x146)]]});for(const _0x4145a6 of _0x5ba245){const _0x4b4be9=await(0x0,ShowTicketService_1[_0x436320(0x13b)])(_0x4145a6['id'],_0x170978),_0x563bbd=await Whatsapp_1[_0x436320(0x13b)][_0x436320(0x144)](_0x4b4be9?.[_0x436320(0x141)]);if(!_0x563bbd)continue;const _0x53ddc0=await TicketTraking_1[_0x436320(0x13b)][_0x436320(0x134)]({'where':{'ticketId':_0x4145a6['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x5c04b4,expiresTicket:_0x3053aa}=_0x563bbd;if(_0x3053aa&&_0x3053aa!==''&&_0x3053aa!=='0'&&Number(_0x3053aa)>0x0){const _0x44ad41=(0x0,Mustache_1[_0x436320(0x13b)])('â€Ž\x20'+_0x5c04b4,_0x4b4be9),_0x158b0c=new Date();_0x158b0c[_0x436320(0x140)](_0x158b0c[_0x436320(0x12d)]()-Number(_0x3053aa));if(_0x4b4be9[_0x436320(0x154)]===_0x436320(0x129)&&!_0x4b4be9['isGroup']){const _0x12c67a=new Date(_0x4b4be9[_0x436320(0x14e)]);if(_0x12c67a<_0x158b0c&&_0x4b4be9[_0x436320(0x137)]){await _0x36d41f(_0x4b4be9,_0x4b4be9[_0x436320(0x154)],_0x44ad41);if(_0x5c04b4!==''&&_0x5c04b4!==undefined){await(0x0,SendPresenceStatus_1[_0x436320(0x159)])((0x0,wbot_1['getWbot'])(_0x4145a6[_0x436320(0x141)]),_0x4145a6[_0x436320(0x13d)][_0x436320(0x14f)]+'@'+(_0x4145a6['isGroup']?'g.us':'s.whatsapp.net'));const _0x2f685b=await(0x0,SendWhatsAppMessage_1[_0x436320(0x13b)])({'body':_0x44ad41,'ticket':_0x4b4be9});await(0x0,wbotMessageListener_1[_0x436320(0x150)])(_0x2f685b,_0x4b4be9,_0x4b4be9['contact']);}await _0x53ddc0[_0x436320(0x12a)]({'finishedAt':(0x0,moment_1[_0x436320(0x13b)])()[_0x436320(0x131)](),'closedAt':(0x0,moment_1[_0x436320(0x13b)])()[_0x436320(0x131)](),'whatsappId':_0x4145a6['whatsappId'],'userId':_0x4145a6[_0x436320(0x15b)]}),_0x41f6b6['to'](_0x436320(0x13c)+_0x4145a6[_0x436320(0x135)]+_0x436320(0x142))[_0x436320(0x12f)]('company-'+_0x170978+_0x436320(0x12e),{'action':_0x436320(0x13f),'ticketId':_0x4b4be9['id']});}}}}}catch(_0x2282c5){console[_0x436320(0x133)]('e',_0x2282c5);}};exports[a556_0x4a8920(0x14a)]=ClosedAllOpenTickets;