function a556_0x1802(_0x58683f,_0x3cfedf){const _0x18e142=a556_0x3a9a();return a556_0x1802=function(_0x767082,_0x2fc9bd){_0x767082=_0x767082-0xb9;let _0x3a9a9a=_0x18e142[_0x767082];return _0x3a9a9a;},a556_0x1802(_0x58683f,_0x3cfedf);}const a556_0x498f1f=a556_0x1802;(function(_0x103620,_0x127c91){const _0x192f19=a556_0x1802,_0xf925df=_0x103620();while(!![]){try{const _0x4e70a4=-parseInt(_0x192f19(0xeb))/0x1*(-parseInt(_0x192f19(0xc3))/0x2)+parseInt(_0x192f19(0xe5))/0x3*(parseInt(_0x192f19(0xef))/0x4)+-parseInt(_0x192f19(0xee))/0x5+-parseInt(_0x192f19(0xd6))/0x6*(parseInt(_0x192f19(0xce))/0x7)+-parseInt(_0x192f19(0xc8))/0x8+parseInt(_0x192f19(0xe2))/0x9*(parseInt(_0x192f19(0xcb))/0xa)+-parseInt(_0x192f19(0xc0))/0xb;if(_0x4e70a4===_0x127c91)break;else _0xf925df['push'](_0xf925df['shift']());}catch(_0xbb8f1b){_0xf925df['push'](_0xf925df['shift']());}}}(a556_0x3a9a,0x66547));function a556_0x3a9a(){const _0x59976d=['getIO','180ZKQWeM','companyId','open','7FHkHlW','__importDefault','apply','string','ClosedAllOpenTickets','../../models/TicketTraking','toDate','-ticket','2285682hBvalQ','nps','../../models/Ticket','getWbot','isGroup','g.us','updatedAt','whatsappId','update','moment','(((.+)+)+)+$','status','398142zWidSC','findByPk','delete','57EPzGvb','trace','closed','sequelize','findOne','contact','163IvjXMR','../../helpers/Mustache','SendPresenceStatus','753760LDaZgW','1732fBTSsR','constructor','findAndCountAll','./wbotMessageListener','../../libs/socket','company-','__esModule','getMinutes','3556388PjpQyJ','fromMe','userId','10054XKLBvV','toString','number','search','default','2798096aGFnjc','../../models/Whatsapp'];a556_0x3a9a=function(){return _0x59976d;};return a556_0x3a9a();}const a556_0x2fc9bd=(function(){let _0x253d97=!![];return function(_0x2e8904,_0x3980a9){const _0x4c4459=_0x253d97?function(){const _0x801597=a556_0x1802;if(_0x3980a9){const _0x327a32=_0x3980a9[_0x801597(0xd0)](_0x2e8904,arguments);return _0x3980a9=null,_0x327a32;}}:function(){};return _0x253d97=![],_0x4c4459;};}()),a556_0x767082=a556_0x2fc9bd(this,function(){const _0x50b50c=a556_0x1802;return a556_0x767082['toString']()[_0x50b50c(0xc6)](_0x50b50c(0xe0))[_0x50b50c(0xc4)]()[_0x50b50c(0xb9)](a556_0x767082)[_0x50b50c(0xc6)](_0x50b50c(0xe0));});a556_0x767082();'use strict';var __importDefault=this&&this[a556_0x498f1f(0xcf)]||function(_0x19e3c9){const _0x464109=a556_0x498f1f;return _0x19e3c9&&_0x19e3c9[_0x464109(0xbe)]?_0x19e3c9:{'default':_0x19e3c9};};Object['defineProperty'](exports,a556_0x498f1f(0xbe),{'value':!![]}),exports[a556_0x498f1f(0xd2)]=void 0x0;const sequelize_1=require(a556_0x498f1f(0xe8)),Ticket_1=__importDefault(require(a556_0x498f1f(0xd8))),Whatsapp_1=__importDefault(require(a556_0x498f1f(0xc9))),socket_1=require(a556_0x498f1f(0xbc)),Mustache_1=__importDefault(require(a556_0x498f1f(0xec))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require(a556_0x498f1f(0xdf))),ShowTicketService_1=__importDefault(require('../TicketServices/ShowTicketService')),wbotMessageListener_1=require(a556_0x498f1f(0xbb)),TicketTraking_1=__importDefault(require(a556_0x498f1f(0xd3))),SendPresenceStatus_1=require('../../helpers/SendPresenceStatus'),wbot_1=require('../../libs/wbot'),ClosedAllOpenTickets=async _0x10ad25=>{const _0x4a8818=a556_0x498f1f,_0x4e2079=async(_0x3d4936,_0x42a7e5,_0x1c3d6c)=>{const _0x16ecb2=a556_0x1802;if(_0x42a7e5===_0x16ecb2(0xd7))typeof _0x1c3d6c!=_0x16ecb2(0xd1)&&console[_0x16ecb2(0xe6)]('body\x20is\x20not\x20a\x20string',_0x1c3d6c),await _0x3d4936[_0x16ecb2(0xde)]({'status':'closed','lastMessage':_0x1c3d6c,'unreadMessages':0x0,'amountUseBotQueues':0x0});else _0x42a7e5===_0x16ecb2(0xcd)?(typeof _0x1c3d6c!=_0x16ecb2(0xd1)&&console['trace']('body\x20is\x20not\x20a\x20string',_0x1c3d6c),await _0x3d4936[_0x16ecb2(0xde)]({'status':_0x16ecb2(0xe7),'lastMessage':_0x1c3d6c,'unreadMessages':0x0,'amountUseBotQueues':0x0})):await _0x3d4936[_0x16ecb2(0xde)]({'status':'closed','unreadMessages':0x0});},_0x44c6c5=(0x0,socket_1[_0x4a8818(0xca)])();try{const {rows:_0x404840}=await Ticket_1[_0x4a8818(0xc7)][_0x4a8818(0xba)]({'where':{'status':{[sequelize_1['Op']['in']]:[_0x4a8818(0xcd)]},'companyId':_0x10ad25},'order':[['updatedAt','DESC']]});for(const _0x272229 of _0x404840){const _0x487287=await(0x0,ShowTicketService_1['default'])(_0x272229['id'],_0x10ad25),_0x24db8b=await Whatsapp_1['default'][_0x4a8818(0xe3)](_0x487287?.[_0x4a8818(0xdd)]);if(!_0x24db8b)continue;const _0x1ccd4f=await TicketTraking_1['default'][_0x4a8818(0xe9)]({'where':{'ticketId':_0x272229['id'],'finishedAt':null}});let {expiresInactiveMessage:_0x25ae25,expiresTicket:_0x48d4c8}=_0x24db8b;if(_0x48d4c8&&_0x48d4c8!==''&&_0x48d4c8!=='0'&&Number(_0x48d4c8)>0x0){const _0x2ad6c1=(0x0,Mustache_1['default'])('â€Ž\x20'+_0x25ae25,_0x487287),_0x3cde97=new Date();_0x3cde97['setMinutes'](_0x3cde97[_0x4a8818(0xbf)]()-Number(_0x48d4c8));if(_0x487287[_0x4a8818(0xe1)]==='open'&&!_0x487287[_0x4a8818(0xda)]){const _0xc34f1f=new Date(_0x487287[_0x4a8818(0xdc)]);if(_0xc34f1f<_0x3cde97&&_0x487287[_0x4a8818(0xc1)]){await _0x4e2079(_0x487287,_0x487287[_0x4a8818(0xe1)],_0x2ad6c1);if(_0x25ae25!==''&&_0x25ae25!==undefined){await(0x0,SendPresenceStatus_1[_0x4a8818(0xed)])((0x0,wbot_1[_0x4a8818(0xd9)])(_0x272229[_0x4a8818(0xdd)]),_0x272229[_0x4a8818(0xea)][_0x4a8818(0xc5)]+'@'+(_0x272229[_0x4a8818(0xda)]?_0x4a8818(0xdb):'s.whatsapp.net'));const _0x3489f0=await(0x0,SendWhatsAppMessage_1[_0x4a8818(0xc7)])({'body':_0x2ad6c1,'ticket':_0x487287});await(0x0,wbotMessageListener_1['verifyMessage'])(_0x3489f0,_0x487287,_0x487287[_0x4a8818(0xea)]);}await _0x1ccd4f[_0x4a8818(0xde)]({'finishedAt':(0x0,moment_1[_0x4a8818(0xc7)])()[_0x4a8818(0xd4)](),'closedAt':(0x0,moment_1[_0x4a8818(0xc7)])()[_0x4a8818(0xd4)](),'whatsappId':_0x272229['whatsappId'],'userId':_0x272229[_0x4a8818(0xc2)]}),_0x44c6c5['to'](_0x4a8818(0xbd)+_0x272229[_0x4a8818(0xcc)]+'-open')['emit'](_0x4a8818(0xbd)+_0x10ad25+_0x4a8818(0xd5),{'action':_0x4a8818(0xe4),'ticketId':_0x487287['id']});}}}}}catch(_0x10b6fa){console['log']('e',_0x10b6fa);}};exports[a556_0x498f1f(0xd2)]=ClosedAllOpenTickets;