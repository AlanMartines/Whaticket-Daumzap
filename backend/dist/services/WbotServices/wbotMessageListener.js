const a558_0x2c2d44=a558_0x4046;(function(_0x3f950d,_0x3dfb56){const _0x1b926d=a558_0x4046,_0x40bc90=_0x3f950d();while(!![]){try{const _0x1fedea=parseInt(_0x1b926d(0x1b5))/0x1*(parseInt(_0x1b926d(0x23c))/0x2)+-parseInt(_0x1b926d(0x2ae))/0x3+-parseInt(_0x1b926d(0x252))/0x4+-parseInt(_0x1b926d(0x167))/0x5+-parseInt(_0x1b926d(0x2ad))/0x6*(parseInt(_0x1b926d(0x28d))/0x7)+parseInt(_0x1b926d(0x215))/0x8*(-parseInt(_0x1b926d(0x162))/0x9)+-parseInt(_0x1b926d(0x1d3))/0xa*(-parseInt(_0x1b926d(0x296))/0xb);if(_0x1fedea===_0x3dfb56)break;else _0x40bc90['push'](_0x40bc90['shift']());}catch(_0x27444f){_0x40bc90['push'](_0x40bc90['shift']());}}}(a558_0x3d25,0x437d8));const a558_0x3d3c7f=(function(){let _0x444105=!![];return function(_0x371bff,_0x278ddb){const _0x38e192=_0x444105?function(){if(_0x278ddb){const _0x3766bd=_0x278ddb['apply'](_0x371bff,arguments);return _0x278ddb=null,_0x3766bd;}}:function(){};return _0x444105=![],_0x38e192;};}()),a558_0x26cc50=a558_0x3d3c7f(this,function(){const _0x11fbc6=a558_0x4046;return a558_0x26cc50[_0x11fbc6(0x10d)]()['search'](_0x11fbc6(0x258))[_0x11fbc6(0x10d)]()['constructor'](a558_0x26cc50)[_0x11fbc6(0x102)](_0x11fbc6(0x258));});a558_0x26cc50();function a558_0x3d25(){const _0x3442ad=['pushName','&z=17&hl=pt-BR|','promisify','finishedAt','user','DAUMZAP','filename','####\x20Nao\x20achou\x20o\x20type\x20em\x20isValidMsg:\x20','reload','changed','maxTokens','gte','speechSynthesisVoiceName','Mensagem\x20inválida!','getIO','singleSelectReply','save','.mp3','messageQueue','WebMessageInfo','getViewOnceMessageV2','head','.wav','voiceMessage','fourRowTemplate','504954gNJPee','\x20MBps','fora\x20do\x20horario','-ticket','proto','141565gsujvQ','messages.upsert','charAt','getQuotedMessage','Mensagem\x20interativa\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','isBetween','directPath','Erro\x20para\x20responder\x20com\x20audio:\x20','update!','Erro\x20ao\x20salvar\x20ticket!','format','scheduleType','random','texto','captureException','*[\x20','message','pollCreationMessageV2','includes','existsSync',']\x20-\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','resolve','webhook','\x20para\x20identificar\x20o\x20cliente.\x0aSua\x20resposta\x20deve\x20usar\x20no\x20máximo\x20','viewOnceMessageV2','toLowerCase','log','pollCreationMessageV3','readFileSync','degreesLatitude','outOfHoursMessage','../../models/Contact','cacheLayer','../CompanyService/VerifyCurrentSchedule','env','error','next','../../libs/wbot','option','toDate','mediaType','queueOptionId','EM_ANDAMENTO','../../models/OldMessage','Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!','DESC','system','caption','writable','unlinkSync','vcard','pending','Error\x20handling\x20whatsapp\x20message:\x20Err:\x20','Latitude:\x20','\x20de\x20baixar\x20o\x20arquivo\x20','handleMessageIntegration','path','emit','then','userId','Configuration','push','viewOnceMessage','reactionMessage','chatbotAt','templateButtonReplyMessage','getStickerMessage','advertising','company-','ERR_WAPP_DOWNLOAD_MEDIA','remoteJid','audio/mpeg','hydratedFourRowTemplate','interactiveMessage','s.whatsapp.net','unknown','whatsappId','11RVFuqX','mediaName','\x0a*[\x20#\x20]*\x20-\x20Menu\x20inicial','verifyRating','parseToMilliseconds','sendMessageImage','getViewOnceMessage','split','dest','updatedAt','toFixed','slice','header','botText','segundo\x20if','assistant','READ','public','listResponseMessage','../../helpers/Mustache','../../helpers/MakeRandomId','isArray','isValidMsg','makeid','ack','amountUsedBotQueues','base64','CIPHERTEXT','verifyRecentCampaign','highlyStructuredMessage','10XYsKsp','values','../../models/QueueOption','sleep','hasOwnProperty','value','chatbot','create','getListMessage','set','replace','contactsArrayMessage','contacts:','buttonsResponseMessage','status@broadcast','setFfmpegPath','util','../TicketServices/FindOrCreateTicketService','CHATBOT_RESTRICT_NUMBER','companyId','greetingMediaAttachment','moment','../../helpers/Debounce','messageContextInfo','configurable','useIntegration','update','time','maxUseBotQueues','now','verifyQuotedMessage','ProtocolMessage','product','verifyMessage','getVideoMessage','call','isNumeric','toUpperCase','Escolha\x20uma\x20opção','end','voice','@g.us','title','isGroup','getLocationMessage','createdAt','ASC','warn','documentMessage','stringify','getTime','getQuotedMessageId','endTime','botText\x202','prompt','greetingMessage','../MessageServices/CreateMessageService','conversation','url','application','Pedido','concat','Menu\x20inicial\x20*[\x200\x20]*\x20Menu\x20anterior','getPaymentMessage','Error\x20getting\x20message\x20body:','documentWithCaptionMessage','8fdDTHK','../../models/Queue','number','stanzaId','__setModuleDefault','selectedId','lodash','../../utils/logger','minutes','fromMe','find','input','Erro\x20ao\x20salvar\x20mensagem!','startLunchTime','body','extendedTextMessage','../../helpers/SendPresenceStatus','isNil','WAMessageStubType','voiceRegion','public/temp/','subject','hydratedTemplate','__importStar','../QueueIntegrationServices/ShowQueueIntegrationService','closed','type','mp3','Mensagem','../../models/Campaign','Status','handleRating','voiceKey','@sentry/node','mkdirSync','indexOf','terceiro\x20if','public/company','getWbot','13510QWAXRb','Throttle','from','getMessageOptions','isBefore','messages','selectedButtonId','queue','setExtra','pt-BR-FabioNeural','../../libs/cache','botText\x203','SendPresenceStatus','urlN8N','forEach','keys','logger','queues','__esModule','extractMessageContent','AudioConfig','setMinutes','140548guHcWR','Mensagem\x20de\x20grupo\x20bloqueada!','default','defineProperty','key','count','(((.+)+)+)+$','REVOKE','Erro\x20ao\x20salvar\x20avaliação!','verifyCampaignMessageAndCloseTicket','../../queues','jidNormalizedUser','writeFile','ffmpeg-static','primeiro\x20if','button','chat','mimetype','mediaPath','openai','chatBotType','mediaMessage','Expected\x20bodyMessage\x20to\x20be\x20a\x20string,\x20got:','sendMessageLink','request','makeRandomId','microsoft-cognitiveservices-speech-sdk','editedMessage','stream-throttle','Lista','../../models/Ticket','getTemplateMessage','groups.update','weekdayEn','isInteger','isNaN','contacts','selectedRowId','data:image/png;base64,\x20','*Você\x20encerrou\x20este\x20atendimento\x20usando\x20o\x20comando\x20SAIR*.\x0a\x0a\x0aSe\x20você\x20finalizou\x20o\x20atendimento\x20*ANTES*\x20de\x20receber\x20um\x20retorno\x20do\x20operador,\x20ele\x20*NÃO*\x20irá\x20visualizar\x20sua\x20solicitação!\x0a\x0aVocê\x20deve\x20aguardar\x20o\x20retorno\x20do\x20operador\x20e\x20que\x20ele\x20encerre\x20seu\x20atendimento\x20quando\x20necessário.\x0a\x0aUse\x20a\x20opção\x20*SAIR*\x20somente\x20em\x20casos\x20de\x20emergência\x20ou\x20se\x20ficou\x20preso\x20em\x20algum\x20setor.\x0a\x0a\x0aPara\x20iniciar\x20um\x20novo\x20atendimento\x20basta\x20enviar\x20uma\x20nova\x20mensagem!','campaignId','subtract','keywords','findOne','Error\x20converting\x20file:\x20','string','endLunchTime','getReactionMessage','OpenAIApi','content','length','Message','dddd','SERVER_ACK','CheckMsgIsGroup',':unreads','locationMessage','audioMessage','>>>>\x20erro\x20','246547LfxhVD','messageStubType','-open','chmodSync','Type','Importando\x20mensagens!!','-closed','quarto\x20if','data','13104806SQHEOw','../../models/UserRating','getAd','\x20]*\x20-\x20','chatbot\x20desativado!','./SendWhatsAppMedia','text','getTextMessage','../ContactServices/CreateOrUpdateContactService','queueId','productMessage','gpt-3.5-turbo-1106','downloadContentFromMessage','complationMessage','contact','liveLocationMessage','ticketId','getBodyButton','temperature','contextInfo','SpeechSynthesizer','stickerMessage','quotedMsg','78LIVPTk','1235346wqtEpy','__importDefault','contactMessage','Nas\x20respostas\x20utilize\x20o\x20nome\x20','floor','../../models/Setting','debounce','trace','Mensagem\x20editada\x20não\x20encontrada:\x20','min','ephemeralMessage','getBodyMessage','Convite\x20Revogado','Error\x20handling\x20message\x20ack.\x20Err:\x20','fileName','listMessage','Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','n8n','findAll','\x201286\x20-\x20Entrei\x20na\x20integracao\x20openai.','dataJson','maxMessages','Novo\x20Tipo\x20de\x20Mensagem\x20em\x20isValidMsg','senderKeyDistributionMessage','integrationId','Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','apiKey','search','createChatCompletion','DELIVERY_ACK','hydratedHsm','sendMessage','upsert','randomValue','\x20|\x20https://maps.google.com/maps?q=','\x0a\x0a*[\x20#\x20]*\x20-\x20Voltar\x20ao\x20Menu\x20Principal','whisper-1','test','toString','name','getGroupInviteMessage','get','DispatchCampaign','image/jpeg','isAfter','Failed\x20to\x20fetch\x20contact\x20from\x20ticket:','No\x20contact\x20found\x20for\x20this\x20ticket.','-appMessage','findByPk','PLAYED','g.us','substring','imageMessage','Produto','filter','../WhatsappService/ShowWhatsAppService','reaction','SAIR','company','options','Failed\x20to\x20get\x20stream','debug','findIndex','extension','videoMessage','protocolMessage','Mensagem\x20inválida\x208!\x20','startTime','inActivity','quotedMessage','\x0a*[\x200\x20]*\x20-\x20Menu\x20anterior','trim','productImage','../../app','document','hydratedContentText','removeNonPrintableChars','delete','PENDING','./providers','status','wbotMessageListener','HH:mm','close','choices','participant','media','body\x20is\x20not\x20a\x20string','../../models/User','map','../../models/Message','handleMessage','promptId','speakTextAsync','@whiskeysockets/baileys','getCallMessage','mediaUrl','templateMessage'];a558_0x3d25=function(){return _0x3442ad;};return a558_0x3d25();}'use strict';var __createBinding=this&&this['__createBinding']||(Object[a558_0x2c2d44(0x1da)]?function(_0x39e497,_0x4ef16a,_0x3be311,_0x117d9f){const _0x4db82e=a558_0x2c2d44;if(_0x117d9f===undefined)_0x117d9f=_0x3be311;var _0x2f026f=Object['getOwnPropertyDescriptor'](_0x4ef16a,_0x3be311);(!_0x2f026f||(_0x4db82e(0x110)in _0x2f026f?!_0x4ef16a['__esModule']:_0x2f026f[_0x4db82e(0x198)]||_0x2f026f[_0x4db82e(0x1eb)]))&&(_0x2f026f={'enumerable':!![],'get':function(){return _0x4ef16a[_0x3be311];}}),Object[_0x4db82e(0x255)](_0x39e497,_0x117d9f,_0x2f026f);}:function(_0x144d15,_0x3de7b8,_0x11fedb,_0x3859bd){if(_0x3859bd===undefined)_0x3859bd=_0x11fedb;_0x144d15[_0x3859bd]=_0x3de7b8[_0x11fedb];}),__setModuleDefault=this&&this[a558_0x2c2d44(0x219)]||(Object['create']?function(_0x347ada,_0x406091){const _0xbb8e81=a558_0x2c2d44;Object['defineProperty'](_0x347ada,_0xbb8e81(0x254),{'enumerable':!![],'value':_0x406091});}:function(_0x58b34c,_0x3db6df){const _0x2feb4d=a558_0x2c2d44;_0x58b34c[_0x2feb4d(0x254)]=_0x3db6df;}),__importStar=this&&this[a558_0x2c2d44(0x22c)]||function(_0x705cee){const _0x4250d5=a558_0x2c2d44;if(_0x705cee&&_0x705cee[_0x4250d5(0x24e)])return _0x705cee;var _0x592e07={};if(_0x705cee!=null){for(var _0x3928d1 in _0x705cee)if(_0x3928d1!==_0x4250d5(0x254)&&Object['prototype'][_0x4250d5(0x1d7)][_0x4250d5(0x1f6)](_0x705cee,_0x3928d1))__createBinding(_0x592e07,_0x705cee,_0x3928d1);}return __setModuleDefault(_0x592e07,_0x705cee),_0x592e07;},__importDefault=this&&this[a558_0x2c2d44(0x2af)]||function(_0x82dc74){const _0x4e5e41=a558_0x2c2d44;return _0x82dc74&&_0x82dc74[_0x4e5e41(0x24e)]?_0x82dc74:{'default':_0x82dc74};};Object[a558_0x2c2d44(0x255)](exports,a558_0x2c2d44(0x24e),{'value':!![]}),exports[a558_0x2c2d44(0x138)]=exports[a558_0x2c2d44(0x25b)]=exports[a558_0x2c2d44(0x1d1)]=exports['handleMsgAck']=exports[a558_0x2c2d44(0x142)]=exports[a558_0x2c2d44(0x19f)]=exports[a558_0x2c2d44(0x234)]=exports[a558_0x2c2d44(0x1b8)]=exports[a558_0x2c2d44(0x1cb)]=exports[a558_0x2c2d44(0x1f4)]=exports[a558_0x2c2d44(0x1f1)]=exports[a558_0x2c2d44(0x206)]=exports[a558_0x2c2d44(0x16a)]=exports['getBodyMessage']=exports['makeid']=exports[a558_0x2c2d44(0x269)]=exports[a558_0x2c2d44(0x1ba)]=exports['sleep']=exports['validaCpfCnpj']=exports[a558_0x2c2d44(0x133)]=exports[a558_0x2c2d44(0x1f7)]=void 0x0;const path_1=__importStar(require(a558_0x2c2d44(0x1a0))),util_1=require(a558_0x2c2d44(0x1e3)),fs_1=require('fs'),Sentry=__importStar(require(a558_0x2c2d44(0x236))),lodash_1=require(a558_0x2c2d44(0x21b)),baileys_1=require(a558_0x2c2d44(0x145)),MessageUtils=__importStar(require('./wbotGetMessageFromType')),stream_throttle_1=require(a558_0x2c2d44(0x26e)),Contact_1=__importDefault(require(a558_0x2c2d44(0x187))),Ticket_1=__importDefault(require(a558_0x2c2d44(0x270))),Message_1=__importDefault(require(a558_0x2c2d44(0x141))),OldMessage_1=__importDefault(require(a558_0x2c2d44(0x193))),socket_1=require('../../libs/socket'),CreateMessageService_1=__importDefault(require(a558_0x2c2d44(0x20b))),logger_1=require(a558_0x2c2d44(0x21c)),CreateOrUpdateContactService_1=__importDefault(require(a558_0x2c2d44(0x29e))),FindOrCreateTicketService_1=__importDefault(require(a558_0x2c2d44(0x1e4))),ShowWhatsAppService_1=__importDefault(require(a558_0x2c2d44(0x11e))),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),Mustache_1=__importDefault(require(a558_0x2c2d44(0x1c8))),UserRating_1=__importDefault(require(a558_0x2c2d44(0x297))),SendWhatsAppMessage_1=__importDefault(require('./SendWhatsAppMessage')),moment_1=__importDefault(require(a558_0x2c2d44(0x1e8))),Queue_1=__importDefault(require(a558_0x2c2d44(0x216))),QueueOption_1=__importDefault(require(a558_0x2c2d44(0x1d5))),FindOrCreateATicketTrakingService_1=__importDefault(require('../TicketServices/FindOrCreateATicketTrakingService')),VerifyCurrentSchedule_1=__importDefault(require(a558_0x2c2d44(0x189))),Campaign_1=__importDefault(require(a558_0x2c2d44(0x232))),CampaignShipping_1=__importDefault(require('../../models/CampaignShipping')),sequelize_1=require('sequelize'),queues_1=require(a558_0x2c2d44(0x25c)),User_1=__importDefault(require(a558_0x2c2d44(0x13f))),Setting_1=__importDefault(require(a558_0x2c2d44(0x2b3))),cache_1=require(a558_0x2c2d44(0x246)),Debounce_1=require(a558_0x2c2d44(0x1e9)),openai_1=require(a558_0x2c2d44(0x265)),fluent_ffmpeg_1=__importDefault(require('fluent-ffmpeg')),microsoft_cognitiveservices_speech_sdk_1=require(a558_0x2c2d44(0x26c)),providers_1=require(a558_0x2c2d44(0x136)),typebotListener_1=__importDefault(require('../TypebotServices/typebotListener')),ShowQueueIntegrationService_1=__importDefault(require(a558_0x2c2d44(0x22d))),SendWhatsAppMedia_1=require(a558_0x2c2d44(0x29b)),fs_2=__importDefault(require('fs')),request_1=__importDefault(require(a558_0x2c2d44(0x26a))),ffmpeg_static_1=__importDefault(require(a558_0x2c2d44(0x25f))),app_1=__importDefault(require(a558_0x2c2d44(0x130))),mime_1=__importDefault(require('mime')),wbot_1=require(a558_0x2c2d44(0x18d)),SendPresenceStatus_1=require(a558_0x2c2d44(0x225)),MakeRandomId_1=require(a558_0x2c2d44(0x1c9));fluent_ffmpeg_1[a558_0x2c2d44(0x254)][a558_0x2c2d44(0x1e2)](ffmpeg_static_1[a558_0x2c2d44(0x254)]);const sessionsOpenAi=[],isNumeric=_0x2ffe56=>/^-?\d+$/['test'](_0x2ffe56);exports[a558_0x2c2d44(0x1f7)]=isNumeric;let outOfHourMessageControl=[],completionMessageControl=[],greetingMessageControl=[],farewellMessageControl=[];const writeFileAsync=(0x0,util_1[a558_0x2c2d44(0x14b)])(fs_1[a558_0x2c2d44(0x25e)]),getTypeMessage=_0x2794e8=>{const _0x18e32b=a558_0x2c2d44;return(0x0,baileys_1['getContentType'])(_0x2794e8[_0x18e32b(0x177)]);},removeNonPrintableChars=_0x4385b8=>{const _0x2a4281=a558_0x2c2d44;return _0x4385b8[_0x2a4281(0x1dd)](/[\x00-\x1F\x7F-\x9F]/g,'');};exports[a558_0x2c2d44(0x133)]=removeNonPrintableChars;async function getQueues(_0x1d2795){const _0xa6dd3b=a558_0x2c2d44;try{const _0x9dfa2=await Queue_1[_0xa6dd3b(0x254)]['findAll']({'where':{'companyId':_0x1d2795}});return _0x9dfa2;}catch(_0x267a26){return console[_0xa6dd3b(0x18b)]('Failed\x20to\x20fetch\x20queues:',_0x267a26),[];}}async function getContactFromTicket(_0x2036c3){const _0x31347f=a558_0x2c2d44;try{const _0x1f5f9b=await Ticket_1[_0x31347f(0x254)]['findByPk'](_0x2036c3,{'include':[{'model':Contact_1[_0x31347f(0x254)],'as':_0x31347f(0x2a4)}]});return _0x1f5f9b&&_0x1f5f9b[_0x31347f(0x2a4)]?_0x1f5f9b[_0x31347f(0x2a4)]:(console[_0x31347f(0x182)](_0x31347f(0x115)),null);}catch(_0x56a96e){return console[_0x31347f(0x18b)](_0x31347f(0x114),_0x56a96e),null;}}function validaCpfCnpj(_0x4c6cd4){const _0x3b1229=a558_0x2c2d44;if(_0x4c6cd4[_0x3b1229(0x284)]==0xb){var _0x3901e5=_0x4c6cd4[_0x3b1229(0x12e)]();_0x3901e5=_0x3901e5[_0x3b1229(0x1dd)](/\./g,''),_0x3901e5=_0x3901e5['replace']('-',''),_0x3901e5=_0x3901e5[_0x3b1229(0x1bc)]('');var _0x3de2b4=0x0,_0x1f814d=0x0,_0x48e481=![];for(var _0x45ca28=0x1;_0x3901e5[_0x3b1229(0x284)]>_0x45ca28;_0x45ca28++){_0x3901e5[_0x45ca28-0x1]!=_0x3901e5[_0x45ca28]&&(_0x48e481=!![]);}if(_0x48e481==![])return![];for(var _0x45ca28=0x0,_0x235fa2=0xa;_0x3901e5[_0x3b1229(0x284)]-0x2>_0x45ca28;_0x45ca28++,_0x235fa2--){_0x3de2b4+=_0x3901e5[_0x45ca28]*_0x235fa2;}_0x3de2b4=_0x3de2b4*0xa%0xb;_0x3de2b4==0xa&&(_0x3de2b4=0x0);if(_0x3de2b4!=_0x3901e5[0x9])return![];for(var _0x45ca28=0x0,_0x235fa2=0xb;_0x3901e5[_0x3b1229(0x284)]-0x1>_0x45ca28;_0x45ca28++,_0x235fa2--){_0x1f814d+=_0x3901e5[_0x45ca28]*_0x235fa2;}return _0x1f814d=_0x1f814d*0xa%0xb,_0x1f814d==0xa&&(_0x1f814d=0x0),_0x1f814d!=_0x3901e5[0xa]?![]:!![];}else{if(_0x4c6cd4[_0x3b1229(0x284)]==0xe){var _0xc36041=_0x4c6cd4['trim']();_0xc36041=_0xc36041[_0x3b1229(0x1dd)](/\./g,''),_0xc36041=_0xc36041[_0x3b1229(0x1dd)]('-',''),_0xc36041=_0xc36041[_0x3b1229(0x1dd)]('/',''),_0xc36041=_0xc36041[_0x3b1229(0x1bc)]('');var _0x3de2b4=0x0,_0x1f814d=0x0,_0x48e481=![];for(var _0x45ca28=0x1;_0xc36041['length']>_0x45ca28;_0x45ca28++){_0xc36041[_0x45ca28-0x1]!=_0xc36041[_0x45ca28]&&(_0x48e481=!![]);}if(_0x48e481==![])return![];for(var _0x45ca28=0x0,_0x27ee72=0x5,_0x22233f=0xd;_0xc36041[_0x3b1229(0x284)]-0x2>_0x45ca28;_0x45ca28++,_0x27ee72--,_0x22233f--){_0x27ee72>=0x2?_0x3de2b4+=_0xc36041[_0x45ca28]*_0x27ee72:_0x3de2b4+=_0xc36041[_0x45ca28]*_0x22233f;}_0x3de2b4=_0x3de2b4%0xb;_0x3de2b4<0x2?_0x3de2b4=0x0:_0x3de2b4=0xb-_0x3de2b4;if(_0x3de2b4!=_0xc36041[0xc])return![];for(var _0x45ca28=0x0,_0x27ee72=0x6,_0x22233f=0xe;_0xc36041[_0x3b1229(0x284)]-0x1>_0x45ca28;_0x45ca28++,_0x27ee72--,_0x22233f--){_0x27ee72>=0x2?_0x1f814d+=_0xc36041[_0x45ca28]*_0x27ee72:_0x1f814d+=_0xc36041[_0x45ca28]*_0x22233f;}return _0x1f814d=_0x1f814d%0xb,_0x1f814d<0x2?_0x1f814d=0x0:_0x1f814d=0xb-_0x1f814d,_0x1f814d!=_0xc36041[0xd]?![]:!![];}else return![];}}exports['validaCpfCnpj']=validaCpfCnpj;function timeout(_0x51745f){return new Promise(_0x566a5f=>setTimeout(_0x566a5f,_0x51745f));}async function sleep(_0x761bce){await timeout(_0x761bce);}exports[a558_0x2c2d44(0x1d6)]=sleep;const sendMessageImage=async(_0x32810a,_0x3ef87,_0x346461,_0x2d8687,_0x363115)=>{const _0x2fa0c3=a558_0x2c2d44;let _0x423812;try{_0x423812=await _0x32810a[_0x2fa0c3(0x106)](_0x3ef87[_0x2fa0c3(0x217)]+'@'+(_0x346461[_0x2fa0c3(0x1fe)]?_0x2fa0c3(0x119):'s.whatsapp.net'),{'image':_0x2d8687?{'url':_0x2d8687}:fs_2[_0x2fa0c3(0x254)]['readFileSync']('public/temp/'+_0x363115+'-'+makeid(0xa)),'fileName':_0x363115,'caption':_0x363115,'mimetype':_0x2fa0c3(0x112)});}catch(_0x3e3b6f){_0x423812=await _0x32810a['sendMessage'](_0x3ef87[_0x2fa0c3(0x217)]+'@'+(_0x346461[_0x2fa0c3(0x1fe)]?_0x2fa0c3(0x119):_0x2fa0c3(0x1b2)),{'text':(0x0,Mustache_1[_0x2fa0c3(0x254)])(_0x2fa0c3(0x194),_0x346461)});}(0x0,exports[_0x2fa0c3(0x1f4)])(_0x423812,_0x346461,_0x3ef87);};exports[a558_0x2c2d44(0x1ba)]=sendMessageImage;const sendMessageLink=async(_0x31003a,_0x3f6edb,_0x289d49,_0x3fc05e,_0x489c4f)=>{const _0x22ab75=a558_0x2c2d44;let _0x517b40;try{_0x517b40=await _0x31003a[_0x22ab75(0x106)](_0x3f6edb['number']+'@'+(_0x289d49[_0x22ab75(0x1fe)]?'g.us':'s.whatsapp.net'),{'document':_0x3fc05e?{'url':_0x3fc05e}:fs_2['default'][_0x22ab75(0x184)](_0x22ab75(0x229)+_0x489c4f+'-'+makeid(0xa)),'fileName':_0x489c4f,'caption':_0x489c4f,'mimetype':'application/pdf'});}catch(_0x5460e3){_0x517b40=await _0x31003a[_0x22ab75(0x106)](_0x3f6edb[_0x22ab75(0x217)]+'@'+(_0x289d49[_0x22ab75(0x1fe)]?_0x22ab75(0x119):_0x22ab75(0x1b2)),{'text':(0x0,Mustache_1['default'])('Não\x20consegui\x20enviar\x20o\x20PDF,\x20tente\x20novamente!',_0x289d49)});}(0x0,exports[_0x22ab75(0x1f4)])(_0x517b40,_0x289d49,_0x3f6edb);};exports['sendMessageLink']=sendMessageLink;function makeid(_0x45daa5){const _0x5d9e09=a558_0x2c2d44;var _0x3f4e39='',_0x39c2cd='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',_0x48257c=_0x39c2cd[_0x5d9e09(0x284)];for(var _0x359028=0x0;_0x359028<_0x45daa5;_0x359028++){_0x3f4e39+=_0x39c2cd[_0x5d9e09(0x169)](Math[_0x5d9e09(0x2b2)](Math[_0x5d9e09(0x173)]()*_0x48257c));}return _0x3f4e39;}exports[a558_0x2c2d44(0x1cc)]=makeid;const msgLocation=(_0x3f7072,_0x4e0142,_0x381a12)=>{const _0x1aadf9=a558_0x2c2d44;if(_0x3f7072){var _0x3b7540=Buffer['from'](_0x3f7072)['toString'](_0x1aadf9(0x1cf));let _0x3e47eb=_0x1aadf9(0x278)+_0x3b7540+_0x1aadf9(0x109)+_0x4e0142+'%2C'+_0x381a12+_0x1aadf9(0x14a)+_0x4e0142+',\x20'+_0x381a12+'\x20';return _0x3e47eb;}},getBodyMessage=_0x1467be=>{const _0x390767=a558_0x2c2d44;try{let _0x6f61a=getTypeMessage(_0x1467be);const _0x2acd86={'conversation':MessageUtils[_0x390767(0x29d)](_0x1467be),'editedMessage':_0x1467be?.[_0x390767(0x177)]?.[_0x390767(0x26d)]?.['message']?.[_0x390767(0x128)]?.['editedMessage']?.[_0x390767(0x20c)]||_0x1467be?.[_0x390767(0x177)]?.[_0x390767(0x26d)]?.[_0x390767(0x177)]?.[_0x390767(0x224)]?.[_0x390767(0x29c)],'imageMessage':MessageUtils['getImageMessage'](_0x1467be),'videoMessage':MessageUtils[_0x390767(0x1f5)](_0x1467be),'extendedTextMessage':_0x1467be[_0x390767(0x177)]?.['extendedTextMessage']?.[_0x390767(0x29c)],'buttonsResponseMessage':MessageUtils['getButtonsMessage'](_0x1467be),'templateButtonReplyMessage':_0x1467be[_0x390767(0x177)]?.[_0x390767(0x1a9)]?.[_0x390767(0x21a)],'messageContextInfo':_0x1467be[_0x390767(0x177)]?.[_0x390767(0x1e0)]?.['selectedButtonId']||_0x1467be[_0x390767(0x177)]?.[_0x390767(0x1c7)]?.[_0x390767(0x1fd)],'buttonsMessage':MessageUtils[_0x390767(0x2a7)](_0x1467be)||_0x1467be['message']?.[_0x390767(0x1c7)]?.[_0x390767(0x158)]?.[_0x390767(0x277)],'viewOnceMessage':MessageUtils[_0x390767(0x1bb)](_0x1467be),'viewOnceMessageV2':MessageUtils[_0x390767(0x15d)](_0x1467be),'stickerMessage':MessageUtils[_0x390767(0x1aa)](_0x1467be),'contactMessage':MessageUtils['getContactMessage'](_0x1467be),'contactsArrayMessage':_0x1467be[_0x390767(0x177)]?.[_0x390767(0x1de)]?.[_0x390767(0x276)]&&MessageUtils['getContactsArrayMessage'](_0x1467be),'pollCreationMessageV2':_0x1467be['message']?.[_0x390767(0x178)]?.[_0x390767(0x10e)]||'Enquete\x20não\x20suportada,\x20abra\x20o\x20dispositivo\x20para\x20ler.','pollCreationMessageV3':_0x1467be[_0x390767(0x177)]?.[_0x390767(0x183)]?.[_0x390767(0x10e)]||_0x390767(0x2be),'interactiveMessage':_0x1467be['message']?.[_0x390767(0x1b1)]?.[_0x390767(0x223)]||_0x1467be[_0x390767(0x177)]?.['interactiveMessage']?.[_0x390767(0x2a9)]||_0x390767(0x16b),'locationMessage':MessageUtils[_0x390767(0x1ff)](_0x1467be),'liveLocationMessage':_0x390767(0x19d)+_0x1467be[_0x390767(0x177)]?.[_0x390767(0x2a5)]?.[_0x390767(0x185)]+'\x20-\x20Longitude:\x20'+_0x1467be['message']?.[_0x390767(0x2a5)]?.['degreesLongitude'],'documentMessage':MessageUtils['getDocumentMessage'](_0x1467be),'documentWithCaptionMessage':_0x1467be[_0x390767(0x177)]?.['documentWithCaptionMessage']?.[_0x390767(0x177)]?.['documentMessage']?.[_0x390767(0x197)],'audioMessage':MessageUtils['getAudioMessage'](_0x1467be),'ephemeralMessage':_0x1467be[_0x390767(0x177)]?.[_0x390767(0x2b8)]?.['message']?.['extendedTextMessage']?.[_0x390767(0x29c)],'listMessage':MessageUtils[_0x390767(0x2a7)](_0x1467be)||_0x1467be['message']?.[_0x390767(0x1c7)]?.['title'],'listResponseMessage':MessageUtils[_0x390767(0x1db)](_0x1467be),'reactionMessage':MessageUtils[_0x390767(0x281)](_0x1467be)||_0x390767(0x11f),'advertising':MessageUtils[_0x390767(0x298)](_0x1467be)||_0x1467be['message']?.['listResponseMessage']?.[_0x390767(0x2a9)]?.['externalAdReply']?.[_0x390767(0x1fd)],'productMessage':_0x1467be['message']?.[_0x390767(0x2a0)]?.[_0x390767(0x1f3)]?.[_0x390767(0x12f)]?.[_0x390767(0x197)]||_0x390767(0x11c),'multiProductMessage':'Múltiplos\x20Produtos','orderMessage':_0x390767(0x20f),'paymentMessage':MessageUtils[_0x390767(0x212)](_0x1467be),'paymentRequestMessage':'Solicitação\x20de\x20Pagamento','groupInviteMessage':MessageUtils[_0x390767(0x10f)](_0x1467be),'revokeInviteMessage':_0x390767(0x2ba),'protocolMessage':_0x1467be[_0x390767(0x177)]?.[_0x390767(0x128)]?.[_0x390767(0x26d)]?.['conversation']||null,'disappearingMessage':'Mensagem\x20que\x20Desaparece','callMessage':MessageUtils[_0x390767(0x146)](_0x1467be),'templateMessage':MessageUtils[_0x390767(0x271)](_0x1467be),'statusUpdateMessage':'Atualização\x20de\x20Status'};return _0x2acd86[_0x6f61a]||null;}catch(_0x33bb5e){return console[_0x390767(0x18b)](_0x390767(0x213),_0x33bb5e),null;}};exports['getBodyMessage']=getBodyMessage;const getQuotedMessage=_0x3190b4=>{const _0x377fe2=a558_0x2c2d44,_0x22728d=_0x3190b4[_0x377fe2(0x177)][_0x377fe2(0x11b)]['contextInfo']||_0x3190b4[_0x377fe2(0x177)][_0x377fe2(0x127)][_0x377fe2(0x2a9)]||_0x3190b4['message']?.[_0x377fe2(0x203)]||_0x3190b4['message']['extendedTextMessage'][_0x377fe2(0x2a9)]||_0x3190b4['message'][_0x377fe2(0x1e0)][_0x377fe2(0x2a9)]||_0x3190b4['message'][_0x377fe2(0x1c7)][_0x377fe2(0x2a9)]||_0x3190b4[_0x377fe2(0x177)][_0x377fe2(0x1a9)][_0x377fe2(0x2a9)]||_0x3190b4['message'][_0x377fe2(0x1e0)]?.[_0x377fe2(0x2a9)]||_0x3190b4?.[_0x377fe2(0x177)]?.[_0x377fe2(0x1e0)]?.['selectedButtonId']||_0x3190b4[_0x377fe2(0x177)]['listResponseMessage']?.['singleSelectReply']?.[_0x377fe2(0x277)]||_0x3190b4?.[_0x377fe2(0x177)]?.[_0x377fe2(0x1c7)]?.[_0x377fe2(0x158)]['selectedRowId']||_0x3190b4[_0x377fe2(0x177)][_0x377fe2(0x1c7)]?.[_0x377fe2(0x2a9)];return _0x3190b4[_0x377fe2(0x177)][_0x377fe2(0x2c5)],(0x0,baileys_1[_0x377fe2(0x24f)])(_0x22728d[Object[_0x377fe2(0x24b)](_0x22728d)[_0x377fe2(0x1d4)]()[_0x377fe2(0x18c)]()['value']]);};exports[a558_0x2c2d44(0x16a)]=getQuotedMessage;const getQuotedMessageId=_0x328356=>{const _0x180004=a558_0x2c2d44,_0x4707b8=(0x0,baileys_1[_0x180004(0x24f)])(_0x328356[_0x180004(0x177)])[Object[_0x180004(0x24b)](_0x328356?.[_0x180004(0x177)])['values']()['next']()['value']];let _0x15e413=_0x328356?.[_0x180004(0x177)]?.['reactionMessage']?_0x328356?.[_0x180004(0x177)]?.[_0x180004(0x1a7)]?.['key']?.['id']:'';return _0x15e413?_0x15e413:_0x4707b8?.['contextInfo']?.[_0x180004(0x218)];};exports[a558_0x2c2d44(0x206)]=getQuotedMessageId;const getMeSocket=_0x4fd1ae=>{const _0xc92e87=a558_0x2c2d44;return{'id':(0x0,baileys_1[_0xc92e87(0x25d)])(_0x4fd1ae[_0xc92e87(0x14d)]['id']),'name':_0x4fd1ae[_0xc92e87(0x14d)][_0xc92e87(0x10e)]};},getSenderMessage=(_0x4e3489,_0x1f59c8)=>{const _0x47895d=a558_0x2c2d44,_0x2ef66b=getMeSocket(_0x1f59c8);if(_0x4e3489[_0x47895d(0x256)]['fromMe'])return _0x2ef66b['id'];const _0x2590b5=_0x4e3489[_0x47895d(0x13c)]||_0x4e3489['key'][_0x47895d(0x13c)]||_0x4e3489[_0x47895d(0x256)][_0x47895d(0x1ae)]||undefined;return _0x2590b5&&(0x0,baileys_1['jidNormalizedUser'])(_0x2590b5);},getContactMessage=async(_0x197619,_0x1ab5b3)=>{const _0xf7c69=a558_0x2c2d44,_0x173a65=_0x197619[_0xf7c69(0x256)][_0xf7c69(0x1ae)][_0xf7c69(0x179)](_0xf7c69(0x119)),_0x420001=_0x197619['key'][_0xf7c69(0x1ae)][_0xf7c69(0x1dd)](/\D/g,'');return _0x173a65?{'id':getSenderMessage(_0x197619,_0x1ab5b3),'name':_0x197619[_0xf7c69(0x149)]}:{'id':_0x197619[_0xf7c69(0x256)][_0xf7c69(0x1ae)],'name':_0x197619[_0xf7c69(0x256)][_0xf7c69(0x21e)]?_0x420001:_0x197619[_0xf7c69(0x149)]};},getUnpackedMessage=_0x4e946e=>{const _0x21eea5=a558_0x2c2d44;return _0x4e946e['message']?.[_0x21eea5(0x214)]?.[_0x21eea5(0x177)]||_0x4e946e['message']?.[_0x21eea5(0x224)]?.['contextInfo']?.[_0x21eea5(0x12c)]||_0x4e946e[_0x21eea5(0x177)]?.[_0x21eea5(0x2b8)]?.[_0x21eea5(0x177)]||_0x4e946e[_0x21eea5(0x177)]?.[_0x21eea5(0x1a6)]?.[_0x21eea5(0x177)]||_0x4e946e[_0x21eea5(0x177)]?.[_0x21eea5(0x180)]?.[_0x21eea5(0x177)]||_0x4e946e[_0x21eea5(0x177)]?.[_0x21eea5(0x2b8)]?.[_0x21eea5(0x177)]||_0x4e946e[_0x21eea5(0x177)]?.['templateMessage']?.[_0x21eea5(0x22b)]||_0x4e946e[_0x21eea5(0x177)]?.['templateMessage']?.[_0x21eea5(0x1b0)]||_0x4e946e[_0x21eea5(0x177)]?.[_0x21eea5(0x148)]?.[_0x21eea5(0x161)]||_0x4e946e[_0x21eea5(0x177)]?.[_0x21eea5(0x1b1)]?.[_0x21eea5(0x1c1)]||_0x4e946e[_0x21eea5(0x177)]?.['highlyStructuredMessage']?.[_0x21eea5(0x105)]?.['hydratedTemplate']||_0x4e946e['message'];},getMessageMedia=_0x65c8f2=>{const _0xc33331=a558_0x2c2d44;return _0x65c8f2?.['imageMessage']||_0x65c8f2?.['audioMessage']||_0x65c8f2?.[_0xc33331(0x127)]||_0x65c8f2?.[_0xc33331(0x2ab)]||_0x65c8f2?.[_0xc33331(0x203)]||null;},downloadMedia=async _0x242f3f=>{const _0x20c53d=a558_0x2c2d44,_0x30575e=getUnpackedMessage(_0x242f3f),_0x2738ab=getMessageMedia(_0x30575e);if(!_0x2738ab)return null;const _0x2732ec=_0x30575e?.[_0x20c53d(0x203)]?_0x20c53d(0x131):_0x2738ab[_0x20c53d(0x263)][_0x20c53d(0x1bc)]('/')[0x0][_0x20c53d(0x1dd)](_0x20c53d(0x20e),_0x20c53d(0x131))?_0x2738ab[_0x20c53d(0x263)][_0x20c53d(0x1bc)]('/')[0x0]['replace']('application',_0x20c53d(0x131)):_0x2738ab[_0x20c53d(0x263)]['split']('/')[0x0];let _0x134a60,_0x3e702f=0x0;while(_0x3e702f<0xa&&!_0x134a60){try{_0x2738ab?.[_0x20c53d(0x16d)]&&(_0x2738ab[_0x20c53d(0x20d)]=''),_0x134a60=await(0x0,baileys_1[_0x20c53d(0x2a2)])(_0x2738ab,_0x2732ec);}catch(_0x337283){_0x3e702f+=0x1,await new Promise(_0x1dc009=>{setTimeout(_0x1dc009,0x3e8*_0x3e702f*0x2);}),logger_1['logger'][_0x20c53d(0x202)](_0x20c53d(0x28c)+_0x3e702f+_0x20c53d(0x19e)+_0x242f3f?.['key']?.['id']);}}if(!_0x134a60)throw new Error(_0x20c53d(0x123));let _0x4449de=_0x30575e?.[_0x20c53d(0x203)]?.[_0x20c53d(0x2bc)]||'';if(!_0x4449de){const _0x39a9fc=mime_1[_0x20c53d(0x254)][_0x20c53d(0x126)](_0x2738ab[_0x20c53d(0x263)]);_0x4449de=(0x0,MakeRandomId_1[_0x20c53d(0x26b)])(0x5)+'-'+new Date()['getTime']()+'.'+_0x39a9fc;}else _0x4449de=_0x4449de['split']('.')[_0x20c53d(0x1c0)](0x0,-0x1)['join']('.')+'.'+(0x0,MakeRandomId_1['makeRandomId'])(0x5)+'.'+_0x4449de['split']('.')['slice'](-0x1);const _0x5eed00=0x5*0x400*0x400/0x8,_0x54edff=0x400*0x400/0x8,_0x5e6922=0x400*0x400,_0x26924d=new stream_throttle_1[(_0x20c53d(0x23d))]({'rate':_0x5eed00});let _0x52e1c8=Buffer[_0x20c53d(0x23e)]([]),_0x34bfe9=0x0;const _0x5c050b=Date[_0x20c53d(0x1f0)]();try{for await(const _0x474bd9 of _0x134a60['pipe'](_0x26924d)){_0x52e1c8=Buffer[_0x20c53d(0x210)]([_0x52e1c8,_0x474bd9]),_0x34bfe9+=_0x474bd9[_0x20c53d(0x284)],_0x34bfe9>_0x5e6922&&(_0x26924d['rate']=_0x54edff);}}catch(_0x298ca2){return{'data':_0x20c53d(0x18b),'mimetype':'','filename':''};}const _0x23e0d0=Date[_0x20c53d(0x1f0)](),_0x1ea5fc=(_0x23e0d0-_0x5c050b)/0x3e8,_0x205200=_0x34bfe9/_0x1ea5fc;logger_1[_0x20c53d(0x24c)][_0x20c53d(0x124)](_0x4449de+'\x20Download\x20completed\x20in\x20'+_0x1ea5fc[_0x20c53d(0x1bf)](0x2)+'\x20seconds\x20with\x20an\x20effective\x20speed\x20of\x20'+(_0x205200/0x400/0x400)[_0x20c53d(0x1bf)](0x2)+_0x20c53d(0x163));if(!_0x52e1c8){Sentry['setExtra'](_0x20c53d(0x1ad),{'msg':_0x242f3f}),Sentry[_0x20c53d(0x175)](new Error(_0x20c53d(0x1ad)));throw new Error('ERR_WAPP_DOWNLOAD_MEDIA');}const _0x5598cd={'data':_0x52e1c8,'mimetype':_0x2738ab[_0x20c53d(0x263)],'filename':_0x4449de};return _0x5598cd;},verifyContact=async(_0x5562d9,_0x561d6f,_0x45c0ca)=>{const _0x4c2054=a558_0x2c2d44,_0x46444a={'name':_0x5562d9?.[_0x4c2054(0x10e)]||_0x5562d9['id'][_0x4c2054(0x1dd)](/\D/g,''),'number':_0x5562d9['id'][_0x4c2054(0x11a)](0x0,_0x5562d9['id'][_0x4c2054(0x238)]('@')),'isGroup':_0x5562d9['id']['includes'](_0x4c2054(0x119)),'companyId':_0x45c0ca,'whatsappId':_0x561d6f['id']},_0x44fb59=(0x0,CreateOrUpdateContactService_1[_0x4c2054(0x254)])(_0x46444a,_0x561d6f,_0x5562d9['id']);return _0x44fb59;},verifyQuotedMessage=async _0x18a6a0=>{const _0x269299=a558_0x2c2d44;if(!_0x18a6a0)return null;const _0x596053=(0x0,exports[_0x269299(0x206)])(_0x18a6a0);if(!_0x596053)return null;const _0x1adf4f=await Message_1[_0x269299(0x254)][_0x269299(0x27d)]({'where':{'id':_0x596053}});if(!_0x1adf4f)return null;return _0x1adf4f;};exports[a558_0x2c2d44(0x1f1)]=verifyQuotedMessage;const sanitizeName=_0xe3d590=>{const _0x4d3e24=a558_0x2c2d44;let _0xe4cb83=_0xe3d590['split']('\x20')[0x0];return _0xe4cb83=_0xe4cb83[_0x4d3e24(0x1dd)](/[^a-zA-Z0-9]/g,''),_0xe4cb83[_0x4d3e24(0x11a)](0x0,0x3c);},convertTextToSpeechAndSaveToFile=(_0x503ae1,_0xf4b908,_0x2825ed,_0x4d393a,_0x49333e=a558_0x2c2d44(0x245),_0x1cc247=a558_0x2c2d44(0x230))=>{return new Promise((_0x117ee4,_0x636900)=>{const _0x21f900=a558_0x4046,_0x13aec0=microsoft_cognitiveservices_speech_sdk_1['SpeechConfig']['fromSubscription'](_0x2825ed,_0x4d393a);_0x13aec0[_0x21f900(0x155)]=_0x49333e;const _0x569d3d=microsoft_cognitiveservices_speech_sdk_1[_0x21f900(0x250)]['fromAudioFileOutput'](_0xf4b908+_0x21f900(0x15f)),_0x12a742=new microsoft_cognitiveservices_speech_sdk_1[(_0x21f900(0x2aa))](_0x13aec0,_0x569d3d);_0x12a742[_0x21f900(0x144)](_0x503ae1,_0x5eef96=>{const _0x408379=_0x21f900;_0x5eef96?convertWavToAnotherFormat(_0xf4b908+_0x408379(0x15f),_0xf4b908+'.'+_0x1cc247,_0x1cc247)['then'](_0x18562a=>{_0x117ee4();})['catch'](_0x4519a4=>{const _0x5649de=_0x408379;console[_0x5649de(0x18b)](_0x4519a4),_0x636900(_0x4519a4);}):_0x636900(new Error('No\x20result\x20from\x20synthesizer')),_0x12a742[_0x408379(0x13a)]();},_0x10a6ca=>{const _0x182dc7=_0x21f900;console['error']('Error:\x20'+_0x10a6ca),_0x12a742[_0x182dc7(0x13a)](),_0x636900(_0x10a6ca);});});},convertWavToAnotherFormat=(_0x3dafa1,_0x1a679c,_0x2256c2)=>{return new Promise((_0x151ec7,_0x4fb7ef)=>{const _0x223721=a558_0x4046;(0x0,fluent_ffmpeg_1[_0x223721(0x254)])()[_0x223721(0x220)](_0x3dafa1)['toFormat'](_0x2256c2)['on'](_0x223721(0x1fa),()=>_0x151ec7(_0x1a679c))['on'](_0x223721(0x18b),_0x4b23aa=>_0x4fb7ef(new Error(_0x223721(0x27e)+_0x4b23aa[_0x223721(0x177)])))[_0x223721(0x159)](_0x1a679c);});},deleteFileSync=_0x3b3e40=>{const _0x26931b=a558_0x2c2d44;try{fs_2[_0x26931b(0x254)][_0x26931b(0x199)](_0x3b3e40);}catch(_0x1670cc){console[_0x26931b(0x18b)]('Erro\x20ao\x20deletar\x20o\x20arquivo:',_0x1670cc);}},keepOnlySpecifiedChars=_0x2639d4=>{const _0x50a2a4=a558_0x2c2d44;return _0x2639d4[_0x50a2a4(0x1dd)](/[^a-zA-Z0-9áéíóúÁÉÍÓÚâêîôûÂÊÎÔÛãõÃÕçÇ!?.,;:\s]/g,'');},handleOpenAi=async(_0x25a86c,_0x126817,_0x12a087,_0x5c9881,_0x28149f)=>{const _0x591038=a558_0x2c2d44,_0x14b18c=(0x0,exports['getBodyMessage'])(_0x25a86c);if(!_0x14b18c)return;let {prompt:_0xd3bb12}=await(0x0,ShowWhatsAppService_1[_0x591038(0x254)])(_0x126817['id'],_0x12a087['companyId']);!_0xd3bb12&&!(0x0,lodash_1[_0x591038(0x226)])(_0x12a087?.[_0x591038(0x243)]?.[_0x591038(0x209)])&&(_0xd3bb12=_0x12a087['queue'][_0x591038(0x209)]);if(!_0xd3bb12)return;if(_0x25a86c['messageStubType'])return;const _0x1b0562=path_1['default'][_0x591038(0x17d)](__dirname,'..','..','..',_0x591038(0x1c6));let _0x13eb02;const _0x5e9872=sessionsOpenAi[_0x591038(0x125)](_0x14a594=>_0x14a594['id']===_0x126817['id']);if(_0x5e9872===-0x1){const _0x2da8d5=new openai_1[(_0x591038(0x1a4))]({'apiKey':_0xd3bb12[_0x591038(0x2c8)]});_0x13eb02=new openai_1[(_0x591038(0x282))](_0x2da8d5),_0x13eb02['id']=_0x126817['id'],sessionsOpenAi[_0x591038(0x1a5)](_0x13eb02);}else _0x13eb02=sessionsOpenAi[_0x5e9872];const _0x1fbb49=await Message_1[_0x591038(0x254)][_0x591038(0x2c0)]({'where':{'ticketId':_0x12a087['id']},'order':[[_0x591038(0x200),'ASC']],'limit':_0xd3bb12[_0x591038(0x2c3)]}),_0x5d5adc=_0x591038(0x2b1)+sanitizeName(_0x5c9881[_0x591038(0x10e)]||'Amigo(a)')+_0x591038(0x17f)+_0xd3bb12[_0x591038(0x153)]+'\x20tokens\x20e\x20cuide\x20para\x20não\x20truncar\x20o\x20final.\x0aSempre\x20que\x20possível,\x20mencione\x20o\x20nome\x20dele\x20para\x20ser\x20mais\x20personalizado\x20o\x20atendimento\x20e\x20mais\x20educado.\x20Quando\x20a\x20resposta\x20requer\x20uma\x20transferência\x20para\x20o\x20setor\x20de\x20atendimento,\x20comece\x20sua\x20resposta\x20com\x20\x27Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento\x27.\x0a\x0a\x20\x20'+_0xd3bb12[_0x591038(0x209)]+'\x0a';let _0x5c2fef=[];if(_0x25a86c['message']?.[_0x591038(0x20c)]||_0x25a86c[_0x591038(0x177)]?.[_0x591038(0x224)]?.[_0x591038(0x29c)]){_0x5c2fef=[],_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x196),'content':_0x5d5adc});for(let _0x6a44cc=0x0;_0x6a44cc<Math[_0x591038(0x2b7)](_0xd3bb12[_0x591038(0x2c3)],_0x1fbb49[_0x591038(0x284)]);_0x6a44cc++){const _0x3eaf88=_0x1fbb49[_0x6a44cc];_0x3eaf88[_0x591038(0x190)]===_0x591038(0x262)&&(_0x3eaf88['fromMe']?_0x5c2fef['push']({'role':_0x591038(0x1c4),'content':_0x3eaf88['body']}):_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x14d),'content':_0x3eaf88[_0x591038(0x223)]}));}_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x14d),'content':_0x14b18c});const _0x1584ae=await _0x13eb02[_0x591038(0x103)]({'model':_0x591038(0x2a1),'messages':_0x5c2fef,'max_tokens':_0xd3bb12['maxTokens'],'temperature':_0xd3bb12[_0x591038(0x2a8)]});let _0x39e1a6=_0x1584ae[_0x591038(0x295)][_0x591038(0x13b)][0x0][_0x591038(0x177)]?.[_0x591038(0x283)];_0x39e1a6?.[_0x591038(0x179)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento')&&(await transferQueue(_0xd3bb12[_0x591038(0x29f)],_0x12a087,_0x5c9881),_0x39e1a6=_0x39e1a6[_0x591038(0x1dd)]('Ação:\x20Transferir\x20para\x20o\x20setor\x20de\x20atendimento','')[_0x591038(0x12e)]());if(_0xd3bb12[_0x591038(0x1fb)]===_0x591038(0x174)){const _0x2b67bd=await _0x126817['sendMessage'](_0x25a86c[_0x591038(0x256)][_0x591038(0x1ae)],{'text':_0x39e1a6});await(0x0,exports[_0x591038(0x1f4)])(_0x2b67bd,_0x12a087,_0x5c9881);}else{const _0x1f1360=_0x12a087['id']+'_'+Date[_0x591038(0x1f0)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0x39e1a6),_0x1b0562+'/'+_0x1f1360,_0xd3bb12[_0x591038(0x235)],_0xd3bb12[_0x591038(0x228)],_0xd3bb12[_0x591038(0x1fb)],_0x591038(0x230))['then'](async()=>{const _0x2c6f64=_0x591038;try{const _0x549745=await _0x126817['sendMessage'](_0x25a86c['key'][_0x2c6f64(0x1ae)],{'audio':{'url':_0x1b0562+'/'+_0x1f1360+_0x2c6f64(0x15a)},'mimetype':'audio/mpeg','ptt':!![]});await verifyMediaMessage(_0x549745,_0x12a087,_0x5c9881),deleteFileSync(_0x1b0562+'/'+_0x1f1360+'.mp3'),deleteFileSync(_0x1b0562+'/'+_0x1f1360+'.wav');}catch(_0x20fe40){console[_0x2c6f64(0x182)](_0x2c6f64(0x16e)+_0x20fe40);}});}}else{if(_0x25a86c[_0x591038(0x177)]?.['audioMessage']){const _0x24b95f=_0x28149f[_0x591038(0x147)]['split']('/')['pop'](),_0x23b05c=fs_2[_0x591038(0x254)]['createReadStream'](_0x1b0562+'/'+_0x24b95f),_0x57ce66=await _0x13eb02['createTranscription'](_0x23b05c,_0x591038(0x10b));_0x5c2fef=[],_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x196),'content':_0x5d5adc});for(let _0x60f0e9=0x0;_0x60f0e9<Math[_0x591038(0x2b7)](_0xd3bb12[_0x591038(0x2c3)],_0x1fbb49[_0x591038(0x284)]);_0x60f0e9++){const _0x6f825e=_0x1fbb49[_0x60f0e9];_0x6f825e[_0x591038(0x190)]===_0x591038(0x262)&&(_0x6f825e[_0x591038(0x21e)]?_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x1c4),'content':_0x6f825e[_0x591038(0x223)]}):_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x14d),'content':_0x6f825e[_0x591038(0x223)]}));}_0x5c2fef[_0x591038(0x1a5)]({'role':_0x591038(0x14d),'content':_0x57ce66['data'][_0x591038(0x29c)]});const _0x13016a=await _0x13eb02[_0x591038(0x103)]({'model':_0x591038(0x2a1),'messages':_0x5c2fef,'max_tokens':_0xd3bb12[_0x591038(0x153)],'temperature':_0xd3bb12[_0x591038(0x2a8)]});let _0xc307af=_0x13016a['data'][_0x591038(0x13b)][0x0][_0x591038(0x177)]?.[_0x591038(0x283)];_0xc307af?.[_0x591038(0x179)](_0x591038(0x2c7))&&(await transferQueue(_0xd3bb12[_0x591038(0x29f)],_0x12a087,_0x5c9881),_0xc307af=_0xc307af['replace'](_0x591038(0x2c7),'')['trim']());if(_0xd3bb12[_0x591038(0x1fb)]===_0x591038(0x174)){const _0x41ea40=await _0x126817['sendMessage'](_0x25a86c[_0x591038(0x256)][_0x591038(0x1ae)],{'text':_0xc307af});await(0x0,exports[_0x591038(0x1f4)])(_0x41ea40,_0x12a087,_0x5c9881);}else{const _0x562773=_0x12a087['id']+'_'+Date[_0x591038(0x1f0)]();convertTextToSpeechAndSaveToFile(keepOnlySpecifiedChars(_0xc307af),_0x1b0562+'/'+_0x562773,_0xd3bb12['voiceKey'],_0xd3bb12[_0x591038(0x228)],_0xd3bb12[_0x591038(0x1fb)],'mp3')[_0x591038(0x1a2)](async()=>{const _0x428edf=_0x591038;try{const _0x2fbdab=await _0x126817[_0x428edf(0x106)](_0x25a86c[_0x428edf(0x256)]['remoteJid'],{'audio':{'url':_0x1b0562+'/'+_0x562773+_0x428edf(0x15a)},'mimetype':_0x428edf(0x1af),'ptt':!![]});await verifyMediaMessage(_0x2fbdab,_0x12a087,_0x5c9881),deleteFileSync(_0x1b0562+'/'+_0x562773+_0x428edf(0x15a)),deleteFileSync(_0x1b0562+'/'+_0x562773+'.wav');}catch(_0x40b429){console[_0x428edf(0x182)](_0x428edf(0x16e)+_0x40b429);}});}}}_0x5c2fef=[];},transferQueue=async(_0x1330f5,_0x3a16be,_0x422346)=>{const _0x3db285=a558_0x2c2d44;console[_0x3db285(0x2b5)](_0x3db285(0x16f)),await(0x0,UpdateTicketService_1[_0x3db285(0x254)])({'ticketData':{'queueId':_0x1330f5,'useIntegration':![],'promptId':null},'ticketId':_0x3a16be['id'],'companyId':_0x3a16be['companyId']});},verifyMediaMessage=async(_0x507073,_0x4d9120,_0xe852f7)=>{const _0x4393b2=a558_0x2c2d44,_0x5ccea4=(0x0,socket_1['getIO'])();let _0x5b8107=await Message_1[_0x4393b2(0x254)][_0x4393b2(0x27d)]({'where':{'id':_0x507073[_0x4393b2(0x256)]['id']}});if(!_0x5b8107){const _0x1763bf=await(0x0,exports['verifyQuotedMessage'])(_0x507073),_0x1646f4=(0x0,wbot_1[_0x4393b2(0x23b)])(_0x4d9120[_0x4393b2(0x1b4)]),_0x325549=await downloadMedia(_0x507073);if(!_0x325549)throw new Error(_0x4393b2(0x1ad));if(!_0x325549[_0x4393b2(0x14f)]){const _0x237c17=typeof _0x325549[_0x4393b2(0x263)]===_0x4393b2(0x27f)&&_0x325549[_0x4393b2(0x263)][_0x4393b2(0x179)]('/')&&_0x325549[_0x4393b2(0x263)]['includes'](';')?mime_1['default'][_0x4393b2(0x126)](_0x325549[_0x4393b2(0x263)]):_0x4393b2(0x1b3);_0x325549[_0x4393b2(0x14f)]=new Date()[_0x4393b2(0x205)]()+'.'+_0x237c17;}else{let _0x586768=_0x325549['filename']?'-'+_0x325549[_0x4393b2(0x14f)]:'';_0x325549[_0x4393b2(0x14f)]=''+new Date()[_0x4393b2(0x205)]()+_0x586768;}try{const _0x231f44=_0x4393b2(0x23a)+_0x4d9120[_0x4393b2(0x1e6)];!fs_2['default'][_0x4393b2(0x17a)](_0x231f44)&&(fs_2[_0x4393b2(0x254)][_0x4393b2(0x237)](_0x231f44),fs_2['default'][_0x4393b2(0x290)](_0x231f44,0x1ff)),await writeFileAsync((0x0,path_1['join'])(__dirname,'..','..','..',_0x231f44,_0x325549[_0x4393b2(0x14f)]),_0x325549[_0x4393b2(0x295)],_0x4393b2(0x1cf));}catch(_0x26c042){Sentry[_0x4393b2(0x175)](_0x26c042),logger_1['logger']['error'](_0x26c042);}const _0xa09373=(0x0,exports[_0x4393b2(0x2b9)])(_0x507073);var _0x25839d=getTypeMessage(_0x507073);const _0x473743={'id':_0x507073[_0x4393b2(0x256)]['id'],'ticketId':_0x4d9120['id'],'contactId':_0x507073['key'][_0x4393b2(0x21e)]?undefined:_0xe852f7['id'],'body':_0xa09373?(0x0,Mustache_1['default'])(_0xa09373,_0x4d9120):_0x325549[_0x4393b2(0x14f)],'fromMe':_0x507073[_0x4393b2(0x256)][_0x4393b2(0x21e)],'read':_0x507073[_0x4393b2(0x256)][_0x4393b2(0x21e)],'mediaUrl':_0x325549[_0x4393b2(0x14f)],'mediaType':typeof _0x325549['mimetype']==='string'?_0x325549[_0x4393b2(0x263)][_0x4393b2(0x1bc)]('/')[0x0]:_0x4393b2(0x1b3),'quotedMsgId':_0x1763bf?.['id'],'ack':getStatus(_0x507073,_0x4393b2(0x13d)),'remoteJid':_0x507073[_0x4393b2(0x256)][_0x4393b2(0x1ae)],'participant':_0x507073['key'][_0x4393b2(0x13c)],'dataJson':JSON['stringify'](_0x507073)};var _0x5d391d=_0xa09373||_0x325549[_0x4393b2(0x14f)];typeof _0x5d391d!=_0x4393b2(0x27f)&&console[_0x4393b2(0x2b5)](_0x4393b2(0x13e),_0x5d391d),await _0x4d9120[_0x4393b2(0x1ed)]({'lastMessage':_0x5d391d}),_0x5b8107=await(0x0,CreateMessageService_1[_0x4393b2(0x254)])({'messageData':_0x473743,'ticket':_0x4d9120,'companyId':_0x4d9120[_0x4393b2(0x1e6)]});}else typeof _0x5b8107[_0x4393b2(0x223)]!=_0x4393b2(0x27f)&&console['trace'](_0x4393b2(0x13e),_0x5b8107[_0x4393b2(0x223)]),await _0x4d9120[_0x4393b2(0x1ed)]({'lastMessage':_0x5b8107['body']}),_0x5b8107[_0x4393b2(0x1cd)]=getStatus(_0x507073,'media'),_0x5b8107[_0x4393b2(0x13c)]=_0x507073[_0x4393b2(0x256)][_0x4393b2(0x13c)],_0x5b8107[_0x4393b2(0x2c2)]=JSON[_0x4393b2(0x204)](_0x507073),await _0x5b8107['save']();return!_0x507073['key']['fromMe']&&_0x4d9120['status']===_0x4393b2(0x22e)&&(await _0x4d9120[_0x4393b2(0x1ed)]({'status':'pending'}),await _0x4d9120['reload']({'include':[{'model':Queue_1[_0x4393b2(0x254)],'as':_0x4393b2(0x243)},{'model':User_1['default'],'as':_0x4393b2(0x14d)},{'model':Contact_1['default'],'as':_0x4393b2(0x2a4)}]}),_0x5ccea4['to']('company-'+_0x4d9120[_0x4393b2(0x1e6)]+_0x4393b2(0x293))[_0x4393b2(0x1a1)](_0x4393b2(0x1ac)+_0x4d9120[_0x4393b2(0x1e6)]+_0x4393b2(0x165),{'action':_0x4393b2(0x134),'ticket':_0x4d9120,'ticketId':_0x4d9120['id']}),_0x5ccea4['to']('company-'+_0x4d9120[_0x4393b2(0x1e6)]+'-'+_0x4d9120[_0x4393b2(0x137)])['to'](_0x4d9120['id'][_0x4393b2(0x10d)]())[_0x4393b2(0x1a1)]('company-'+_0x4d9120[_0x4393b2(0x1e6)]+_0x4393b2(0x165),{'action':_0x4393b2(0x1ed),'ticket':_0x4d9120,'ticketId':_0x4d9120['id']})),_0x5b8107;};function getStatus(_0x5239cd,_0x3681b0){const _0x487ac3=a558_0x2c2d44;if(_0x5239cd[_0x487ac3(0x137)]==baileys_1[_0x487ac3(0x166)]['WebMessageInfo']['Status'][_0x487ac3(0x135)]){if(_0x5239cd[_0x487ac3(0x256)]['fromMe']&&_0x3681b0=='reactionMessage')return 0x3;return 0x1;}else{if(_0x5239cd[_0x487ac3(0x137)]==baileys_1[_0x487ac3(0x166)][_0x487ac3(0x15c)][_0x487ac3(0x233)][_0x487ac3(0x287)])return 0x1;else{if(_0x5239cd['status']==baileys_1[_0x487ac3(0x166)]['WebMessageInfo'][_0x487ac3(0x233)][_0x487ac3(0x104)])return 0x2;else{if(_0x5239cd[_0x487ac3(0x137)]==baileys_1[_0x487ac3(0x166)][_0x487ac3(0x15c)][_0x487ac3(0x233)][_0x487ac3(0x1c5)]||_0x5239cd[_0x487ac3(0x137)]==baileys_1[_0x487ac3(0x166)]['WebMessageInfo'][_0x487ac3(0x233)][_0x487ac3(0x118)])return 0x3;}}}return 0x0;}const verifyMessage=async(_0x199d04,_0x2a07e8,_0x5a049b)=>{const _0x45e77d=a558_0x2c2d44,_0x59eda2=(0x0,socket_1[_0x45e77d(0x157)])(),_0xbb80bb=await(0x0,exports[_0x45e77d(0x1f1)])(_0x199d04),_0xadfde9=(0x0,exports[_0x45e77d(0x2b9)])(_0x199d04);if(!_0xadfde9)return;let _0x521a48=getTypeMessage(_0x199d04);const _0x1b9f1f=_0x521a48==_0x45e77d(0x26d)||_0x199d04?.['message']?.[_0x45e77d(0x128)]?.[_0x45e77d(0x22f)]==baileys_1[_0x45e77d(0x166)][_0x45e77d(0x285)][_0x45e77d(0x1f2)][_0x45e77d(0x291)]['MESSAGE_EDIT']||_0x199d04?.[_0x45e77d(0x177)]?.[_0x45e77d(0x128)]?.[_0x45e77d(0x26d)]?.['conversation']?.[_0x45e77d(0x284)]>0x0;let _0x529f45=_0x199d04[_0x45e77d(0x256)]['id'];if(_0x521a48==_0x45e77d(0x128))_0x529f45=_0x199d04?.[_0x45e77d(0x177)]?.[_0x45e77d(0x128)]?.[_0x45e77d(0x256)]?.['id']||_0x199d04[_0x45e77d(0x256)]['id'];else _0x521a48==_0x45e77d(0x26d)&&(_0x529f45=_0x199d04?.['message']?.[_0x45e77d(0x26d)]?.['message']?.['protocolMessage']?.[_0x45e77d(0x256)]?.['id']||_0x199d04[_0x45e77d(0x256)]['id']);const _0xbe12d7={'id':_0x529f45,'ticketId':_0x2a07e8['id'],'contactId':_0x199d04['key'][_0x45e77d(0x21e)]?undefined:_0x5a049b['id'],'body':_0xadfde9,'fromMe':_0x199d04[_0x45e77d(0x256)][_0x45e77d(0x21e)],'mediaType':_0x521a48,'read':_0x199d04['key'][_0x45e77d(0x21e)],'quotedMsgId':_0xbb80bb?.['id'],'ack':getStatus(_0x199d04,_0x521a48),'remoteJid':_0x199d04[_0x45e77d(0x256)][_0x45e77d(0x1ae)],'participant':_0x199d04[_0x45e77d(0x256)][_0x45e77d(0x13c)],'dataJson':JSON[_0x45e77d(0x204)](_0x199d04),'isEdited':_0x1b9f1f};typeof _0xadfde9!=_0x45e77d(0x27f)&&console['trace'](_0x45e77d(0x13e),_0xadfde9);await _0x2a07e8[_0x45e77d(0x1ed)]({'lastMessage':_0xadfde9});if(_0x1b9f1f){let _0x20b72a=await Message_1[_0x45e77d(0x254)][_0x45e77d(0x117)](_0xbe12d7['id']);if(_0x20b72a){const _0x3d151d={'messageId':_0xbe12d7['id'],'body':_0x20b72a[_0x45e77d(0x223)]};await OldMessage_1[_0x45e77d(0x254)][_0x45e77d(0x107)](_0x3d151d);}else console[_0x45e77d(0x182)](_0x45e77d(0x2b6)+_0xbe12d7['id']);}await(0x0,CreateMessageService_1[_0x45e77d(0x254)])({'messageData':_0xbe12d7,'ticket':_0x2a07e8,'companyId':_0x2a07e8[_0x45e77d(0x1e6)]}),!_0x199d04[_0x45e77d(0x256)]['fromMe']&&_0x2a07e8[_0x45e77d(0x137)]===_0x45e77d(0x22e)&&(await _0x2a07e8[_0x45e77d(0x1ed)]({'status':_0x45e77d(0x19b)}),await _0x2a07e8[_0x45e77d(0x151)]({'include':[{'model':Queue_1[_0x45e77d(0x254)],'as':_0x45e77d(0x243)},{'model':User_1['default'],'as':_0x45e77d(0x14d)},{'model':Contact_1['default'],'as':_0x45e77d(0x2a4)}]}),_0x59eda2['to'](_0x45e77d(0x1ac)+_0x2a07e8[_0x45e77d(0x1e6)]+_0x45e77d(0x293))[_0x45e77d(0x1a1)](_0x45e77d(0x1ac)+_0x2a07e8[_0x45e77d(0x1e6)]+'-ticket',{'action':_0x45e77d(0x134),'ticket':_0x2a07e8,'ticketId':_0x2a07e8['id']}),_0x59eda2['to'](_0x45e77d(0x1ac)+_0x2a07e8[_0x45e77d(0x1e6)]+'-'+_0x2a07e8['status'])['to'](_0x2a07e8['id'][_0x45e77d(0x10d)]())[_0x45e77d(0x1a1)](_0x45e77d(0x1ac)+_0x2a07e8[_0x45e77d(0x1e6)]+_0x45e77d(0x165),{'action':_0x45e77d(0x1ed),'ticket':_0x2a07e8,'ticketId':_0x2a07e8['id']}));};exports[a558_0x2c2d44(0x1f4)]=verifyMessage;const isValidMsg=_0x78b7db=>{const _0x56b41b=a558_0x2c2d44;if(_0x78b7db[_0x56b41b(0x256)][_0x56b41b(0x1ae)]===_0x56b41b(0x1e1))return![];try{const _0x1c9bbc=getTypeMessage(_0x78b7db);if(!_0x1c9bbc)return![];const _0x4b8ab0=_0x1c9bbc===_0x56b41b(0x20c)||_0x1c9bbc===_0x56b41b(0x26d)||_0x1c9bbc===_0x56b41b(0x224)||_0x1c9bbc===_0x56b41b(0x28b)||_0x1c9bbc===_0x56b41b(0x127)||_0x1c9bbc===_0x56b41b(0x178)||_0x1c9bbc==='templateMessage'||_0x1c9bbc==='pollCreationMessageV3'||_0x1c9bbc==='interactiveMessage'||_0x1c9bbc==='imageMessage'||_0x1c9bbc===_0x56b41b(0x203)||_0x1c9bbc===_0x56b41b(0x214)||_0x1c9bbc===_0x56b41b(0x2ab)||_0x1c9bbc===_0x56b41b(0x1e0)||_0x1c9bbc==='buttonsMessage'||_0x1c9bbc===_0x56b41b(0x1ea)||_0x1c9bbc===_0x56b41b(0x28a)||_0x1c9bbc===_0x56b41b(0x2a5)||_0x1c9bbc===_0x56b41b(0x2b0)||_0x1c9bbc===_0x56b41b(0x160)||_0x1c9bbc===_0x56b41b(0x267)||_0x1c9bbc===_0x56b41b(0x1de)||_0x1c9bbc===_0x56b41b(0x1a7)||_0x1c9bbc===_0x56b41b(0x2b8)||_0x1c9bbc===_0x56b41b(0x128)||_0x1c9bbc===_0x56b41b(0x1c7)||_0x1c9bbc===_0x56b41b(0x2bd)||_0x1c9bbc===_0x56b41b(0x1a6)||_0x1c9bbc===_0x56b41b(0x180)||_0x1c9bbc===_0x56b41b(0x1ab)||_0x1c9bbc===_0x56b41b(0x1d2);return!_0x4b8ab0&&(logger_1[_0x56b41b(0x24c)][_0x56b41b(0x202)](_0x56b41b(0x150)+_0x1c9bbc+'\x0a'+JSON[_0x56b41b(0x204)](_0x78b7db?.[_0x56b41b(0x177)])),Sentry[_0x56b41b(0x244)](_0x56b41b(0x231),{'BodyMsg':_0x78b7db[_0x56b41b(0x177)],'msg':_0x78b7db,'msgType':_0x1c9bbc}),Sentry['captureException'](new Error(_0x56b41b(0x2c4)))),!!_0x4b8ab0;}catch(_0x51f257){Sentry[_0x56b41b(0x244)]('Error\x20isValidMsg',{'msg':_0x78b7db}),Sentry['captureException'](_0x51f257);}return![];};exports[a558_0x2c2d44(0x1cb)]=isValidMsg;const Push=_0x2ae7a0=>{const _0x1a3746=a558_0x2c2d44;return _0x2ae7a0[_0x1a3746(0x149)];},verifyQueue=async(_0x21661d,_0x411fc9,_0x1b3c3f,_0xfaf5c1,_0x1f7519)=>{const _0x282cbb=a558_0x2c2d44,_0x132c5b=_0x1b3c3f[_0x282cbb(0x1e6)],{queues:_0x50ef4c,greetingMessage:_0x375f1f,maxUseBotQueues:_0x2ce051,timeUseBotQueues:_0x51578e}=await(0x0,ShowWhatsAppService_1[_0x282cbb(0x254)])(_0x21661d['id'],_0x1b3c3f['companyId']);if(_0x50ef4c[_0x282cbb(0x284)]===0x1){const _0x94f0f=(0x0,lodash_1[_0x282cbb(0x15e)])(_0x50ef4c);let _0x571e37=![];_0x94f0f?.[_0x282cbb(0x122)]&&(_0x571e37=_0x94f0f['options'][_0x282cbb(0x284)]>0x0);const _0x4ca061=await Setting_1[_0x282cbb(0x254)][_0x282cbb(0x27d)]({'where':{'key':'sendGreetingMessageOneQueues','companyId':_0x1b3c3f['companyId']}});greetingMessageControl['push']({'ticketId':_0x1b3c3f['id'],'greetingMessage':_0x375f1f,'companyId':_0x132c5b});if(_0x375f1f[_0x282cbb(0x284)]>0x1&&_0x4ca061?.[_0x282cbb(0x1d8)]==='enabled'){const _0x193b65=await Message_1[_0x282cbb(0x254)][_0x282cbb(0x27d)]({'where':{'ticketId':_0x1b3c3f['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x282cbb(0x154)]]:(0x0,moment_1['default'])()[_0x282cbb(0x27b)](0x5,_0x282cbb(0x21d))[_0x282cbb(0x18f)]()}}});if(_0x193b65)return;const _0x114821=(0x0,Mustache_1[_0x282cbb(0x254)])(''+_0x375f1f,_0x1b3c3f);await _0x21661d['sendMessage'](_0xfaf5c1[_0x282cbb(0x217)]+'@'+(_0x1b3c3f[_0x282cbb(0x1fe)]?_0x282cbb(0x119):'s.whatsapp.net'),{'text':_0x114821});}const _0x2eaf52=await(0x0,ShowWhatsAppService_1[_0x282cbb(0x254)])(_0x21661d['id'],_0x132c5b),_0x4ae462=_0x50ef4c[0x0]?.['integrationId']||_0x2eaf52[_0x282cbb(0x2c6)];if(!_0x411fc9[_0x282cbb(0x256)][_0x282cbb(0x21e)]&&!_0x1b3c3f[_0x282cbb(0x1fe)]&&!(0x0,lodash_1[_0x282cbb(0x226)])(_0x4ae462)){const _0x3b2a10=await(0x0,ShowQueueIntegrationService_1['default'])(_0x4ae462,_0x132c5b);await(0x0,exports[_0x282cbb(0x19f)])(_0x411fc9,_0x21661d,_0x3b2a10,_0x1b3c3f),await _0x1b3c3f['update']({'useIntegration':!![],'integrationId':_0x3b2a10['id']});}const _0x6cecb4=_0x50ef4c[0x0]?.[_0x282cbb(0x143)]||_0x2eaf52[_0x282cbb(0x143)];!_0x411fc9[_0x282cbb(0x256)][_0x282cbb(0x21e)]&&!_0x1b3c3f[_0x282cbb(0x1fe)]&&!(0x0,lodash_1['isNil'])(_0x6cecb4)&&(console['log'](_0x282cbb(0x2c1)),await handleOpenAi(_0x411fc9,_0x21661d,_0x1b3c3f,_0xfaf5c1,_0x1f7519),await _0x1b3c3f[_0x282cbb(0x1ed)]({'useIntegration':!![],'promptId':_0x6cecb4}));await(0x0,UpdateTicketService_1[_0x282cbb(0x254)])({'ticketData':{'queueId':_0x94f0f?.['id'],'chatbot':_0x571e37,'status':_0x282cbb(0x19b)},'ticketId':_0x1b3c3f['id'],'companyId':_0x1b3c3f[_0x282cbb(0x1e6)]});return;}const _0x38fcce=_0x411fc9?.[_0x282cbb(0x177)]?.[_0x282cbb(0x1e0)]?.['selectedButtonId']||_0x411fc9?.[_0x282cbb(0x177)]?.[_0x282cbb(0x1c7)]?.[_0x282cbb(0x158)]?.['selectedRowId']||_0x411fc9?.['message']?.[_0x282cbb(0x224)]?.[_0x282cbb(0x29c)]||_0x411fc9?.['message']?.[_0x282cbb(0x20c)];let _0x575a8e=null;if(_0x38fcce&&!(0x0,exports[_0x282cbb(0x1f7)])(_0x38fcce)||+_0x38fcce>_0x50ef4c['length']){const _0x2af00b=_0x38fcce[_0x282cbb(0x181)]();for(let _0x3d1670 of _0x50ef4c){if(_0x3d1670[_0x282cbb(0x10e)][_0x282cbb(0x181)]()===_0x2af00b){_0x575a8e=_0x3d1670;break;}if(_0x3d1670[_0x282cbb(0x27c)]&&_0x3d1670[_0x282cbb(0x27c)][_0x282cbb(0x284)]>0x0){let _0x3cf65e=_0x3d1670[_0x282cbb(0x27c)]['split'](',\x20');for(let _0xd96e7d of _0x3cf65e){if(_0xd96e7d['toLowerCase']()==_0x2af00b){_0x575a8e=_0x3d1670;break;}}}}}else _0x575a8e=_0x50ef4c[+_0x38fcce-0x1];const _0x6b3d41=await Setting_1[_0x282cbb(0x254)][_0x282cbb(0x27d)]({'where':{'key':_0x282cbb(0x266),'companyId':_0x132c5b}}),_0x125059=async()=>{const _0x197fd5=_0x282cbb;let _0x18b15d='';if(outOfHourMessageControl['length']>0x1388)outOfHourMessageControl=[];_0x50ef4c[_0x197fd5(0x24a)]((_0x5872ad,_0x1c9e1f)=>{const _0x152e87=_0x197fd5;_0x18b15d+=_0x152e87(0x176)+(_0x1c9e1f+0x1)+_0x152e87(0x299)+_0x5872ad[_0x152e87(0x10e)]+'\x0a';});if(process[_0x197fd5(0x18a)]['CHATBOT_RESTRICT_NUMBER']?.[_0x197fd5(0x284)]>=0x8){if(_0x1b3c3f[_0x197fd5(0x2a4)][_0x197fd5(0x217)]!=process['env'][_0x197fd5(0x1e5)]){console[_0x197fd5(0x2b5)](_0x197fd5(0x29a));return;}}const _0x40397e={'text':(0x0,Mustache_1['default'])('‎'+_0x375f1f+'\x0a\x0a'+_0x18b15d,_0x1b3c3f)};await(0x0,UpdateTicketService_1[_0x197fd5(0x254)])({'ticketData':{'amountUsedBotQueues':_0x1b3c3f['amountUsedBotQueues']+0x1},'ticketId':_0x1b3c3f['id'],'companyId':_0x1b3c3f['companyId']});const _0x2ba056=await _0x21661d[_0x197fd5(0x106)](_0xfaf5c1[_0x197fd5(0x217)]+'@'+(_0x1b3c3f[_0x197fd5(0x1fe)]?_0x197fd5(0x119):_0x197fd5(0x1b2)),_0x40397e);await(0x0,exports[_0x197fd5(0x1f4)])(_0x2ba056,_0x1b3c3f,_0x1b3c3f['contact']);};if(_0x575a8e){let _0x27aea7=![];_0x575a8e?.['options']&&(_0x27aea7=_0x575a8e[_0x282cbb(0x122)][_0x282cbb(0x284)]>0x0);await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':_0x575a8e['id'],'chatbot':_0x27aea7,'status':'pending','amountUsedBotQueues':0x0},'ticketId':_0x1b3c3f['id'],'companyId':_0x1b3c3f[_0x282cbb(0x1e6)]}),console[_0x282cbb(0x2b5)](_0x575a8e[_0x282cbb(0x122)]);if(_0x575a8e['options']['length']===0x0){const _0x464150=await Queue_1[_0x282cbb(0x254)]['findByPk'](_0x575a8e['id']),{schedules:_0x3474d1}=_0x464150,_0xcbee97=(0x0,moment_1[_0x282cbb(0x254)])(),_0x375333=_0xcbee97[_0x282cbb(0x171)](_0x282cbb(0x286))['toLowerCase']();let _0x240cc1;Array[_0x282cbb(0x1ca)](_0x3474d1)&&_0x3474d1[_0x282cbb(0x284)]>0x0&&(_0x240cc1=_0x3474d1['find'](_0x330467=>_0x330467[_0x282cbb(0x273)]===_0x375333&&_0x330467[_0x282cbb(0x12a)]!==''&&_0x330467['startTime']!==null&&_0x330467[_0x282cbb(0x207)]!==''&&_0x330467[_0x282cbb(0x207)]!==null));if(_0x464150['outOfHoursMessage']!==null&&_0x464150['outOfHoursMessage']!==''&&!(0x0,lodash_1['isNil'])(_0x240cc1)){var _0x2dd98b=outOfHourMessageControl['find'](_0x509831=>_0x509831[_0x282cbb(0x2a6)]===_0x1b3c3f['id']||_0x509831[_0x282cbb(0x1bd)]===_0xfaf5c1[_0x282cbb(0x217)]);if(!_0x2dd98b||_0x2dd98b&&_0x2dd98b[_0x282cbb(0x1ee)]+0x3e8*0x3c*0x5<new Date()[_0x282cbb(0x205)]()){_0x2dd98b&&(outOfHourMessageControl=outOfHourMessageControl[_0x282cbb(0x11d)](_0x32473b=>_0x32473b[_0x282cbb(0x2a6)]!==_0x1b3c3f['id']),_0x2dd98b=null);const _0x4c568a=(0x0,moment_1[_0x282cbb(0x254)])(_0x240cc1[_0x282cbb(0x12a)],_0x282cbb(0x139)),_0x30fdb2=(0x0,moment_1[_0x282cbb(0x254)])(_0x240cc1[_0x282cbb(0x207)],_0x282cbb(0x139));outOfHourMessageControl[_0x282cbb(0x1a5)]({'ticketId':_0x1b3c3f['id'],'time':new Date()['getTime']()});if(_0xcbee97[_0x282cbb(0x240)](_0x4c568a)||_0xcbee97[_0x282cbb(0x113)](_0x30fdb2)){const _0x4bac62=(0x0,Mustache_1[_0x282cbb(0x254)])('‎\x20'+_0x464150[_0x282cbb(0x186)]+_0x282cbb(0x10a),_0x1b3c3f),_0x232114=await _0x21661d[_0x282cbb(0x106)](_0xfaf5c1['number']+'@'+(_0x1b3c3f[_0x282cbb(0x1fe)]?'g.us':_0x282cbb(0x1b2)),{'text':_0x4bac62});await(0x0,exports[_0x282cbb(0x1f4)])(_0x232114,_0x1b3c3f,_0xfaf5c1),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'queueId':null,'chatbot':_0x27aea7},'ticketId':_0x1b3c3f['id'],'companyId':_0x1b3c3f['companyId']}),console[_0x282cbb(0x182)](_0x282cbb(0x164));return;}}!_0x2dd98b&&outOfHourMessageControl[_0x282cbb(0x1a5)]({'ticketId':_0x1b3c3f['id'],'dest':_0xfaf5c1[_0x282cbb(0x217)],'time':new Date()[_0x282cbb(0x205)]()});}console['trace'](_0x575a8e['integrationId']);if(!_0x411fc9[_0x282cbb(0x256)][_0x282cbb(0x21e)]&&!_0x1b3c3f['isGroup']&&_0x575a8e[_0x282cbb(0x2c6)]){const _0x1625ba=await(0x0,ShowQueueIntegrationService_1[_0x282cbb(0x254)])(_0x575a8e[_0x282cbb(0x2c6)],_0x132c5b);await(0x0,exports['handleMessageIntegration'])(_0x411fc9,_0x21661d,_0x1625ba,_0x1b3c3f),await _0x1b3c3f[_0x282cbb(0x1ed)]({'useIntegration':!![],'integrationId':_0x1625ba['id']});}!_0x411fc9[_0x282cbb(0x256)]['fromMe']&&!_0x1b3c3f[_0x282cbb(0x1fe)]&&!(0x0,lodash_1[_0x282cbb(0x226)])(_0x575a8e?.[_0x282cbb(0x143)])&&(await handleOpenAi(_0x411fc9,_0x21661d,_0x1b3c3f,_0xfaf5c1,_0x1f7519),await _0x1b3c3f['update']({'useIntegration':!![],'promptId':_0x575a8e?.[_0x282cbb(0x143)]}));const _0x2c4604=(0x0,Mustache_1[_0x282cbb(0x254)])('‎'+_0x575a8e[_0x282cbb(0x20a)],_0x1b3c3f);if(_0x575a8e[_0x282cbb(0x20a)]){const _0x1e77c4=await _0x21661d[_0x282cbb(0x106)](_0xfaf5c1[_0x282cbb(0x217)]+'@'+(_0x1b3c3f[_0x282cbb(0x1fe)]?'g.us':_0x282cbb(0x1b2)),{'text':_0x2c4604});await(0x0,exports[_0x282cbb(0x1f4)])(_0x1e77c4,_0x1b3c3f,_0xfaf5c1);if(_0x575a8e[_0x282cbb(0x264)]!==null&&_0x575a8e[_0x282cbb(0x264)]!==''){const _0x4ccb6a=path_1[_0x282cbb(0x254)][_0x282cbb(0x17d)](_0x282cbb(0x1c6),_0x282cbb(0x121)+_0x575a8e[_0x282cbb(0x1e6)],_0x575a8e[_0x282cbb(0x264)]),_0x4f6551=await(0x0,SendWhatsAppMedia_1[_0x282cbb(0x23f)])(_0x575a8e['mediaName'],_0x4ccb6a,null,_0x1b3c3f[_0x282cbb(0x1e6)]);let _0x2ebda6=await _0x21661d[_0x282cbb(0x106)](_0x1b3c3f[_0x282cbb(0x2a4)][_0x282cbb(0x217)]+'@'+(_0x1b3c3f[_0x282cbb(0x1fe)]?_0x282cbb(0x119):_0x282cbb(0x1b2)),{..._0x4f6551});await verifyMediaMessage(_0x2ebda6,_0x1b3c3f,_0xfaf5c1);}}}}else{if(_0x2ce051&&_0x2ce051!==0x0&&_0x1b3c3f[_0x282cbb(0x1ce)]>=_0x2ce051)return;const _0x1cc31f=await(0x0,FindOrCreateATicketTrakingService_1[_0x282cbb(0x254)])({'ticketId':_0x1b3c3f['id'],'companyId':_0x132c5b});let _0x3c04a7=new Date(),_0x5942b0=new Date();if(_0x1cc31f['chatbotAt']!==null){_0x3c04a7[_0x282cbb(0x251)](_0x1cc31f[_0x282cbb(0x1a8)]['getMinutes']()+Number(_0x51578e));if(_0x1cc31f['chatbotAt']!==null&&_0x5942b0<_0x3c04a7&&_0x51578e!=='0'&&_0x1b3c3f[_0x282cbb(0x1ce)]!==0x0)return;}await _0x1cc31f[_0x282cbb(0x1ed)]({'updatedAt':new Date()});if(_0x6b3d41[_0x282cbb(0x1d8)]===_0x282cbb(0x29c))return console[_0x282cbb(0x2b5)]('botText'),_0x125059();}},verifyRating=_0x31606f=>{const _0x3f8e84=a558_0x2c2d44;return _0x31606f&&_0x31606f[_0x3f8e84(0x14c)]===null&&_0x31606f[_0x3f8e84(0x1a3)]!==null&&_0x31606f['ratingAt']!==null;};exports[a558_0x2c2d44(0x1b8)]=verifyRating;const handleRating=async(_0x138a95,_0x28cd1b,_0xdca98e)=>{const _0x2111e3=a558_0x2c2d44,_0x1f9256=(0x0,socket_1[_0x2111e3(0x157)])();let _0x300df6=null;(_0x138a95?.['message']?.[_0x2111e3(0x20c)]||_0x138a95?.['message']?.[_0x2111e3(0x224)])&&(_0x300df6=parseInt(_0x138a95['message']['conversation']||_0x138a95['message'][_0x2111e3(0x224)]['text'],0xa)||null);if(!Number[_0x2111e3(0x275)](_0x300df6)&&Number[_0x2111e3(0x274)](_0x300df6)&&!(0x0,lodash_1['isNull'])(_0x300df6)){const {complationMessage:_0x14063f}=await(0x0,ShowWhatsAppService_1[_0x2111e3(0x254)])(_0x28cd1b[_0x2111e3(0x1b4)],_0x28cd1b[_0x2111e3(0x1e6)]);let _0x5aee36=_0x300df6;_0x300df6<0x1&&(_0x5aee36=0x1);_0x300df6>0x5&&(_0x5aee36=0x5);await UserRating_1[_0x2111e3(0x254)][_0x2111e3(0x1da)]({'ticketId':_0xdca98e[_0x2111e3(0x2a6)],'companyId':_0xdca98e[_0x2111e3(0x1e6)],'userId':_0xdca98e[_0x2111e3(0x1a3)],'rate':_0x5aee36});if(_0x14063f){if(completionMessageControl['length']>=0x9c4)completionMessageControl=[];var _0x383a50=completionMessageControl[_0x2111e3(0x21f)](_0x3a2f37=>_0x3a2f37[_0x2111e3(0x2a6)]===_0x28cd1b['id']||_0x3a2f37[_0x2111e3(0x1bd)]===_0x28cd1b[_0x2111e3(0x2a4)]['number']);if(!_0x383a50||_0x383a50&&_0x383a50[_0x2111e3(0x1ee)]+0x3e8*0x3c*0x1e<new Date()['getTime']()){_0x383a50&&(completionMessageControl=completionMessageControl[_0x2111e3(0x11d)](_0x17f3ca=>_0x17f3ca[_0x2111e3(0x2a6)]!==_0x28cd1b['id']),_0x383a50=null);const _0x274757=(0x0,Mustache_1[_0x2111e3(0x254)])('‎'+_0x14063f,_0x28cd1b);await(0x0,SendPresenceStatus_1[_0x2111e3(0x248)])((0x0,wbot_1[_0x2111e3(0x23b)])(_0x28cd1b[_0x2111e3(0x1b4)]),_0x28cd1b[_0x2111e3(0x2a4)]['number']+'@'+(_0x28cd1b[_0x2111e3(0x1fe)]?'g.us':_0x2111e3(0x1b2))),await(0x0,SendWhatsAppMessage_1[_0x2111e3(0x254)])({'body':_0x274757,'ticket':_0x28cd1b});}!_0x383a50&&completionMessageControl[_0x2111e3(0x1a5)]({'ticketId':_0x28cd1b['id'],'dest':_0x28cd1b['contact']['number'],'time':new Date()[_0x2111e3(0x205)]()});}await _0xdca98e['update']({'finishedAt':(0x0,moment_1[_0x2111e3(0x254)])()['toDate'](),'ratedAt':(0x0,moment_1[_0x2111e3(0x254)])()[_0x2111e3(0x18f)](),'rated':!![]}),await _0x28cd1b['update']({'queueId':null,'chatbot':null,'queueOptionId':null,'userId':null,'status':'closed'}),_0x1f9256['to'](_0x2111e3(0x1ac)+_0x28cd1b['companyId']+_0x2111e3(0x28f))[_0x2111e3(0x1a1)](_0x2111e3(0x1ac)+_0x28cd1b[_0x2111e3(0x1e6)]+_0x2111e3(0x165),{'action':_0x2111e3(0x134),'ticket':_0x28cd1b,'ticketId':_0x28cd1b['id']}),_0x1f9256['to'](_0x2111e3(0x1ac)+_0x28cd1b[_0x2111e3(0x1e6)]+'-'+_0x28cd1b['status'])['to'](_0x28cd1b['id'][_0x2111e3(0x10d)]())[_0x2111e3(0x1a1)]('company-'+_0x28cd1b[_0x2111e3(0x1e6)]+_0x2111e3(0x165),{'action':_0x2111e3(0x1ed),'ticket':_0x28cd1b,'ticketId':_0x28cd1b['id']});}};exports['handleRating']=handleRating;const handleChartbot=async(_0x58af1a,_0x9745fa,_0x4fd8a6,_0x1d7356,_0x456e19=![])=>{const _0x39803e=a558_0x2c2d44;if(!_0x58af1a[_0x39803e(0x2a4)]['disableBot']){const _0x538a9e=await Queue_1['default']['findByPk'](_0x58af1a[_0x39803e(0x29f)],{'include':[{'model':QueueOption_1['default'],'as':'options','where':{'parentId':null},'order':[[_0x39803e(0x18e),'ASC'],['createdAt','ASC']]}]}),_0x3f27dc=_0x9745fa?.[_0x39803e(0x177)]?.['buttonsResponseMessage']?.[_0x39803e(0x242)]||_0x9745fa?.[_0x39803e(0x177)]?.['listResponseMessage']?.['singleSelectReply']?.[_0x39803e(0x277)]||_0x9745fa?.[_0x39803e(0x177)]?.[_0x39803e(0x224)]?.[_0x39803e(0x29c)]||_0x9745fa?.[_0x39803e(0x177)]?.['conversation'];if(_0x3f27dc=='#'&&(!_0x58af1a[_0x39803e(0x1a3)]||_0x58af1a['status']=='pending')){console[_0x39803e(0x2b5)]('##\x20if'),await _0x58af1a[_0x39803e(0x1ed)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x4fd8a6,_0x9745fa,_0x58af1a,_0x58af1a[_0x39803e(0x2a4)]);return;}if(!(0x0,lodash_1[_0x39803e(0x226)])(_0x538a9e)&&!(0x0,lodash_1['isNil'])(_0x58af1a[_0x39803e(0x191)])&&_0x3f27dc=='0'){console[_0x39803e(0x2b5)](_0x39803e(0x260));const _0x30e2ab=await QueueOption_1[_0x39803e(0x254)][_0x39803e(0x117)](_0x58af1a['queueOptionId']);await _0x58af1a[_0x39803e(0x1ed)]({'queueOptionId':_0x30e2ab?.['parentId'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x39803e(0x226)])(_0x538a9e)&&!(0x0,lodash_1[_0x39803e(0x226)])(_0x58af1a[_0x39803e(0x191)])){console[_0x39803e(0x2b5)](_0x39803e(0x1c3));const _0x125836=await QueueOption_1[_0x39803e(0x254)][_0x39803e(0x257)]({'where':{'parentId':_0x58af1a[_0x39803e(0x191)]}});let _0x5c977f={};_0x125836==0x1?_0x5c977f=await QueueOption_1[_0x39803e(0x254)][_0x39803e(0x27d)]({'where':{'parentId':_0x58af1a[_0x39803e(0x191)]}}):(console['trace'](_0x39803e(0x239)),_0x5c977f=await QueueOption_1[_0x39803e(0x254)][_0x39803e(0x27d)]({'where':{[sequelize_1['Op']['or']]:[{'option':_0x3f27dc||''},{'title':_0x3f27dc||''}],'parentId':_0x58af1a['queueOptionId']}})),_0x5c977f&&await _0x58af1a[_0x39803e(0x1ed)]({'queueOptionId':_0x5c977f?.['id'],'amountUsedBotQueues':0x0});}else{if(!(0x0,lodash_1[_0x39803e(0x226)])(_0x538a9e)&&(0x0,lodash_1['isNil'])(_0x58af1a['queueOptionId'])&&!_0x456e19){console[_0x39803e(0x2b5)](_0x39803e(0x294));const _0x3bea52=_0x538a9e?.[_0x39803e(0x122)][_0x39803e(0x21f)](_0x17287c=>_0x17287c['option']==_0x3f27dc||_0x17287c[_0x39803e(0x1fd)][_0x39803e(0x181)]()==_0x3f27dc[_0x39803e(0x181)]());if(_0x3bea52)await _0x58af1a['update']({'queueOptionId':_0x3bea52?.['id'],'amountUsedBotQueues':0x0});else{if(_0x1d7356[_0x39803e(0x1ef)]&&_0x1d7356[_0x39803e(0x1ef)]!==0x0&&_0x58af1a['amountUsedBotQueues']>=_0x1d7356['maxUseBotQueues'])return;await _0x58af1a['update']({'amountUsedBotQueues':_0x58af1a['amountUsedBotQueues']+0x1});}}else{if(_0x1d7356[_0x39803e(0x1ef)]&&_0x1d7356[_0x39803e(0x1ef)]!==0x0&&_0x58af1a[_0x39803e(0x1ce)]>=_0x1d7356['maxUseBotQueues'])return;await _0x58af1a[_0x39803e(0x1ed)]({'amountUsedBotQueues':_0x58af1a['amountUsedBotQueues']+0x1});}}}await _0x58af1a['reload']();if(!(0x0,lodash_1[_0x39803e(0x226)])(_0x538a9e)&&(0x0,lodash_1[_0x39803e(0x226)])(_0x58af1a[_0x39803e(0x191)])){const _0x22d81d=await QueueOption_1[_0x39803e(0x254)][_0x39803e(0x2c0)]({'where':{'queueId':_0x58af1a[_0x39803e(0x29f)],'parentId':null},'order':[['option',_0x39803e(0x201)],[_0x39803e(0x200),'ASC']]}),_0x663cdb=_0x58af1a['companyId'],_0x350559=await Setting_1[_0x39803e(0x254)][_0x39803e(0x27d)]({'where':{'key':_0x39803e(0x266),'companyId':_0x663cdb}}),_0x1531bd=async()=>{const _0x5a1e96=_0x39803e,_0x36ddf1=[];_0x22d81d[_0x5a1e96(0x24a)]((_0x323b25,_0x1d0697)=>{const _0xfe6cc8=_0x5a1e96;_0x36ddf1[_0xfe6cc8(0x1a5)]({'buttonId':''+_0x323b25[_0xfe6cc8(0x18e)],'buttonText':{'displayText':_0x323b25[_0xfe6cc8(0x1fd)]},'type':0x4});}),_0x36ddf1[_0x5a1e96(0x1a5)]({'buttonId':'#','buttonText':{'displayText':_0x5a1e96(0x211)},'type':0x4});const _0x4d3c43={'text':(0x0,Mustache_1[_0x5a1e96(0x254)])('‎'+_0x538a9e[_0x5a1e96(0x20a)],_0x58af1a),'buttons':_0x36ddf1,'footer':_0x5a1e96(0x14e),'headerType':0x1},_0x3bcab5=await _0x4fd8a6[_0x5a1e96(0x106)](_0x58af1a['contact']['number']+'@'+(_0x58af1a[_0x5a1e96(0x1fe)]?_0x5a1e96(0x119):'s.whatsapp.net'),_0x4d3c43);await(0x0,exports[_0x5a1e96(0x1f4)])(_0x3bcab5,_0x58af1a,_0x58af1a['contact']);},_0xa432a2=async()=>{const _0x47d32b=_0x39803e;let _0x304478='';console[_0x47d32b(0x2b5)](_0x47d32b(0x1c2)),console[_0x47d32b(0x182)](_0x538a9e[_0x47d32b(0x264)]),_0x22d81d[_0x47d32b(0x24a)]((_0x495a36,_0x141723)=>{const _0x45f2e4=_0x47d32b;_0x304478+=_0x45f2e4(0x176)+_0x495a36['option']+_0x45f2e4(0x299)+_0x495a36[_0x45f2e4(0x1fd)]+'\x0a';}),_0x304478+=_0x47d32b(0x1b7);const _0x424d0a={'text':(0x0,Mustache_1['default'])('‎'+_0x538a9e['greetingMessage']+'\x0a\x0a'+_0x304478,_0x58af1a)};let _0x5b86fb;if(!_0x538a9e[_0x47d32b(0x264)])_0x5b86fb=await _0x4fd8a6[_0x47d32b(0x106)](_0x58af1a[_0x47d32b(0x2a4)][_0x47d32b(0x217)]+'@'+(_0x58af1a[_0x47d32b(0x1fe)]?_0x47d32b(0x119):_0x47d32b(0x1b2)),_0x424d0a),await(0x0,exports[_0x47d32b(0x1f4)])(_0x5b86fb,_0x58af1a,_0x58af1a['contact']);else{const _0x100e09=path_1['default'][_0x47d32b(0x17d)](_0x47d32b(0x1c6),'company'+_0x58af1a[_0x47d32b(0x1e6)],_0x538a9e[_0x47d32b(0x264)]),_0x28bcdb=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x424d0a[_0x47d32b(0x29c)],_0x100e09,_0x424d0a[_0x47d32b(0x29c)],_0x58af1a[_0x47d32b(0x1e6)]);_0x5b86fb=await _0x4fd8a6[_0x47d32b(0x106)](_0x58af1a['contact'][_0x47d32b(0x217)]+'@'+(_0x58af1a[_0x47d32b(0x1fe)]?'g.us':_0x47d32b(0x1b2)),{..._0x28bcdb}),await verifyMediaMessage(_0x5b86fb,_0x58af1a,_0x58af1a[_0x47d32b(0x2a4)]);}};if(_0x350559['value']===_0x39803e(0x261)&&QueueOption_1[_0x39803e(0x254)]['length']<=0x4)return _0x1531bd();if(_0x350559[_0x39803e(0x1d8)]===_0x39803e(0x29c))return console[_0x39803e(0x2b5)](_0x39803e(0x1c2)),_0xa432a2();if(_0x350559[_0x39803e(0x1d8)]==='button'&&QueueOption_1[_0x39803e(0x254)]['length']>0x4)return console[_0x39803e(0x2b5)]('botText'),_0xa432a2();}else{if(!(0x0,lodash_1['isNil'])(_0x538a9e)&&!(0x0,lodash_1['isNil'])(_0x58af1a[_0x39803e(0x191)])){const _0x3768d9=await QueueOption_1['default'][_0x39803e(0x117)](_0x58af1a[_0x39803e(0x191)]),_0x58557d=await QueueOption_1['default'][_0x39803e(0x2c0)]({'where':{'parentId':_0x58af1a[_0x39803e(0x191)]},'order':[[_0x39803e(0x18e),_0x39803e(0x201)],[_0x39803e(0x200),_0x39803e(0x201)]]});if(_0x58557d[_0x39803e(0x284)]===0x0){const _0x1e14b9={'text':(0x0,Mustache_1[_0x39803e(0x254)])('‎'+_0x3768d9[_0x39803e(0x177)],_0x58af1a)},_0x305dd0=await _0x4fd8a6[_0x39803e(0x106)](_0x58af1a[_0x39803e(0x2a4)][_0x39803e(0x217)]+'@'+(_0x58af1a['isGroup']?_0x39803e(0x119):'s.whatsapp.net'),_0x1e14b9);await(0x0,exports[_0x39803e(0x1f4)])(_0x305dd0,_0x58af1a,_0x58af1a['contact']),await _0x58af1a[_0x39803e(0x1ed)]({'queueOptionId':null,'chatbot':![]});return;}if(_0x58557d['length']>-0x1){const _0x2f4460=_0x58af1a['companyId'],_0x2789c3=await Setting_1[_0x39803e(0x254)][_0x39803e(0x27d)]({'where':{'key':_0x39803e(0x266),'companyId':_0x2f4460}}),_0x35c947=async()=>{const _0x53652d=_0x39803e,_0x2f904f=[],_0x1a7cf0=_0x58af1a[_0x53652d(0x1e6)],_0x13aebd=await getQueues(_0x1a7cf0),_0x340a14=await getContactFromTicket(_0x58af1a['id']);_0x13aebd[_0x53652d(0x24a)]((_0x482271,_0x4c9176)=>{const _0x2974c7=_0x53652d;_0x2f904f[_0x2974c7(0x1a5)]({'title':'['+(_0x4c9176+0x1)+_0x2974c7(0x17b)+_0x482271[_0x2974c7(0x10e)],'rowId':''+(_0x4c9176+0x1)});});const _0x126fdc=[{'rows':_0x2f904f}],_0x1e5034={'text':(0x0,Mustache_1[_0x53652d(0x254)])('‎'+_0x3768d9['message'],_0x58af1a),'title':_0x53652d(0x26f),'buttonText':_0x53652d(0x1f9),'sections':_0x126fdc};await sleep(0x3e8);const _0x371442=await _0x4fd8a6['sendMessage'](_0x53652d(0x17c)+_0x340a14[_0x53652d(0x217)]+'@'+(_0x58af1a[_0x53652d(0x1fe)]?_0x53652d(0x119):_0x53652d(0x1b2)),_0x1e5034);await(0x0,exports[_0x53652d(0x1f4)])(_0x371442,_0x58af1a,_0x58af1a[_0x53652d(0x2a4)]);},_0x157044=async()=>{const _0x34af30=_0x39803e,_0x3394f5=[];_0x58557d['forEach']((_0x1c3b05,_0x440582)=>{const _0x4ec880=a558_0x4046;_0x3394f5[_0x4ec880(0x1a5)]({'buttonId':''+_0x1c3b05['option'],'buttonText':{'displayText':_0x1c3b05[_0x4ec880(0x1fd)]},'type':0x4});}),_0x3394f5['push']({'buttonId':'#','buttonText':{'displayText':_0x34af30(0x211)},'type':0x4});const _0x43e304={'text':(0x0,Mustache_1[_0x34af30(0x254)])('‎'+_0x3768d9[_0x34af30(0x177)],_0x58af1a),'buttons':_0x3394f5,'headerType':0x4};if(process[_0x34af30(0x18a)]['CHATBOT_RESTRICT_NUMBER']?.[_0x34af30(0x284)]>=0x8){if(_0x58af1a['contact'][_0x34af30(0x217)]!=process[_0x34af30(0x18a)][_0x34af30(0x1e5)]){console[_0x34af30(0x2b5)](_0x34af30(0x29a));return;}}if(!_0x3768d9['mediaPath']){const _0x1723d7=await _0x4fd8a6[_0x34af30(0x106)](_0x58af1a[_0x34af30(0x2a4)]['number']+'@'+(_0x58af1a[_0x34af30(0x1fe)]?'g.us':'s.whatsapp.net'),_0x43e304);await(0x0,exports[_0x34af30(0x1f4)])(_0x1723d7,_0x58af1a,_0x58af1a[_0x34af30(0x2a4)]);}else{const _0x4bd436=path_1[_0x34af30(0x254)][_0x34af30(0x17d)](_0x34af30(0x1c6),_0x34af30(0x121)+_0x58af1a['companyId'],_0x3768d9[_0x34af30(0x264)]),_0x3d8874=await(0x0,SendWhatsAppMedia_1[_0x34af30(0x23f)])(_0x3768d9['mediaName'],_0x4bd436,_0x43e304[_0x34af30(0x29c)],_0x58af1a[_0x34af30(0x1e6)]);let _0x5355d0=await _0x4fd8a6[_0x34af30(0x106)](_0x58af1a[_0x34af30(0x2a4)]['number']+'@'+(_0x58af1a[_0x34af30(0x1fe)]?'g.us':_0x34af30(0x1b2)),{..._0x3d8874});await verifyMediaMessage(_0x5355d0,_0x58af1a,_0x58af1a[_0x34af30(0x2a4)]);}const _0x44332d=await _0x4fd8a6[_0x34af30(0x106)](_0x58af1a[_0x34af30(0x2a4)]['number']+'@'+(_0x58af1a['isGroup']?_0x34af30(0x119):_0x34af30(0x1b2)),_0x43e304);await(0x0,exports['verifyMessage'])(_0x44332d,_0x58af1a,_0x58af1a[_0x34af30(0x2a4)]);},_0x4033b6=async()=>{const _0x27fa80=_0x39803e;let _0x538373='';_0x58557d['forEach']((_0x55bbd1,_0x91f60e)=>{const _0x3a0435=a558_0x4046;_0x538373+=_0x3a0435(0x176)+_0x55bbd1[_0x3a0435(0x18e)]+_0x3a0435(0x299)+_0x55bbd1[_0x3a0435(0x1fd)]+'\x0a';}),_0x538373+=_0x27fa80(0x12d),_0x538373+=_0x27fa80(0x1b7);const _0x4e648e={'text':(0x0,Mustache_1['default'])('‎'+_0x3768d9['message']+'\x0a\x0a'+_0x538373,_0x58af1a)};if(process[_0x27fa80(0x18a)][_0x27fa80(0x1e5)]?.[_0x27fa80(0x284)]>=0x8){if(_0x58af1a[_0x27fa80(0x2a4)][_0x27fa80(0x217)]!=process[_0x27fa80(0x18a)][_0x27fa80(0x1e5)]){console[_0x27fa80(0x2b5)](_0x27fa80(0x29a));return;}}if(!_0x3768d9[_0x27fa80(0x264)]){const _0x384157=await _0x4fd8a6['sendMessage'](_0x58af1a[_0x27fa80(0x2a4)]['number']+'@'+(_0x58af1a[_0x27fa80(0x1fe)]?'g.us':_0x27fa80(0x1b2)),_0x4e648e);await(0x0,exports[_0x27fa80(0x1f4)])(_0x384157,_0x58af1a,_0x58af1a[_0x27fa80(0x2a4)]);}else{const _0x2de55c=path_1[_0x27fa80(0x254)]['resolve'](_0x27fa80(0x1c6),'company'+_0x58af1a[_0x27fa80(0x1e6)],_0x3768d9[_0x27fa80(0x264)]),_0x1fb08a=await(0x0,SendWhatsAppMedia_1[_0x27fa80(0x23f)])(_0x3768d9[_0x27fa80(0x1b6)],_0x2de55c,_0x4e648e[_0x27fa80(0x29c)],_0x58af1a[_0x27fa80(0x1e6)]);let _0x53b994=await _0x4fd8a6[_0x27fa80(0x106)](_0x58af1a[_0x27fa80(0x2a4)][_0x27fa80(0x217)]+'@'+(_0x58af1a['isGroup']?_0x27fa80(0x119):_0x27fa80(0x1b2)),{..._0x1fb08a});await verifyMediaMessage(_0x53b994,_0x58af1a,_0x58af1a['contact']);}};if(_0x2789c3[_0x39803e(0x1d8)]==='list')return _0x35c947();if(_0x2789c3[_0x39803e(0x1d8)]===_0x39803e(0x261)&&QueueOption_1[_0x39803e(0x254)][_0x39803e(0x284)]<=0x4)return _0x157044();if(_0x2789c3[_0x39803e(0x1d8)]===_0x39803e(0x29c))return console['trace'](_0x39803e(0x247)),_0x4033b6();if(_0x2789c3[_0x39803e(0x1d8)]===_0x39803e(0x261)&&QueueOption_1[_0x39803e(0x254)][_0x39803e(0x284)]>0x4)return console[_0x39803e(0x2b5)](_0x39803e(0x208)),_0x4033b6();}}}}},handleMessageIntegration=async(_0x395c88,_0x12e6fd,_0x4594bc,_0x2c2828)=>{const _0x2027e1=a558_0x2c2d44;if(process[_0x2027e1(0x18a)][_0x2027e1(0x1e5)]){if(_0x2c2828['contact'][_0x2027e1(0x217)]!=process[_0x2027e1(0x18a)][_0x2027e1(0x1e5)]){console['log'](_0x2027e1(0x29a));return;}}const _0x3d855a=getTypeMessage(_0x395c88);if(_0x4594bc[_0x2027e1(0x22f)]===_0x2027e1(0x2bf)||_0x4594bc[_0x2027e1(0x22f)]===_0x2027e1(0x17e)){if(_0x4594bc?.[_0x2027e1(0x249)]){const _0x3bb9b5={'method':'POST','url':_0x4594bc?.[_0x2027e1(0x249)],'headers':{'Content-Type':'application/json'},'json':_0x395c88};try{(0x0,request_1[_0x2027e1(0x254)])(_0x3bb9b5,function(_0x442448,_0x523e4d){const _0xb08b48=_0x2027e1;if(_0x442448)throw new Error(_0x442448);else console[_0xb08b48(0x182)](_0x523e4d[_0xb08b48(0x223)]);});}catch(_0x45ee73){throw new Error(_0x45ee73);}}}else _0x4594bc[_0x2027e1(0x22f)]==='typebot'&&await(0x0,typebotListener_1[_0x2027e1(0x254)])({'ticket':_0x2c2828,'msg':_0x395c88,'wbot':_0x12e6fd,'typebot':_0x4594bc});};exports['handleMessageIntegration']=handleMessageIntegration;function a558_0x4046(_0x166116,_0x455211){const _0x362609=a558_0x3d25();return a558_0x4046=function(_0x26cc50,_0x3d3c7f){_0x26cc50=_0x26cc50-0x102;let _0x3d25f3=_0x362609[_0x26cc50];return _0x3d25f3;},a558_0x4046(_0x166116,_0x455211);}const messageContainsMedia=_0x26a411=>{const _0x51e955=a558_0x2c2d44;return _0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x11b)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x28b)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x127)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x2ab)]||_0x26a411['message']?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x214)]?.[_0x51e955(0x177)]?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x2b8)]?.[_0x51e955(0x177)]?.[_0x51e955(0x28b)]||_0x26a411[_0x51e955(0x177)]?.['ephemeralMessage']?.[_0x51e955(0x177)]?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.['ephemeralMessage']?.[_0x51e955(0x177)]?.['videoMessage']||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x2b8)]?.[_0x51e955(0x177)]?.[_0x51e955(0x2ab)]||_0x26a411[_0x51e955(0x177)]?.['ephemeralMessage']?.[_0x51e955(0x177)]?.[_0x51e955(0x11b)]||_0x26a411['message']?.[_0x51e955(0x1a6)]?.[_0x51e955(0x177)]?.[_0x51e955(0x11b)]||_0x26a411['message']?.['viewOnceMessage']?.[_0x51e955(0x177)]?.[_0x51e955(0x127)]||_0x26a411['message']?.[_0x51e955(0x2b8)]?.[_0x51e955(0x177)]?.[_0x51e955(0x1a6)]?.['message']?.[_0x51e955(0x11b)]||_0x26a411['message']?.['ephemeralMessage']?.[_0x51e955(0x177)]?.[_0x51e955(0x1a6)]?.[_0x51e955(0x177)]?.[_0x51e955(0x127)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x2b8)]?.[_0x51e955(0x177)]?.['viewOnceMessage']?.[_0x51e955(0x177)]?.[_0x51e955(0x28b)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x2b8)]?.['message']?.[_0x51e955(0x1a6)]?.['message']?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x214)]?.[_0x51e955(0x177)]?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.['templateMessage']?.[_0x51e955(0x22b)]?.['imageMessage']||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x148)]?.[_0x51e955(0x22b)]?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.['templateMessage']?.[_0x51e955(0x22b)]?.[_0x51e955(0x127)]||_0x26a411[_0x51e955(0x177)]?.['templateMessage']?.[_0x51e955(0x1b0)]?.[_0x51e955(0x11b)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x148)]?.['hydratedFourRowTemplate']?.['documentMessage']||_0x26a411[_0x51e955(0x177)]?.['templateMessage']?.[_0x51e955(0x1b0)]?.[_0x51e955(0x127)]||_0x26a411['message']?.['templateMessage']?.[_0x51e955(0x161)]?.[_0x51e955(0x11b)]||_0x26a411['message']?.[_0x51e955(0x148)]?.[_0x51e955(0x161)]?.[_0x51e955(0x203)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x148)]?.[_0x51e955(0x161)]?.[_0x51e955(0x127)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x1b1)]?.[_0x51e955(0x1c1)]?.[_0x51e955(0x11b)]||_0x26a411['message']?.['interactiveMessage']?.[_0x51e955(0x1c1)]?.['documentMessage']||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x1b1)]?.[_0x51e955(0x1c1)]?.['videoMessage']||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x1d2)]?.[_0x51e955(0x105)]?.['hydratedTemplate']?.['documentMessage']||_0x26a411[_0x51e955(0x177)]?.['highlyStructuredMessage']?.[_0x51e955(0x105)]?.['hydratedTemplate']?.[_0x51e955(0x127)]||_0x26a411[_0x51e955(0x177)]?.[_0x51e955(0x1d2)]?.[_0x51e955(0x105)]?.[_0x51e955(0x22b)]?.['imageMessage']||_0x26a411[_0x51e955(0x177)]?.['highlyStructuredMessage']?.[_0x51e955(0x105)]?.['hydratedTemplate']?.[_0x51e955(0x28a)];},handleMessage=async(_0x305e53,_0x317a9c,_0x51bc2d,_0xc5e98f=![])=>{const _0x205777=a558_0x2c2d44;if(_0xc5e98f){console['log'](_0x205777(0x292));let _0x5adb53=_0x305e53[_0x205777(0x256)]['id'],_0x328f1b=await Message_1[_0x205777(0x254)][_0x205777(0x257)]({'where':{'id':_0x5adb53}});if(_0x328f1b>0x0){await new Promise(_0x574586=>setTimeout(_0x574586,0x96));return;}else await new Promise(_0x50230c=>setTimeout(_0x50230c,0x14a));}let _0x28c29b;if(!(0x0,exports[_0x205777(0x1cb)])(_0x305e53)){console[_0x205777(0x182)](_0x205777(0x156)),console['log'](_0x305e53);return;}_0x305e53['message']?.[_0x205777(0x2b8)]&&(_0x305e53['message']=_0x305e53[_0x205777(0x177)][_0x205777(0x2b8)][_0x205777(0x177)]);try{let _0x170369;const _0x1f46eb=_0x305e53[_0x205777(0x256)][_0x205777(0x1ae)]?.['endsWith'](_0x205777(0x1fc)),_0x11bb52=await Setting_1[_0x205777(0x254)][_0x205777(0x27d)]({'where':{'companyId':_0x51bc2d,'key':_0x205777(0x288)}});if(_0x11bb52?.['value']==='enabled'&&_0x1f46eb){console[_0x205777(0x182)](_0x205777(0x253));return;}let _0x4f2420=(0x0,exports[_0x205777(0x2b9)])(_0x305e53);const _0x591b0e=getTypeMessage(_0x305e53);typeof _0x4f2420===_0x205777(0x27f)&&(_0x4f2420=_0x4f2420['replace'](/\u200c/,''));const _0x38116d=messageContainsMedia(_0x305e53);if(_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]){if(!_0x38116d&&_0x591b0e!==_0x205777(0x20c)&&_0x591b0e!==_0x205777(0x224)&&_0x591b0e!==_0x205777(0x19a)&&_0x591b0e!==_0x205777(0x2b0)&&_0x591b0e!==_0x205777(0x2b8)&&_0x591b0e!==_0x205777(0x128)&&_0x591b0e!=='reactionMessage'&&_0x591b0e!==_0x205777(0x1a6)&&_0x591b0e!==_0x205777(0x28a)&&_0x591b0e!==_0x205777(0x132)&&_0x591b0e!==_0x205777(0x1ab)){console[_0x205777(0x2b5)](_0x591b0e);return;}}const _0x595d77=await(0x0,ShowWhatsAppService_1['default'])(_0x317a9c['id'],_0x51bc2d);let _0x224169,_0x56daf9=await getContactMessage(_0x305e53,_0x317a9c);_0x170369=await verifyContact(_0x56daf9,_0x317a9c,_0x51bc2d);if(_0x1f46eb){if(!_0x595d77['allowGroup'])return;try{const _0x5f3f73=await _0x317a9c['groupMetadata'](_0x305e53[_0x205777(0x256)][_0x205777(0x1ae)]),_0x5b0bee={'id':_0x5f3f73['id'],'name':_0x5f3f73[_0x205777(0x22a)]};_0x224169=await verifyContact(_0x5b0bee,_0x317a9c,_0x51bc2d);}catch(_0x34a1db){console[_0x205777(0x182)]('Erro\x20ao\x20buscar\x20grupo!'),console[_0x205777(0x182)](_0x34a1db);return;}}let _0x5e12fb=0x0;if(_0x305e53[_0x205777(0x256)]['fromMe'])await cache_1[_0x205777(0x188)][_0x205777(0x1dc)](_0x205777(0x1df)+_0x170369['id']+_0x205777(0x289),'0');else{const _0x227d80=await cache_1[_0x205777(0x188)]['get']('contacts:'+_0x170369['id']+':unreads');_0x5e12fb=+_0x227d80+0x1,await cache_1[_0x205777(0x188)][_0x205777(0x1dc)]('contacts:'+_0x170369['id']+':unreads',''+_0x5e12fb);}const _0x65300c=await(0x0,FindOrCreateTicketService_1['default'])(_0x170369,_0x317a9c['id'],_0x5e12fb,_0x51bc2d,_0x224169,_0xc5e98f),_0x295aa2=await(0x0,FindOrCreateATicketTrakingService_1[_0x205777(0x254)])({'ticketId':_0x65300c['id'],'companyId':_0x51bc2d,'whatsappId':_0x595d77?.['id']});_0x295aa2[_0x205777(0x152)]('updatedAt',!![]),await _0x295aa2[_0x205777(0x1ed)]({'updatedAt':new Date()}),await(0x0,providers_1['provider'])(_0x65300c,_0x305e53,_0x51bc2d,_0x170369,_0x317a9c);if(_0x595d77[_0x205777(0x2a3)]&&_0x5e12fb===0x0){const _0xfe7ce5=await Message_1['default'][_0x205777(0x27d)]({'where':{'contactId':_0x170369['id'],'companyId':_0x51bc2d},'order':[[_0x205777(0x200),_0x205777(0x195)]]});if((0x0,Mustache_1['default'])(_0x595d77[_0x205777(0x2a3)],_0x65300c)[_0x205777(0x12e)]()[_0x205777(0x181)]()===_0xfe7ce5?.['body'][_0x205777(0x12e)]()['toLowerCase']())return;}if(_0x4f2420=='#'&&!_0xc5e98f&&(!_0x65300c['userId']||_0x65300c[_0x205777(0x137)]==_0x205777(0x19b))){await _0x65300c[_0x205777(0x1ed)]({'queueOptionId':null,'chatbot':![],'queueId':null,'amountUsedBotQueues':0x0}),await verifyQueue(_0x317a9c,_0x305e53,_0x65300c,_0x65300c['contact']);return;}try{if(!_0x305e53['key'][_0x205777(0x21e)]&&!_0xc5e98f){if(_0x4f2420!=null&&typeof _0x4f2420!==_0x205777(0x27f)){console[_0x205777(0x182)](_0x4f2420),console['trace'](_0x205777(0x268),typeof _0x4f2420);return;}if(_0x4f2420?.[_0x205777(0x1f8)]()===_0x205777(0x120)&&_0x65300c[_0x205777(0x137)]!='closed'){await(0x0,SendPresenceStatus_1[_0x205777(0x248)])(_0x317a9c,_0x65300c['contact']['number']+'@'+(_0x65300c[_0x205777(0x1fe)]?'g.us':_0x205777(0x1b2)));const _0x573bc5=await _0x317a9c[_0x205777(0x106)](_0x65300c[_0x205777(0x2a4)]['number']+'@'+(_0x65300c[_0x205777(0x1fe)]?'g.us':'s.whatsapp.net'),{'text':_0x205777(0x279)});await(0x0,exports['verifyMessage'])(_0x573bc5,_0x65300c,_0x65300c[_0x205777(0x2a4)]),await(0x0,UpdateTicketService_1[_0x205777(0x254)])({'ticketData':{'queueId':null,'status':_0x205777(0x22e)},'ticketId':_0x65300c['id'],'companyId':_0x65300c[_0x205777(0x1e6)]}),await _0x65300c[_0x205777(0x151)]();return;}}}catch(_0xf3d418){console[_0x205777(0x182)](_0x205777(0x221)),console['log'](_0xf3d418),Sentry[_0x205777(0x175)](_0xf3d418);}try{await _0x65300c[_0x205777(0x1ed)]({'fromMe':_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]});}catch(_0x555cfd){console[_0x205777(0x182)](_0x205777(0x170)),console[_0x205777(0x182)](_0x555cfd),Sentry[_0x205777(0x175)](_0x555cfd);}try{if(!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]){if((0x0,exports[_0x205777(0x1b8)])(_0x295aa2)){await(0x0,exports[_0x205777(0x234)])(_0x305e53,_0x65300c,_0x295aa2),console['log'](_0x205777(0x129)+_0x305e53);return;}}}catch(_0x5f5379){console[_0x205777(0x182)](_0x205777(0x25a)),Sentry['captureException'](_0x5f5379),console[_0x205777(0x182)](_0x5f5379);}_0x38116d?_0x28c29b=await verifyMediaMessage(_0x305e53,_0x65300c,_0x170369):await(0x0,exports['verifyMessage'])(_0x305e53,_0x65300c,_0x170369);const _0x5294c3=await(0x0,VerifyCurrentSchedule_1[_0x205777(0x254)])(_0x51bc2d),_0xf504e1=await Setting_1[_0x205777(0x254)][_0x205777(0x27d)]({'where':{'companyId':_0x51bc2d,'key':_0x205777(0x172)}});if(!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]&&_0xf504e1&&!_0xc5e98f)await handleOutOfHour(_0x317a9c,_0x65300c,_0xf504e1,_0x170369,_0x5294c3,_0x595d77);!_0x65300c[_0x205777(0x243)]&&!_0x1f46eb&&!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]&&!_0x65300c[_0x205777(0x1a3)]&&!(0x0,lodash_1[_0x205777(0x226)])(_0x595d77['promptId'])&&!_0xc5e98f&&await handleOpenAi(_0x305e53,_0x317a9c,_0x65300c,_0x170369,_0x28c29b);if(!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]&&!_0x65300c[_0x205777(0x1fe)]&&!_0x65300c[_0x205777(0x243)]&&!_0x65300c[_0x205777(0x14d)]&&_0x65300c[_0x205777(0x1d9)]&&!(0x0,lodash_1['isNil'])(_0x595d77[_0x205777(0x2c6)])&&!_0x65300c['useIntegration']&&!_0xc5e98f){const _0x1b020f=await(0x0,ShowQueueIntegrationService_1[_0x205777(0x254)])(_0x595d77['integrationId'],_0x51bc2d);await(0x0,exports[_0x205777(0x19f)])(_0x305e53,_0x317a9c,_0x1b020f,_0x65300c);return;}!_0x1f46eb&&!_0x305e53['key']['fromMe']&&!_0x65300c[_0x205777(0x1a3)]&&!(0x0,lodash_1[_0x205777(0x226)])(_0x65300c[_0x205777(0x143)])&&_0x65300c[_0x205777(0x1ec)]&&!_0xc5e98f&&await handleOpenAi(_0x305e53,_0x317a9c,_0x65300c,_0x170369,_0x28c29b);if(!_0x305e53['key'][_0x205777(0x21e)]&&!_0x65300c['isGroup']&&!_0x65300c[_0x205777(0x1a3)]&&_0x65300c[_0x205777(0x2c6)]&&_0x65300c['useIntegration']&&!_0xc5e98f){const _0x1d71ce=await(0x0,ShowQueueIntegrationService_1[_0x205777(0x254)])(_0x65300c[_0x205777(0x2c6)],_0x51bc2d);await(0x0,exports['handleMessageIntegration'])(_0x305e53,_0x317a9c,_0x1d71ce,_0x65300c);}!_0x65300c[_0x205777(0x243)]&&!_0x65300c[_0x205777(0x1fe)]&&!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]&&!_0x65300c['userId']&&_0x595d77[_0x205777(0x24d)][_0x205777(0x284)]>=0x1&&!_0x65300c[_0x205777(0x1ec)]&&!_0xc5e98f&&(await verifyQueue(_0x317a9c,_0x305e53,_0x65300c,_0x170369),_0x295aa2[_0x205777(0x152)](_0x205777(0x1a8),!![]),_0x295aa2[_0x205777(0x152)](_0x205777(0x1be),!![]),await _0x295aa2[_0x205777(0x1ed)]({'chatbotAt':(0x0,moment_1[_0x205777(0x254)])()[_0x205777(0x18f)](),'updatedAt':new Date()}));const _0x173dbe=_0x65300c['queue']===null;await _0x65300c[_0x205777(0x151)]();if(!_0xc5e98f&&_0x595d77['greetingMessage'])await greetingMessage(_0x317a9c,_0x65300c,_0x305e53,_0x595d77,_0x1f46eb);_0x595d77[_0x205777(0x24d)][_0x205777(0x284)]==0x1&&_0x65300c['queue']&&!_0xc5e98f&&(_0x65300c[_0x205777(0x1d9)]&&!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]&&!_0x65300c[_0x205777(0x1a3)]&&await handleChartbot(_0x65300c,_0x305e53,_0x317a9c,_0x595d77)),_0x595d77[_0x205777(0x24d)][_0x205777(0x284)]>0x1&&_0x65300c[_0x205777(0x243)]&&!_0xc5e98f&&(_0x65300c[_0x205777(0x1d9)]&&!_0x305e53[_0x205777(0x256)][_0x205777(0x21e)]&&!_0x65300c[_0x205777(0x1a3)]&&await handleChartbot(_0x65300c,_0x305e53,_0x317a9c,_0x595d77,_0x173dbe));}catch(_0x2c765e){console['log'](_0x2c765e),Sentry[_0x205777(0x175)](_0x2c765e),logger_1['logger'][_0x205777(0x18b)](_0x205777(0x19c)+_0x2c765e);}};exports[a558_0x2c2d44(0x142)]=handleMessage;const handleOutOfHour=async(_0x4419f9,_0x4b158b,_0x1ffff0,_0x40ee6f,_0x5b904e,_0x2ec7a7)=>{const _0x5e7422=a558_0x2c2d44;try{if(outOfHourMessageControl[_0x5e7422(0x284)]>0x1388)outOfHourMessageControl=[];let _0x58d2c6=outOfHourMessageControl[_0x5e7422(0x21f)](_0x215628=>_0x215628['ticketId']===_0x4b158b['id']||_0x215628['dest']===_0x40ee6f['number']);if(_0x1ffff0['value']===_0x5e7422(0x121)&&!(0x0,lodash_1[_0x5e7422(0x226)])(_0x5b904e)&&_0x2ec7a7[_0x5e7422(0x186)]&&(!_0x5b904e||_0x5b904e[_0x5e7422(0x12b)]===![])){if(!_0x58d2c6||_0x58d2c6&&_0x58d2c6[_0x5e7422(0x1ee)]+0x3e8*0x3c*0x5<new Date()[_0x5e7422(0x205)]()){_0x58d2c6&&(outOfHourMessageControl=outOfHourMessageControl[_0x5e7422(0x11d)](_0xf25fbd=>_0xf25fbd[_0x5e7422(0x2a6)]!==_0x4b158b['id']),_0x58d2c6=null);if(!_0x58d2c6)outOfHourMessageControl['push']({'ticketId':_0x4b158b['id'],'dest':_0x40ee6f[_0x5e7422(0x217)],'time':new Date()[_0x5e7422(0x205)]()});const _0x2ae4c0='‎\x20'+_0x2ec7a7[_0x5e7422(0x186)],_0x588431=(0x0,Debounce_1['debounce'])(async()=>{const _0x53483b=_0x5e7422;await _0x4419f9[_0x53483b(0x106)](_0x4b158b[_0x53483b(0x2a4)][_0x53483b(0x217)]+'@'+(_0x4b158b[_0x53483b(0x1fe)]?_0x53483b(0x119):'s.whatsapp.net'),{'text':_0x2ae4c0});},(0x0,queues_1[_0x5e7422(0x108)])(0x5dc,0xdac),_0x4b158b['id']);_0x588431();return;}}if(_0x1ffff0[_0x5e7422(0x1d8)]===_0x5e7422(0x243)&&_0x4b158b['queueId']!==null){const _0x3a3756=await Queue_1[_0x5e7422(0x254)]['findByPk'](_0x4b158b['queueId']),{schedules:_0x4c431a}=_0x3a3756,_0x2b30ed=(0x0,moment_1[_0x5e7422(0x254)])(),_0x1fd446=_0x2b30ed[_0x5e7422(0x171)](_0x5e7422(0x286))[_0x5e7422(0x181)]();let _0x52862a=null;Array[_0x5e7422(0x1ca)](_0x4c431a)&&_0x4c431a['length']>0x0&&(_0x52862a=_0x4c431a['find'](_0x340175=>_0x340175[_0x5e7422(0x273)]===_0x1fd446&&_0x340175[_0x5e7422(0x12a)]!==''&&_0x340175[_0x5e7422(0x12a)]!==null&&_0x340175[_0x5e7422(0x207)]!==''&&_0x340175[_0x5e7422(0x207)]!==null));if(_0x1ffff0[_0x5e7422(0x1d8)]===_0x5e7422(0x243)&&_0x3a3756[_0x5e7422(0x186)]!==null&&_0x3a3756[_0x5e7422(0x186)]!==''&&!(0x0,lodash_1[_0x5e7422(0x226)])(_0x52862a)){const _0xb8ec75=(0x0,moment_1[_0x5e7422(0x254)])(_0x52862a[_0x5e7422(0x12a)],_0x5e7422(0x139)),_0x411aed=(0x0,moment_1[_0x5e7422(0x254)])(_0x52862a['endTime'],_0x5e7422(0x139));let _0x1fe647=_0x2b30ed[_0x5e7422(0x240)](_0xb8ec75)||_0x2b30ed[_0x5e7422(0x113)](_0x411aed);if(!_0x1fe647){if(_0x52862a['startLunchTime']&&_0x52862a[_0x5e7422(0x280)]){const _0x461b96=(0x0,moment_1[_0x5e7422(0x254)])(_0x52862a[_0x5e7422(0x222)],'HH:mm'),_0x541689=(0x0,moment_1[_0x5e7422(0x254)])(_0x52862a[_0x5e7422(0x280)],_0x5e7422(0x139));_0x1fe647=_0x2b30ed[_0x5e7422(0x16c)](_0x461b96,_0x541689);}}if(_0x1fe647){if(!_0x58d2c6||_0x58d2c6&&_0x58d2c6['time']+0x3e8*0x3c*0x1e<new Date()['getTime']()){const _0x1d6f4f=_0x3a3756['outOfHoursMessage'],_0x1bc004=(0x0,Debounce_1[_0x5e7422(0x2b4)])(async()=>{const _0x28b007=_0x5e7422;await _0x4419f9[_0x28b007(0x106)](_0x4b158b['contact'][_0x28b007(0x217)]+'@'+(_0x4b158b['isGroup']?_0x28b007(0x119):_0x28b007(0x1b2)),{'text':_0x1d6f4f});},(0x0,queues_1[_0x5e7422(0x108)])(0x3e8,0xbb8),_0x4b158b['id']);_0x1bc004();return;}if(!_0x58d2c6)outOfHourMessageControl[_0x5e7422(0x1a5)]({'ticketId':_0x4b158b['id'],'dest':_0x40ee6f['number'],'time':new Date()[_0x5e7422(0x205)]()});}}}}catch(_0x38b00e){Sentry[_0x5e7422(0x175)](_0x38b00e),console[_0x5e7422(0x182)](_0x38b00e);}},greetingMessage=async(_0x5764e7,_0x358622,_0x151a06,_0x54a076,_0x2eac1d)=>{const _0x53b1a7=a558_0x2c2d44;if(!_0x54a076?.['queues']?.[_0x53b1a7(0x284)]&&!_0x358622[_0x53b1a7(0x1a3)]&&!_0x2eac1d&&!_0x151a06[_0x53b1a7(0x256)][_0x53b1a7(0x21e)]){if(process[_0x53b1a7(0x18a)][_0x53b1a7(0x1e5)]?.[_0x53b1a7(0x284)]>=0x8){if(_0x358622[_0x53b1a7(0x2a4)]['number']!=process[_0x53b1a7(0x18a)][_0x53b1a7(0x1e5)])return;}if(greetingMessageControl[_0x53b1a7(0x284)]>0x1388)greetingMessageControl=[];var _0x4085ce=greetingMessageControl['find'](_0x1d6605=>_0x1d6605[_0x53b1a7(0x2a6)]===_0x358622['id']||_0x1d6605[_0x53b1a7(0x1bd)]===_0x358622[_0x53b1a7(0x2a4)][_0x53b1a7(0x217)]);if(_0x4085ce&&_0x4085ce[_0x53b1a7(0x1ee)]+0x3e8*0x3c*0x5>=new Date()['getTime']())return;const _0x1792fe=await Message_1[_0x53b1a7(0x254)]['findOne']({'where':{'ticketId':_0x358622['id'],'fromMe':!![],'createdAt':{[sequelize_1['Op'][_0x53b1a7(0x154)]]:(0x0,moment_1[_0x53b1a7(0x254)])()[_0x53b1a7(0x27b)](0x5,_0x53b1a7(0x21d))['toDate']()}}});if(_0x1792fe)return;const _0x53dedd=(0x0,Debounce_1['debounce'])(async()=>{const _0x4af644=_0x53b1a7;if(!_0x54a076[_0x4af644(0x1e7)])await _0x5764e7[_0x4af644(0x106)](_0x358622[_0x4af644(0x2a4)][_0x4af644(0x217)]+'@'+(_0x358622[_0x4af644(0x1fe)]?_0x4af644(0x119):_0x4af644(0x1b2)),{'text':(0x0,Mustache_1[_0x4af644(0x254)])(_0x54a076[_0x4af644(0x20a)],_0x358622)});else{const _0x5464b2=path_1[_0x4af644(0x254)][_0x4af644(0x17d)](_0x4af644(0x1c6),_0x4af644(0x121)+_0x358622[_0x4af644(0x1e6)],_0x54a076[_0x4af644(0x1e7)]),_0x336c10=await(0x0,SendWhatsAppMedia_1['getMessageOptions'])(_0x54a076['greetingMediaAttachment'],_0x5464b2,_0x54a076['greetingMessage'],_0x358622[_0x4af644(0x1e6)]);await _0x5764e7[_0x4af644(0x106)](_0x358622[_0x4af644(0x2a4)][_0x4af644(0x217)]+'@'+(_0x358622['isGroup']?'g.us':_0x4af644(0x1b2)),{..._0x336c10});}},0x3e8,_0x358622['id']);_0x53dedd();return;}},handleMsgAck=async(_0x22d4d2,_0x390f59)=>{const _0x2b50e3=a558_0x2c2d44,_0x41c943=(0x0,socket_1['getIO'])();try{const _0xb69cf4=await Message_1[_0x2b50e3(0x254)][_0x2b50e3(0x117)](_0x22d4d2[_0x2b50e3(0x256)]['id'],{'include':['contact',{'model':Message_1[_0x2b50e3(0x254)],'as':_0x2b50e3(0x2ac),'include':[_0x2b50e3(0x2a4)]}]});if(!_0xb69cf4){console['log'](_0x22d4d2),console[_0x2b50e3(0x182)]('Mensagem\x20não\x20encontrada!');return;}await _0xb69cf4['update']({'ack':_0x390f59}),_0x41c943['to'](_0xb69cf4['ticketId']['toString']())[_0x2b50e3(0x1a1)](_0x2b50e3(0x1ac)+_0xb69cf4[_0x2b50e3(0x1e6)]+_0x2b50e3(0x116),{'action':'update','message':_0xb69cf4});}catch(_0x43637f){Sentry['captureException'](_0x43637f),logger_1[_0x2b50e3(0x24c)]['error'](_0x2b50e3(0x2bb)+_0x43637f);}};exports['handleMsgAck']=handleMsgAck;const verifyRecentCampaign=async(_0x223006,_0x14272b)=>{const _0x4b59e6=a558_0x2c2d44;if(!_0x223006['key']['fromMe']){const _0x5330e7=_0x223006[_0x4b59e6(0x256)][_0x4b59e6(0x1ae)][_0x4b59e6(0x1dd)](/\D/g,''),_0x310462=await Campaign_1['default'][_0x4b59e6(0x2c0)]({'where':{'companyId':_0x14272b,'status':_0x4b59e6(0x192),'confirmation':!![]}});if(_0x310462){const _0x48a3b9=_0x310462[_0x4b59e6(0x140)](_0x30c656=>_0x30c656['id']),_0x41b920=await CampaignShipping_1[_0x4b59e6(0x254)]['findOne']({'where':{'campaignId':{[sequelize_1['Op']['in']]:_0x48a3b9},'number':_0x5330e7,'confirmation':null}});_0x41b920&&(await _0x41b920[_0x4b59e6(0x1ed)]({'confirmedAt':(0x0,moment_1['default'])(),'confirmation':!![]}),await queues_1['campaignQueue']['add'](_0x4b59e6(0x111),{'campaignShippingId':_0x41b920['id'],'campaignId':_0x41b920[_0x4b59e6(0x27a)]},{'delay':(0x0,queues_1[_0x4b59e6(0x1b9)])((0x0,queues_1[_0x4b59e6(0x108)])(0x0,0xa))}));}}};exports[a558_0x2c2d44(0x1d1)]=verifyRecentCampaign;const verifyCampaignMessageAndCloseTicket=async(_0x5a7336,_0x54be69)=>{const _0x27fe6c=a558_0x2c2d44,_0x2dbea7=(0x0,socket_1['getIO'])(),_0x35d1a4=(0x0,exports['getBodyMessage'])(_0x5a7336),_0x11d0d7=/\u200c/[_0x27fe6c(0x10c)](_0x35d1a4);if(_0x5a7336[_0x27fe6c(0x256)][_0x27fe6c(0x21e)]&&_0x11d0d7){const _0x17ec26=await Message_1['default'][_0x27fe6c(0x27d)]({'where':{'id':_0x5a7336[_0x27fe6c(0x256)]['id'],'companyId':_0x54be69}}),_0xde01a5=await Ticket_1[_0x27fe6c(0x254)]['findByPk'](_0x17ec26[_0x27fe6c(0x2a6)]);await _0xde01a5['update']({'status':_0x27fe6c(0x22e)}),_0x2dbea7['to'](_0x27fe6c(0x1ac)+_0xde01a5[_0x27fe6c(0x1e6)]+_0x27fe6c(0x28f))[_0x27fe6c(0x1a1)](_0x27fe6c(0x1ac)+_0xde01a5['companyId']+_0x27fe6c(0x165),{'action':_0x27fe6c(0x134),'ticket':_0xde01a5,'ticketId':_0xde01a5['id']}),_0x2dbea7['to']('company-'+_0x54be69+'-'+_0xde01a5[_0x27fe6c(0x137)])['to'](_0xde01a5['id']['toString']())['emit'](_0x27fe6c(0x1ac)+_0xde01a5[_0x27fe6c(0x1e6)]+_0x27fe6c(0x165),{'action':_0x27fe6c(0x1ed),'ticket':_0xde01a5,'ticketId':_0xde01a5['id']});}};exports['verifyCampaignMessageAndCloseTicket']=verifyCampaignMessageAndCloseTicket;const filterMessages=_0x3b2c46=>{const _0x198262=a558_0x2c2d44;if([baileys_1[_0x198262(0x227)][_0x198262(0x259)],baileys_1[_0x198262(0x227)]['E2E_DEVICE_CHANGED'],baileys_1[_0x198262(0x227)]['E2E_IDENTITY_CHANGED'],baileys_1['WAMessageStubType'][_0x198262(0x1d0)]][_0x198262(0x179)](_0x3b2c46[_0x198262(0x28e)]))return![];return!![];},wbotMessageListener=async(_0x269c00,_0x4dd5ca,_0x54aa8c)=>{const _0x184c65=a558_0x2c2d44;_0x269c00['ev']['on'](_0x184c65(0x168),async _0x480100=>{const _0x28fb34=_0x184c65,_0x23c390=_0x480100[_0x28fb34(0x241)]['filter'](filterMessages);if(!_0x23c390)return;await app_1[_0x28fb34(0x254)]['get'](_0x28fb34(0x24d))[_0x28fb34(0x15b)]['add']('HandleMessageJob',{'whatsappId':_0x54aa8c['id'],'messages':_0x23c390,'companyId':_0x4dd5ca},{'removeOnComplete':!![],'attempts':0x3});}),_0x269c00['ev']['on']('messages.update',async _0x4de929=>{const _0x5931b4=_0x184c65;if(_0x4de929[_0x5931b4(0x284)]===0x0)return;await app_1[_0x5931b4(0x254)][_0x5931b4(0x110)](_0x5931b4(0x24d))[_0x5931b4(0x15b)]['add']('MessageUpdateJob',{'whatsappId':_0x54aa8c['id'],'messageUpdate':_0x4de929,'companyId':_0x4dd5ca},{'removeOnComplete':!![],'attempts':0x3,'delay':0x64});}),_0x269c00['ev']['on'](_0x184c65(0x272),async _0xc0883c=>{const _0x24ed7b=_0x184c65;console[_0x24ed7b(0x182)](_0xc0883c);if(_0xc0883c[_0x24ed7b(0x284)]===0x0)return;for(const _0x3444d3 of _0xc0883c){const _0x5b6066=_0x3444d3['id']['split']('@')[0x0],_0x485519=_0x3444d3[_0x24ed7b(0x22a)]||_0x5b6066,_0x5a35ad={'name':_0x485519,'number':_0x5b6066,'isGroup':!![],'companyId':_0x4dd5ca,'remoteJid':_0x3444d3['id'],'whatsappId':_0x269c00['id']};await(0x0,CreateOrUpdateContactService_1[_0x24ed7b(0x254)])(_0x5a35ad,_0x269c00,_0x3444d3['id']);}});};exports[a558_0x2c2d44(0x138)]=wbotMessageListener;