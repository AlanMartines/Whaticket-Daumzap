const a559_0x38df46=a559_0x1e2f;(function(_0x4f05c6,_0x216bfc){const _0x29a201=a559_0x1e2f,_0x511f3c=_0x4f05c6();while(!![]){try{const _0x341557=parseInt(_0x29a201(0x227))/0x1*(-parseInt(_0x29a201(0x1f6))/0x2)+-parseInt(_0x29a201(0x214))/0x3*(parseInt(_0x29a201(0x226))/0x4)+-parseInt(_0x29a201(0x223))/0x5+-parseInt(_0x29a201(0x216))/0x6+-parseInt(_0x29a201(0x220))/0x7*(parseInt(_0x29a201(0x22b))/0x8)+parseInt(_0x29a201(0x205))/0x9+parseInt(_0x29a201(0x21e))/0xa;if(_0x341557===_0x216bfc)break;else _0x511f3c['push'](_0x511f3c['shift']());}catch(_0x14e0ea){_0x511f3c['push'](_0x511f3c['shift']());}}}(a559_0xa0e7,0x7b6dc));const a559_0x3af704=(function(){let _0x438603=!![];return function(_0x6ed503,_0x18a200){const _0x2ff6ef=_0x438603?function(){if(_0x18a200){const _0x2ceacb=_0x18a200['apply'](_0x6ed503,arguments);return _0x18a200=null,_0x2ceacb;}}:function(){};return _0x438603=![],_0x2ff6ef;};}()),a559_0x24bf9f=a559_0x3af704(this,function(){const _0x2ca679=a559_0x1e2f;return a559_0x24bf9f[_0x2ca679(0x213)]()[_0x2ca679(0x219)]('(((.+)+)+)+$')[_0x2ca679(0x213)]()['constructor'](a559_0x24bf9f)['search'](_0x2ca679(0x21c));});a559_0x24bf9f();'use strict';var __createBinding=this&&this[a559_0x38df46(0x212)]||(Object[a559_0x38df46(0x229)]?function(_0x2098f9,_0x14d40b,_0x4f8db1,_0x39ca6c){const _0x47d332=a559_0x38df46;if(_0x39ca6c===undefined)_0x39ca6c=_0x4f8db1;var _0x578ff6=Object[_0x47d332(0x1f2)](_0x14d40b,_0x4f8db1);(!_0x578ff6||('get'in _0x578ff6?!_0x14d40b[_0x47d332(0x22f)]:_0x578ff6[_0x47d332(0x231)]||_0x578ff6[_0x47d332(0x203)]))&&(_0x578ff6={'enumerable':!![],'get':function(){return _0x14d40b[_0x4f8db1];}}),Object[_0x47d332(0x1ff)](_0x2098f9,_0x39ca6c,_0x578ff6);}:function(_0x1193be,_0x15a05d,_0x43e068,_0x1978bc){if(_0x1978bc===undefined)_0x1978bc=_0x43e068;_0x1193be[_0x1978bc]=_0x15a05d[_0x43e068];}),__setModuleDefault=this&&this[a559_0x38df46(0x211)]||(Object[a559_0x38df46(0x229)]?function(_0x10bf92,_0x482dfe){const _0xae2205=a559_0x38df46;Object[_0xae2205(0x1ff)](_0x10bf92,_0xae2205(0x1fb),{'enumerable':!![],'value':_0x482dfe});}:function(_0x17521d,_0x12f7e2){const _0x1d03ce=a559_0x38df46;_0x17521d[_0x1d03ce(0x1fb)]=_0x12f7e2;}),__importStar=this&&this[a559_0x38df46(0x204)]||function(_0x102220){const _0x4af5c4=a559_0x38df46;if(_0x102220&&_0x102220['__esModule'])return _0x102220;var _0xd5d4f5={};if(_0x102220!=null){for(var _0x2d75f0 in _0x102220)if(_0x2d75f0!==_0x4af5c4(0x1fb)&&Object[_0x4af5c4(0x22d)][_0x4af5c4(0x215)][_0x4af5c4(0x20e)](_0x102220,_0x2d75f0))__createBinding(_0xd5d4f5,_0x102220,_0x2d75f0);}return __setModuleDefault(_0xd5d4f5,_0x102220),_0xd5d4f5;},__importDefault=this&&this[a559_0x38df46(0x21a)]||function(_0x5c890d){const _0x464196=a559_0x38df46;return _0x5c890d&&_0x5c890d[_0x464196(0x22f)]?_0x5c890d:{'default':_0x5c890d};};Object[a559_0x38df46(0x1ff)](exports,a559_0x38df46(0x22f),{'value':!![]});function a559_0x1e2f(_0x53a4d2,_0x1c60e6){const _0x8d22b1=a559_0xa0e7();return a559_0x1e2f=function(_0x24bf9f,_0x3af704){_0x24bf9f=_0x24bf9f-0x1f1;let _0xa0e749=_0x8d22b1[_0x24bf9f];return _0xa0e749;},a559_0x1e2f(_0x53a4d2,_0x1c60e6);}function a559_0xa0e7(){const _0x5be356=['(((.+)+)+)+$','disabled','23762160PGQLVQ','getHours','287USECjH','../../models/Contact','terminate','4747750zCWaxG','tag','status','2234908DPaVDM','1iDNofQ','trace','create','attrs','56704yTHQrJ','../../helpers/SendPresenceStatus','prototype','../MessageServices/CreateMessageService','__esModule','push','writable','../../models/Setting','call-id','getOwnPropertyDescriptor','contacts.upsert','value','open','143566KjlMpa','closed','SendPresenceStatus','findOne','error','default','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','sendMessage','call_log','defineProperty','body\x20is\x20not\x20a\x20string','offer','@sentry/node','configurable','__importStar','2716569FhQJix','string','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','content','CB:call','update','getTime','../BaileysServices/CreateOrUpdateBaileysService','from','call','replace','getMinutes','__setModuleDefault','__createBinding','toString','3uqiUhr','hasOwnProperty','1810950HMgkzp','time','filter','search','__importDefault','length'];a559_0xa0e7=function(){return _0x5be356;};return a559_0xa0e7();}const Sentry=__importStar(require(a559_0x38df46(0x202))),Contact_1=__importDefault(require(a559_0x38df46(0x221))),Setting_1=__importDefault(require(a559_0x38df46(0x232))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require('../../utils/logger'),CreateOrUpdateBaileysService_1=__importDefault(require(a559_0x38df46(0x20c))),CreateMessageService_1=__importDefault(require(a559_0x38df46(0x22e))),SendPresenceStatus_1=require(a559_0x38df46(0x22c));let messageControl=[];const wbotMonitor=async(_0x5929f1,_0x357716,_0x41fadf)=>{const _0x10a683=a559_0x38df46;try{_0x5929f1['ws']['on'](_0x10a683(0x209),async _0x3b7494=>{const _0x55af44=_0x10a683,_0x267d1e=_0x3b7494[_0x55af44(0x208)][0x0];if(_0x267d1e[_0x55af44(0x224)]===_0x55af44(0x201)){const {from:_0x2b23e1,id:_0x2bd5f4}=_0x3b7494[_0x55af44(0x22a)];}if(_0x267d1e[_0x55af44(0x224)]===_0x55af44(0x222)){const _0x3a5e6d=await Setting_1['default']['findOne']({'where':{'key':_0x55af44(0x20e),'companyId':_0x41fadf}});if(!_0x3a5e6d||_0x3a5e6d[_0x55af44(0x1f4)]===_0x55af44(0x21d)){if(messageControl[_0x55af44(0x21b)]>0x1388)messageControl=[];var _0xf5000f=messageControl['find'](_0xf36ef2=>_0xf36ef2['from']===_0x3b7494[_0x55af44(0x22a)]['from']);(!_0xf5000f||new Date()[_0x55af44(0x20b)]()-_0xf5000f[_0x55af44(0x217)]>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0x55af44(0x1f8)])(_0x5929f1,_0x3b7494['attrs'][_0x55af44(0x20d)]),await _0x5929f1[_0x55af44(0x1fd)](_0x3b7494[_0x55af44(0x22a)]['from'],{'text':_0x55af44(0x1fc)}),_0xf5000f&&(_0xf5000f=null,messageControl=messageControl[_0x55af44(0x218)](_0x5ae195=>_0x5ae195[_0x55af44(0x20d)]!==_0x3b7494[_0x55af44(0x22a)][_0x55af44(0x20d)])));!_0xf5000f&&messageControl[_0x55af44(0x230)]({'from':_0x3b7494[_0x55af44(0x22a)][_0x55af44(0x20d)],'time':new Date()['getTime']()});const _0x2047b7=_0x3b7494['attrs']['from'][_0x55af44(0x20f)](/\D/g,''),_0x115538=await Contact_1[_0x55af44(0x1fb)][_0x55af44(0x1f9)]({'where':{'companyId':_0x41fadf,'number':_0x2047b7}}),_0x1b8efa=await Ticket_1[_0x55af44(0x1fb)]['findOne']({'where':{'contactId':_0x115538['id'],'whatsappId':_0x5929f1['id'],'status':_0x55af44(0x1f5),'companyId':_0x41fadf}});if(!_0x1b8efa)return;const _0x54a01d=new Date(),_0x209022=_0x54a01d[_0x55af44(0x21f)](),_0x4c2649=_0x54a01d[_0x55af44(0x210)](),_0xc2637=_0x55af44(0x207)+_0x209022+':'+_0x4c2649,_0x17369c={'id':_0x267d1e[_0x55af44(0x22a)][_0x55af44(0x1f1)],'ticketId':_0x1b8efa['id'],'contactId':_0x115538['id'],'body':_0xc2637,'fromMe':![],'mediaType':_0x55af44(0x1fe),'read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0xc2637!==_0x55af44(0x206)&&console[_0x55af44(0x228)](_0x55af44(0x200),_0xc2637),await _0x1b8efa[_0x55af44(0x20a)]({'lastMessage':_0xc2637}),_0x1b8efa[_0x55af44(0x225)]===_0x55af44(0x1f7)&&await _0x1b8efa[_0x55af44(0x20a)]({'status':'pending'}),(0x0,CreateMessageService_1['default'])({'messageData':_0x17369c,'ticket':_0x1b8efa,'companyId':_0x41fadf});}}}),_0x5929f1['ev']['on'](_0x10a683(0x1f3),async _0xa19ec5=>{const _0x553710=_0x10a683;await(0x0,CreateOrUpdateBaileysService_1[_0x553710(0x1fb)])({'whatsappId':_0x357716['id'],'contacts':_0xa19ec5});});}catch(_0x23fee9){Sentry['captureException'](_0x23fee9),logger_1['logger'][_0x10a683(0x1fa)](_0x23fee9);}};exports[a559_0x38df46(0x1fb)]=wbotMonitor;