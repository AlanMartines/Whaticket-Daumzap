const a559_0x2e6a7b=a559_0x660b;(function(_0x192ee4,_0x4a190b){const _0xd6e5f8=a559_0x660b,_0x2a9818=_0x192ee4();while(!![]){try{const _0x17c8a9=-parseInt(_0xd6e5f8(0x16f))/0x1+parseInt(_0xd6e5f8(0x184))/0x2*(parseInt(_0xd6e5f8(0x17f))/0x3)+-parseInt(_0xd6e5f8(0x163))/0x4*(-parseInt(_0xd6e5f8(0x192))/0x5)+-parseInt(_0xd6e5f8(0x191))/0x6*(parseInt(_0xd6e5f8(0x174))/0x7)+-parseInt(_0xd6e5f8(0x186))/0x8+-parseInt(_0xd6e5f8(0x168))/0x9*(parseInt(_0xd6e5f8(0x162))/0xa)+-parseInt(_0xd6e5f8(0x15f))/0xb*(-parseInt(_0xd6e5f8(0x193))/0xc);if(_0x17c8a9===_0x4a190b)break;else _0x2a9818['push'](_0x2a9818['shift']());}catch(_0x5693d9){_0x2a9818['push'](_0x2a9818['shift']());}}}(a559_0x47c3,0x455da));function a559_0x47c3(){const _0x4fe243=['default','offer','6nlepNG','726005fpLJwe','5640BjkGdW','body\x20is\x20not\x20a\x20string','prototype','closed','find','filter','(((.+)+)+)+$','getOwnPropertyDescriptor','9768DJgguh','writable','create','10mQgMia','4pKkYtV','../../models/Setting','__importStar','tag','string','1705545fLqMYA','getTime','../../models/Ticket','call_log','toString','pending','push','151995Cgddrf','status','../../helpers/SendPresenceStatus','disabled','attrs','118986Bqtqsi','sendMessage','open','replace','length','search','findOne','from','update','constructor','@sentry/node','397770MyXfdL','defineProperty','getHours','error','../BaileysServices/CreateOrUpdateBaileysService','4WTEYsc','call','1480968EoSOqr','value','../../utils/logger','__esModule','contacts.upsert','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','captureException','../../models/Contact','call-id'];a559_0x47c3=function(){return _0x4fe243;};return a559_0x47c3();}function a559_0x660b(_0x2fee97,_0x604b00){const _0x383b41=a559_0x47c3();return a559_0x660b=function(_0x392845,_0x4e98cb){_0x392845=_0x392845-0x15f;let _0x47c3fc=_0x383b41[_0x392845];return _0x47c3fc;},a559_0x660b(_0x2fee97,_0x604b00);}const a559_0x4e98cb=(function(){let _0x120bff=!![];return function(_0x43cffa,_0x5626ad){const _0x4261bf=_0x120bff?function(){if(_0x5626ad){const _0x3cc384=_0x5626ad['apply'](_0x43cffa,arguments);return _0x5626ad=null,_0x3cc384;}}:function(){};return _0x120bff=![],_0x4261bf;};}()),a559_0x392845=a559_0x4e98cb(this,function(){const _0x9b1575=a559_0x660b;return a559_0x392845[_0x9b1575(0x16c)]()['search'](_0x9b1575(0x199))[_0x9b1575(0x16c)]()[_0x9b1575(0x17d)](a559_0x392845)[_0x9b1575(0x179)](_0x9b1575(0x199));});a559_0x392845();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a559_0x2e6a7b(0x161)]?function(_0x5a8581,_0x390fe7,_0x50af13,_0x51747d){const _0x18a99b=a559_0x2e6a7b;if(_0x51747d===undefined)_0x51747d=_0x50af13;var _0x235ea4=Object[_0x18a99b(0x19a)](_0x390fe7,_0x50af13);(!_0x235ea4||('get'in _0x235ea4?!_0x390fe7[_0x18a99b(0x189)]:_0x235ea4[_0x18a99b(0x160)]||_0x235ea4['configurable']))&&(_0x235ea4={'enumerable':!![],'get':function(){return _0x390fe7[_0x50af13];}}),Object[_0x18a99b(0x180)](_0x5a8581,_0x51747d,_0x235ea4);}:function(_0x2adcf3,_0x38b22a,_0x690a4d,_0x3a13e6){if(_0x3a13e6===undefined)_0x3a13e6=_0x690a4d;_0x2adcf3[_0x3a13e6]=_0x38b22a[_0x690a4d];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a559_0x2e6a7b(0x161)]?function(_0x5c6254,_0x522c56){const _0x2764db=a559_0x2e6a7b;Object[_0x2764db(0x180)](_0x5c6254,_0x2764db(0x18f),{'enumerable':!![],'value':_0x522c56});}:function(_0xbc41c9,_0x5410d4){_0xbc41c9['default']=_0x5410d4;}),__importStar=this&&this[a559_0x2e6a7b(0x165)]||function(_0x2ac577){const _0x14718c=a559_0x2e6a7b;if(_0x2ac577&&_0x2ac577['__esModule'])return _0x2ac577;var _0x2db93b={};if(_0x2ac577!=null){for(var _0x279604 in _0x2ac577)if(_0x279604!=='default'&&Object[_0x14718c(0x195)]['hasOwnProperty']['call'](_0x2ac577,_0x279604))__createBinding(_0x2db93b,_0x2ac577,_0x279604);}return __setModuleDefault(_0x2db93b,_0x2ac577),_0x2db93b;},__importDefault=this&&this['__importDefault']||function(_0x68ff85){const _0x391cb5=a559_0x2e6a7b;return _0x68ff85&&_0x68ff85[_0x391cb5(0x189)]?_0x68ff85:{'default':_0x68ff85};};Object[a559_0x2e6a7b(0x180)](exports,a559_0x2e6a7b(0x189),{'value':!![]});const Sentry=__importStar(require(a559_0x2e6a7b(0x17e))),Contact_1=__importDefault(require(a559_0x2e6a7b(0x18d))),Setting_1=__importDefault(require(a559_0x2e6a7b(0x164))),Ticket_1=__importDefault(require(a559_0x2e6a7b(0x16a))),logger_1=require(a559_0x2e6a7b(0x188)),CreateOrUpdateBaileysService_1=__importDefault(require(a559_0x2e6a7b(0x183))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),SendPresenceStatus_1=require(a559_0x2e6a7b(0x171));let messageControl=[];const wbotMonitor=async(_0xae1b7d,_0x351b38,_0x1686b8)=>{const _0x5d2703=a559_0x2e6a7b;try{_0xae1b7d['ws']['on']('CB:call',async _0x18f9f9=>{const _0xd31b21=a559_0x660b,_0x2eeb1f=_0x18f9f9['content'][0x0];if(_0x2eeb1f[_0xd31b21(0x166)]===_0xd31b21(0x190)){const {from:_0x4437f6,id:_0xdd2c71}=_0x18f9f9[_0xd31b21(0x173)];}if(_0x2eeb1f['tag']==='terminate'){const _0x2b78ff=await Setting_1[_0xd31b21(0x18f)][_0xd31b21(0x17a)]({'where':{'key':_0xd31b21(0x185),'companyId':_0x1686b8}});if(!_0x2b78ff||_0x2b78ff[_0xd31b21(0x187)]===_0xd31b21(0x172)){if(messageControl[_0xd31b21(0x178)]>0x1388)messageControl=[];var _0x271bcb=messageControl[_0xd31b21(0x197)](_0x25a72c=>_0x25a72c['from']===_0x18f9f9[_0xd31b21(0x173)][_0xd31b21(0x17b)]);(!_0x271bcb||new Date()[_0xd31b21(0x169)]()-_0x271bcb['time']>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1['SendPresenceStatus'])(_0xae1b7d,_0x18f9f9[_0xd31b21(0x173)][_0xd31b21(0x17b)]),await _0xae1b7d[_0xd31b21(0x175)](_0x18f9f9[_0xd31b21(0x173)][_0xd31b21(0x17b)],{'text':_0xd31b21(0x18b)}),_0x271bcb&&(_0x271bcb=null,messageControl=messageControl[_0xd31b21(0x198)](_0x45ea30=>_0x45ea30['from']!==_0x18f9f9['attrs'][_0xd31b21(0x17b)])));!_0x271bcb&&messageControl[_0xd31b21(0x16e)]({'from':_0x18f9f9[_0xd31b21(0x173)][_0xd31b21(0x17b)],'time':new Date()[_0xd31b21(0x169)]()});const _0x3c7c3d=_0x18f9f9['attrs']['from'][_0xd31b21(0x177)](/\D/g,''),_0x177e47=await Contact_1[_0xd31b21(0x18f)][_0xd31b21(0x17a)]({'where':{'companyId':_0x1686b8,'number':_0x3c7c3d}}),_0x5ccbb4=await Ticket_1[_0xd31b21(0x18f)][_0xd31b21(0x17a)]({'where':{'contactId':_0x177e47['id'],'whatsappId':_0xae1b7d['id'],'status':_0xd31b21(0x176),'companyId':_0x1686b8}});if(!_0x5ccbb4)return;const _0x577e64=new Date(),_0x293f2c=_0x577e64[_0xd31b21(0x181)](),_0x118c2a=_0x577e64['getMinutes'](),_0xee8e10='Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20'+_0x293f2c+':'+_0x118c2a,_0x3a048a={'id':_0x2eeb1f[_0xd31b21(0x173)][_0xd31b21(0x18e)],'ticketId':_0x5ccbb4['id'],'contactId':_0x177e47['id'],'body':_0xee8e10,'fromMe':![],'mediaType':_0xd31b21(0x16b),'read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0xee8e10!==_0xd31b21(0x167)&&console['trace'](_0xd31b21(0x194),_0xee8e10),await _0x5ccbb4[_0xd31b21(0x17c)]({'lastMessage':_0xee8e10}),_0x5ccbb4[_0xd31b21(0x170)]===_0xd31b21(0x196)&&await _0x5ccbb4[_0xd31b21(0x17c)]({'status':_0xd31b21(0x16d)}),(0x0,CreateMessageService_1['default'])({'messageData':_0x3a048a,'ticket':_0x5ccbb4,'companyId':_0x1686b8});}}}),_0xae1b7d['ev']['on'](_0x5d2703(0x18a),async _0x1cc3cb=>{const _0x5689d7=_0x5d2703;await(0x0,CreateOrUpdateBaileysService_1[_0x5689d7(0x18f)])({'whatsappId':_0x351b38['id'],'contacts':_0x1cc3cb});});}catch(_0x12251f){Sentry[_0x5d2703(0x18c)](_0x12251f),logger_1['logger'][_0x5d2703(0x182)](_0x12251f);}};exports[a559_0x2e6a7b(0x18f)]=wbotMonitor;