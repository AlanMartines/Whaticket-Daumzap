const a559_0x32477c=a559_0xb82a;(function(_0x56b5fe,_0x418a1d){const _0x48237b=a559_0xb82a,_0x4c2d9d=_0x56b5fe();while(!![]){try{const _0x3ec696=parseInt(_0x48237b(0x1bb))/0x1*(-parseInt(_0x48237b(0x1bd))/0x2)+parseInt(_0x48237b(0x1bc))/0x3+-parseInt(_0x48237b(0x1ca))/0x4*(parseInt(_0x48237b(0x1b6))/0x5)+parseInt(_0x48237b(0x1d1))/0x6*(parseInt(_0x48237b(0x1cd))/0x7)+parseInt(_0x48237b(0x1d4))/0x8*(-parseInt(_0x48237b(0x1df))/0x9)+parseInt(_0x48237b(0x1a9))/0xa*(-parseInt(_0x48237b(0x1d3))/0xb)+-parseInt(_0x48237b(0x1d0))/0xc*(-parseInt(_0x48237b(0x1ba))/0xd);if(_0x3ec696===_0x418a1d)break;else _0x4c2d9d['push'](_0x4c2d9d['shift']());}catch(_0x304717){_0x4c2d9d['push'](_0x4c2d9d['shift']());}}}(a559_0x122b,0xb1853));const a559_0x3ea6c5=(function(){let _0x4d7c35=!![];return function(_0x2b2942,_0x5212a9){const _0x55c92f=_0x4d7c35?function(){const _0x7aec82=a559_0xb82a;if(_0x5212a9){const _0x1283c1=_0x5212a9[_0x7aec82(0x1de)](_0x2b2942,arguments);return _0x5212a9=null,_0x1283c1;}}:function(){};return _0x4d7c35=![],_0x55c92f;};}()),a559_0x52900a=a559_0x3ea6c5(this,function(){const _0x736363=a559_0xb82a;return a559_0x52900a[_0x736363(0x1dc)]()[_0x736363(0x1e2)](_0x736363(0x1c6))[_0x736363(0x1dc)]()['constructor'](a559_0x52900a)[_0x736363(0x1e2)](_0x736363(0x1c6));});a559_0x52900a();'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3c6ed2,_0x322f5c,_0x1e72e8,_0x552e54){const _0x36be82=a559_0xb82a;if(_0x552e54===undefined)_0x552e54=_0x1e72e8;var _0x213abc=Object[_0x36be82(0x1d8)](_0x322f5c,_0x1e72e8);(!_0x213abc||(_0x36be82(0x1d7)in _0x213abc?!_0x322f5c[_0x36be82(0x1c1)]:_0x213abc[_0x36be82(0x1e1)]||_0x213abc[_0x36be82(0x1a8)]))&&(_0x213abc={'enumerable':!![],'get':function(){return _0x322f5c[_0x1e72e8];}}),Object['defineProperty'](_0x3c6ed2,_0x552e54,_0x213abc);}:function(_0x4ed6e5,_0x232e3e,_0x1b21f5,_0x2508f1){if(_0x2508f1===undefined)_0x2508f1=_0x1b21f5;_0x4ed6e5[_0x2508f1]=_0x232e3e[_0x1b21f5];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a559_0x32477c(0x1c4)]?function(_0x5c50d6,_0x3d4083){const _0x5a93e5=a559_0x32477c;Object[_0x5a93e5(0x1e4)](_0x5c50d6,_0x5a93e5(0x1ae),{'enumerable':!![],'value':_0x3d4083});}:function(_0x516d88,_0x14571){const _0x44c685=a559_0x32477c;_0x516d88[_0x44c685(0x1ae)]=_0x14571;}),__importStar=this&&this[a559_0x32477c(0x1db)]||function(_0x32408c){const _0x553a7d=a559_0x32477c;if(_0x32408c&&_0x32408c[_0x553a7d(0x1c1)])return _0x32408c;var _0x10bfb8={};if(_0x32408c!=null){for(var _0x32dcc2 in _0x32408c)if(_0x32dcc2!==_0x553a7d(0x1ae)&&Object[_0x553a7d(0x1cb)][_0x553a7d(0x1aa)]['call'](_0x32408c,_0x32dcc2))__createBinding(_0x10bfb8,_0x32408c,_0x32dcc2);}return __setModuleDefault(_0x10bfb8,_0x32408c),_0x10bfb8;},__importDefault=this&&this['__importDefault']||function(_0x450db5){const _0x16f1c0=a559_0x32477c;return _0x450db5&&_0x450db5[_0x16f1c0(0x1c1)]?_0x450db5:{'default':_0x450db5};};Object[a559_0x32477c(0x1e4)](exports,a559_0x32477c(0x1c1),{'value':!![]});const Sentry=__importStar(require(a559_0x32477c(0x1b2))),Contact_1=__importDefault(require(a559_0x32477c(0x1b9))),Setting_1=__importDefault(require(a559_0x32477c(0x1d6))),Ticket_1=__importDefault(require('../../models/Ticket')),logger_1=require(a559_0x32477c(0x1d2)),CreateOrUpdateBaileysService_1=__importDefault(require(a559_0x32477c(0x1a7))),CreateMessageService_1=__importDefault(require(a559_0x32477c(0x1be))),SendPresenceStatus_1=require(a559_0x32477c(0x1c9));function a559_0xb82a(_0x180c43,_0x4ad78f){const _0x3cf0ae=a559_0x122b();return a559_0xb82a=function(_0x52900a,_0x3ea6c5){_0x52900a=_0x52900a-0x1a7;let _0x122b83=_0x3cf0ae[_0x52900a];return _0x122b83;},a559_0xb82a(_0x180c43,_0x4ad78f);}function a559_0x122b(){const _0xd29a09=['logger','*Mensagem\x20Automática:*\x0a\x0aAs\x20chamadas\x20de\x20voz\x20e\x20vídeo\x20estão\x20desabilitas\x20para\x20esse\x20WhatsApp,\x20favor\x20enviar\x20uma\x20mensagem\x20de\x20texto.\x20Obrigado','create','trace','(((.+)+)+)+$','call_log','from','../../helpers/SendPresenceStatus','6492RGiAXq','prototype','call-id','8946bduikE','string','push','29652jXsGyJ','6ygiDMT','../../utils/logger','16313tDVznq','10579144RCOmxP','getTime','../../models/Setting','get','getOwnPropertyDescriptor','CB:call','offer','__importStar','toString','getHours','apply','9PZNzfi','find','writable','search','findOne','defineProperty','SendPresenceStatus','../BaileysServices/CreateOrUpdateBaileysService','configurable','670gyhoMI','hasOwnProperty','closed','attrs','update','default','value','terminate','tag','@sentry/node','content','pending','replace','1190SHjNQZ','Chamada\x20de\x20voz/vídeo\x20perdida\x20às\x20','status','../../models/Contact','8879OzAKtq','45kyuXoD','3400785NvfqKT','12774eAyRcA','../MessageServices/CreateMessageService','length','captureException','__esModule'];a559_0x122b=function(){return _0xd29a09;};return a559_0x122b();}let messageControl=[];const wbotMonitor=async(_0x45c43f,_0x91823f,_0x33ee3d)=>{const _0x3986be=a559_0x32477c;try{_0x45c43f['ws']['on'](_0x3986be(0x1d9),async _0x9fee91=>{const _0xb859ec=_0x3986be,_0x4744aa=_0x9fee91[_0xb859ec(0x1b3)][0x0];if(_0x4744aa['tag']===_0xb859ec(0x1da)){const {from:_0x363032,id:_0xc68f27}=_0x9fee91[_0xb859ec(0x1ac)];}if(_0x4744aa[_0xb859ec(0x1b1)]===_0xb859ec(0x1b0)){const _0x1985df=await Setting_1[_0xb859ec(0x1ae)][_0xb859ec(0x1e3)]({'where':{'key':'call','companyId':_0x33ee3d}});if(!_0x1985df||_0x1985df[_0xb859ec(0x1af)]==='disabled'){if(messageControl[_0xb859ec(0x1bf)]>0x1388)messageControl=[];var _0x54f85e=messageControl[_0xb859ec(0x1e0)](_0x1421a6=>_0x1421a6[_0xb859ec(0x1c8)]===_0x9fee91[_0xb859ec(0x1ac)][_0xb859ec(0x1c8)]);(!_0x54f85e||new Date()[_0xb859ec(0x1d5)]()-_0x54f85e['time']>=0x3e8*0x3c*0x5)&&(await(0x0,SendPresenceStatus_1[_0xb859ec(0x1e5)])(_0x45c43f,_0x9fee91[_0xb859ec(0x1ac)][_0xb859ec(0x1c8)]),await _0x45c43f['sendMessage'](_0x9fee91[_0xb859ec(0x1ac)][_0xb859ec(0x1c8)],{'text':_0xb859ec(0x1c3)}),_0x54f85e&&(_0x54f85e=null,messageControl=messageControl['filter'](_0x3696ca=>_0x3696ca[_0xb859ec(0x1c8)]!==_0x9fee91[_0xb859ec(0x1ac)][_0xb859ec(0x1c8)])));!_0x54f85e&&messageControl[_0xb859ec(0x1cf)]({'from':_0x9fee91[_0xb859ec(0x1ac)]['from'],'time':new Date()[_0xb859ec(0x1d5)]()});const _0x372da0=_0x9fee91[_0xb859ec(0x1ac)][_0xb859ec(0x1c8)][_0xb859ec(0x1b5)](/\D/g,''),_0x56845b=await Contact_1[_0xb859ec(0x1ae)][_0xb859ec(0x1e3)]({'where':{'companyId':_0x33ee3d,'number':_0x372da0}}),_0xf41683=await Ticket_1[_0xb859ec(0x1ae)][_0xb859ec(0x1e3)]({'where':{'contactId':_0x56845b['id'],'whatsappId':_0x45c43f['id'],'status':'open','companyId':_0x33ee3d}});if(!_0xf41683)return;const _0x9440=new Date(),_0x6d7c5e=_0x9440[_0xb859ec(0x1dd)](),_0x35e543=_0x9440['getMinutes'](),_0x53632b=_0xb859ec(0x1b7)+_0x6d7c5e+':'+_0x35e543,_0x1d8a81={'id':_0x4744aa[_0xb859ec(0x1ac)][_0xb859ec(0x1cc)],'ticketId':_0xf41683['id'],'contactId':_0x56845b['id'],'body':_0x53632b,'fromMe':![],'mediaType':_0xb859ec(0x1c7),'read':!![],'quotedMsgId':null,'ack':0x1};return typeof _0x53632b!==_0xb859ec(0x1ce)&&console[_0xb859ec(0x1c5)]('body\x20is\x20not\x20a\x20string',_0x53632b),await _0xf41683['update']({'lastMessage':_0x53632b}),_0xf41683[_0xb859ec(0x1b8)]===_0xb859ec(0x1ab)&&await _0xf41683[_0xb859ec(0x1ad)]({'status':_0xb859ec(0x1b4)}),(0x0,CreateMessageService_1[_0xb859ec(0x1ae)])({'messageData':_0x1d8a81,'ticket':_0xf41683,'companyId':_0x33ee3d});}}}),_0x45c43f['ev']['on']('contacts.upsert',async _0x3dcfa4=>{await(0x0,CreateOrUpdateBaileysService_1['default'])({'whatsappId':_0x91823f['id'],'contacts':_0x3dcfa4});});}catch(_0x3253b0){Sentry[_0x3986be(0x1c0)](_0x3253b0),logger_1[_0x3986be(0x1c2)]['error'](_0x3253b0);}};exports[a559_0x32477c(0x1ae)]=wbotMonitor;