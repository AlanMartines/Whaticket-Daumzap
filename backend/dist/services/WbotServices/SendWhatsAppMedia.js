const a548_0x1c0286=a548_0x2820;(function(_0x50f9a1,_0x56df29){const _0x479a63=a548_0x2820,_0x43555c=_0x50f9a1();while(!![]){try{const _0x4b3c67=-parseInt(_0x479a63(0x21f))/0x1*(-parseInt(_0x479a63(0x1e4))/0x2)+-parseInt(_0x479a63(0x1ee))/0x3*(-parseInt(_0x479a63(0x1de))/0x4)+parseInt(_0x479a63(0x211))/0x5+parseInt(_0x479a63(0x1f5))/0x6+parseInt(_0x479a63(0x220))/0x7+-parseInt(_0x479a63(0x23c))/0x8+-parseInt(_0x479a63(0x221))/0x9*(parseInt(_0x479a63(0x1f1))/0xa);if(_0x4b3c67===_0x56df29)break;else _0x43555c['push'](_0x43555c['shift']());}catch(_0x308565){_0x43555c['push'](_0x43555c['shift']());}}}(a548_0x5c7c,0x4e203));const a548_0xa1f7cf=(function(){let _0x3d37b8=!![];return function(_0x2f3439,_0x5c6828){const _0x24446c=_0x3d37b8?function(){if(_0x5c6828){const _0x1a3e8b=_0x5c6828['apply'](_0x2f3439,arguments);return _0x5c6828=null,_0x1a3e8b;}}:function(){};return _0x3d37b8=![],_0x24446c;};}()),a548_0x3ccaa0=a548_0xa1f7cf(this,function(){const _0x4fc026=a548_0x2820;return a548_0x3ccaa0['toString']()['search'](_0x4fc026(0x207))['toString']()[_0x4fc026(0x223)](a548_0x3ccaa0)[_0x4fc026(0x22d)]('(((.+)+)+)+$');});a548_0x3ccaa0();'use strict';function a548_0x2820(_0x3c6528,_0x1b89d0){const _0x4266ab=a548_0x5c7c();return a548_0x2820=function(_0x3ccaa0,_0xa1f7cf){_0x3ccaa0=_0x3ccaa0-0x1d6;let _0x5c7c89=_0x4266ab[_0x3ccaa0];return _0x5c7c89;},a548_0x2820(_0x3c6528,_0x1b89d0);}var __createBinding=this&&this[a548_0x1c0286(0x1eb)]||(Object[a548_0x1c0286(0x214)]?function(_0x14b885,_0x5f4bd7,_0x47625c,_0x416b1b){const _0xd21e8f=a548_0x1c0286;if(_0x416b1b===undefined)_0x416b1b=_0x47625c;var _0x3fc4e5=Object[_0xd21e8f(0x1e6)](_0x5f4bd7,_0x47625c);(!_0x3fc4e5||(_0xd21e8f(0x203)in _0x3fc4e5?!_0x5f4bd7['__esModule']:_0x3fc4e5[_0xd21e8f(0x222)]||_0x3fc4e5[_0xd21e8f(0x1d8)]))&&(_0x3fc4e5={'enumerable':!![],'get':function(){return _0x5f4bd7[_0x47625c];}}),Object[_0xd21e8f(0x21e)](_0x14b885,_0x416b1b,_0x3fc4e5);}:function(_0x5bec0a,_0x40f402,_0x299372,_0x4fd59a){if(_0x4fd59a===undefined)_0x4fd59a=_0x299372;_0x5bec0a[_0x4fd59a]=_0x40f402[_0x299372];}),__setModuleDefault=this&&this[a548_0x1c0286(0x226)]||(Object[a548_0x1c0286(0x214)]?function(_0x4cc508,_0x130bc5){const _0x52af1c=a548_0x1c0286;Object[_0x52af1c(0x21e)](_0x4cc508,_0x52af1c(0x228),{'enumerable':!![],'value':_0x130bc5});}:function(_0x4c312c,_0x4bddb2){_0x4c312c['default']=_0x4bddb2;}),__importStar=this&&this['__importStar']||function(_0x473c9d){const _0x4df770=a548_0x1c0286;if(_0x473c9d&&_0x473c9d[_0x4df770(0x216)])return _0x473c9d;var _0x1c39e6={};if(_0x473c9d!=null){for(var _0x31dc87 in _0x473c9d)if(_0x31dc87!==_0x4df770(0x228)&&Object[_0x4df770(0x20a)]['hasOwnProperty']['call'](_0x473c9d,_0x31dc87))__createBinding(_0x1c39e6,_0x473c9d,_0x31dc87);}return __setModuleDefault(_0x1c39e6,_0x473c9d),_0x1c39e6;},__importDefault=this&&this[a548_0x1c0286(0x201)]||function(_0x2ff870){const _0x326702=a548_0x1c0286;return _0x2ff870&&_0x2ff870[_0x326702(0x216)]?_0x2ff870:{'default':_0x2ff870};};Object[a548_0x1c0286(0x21e)](exports,a548_0x1c0286(0x216),{'value':!![]}),exports[a548_0x1c0286(0x20e)]=exports[a548_0x1c0286(0x233)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a548_0x1c0286(0x21a)),path_1=__importDefault(require(a548_0x1c0286(0x1db))),fluent_ffmpeg_1=__importDefault(require(a548_0x1c0286(0x22c))),AppError_1=__importDefault(require(a548_0x1c0286(0x20d))),GetTicketWbot_1=__importDefault(require('../../helpers/GetTicketWbot')),mime_types_1=__importDefault(require(a548_0x1c0286(0x208))),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require(a548_0x1c0286(0x200))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require('./wbotMessageListener');function a548_0x5c7c(){const _0x35de5a=['fromMe','child_process','s.whatsapp.net','application/x-rar-compressed','video/mp4','defineProperty','85919cTVNpG','2414916ewDBLJ','163242vxhamP','writable','constructor','update','join','__setModuleDefault','verifyQuotedMessage','default','video','ERR_SENDING_WAPP_MSG','application/rtf','fluent-ffmpeg','search','video/3gpp2','companyId','log','includes','text/html','getMessageOptions','application/vnd.ms-excel','getBodyMessage','getTime','audio-record-site','public','contact','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','participant','2464584tTqSDO','video/3gpp','text/plain','configurable','application/msword','exec','path','originalname','audio/mp4','260ExWYvV','readFileSync','application/zip','lookup','audio','unlinkSync','6zJqbHo','application/pdf','getOwnPropertyDescriptor','trace','pop','image/gif','body','__createBinding','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','/public','20718TXLmUu','\x20-i\x20','number','570yNfSSO','text','remoteJid','mimetype','685056FwyntG','application','stringify','captureException','isGroup','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','application/octet-stream','split','length','application/vnd.ms-powerpoint','document','ffmpeg-static','__importDefault','application/vnd.openxmlformats-officedocument.presentationml.presentation','get','Invalid\x20mimetype','image/jpeg','sendMessage','(((.+)+)+)+$','mime-types','/company','prototype','key','g.us','../../errors/AppError','SendWhatsAppMediaFileAddress','application/x-7z-compressed','./public','2480655swiZvQ','http','.mp3','create','body\x20is\x20not\x20a\x20string','__esModule','application/vnd.openxmlformats-officedocument.wordprocessingml.document','audio/ogg'];a548_0x5c7c=function(){return _0x35de5a;};return a548_0x5c7c();}fluent_ffmpeg_1[a548_0x1c0286(0x228)]['setFfmpegPath'](ffmpeg_static_1['default']);const publicFolder=path_1[a548_0x1c0286(0x228)]['resolve'](__dirname,'..','..','..',a548_0x1c0286(0x238)),processAudio=async(_0x33bc95,_0x30c158)=>{const _0xa3ca83=a548_0x1c0286,_0xbd667d=publicFolder+_0xa3ca83(0x209)+_0x30c158+'/'+new Date()[_0xa3ca83(0x236)]()+_0xa3ca83(0x213);return new Promise((_0x68113a,_0x179eaf)=>{const _0xb3f696=_0xa3ca83;(0x0,child_process_1['exec'])(ffmpeg_static_1[_0xb3f696(0x228)]+_0xb3f696(0x1ef)+_0x33bc95+_0xb3f696(0x23a)+_0xbd667d+'\x20-y',(_0x4931a9,_0x34ad1d,_0x4fa915)=>{if(_0x4931a9)_0x179eaf(_0x4931a9);fs_1['default']['unlinkSync'](_0x33bc95),_0x68113a(_0xbd667d);});});},processAudioFile=async _0x1fd3f6=>{const _0x1fb217=a548_0x1c0286,_0x4f4b2a=publicFolder+'/'+new Date()[_0x1fb217(0x236)]()+'.mp3';return new Promise((_0x23aa21,_0x2601d0)=>{const _0x325eb2=_0x1fb217;(0x0,child_process_1[_0x325eb2(0x1da)])(ffmpeg_static_1['default']+_0x325eb2(0x1ef)+_0x1fd3f6+_0x325eb2(0x1ec)+_0x4f4b2a,(_0x2fc921,_0x435c3f,_0x498ed8)=>{const _0x379845=_0x325eb2;if(_0x2fc921)_0x2601d0(_0x2fc921);fs_1['default'][_0x379845(0x1e3)](_0x1fd3f6),_0x23aa21(_0x4f4b2a);});});},getMessageOptions=async(_0x185b07,_0x413da9,_0x32da3c,_0x5f426b)=>{const _0x34f631=a548_0x1c0286,_0x5c86b9=mime_types_1['default'][_0x34f631(0x1e1)](_0x413da9),_0x178183=_0x5c86b9[_0x34f631(0x1fc)]('/')[0x0];try{if(!_0x5c86b9)throw new Error(_0x34f631(0x204));let _0x5c5cb7;if(_0x178183==='video')_0x5c5cb7={'video':fs_1[_0x34f631(0x228)][_0x34f631(0x1df)](_0x413da9),'caption':_0x32da3c?_0x32da3c:'','fileName':_0x185b07};else{if(_0x178183===_0x34f631(0x1e2)){const _0x4ce1f7=!![],_0x1bfb55=await processAudio(_0x413da9,_0x5f426b);_0x4ce1f7?_0x5c5cb7={'audio':fs_1[_0x34f631(0x228)][_0x34f631(0x1df)](_0x1bfb55),'mimetype':_0x4ce1f7?'audio/mp4':_0x5c86b9,'caption':_0x32da3c?_0x32da3c:null,'ptt':!![]}:_0x5c5cb7={'audio':fs_1[_0x34f631(0x228)][_0x34f631(0x1df)](_0x1bfb55),'mimetype':_0x4ce1f7?_0x34f631(0x1dd):_0x5c86b9,'caption':_0x32da3c?_0x32da3c:null,'ptt':!![]};}else{if(_0x178183===_0x34f631(0x1ff))_0x5c5cb7={'document':fs_1[_0x34f631(0x228)]['readFileSync'](_0x413da9),'caption':_0x32da3c?_0x32da3c:null,'fileName':_0x185b07,'mimetype':_0x5c86b9};else _0x178183===_0x34f631(0x1f6)?_0x5c5cb7={'document':fs_1['default'][_0x34f631(0x1df)](_0x413da9),'caption':_0x32da3c?_0x32da3c:null,'fileName':_0x185b07,'mimetype':_0x5c86b9}:_0x5c5cb7={'image':fs_1[_0x34f631(0x228)]['readFileSync'](_0x413da9),'caption':_0x32da3c?_0x32da3c:null};}}return _0x5c5cb7;}catch(_0x544ff5){return Sentry[_0x34f631(0x1f8)](_0x544ff5),console['log'](_0x544ff5),null;}};exports[a548_0x1c0286(0x233)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0xf2cc74,ticket:_0x32bc62,body:_0x455f90})=>{const _0x4910f3=a548_0x1c0286;try{const _0x553c73=await(0x0,GetTicketWbot_1[_0x4910f3(0x228)])(_0x32bc62),_0x591391=_0xf2cc74[_0x4910f3(0x1db)],_0x36c414=_0xf2cc74[_0x4910f3(0x1f4)][_0x4910f3(0x1fc)]('/')[0x0];let _0x538f78;const _0x4787c4=(0x0,Mustache_1['default'])(_0x455f90,_0x32bc62);var _0x306241=_0xf2cc74['filename'];if(_0x36c414==='video')_0x538f78={'video':fs_1[_0x4910f3(0x228)][_0x4910f3(0x1df)](_0x591391),'caption':_0x4787c4,'fileName':_0xf2cc74['originalname']};else{if(_0x36c414===_0x4910f3(0x1e2)){const _0x2da0d1=_0xf2cc74[_0x4910f3(0x1dc)]['includes'](_0x4910f3(0x237));if(_0x2da0d1){const _0x5f1f2a=await processAudio(_0xf2cc74[_0x4910f3(0x1db)],_0x32bc62['companyId']);_0x538f78={'audio':fs_1['default'][_0x4910f3(0x1df)](_0x5f1f2a),'mimetype':_0x2da0d1?_0x4910f3(0x1dd):_0xf2cc74['mimetype'],'ptt':!![]},_0x306241=_0x5f1f2a[_0x4910f3(0x1fc)]('/')[_0x5f1f2a[_0x4910f3(0x1fc)]('/')[_0x4910f3(0x1fd)]-0x1];}else{const _0x448252=await processAudioFile(_0xf2cc74[_0x4910f3(0x1db)]);_0x538f78={'audio':fs_1['default'][_0x4910f3(0x1df)](_0x448252),'mimetype':_0x2da0d1?_0x4910f3(0x1dd):_0xf2cc74['mimetype']},_0x306241=_0x448252[_0x4910f3(0x1fc)]('/')[_0x448252[_0x4910f3(0x1fc)]('/')[_0x4910f3(0x1fd)]-0x1];}}else{if(_0x36c414===_0x4910f3(0x1ff)||_0x36c414===_0x4910f3(0x1f2))_0x538f78={'document':fs_1['default'][_0x4910f3(0x1df)](_0x591391),'caption':_0x4787c4,'fileName':_0xf2cc74[_0x4910f3(0x1dc)],'mimetype':_0xf2cc74[_0x4910f3(0x1f4)]};else _0x36c414===_0x4910f3(0x1f6)?_0x538f78={'document':fs_1[_0x4910f3(0x228)][_0x4910f3(0x1df)](_0x591391),'caption':_0x4787c4,'fileName':_0xf2cc74['originalname'],'mimetype':_0xf2cc74[_0x4910f3(0x1f4)]}:_0x538f78={'image':fs_1[_0x4910f3(0x228)][_0x4910f3(0x1df)](_0x591391),'caption':_0x4787c4};}}var _0x4df0a4=await _0x553c73[_0x4910f3(0x206)](_0x32bc62[_0x4910f3(0x239)][_0x4910f3(0x1f0)]+'@'+(_0x32bc62[_0x4910f3(0x1f9)]?_0x4910f3(0x20c):_0x4910f3(0x21b)),{..._0x538f78});const _0x386552=await(0x0,wbotMessageListener_1[_0x4910f3(0x227)])(_0x4df0a4),_0x46f227={'id':_0x4df0a4['key']['id'],'ticketId':_0x32bc62['id'],'contactId':undefined,'body':_0x455f90?(0x0,Mustache_1[_0x4910f3(0x228)])(_0x455f90,_0x32bc62):(0x0,wbotMessageListener_1[_0x4910f3(0x235)])(_0x4df0a4),'fromMe':_0x4df0a4[_0x4910f3(0x20b)][_0x4910f3(0x219)],'read':_0x4df0a4[_0x4910f3(0x20b)][_0x4910f3(0x219)],'mediaUrl':_0x306241,'mediaType':_0x36c414,'quotedMsgId':_0x386552?.['id'],'ack':0x0,'remoteJid':_0x4df0a4[_0x4910f3(0x20b)][_0x4910f3(0x1f3)],'participant':_0x4df0a4[_0x4910f3(0x20b)][_0x4910f3(0x23b)],'dataJson':JSON[_0x4910f3(0x1f7)](_0x4df0a4)};return typeof _0x46f227[_0x4910f3(0x1ea)]!='string'&&console[_0x4910f3(0x1e7)](_0x4910f3(0x215),_0x46f227[_0x4910f3(0x1ea)]),await _0x32bc62[_0x4910f3(0x224)]({'lastMessage':_0x46f227[_0x4910f3(0x1ea)]}),await(0x0,CreateMessageService_1[_0x4910f3(0x228)])({'messageData':_0x46f227,'ticket':_0x32bc62,'companyId':_0x32bc62[_0x4910f3(0x22f)]}),_0x4df0a4;}catch(_0x3a6784){Sentry[_0x4910f3(0x1f8)](_0x3a6784),console['trace'](_0x3a6784);throw new AppError_1[(_0x4910f3(0x228))](_0x4910f3(0x22a));}};exports[a548_0x1c0286(0x228)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x49d168,_0x3c1ce4,_0x271693)=>{const _0x4eaae7=a548_0x1c0286;try{const _0x2c3e64=await(0x0,GetTicketWbot_1[_0x4eaae7(0x228)])(_0x3c1ce4);_0x49d168['startsWith'](_0x4eaae7(0x212))&&(_0x49d168=_0x4eaae7(0x210)+_0x49d168[_0x4eaae7(0x1fc)](_0x4eaae7(0x1ed))[0x1]);const _0x35e7bd=_0x49d168,_0xa860c9=getMimeType(_0x49d168)[_0x4eaae7(0x1fc)]('/')[0x0];let _0x17364a;if(_0xa860c9===_0x4eaae7(0x229))_0x17364a={'video':fs_1[_0x4eaae7(0x228)][_0x4eaae7(0x1df)](_0x35e7bd),'caption':_0x271693,'fileName':extractFileName(_0x49d168)};else{if(_0xa860c9==='audio'){const _0x1d165b=_0x49d168[_0x4eaae7(0x231)](_0x4eaae7(0x237));if(_0x1d165b){const _0x147b29=await processAudio(_0x49d168,_0x3c1ce4[_0x4eaae7(0x22f)]);_0x17364a={'audio':fs_1['default']['readFileSync'](_0x147b29),'mimetype':_0x1d165b?_0x4eaae7(0x1dd):getMimeType(_0x49d168),'ptt':!![]};}else{const _0x32ad46=await processAudioFile(_0x49d168);_0x17364a={'audio':fs_1[_0x4eaae7(0x228)][_0x4eaae7(0x1df)](_0x32ad46),'mimetype':_0x1d165b?'audio/mp4':getMimeType(_0x49d168)};}}else{if(_0xa860c9===_0x4eaae7(0x1ff)||_0xa860c9==='text')_0x17364a={'document':fs_1[_0x4eaae7(0x228)][_0x4eaae7(0x1df)](_0x35e7bd),'caption':_0x271693,'fileName':extractFileName(_0x49d168),'mimetype':getMimeType(_0x49d168)};else _0xa860c9===_0x4eaae7(0x1f6)?_0x17364a={'document':fs_1[_0x4eaae7(0x228)][_0x4eaae7(0x1df)](_0x35e7bd),'caption':_0x271693,'fileName':extractFileName(_0x49d168),'mimetype':getMimeType(_0x49d168)}:_0x17364a={'image':fs_1[_0x4eaae7(0x228)][_0x4eaae7(0x1df)](_0x35e7bd),'caption':_0x271693};}}const _0x20b830=await _0x2c3e64[_0x4eaae7(0x206)](_0x3c1ce4[_0x4eaae7(0x239)][_0x4eaae7(0x1f0)]+'@'+(_0x3c1ce4[_0x4eaae7(0x1f9)]?_0x4eaae7(0x20c):_0x4eaae7(0x21b)),{..._0x17364a});return _0x20b830;}catch(_0x3016e9){Sentry[_0x4eaae7(0x1f8)](_0x3016e9),console[_0x4eaae7(0x230)](_0x3016e9);throw new AppError_1['default'](_0x4eaae7(0x22a));}};exports[a548_0x1c0286(0x20e)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x466876=>{const _0x3d37ce=a548_0x1c0286,_0x41678a=_0x466876[_0x3d37ce(0x1fc)]('/');return _0x41678a[_0x41678a[_0x3d37ce(0x1fd)]-0x1];},extractFilePath=_0x2e4467=>{const _0x4f74df=a548_0x1c0286,_0x5173fa=_0x2e4467[_0x4f74df(0x1fc)]('/');return _0x5173fa[_0x4f74df(0x1e8)](),_0x5173fa[_0x4f74df(0x225)]('/');},getMimeType=_0x5cbe7f=>{const _0x38a6f4=a548_0x1c0286,_0x28ba88=_0x5cbe7f[_0x38a6f4(0x1fc)]('.'),_0x140404=_0x28ba88[_0x28ba88['length']-0x1],_0x35df07={'jpg':_0x38a6f4(0x205),'jpeg':'image/jpeg','png':'image/png','gif':_0x38a6f4(0x1e9),'mp4':_0x38a6f4(0x21d),'mp3':'audio/mp3','m4a':'audio/mp4','ogg':_0x38a6f4(0x218),'pdf':'application/pdf','doc':_0x38a6f4(0x1d9),'docx':_0x38a6f4(0x217),'xls':_0x38a6f4(0x234),'xlsx':_0x38a6f4(0x1fa),'ppt':_0x38a6f4(0x1fe),'pptx':_0x38a6f4(0x202),'txt':_0x38a6f4(0x1d7),'rtf':_0x38a6f4(0x22b),'csv':'text/csv','html':_0x38a6f4(0x232),'zip':_0x38a6f4(0x1e0),'rar':_0x38a6f4(0x21c),'7z':_0x38a6f4(0x20f),'3gp':'video/3gpp','3g2':'video/3gpp2','3ga':_0x38a6f4(0x1d6),'7gp':_0x38a6f4(0x22e),'7ga':'video/3gpp','3gpp':_0x38a6f4(0x1d6),'3gpp2':_0x38a6f4(0x22e),'7gpp':'video/3gpp','7gpp2':_0x38a6f4(0x22e),'3gpp-tt':_0x38a6f4(0x1d6),'3gpp2-tt':'video/3gpp2','7gpp-tt':'video/3gpp','7gpp2-tt':'video/3gpp2','3gpp-rtt':_0x38a6f4(0x1d6),'3gpp2-rtt':'video/3gpp2','7gpp-rtt':_0x38a6f4(0x1d6),'7gpp2-rtt':_0x38a6f4(0x22e),'3gpp-sms':_0x38a6f4(0x1d6),'3gpp2-sms':_0x38a6f4(0x22e),'7gpp-sms':_0x38a6f4(0x1d6),'7gpp2-sms':_0x38a6f4(0x22e),'pdfa':_0x38a6f4(0x1e5),'x-pdf':_0x38a6f4(0x1e5)};if(_0x35df07[_0x140404])return _0x35df07[_0x140404];return _0x38a6f4(0x1fb);};