const a548_0x3fb1a4=a548_0x2696;(function(_0x1a2186,_0x53f4b7){const _0x373ea6=a548_0x2696,_0x51cb69=_0x1a2186();while(!![]){try{const _0x471b03=parseInt(_0x373ea6(0xd7))/0x1*(parseInt(_0x373ea6(0x100))/0x2)+-parseInt(_0x373ea6(0xfe))/0x3+-parseInt(_0x373ea6(0xdf))/0x4*(parseInt(_0x373ea6(0x111))/0x5)+-parseInt(_0x373ea6(0x10b))/0x6*(-parseInt(_0x373ea6(0x104))/0x7)+parseInt(_0x373ea6(0xf9))/0x8+parseInt(_0x373ea6(0x11b))/0x9*(parseInt(_0x373ea6(0x128))/0xa)+parseInt(_0x373ea6(0x12a))/0xb*(parseInt(_0x373ea6(0xf1))/0xc);if(_0x471b03===_0x53f4b7)break;else _0x51cb69['push'](_0x51cb69['shift']());}catch(_0x4b78f4){_0x51cb69['push'](_0x51cb69['shift']());}}}(a548_0x23e9,0x6184b));const a548_0x4b1cbb=(function(){let _0x2da5ea=!![];return function(_0x2eb8d6,_0x37f0b4){const _0xb16989=_0x2da5ea?function(){if(_0x37f0b4){const _0x19694a=_0x37f0b4['apply'](_0x2eb8d6,arguments);return _0x37f0b4=null,_0x19694a;}}:function(){};return _0x2da5ea=![],_0xb16989;};}()),a548_0x57b286=a548_0x4b1cbb(this,function(){const _0x536ef5=a548_0x2696;return a548_0x57b286[_0x536ef5(0xf5)]()['search'](_0x536ef5(0xe2))[_0x536ef5(0xf5)]()[_0x536ef5(0xfa)](a548_0x57b286)[_0x536ef5(0x12c)]('(((.+)+)+)+$');});function a548_0x23e9(){const _0x54dcfe=['default','create','originalname','pop','.mp3','576988rsDSCf','prototype','body\x20is\x20not\x20a\x20string','(((.+)+)+)+$','application/pdf','Invalid\x20mimetype','getMessageOptions','verifyQuotedMessage','defineProperty','video/3gpp','ffmpeg-static','/public','string','startsWith','SendWhatsAppMediaFileAddress','sendMessage','mime-types','remoteJid','7696044FpvktD','fromMe','getOwnPropertyDescriptor','getTime','toString','../../helpers/GetTicketWbot','participant','exec','1699032pEflIG','constructor','resolve','key','@sentry/node','650094ofqiyG','application/rtf','8thvhcy','__esModule','video','configurable','288344DWXVcL','application','companyId','length','getBodyMessage','application/x-rar-compressed','unlinkSync','6IkuvZA','ERR_SENDING_WAPP_MSG','\x20-i\x20','\x20-y','application/vnd.ms-powerpoint','application/vnd.openxmlformats-officedocument.wordprocessingml.document','25HvEAeL','trace','join','application/octet-stream','application/vnd.openxmlformats-officedocument.presentationml.presentation','setFfmpegPath','stringify','log','mimetype','text/plain','36ItdhPw','text/html','body','image/jpeg','split','lookup','__createBinding','text','__importDefault','image/gif','readFileSync','path','http','581220CiwFkE','audio/mp3','11VTGtCr','document','search','text/csv','includes','filename','s.whatsapp.net','captureException','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','application/vnd.ms-excel','video/3gpp2','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','audio/mp4','application/msword','application/x-7z-compressed','audio','contact','/company','image/png','isGroup','video/mp4','../../errors/AppError','hasOwnProperty','call','52493cwSwGk','application/zip','audio-record-site'];a548_0x23e9=function(){return _0x54dcfe;};return a548_0x23e9();}a548_0x57b286();'use strict';function a548_0x2696(_0x452205,_0x1ce2bf){const _0x1bb5e7=a548_0x23e9();return a548_0x2696=function(_0x57b286,_0x4b1cbb){_0x57b286=_0x57b286-0xd0;let _0x23e91e=_0x1bb5e7[_0x57b286];return _0x23e91e;},a548_0x2696(_0x452205,_0x1ce2bf);}var __createBinding=this&&this[a548_0x3fb1a4(0x121)]||(Object[a548_0x3fb1a4(0xdb)]?function(_0x95b7f1,_0x174725,_0x932d4b,_0x10445d){const _0x26e4c0=a548_0x3fb1a4;if(_0x10445d===undefined)_0x10445d=_0x932d4b;var _0x3bc47a=Object[_0x26e4c0(0xf3)](_0x174725,_0x932d4b);(!_0x3bc47a||('get'in _0x3bc47a?!_0x174725['__esModule']:_0x3bc47a['writable']||_0x3bc47a[_0x26e4c0(0x103)]))&&(_0x3bc47a={'enumerable':!![],'get':function(){return _0x174725[_0x932d4b];}}),Object[_0x26e4c0(0xe7)](_0x95b7f1,_0x10445d,_0x3bc47a);}:function(_0x48d646,_0x3363a9,_0x33768c,_0x1a1385){if(_0x1a1385===undefined)_0x1a1385=_0x33768c;_0x48d646[_0x1a1385]=_0x3363a9[_0x33768c];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a548_0x3fb1a4(0xdb)]?function(_0x3e683a,_0x5edab0){const _0x166261=a548_0x3fb1a4;Object[_0x166261(0xe7)](_0x3e683a,_0x166261(0xda),{'enumerable':!![],'value':_0x5edab0});}:function(_0x1cfbee,_0x3b6103){const _0x33f89b=a548_0x3fb1a4;_0x1cfbee[_0x33f89b(0xda)]=_0x3b6103;}),__importStar=this&&this['__importStar']||function(_0x121c01){const _0x253846=a548_0x3fb1a4;if(_0x121c01&&_0x121c01[_0x253846(0x101)])return _0x121c01;var _0x2ba2c0={};if(_0x121c01!=null){for(var _0x189868 in _0x121c01)if(_0x189868!==_0x253846(0xda)&&Object[_0x253846(0xe0)][_0x253846(0xd5)][_0x253846(0xd6)](_0x121c01,_0x189868))__createBinding(_0x2ba2c0,_0x121c01,_0x189868);}return __setModuleDefault(_0x2ba2c0,_0x121c01),_0x2ba2c0;},__importDefault=this&&this[a548_0x3fb1a4(0x123)]||function(_0x7bf482){const _0x9162b6=a548_0x3fb1a4;return _0x7bf482&&_0x7bf482[_0x9162b6(0x101)]?_0x7bf482:{'default':_0x7bf482};};Object[a548_0x3fb1a4(0xe7)](exports,a548_0x3fb1a4(0x101),{'value':!![]}),exports[a548_0x3fb1a4(0xed)]=exports[a548_0x3fb1a4(0xe5)]=void 0x0;const Sentry=__importStar(require(a548_0x3fb1a4(0xfd))),fs_1=__importDefault(require('fs')),child_process_1=require('child_process'),path_1=__importDefault(require(a548_0x3fb1a4(0x126))),fluent_ffmpeg_1=__importDefault(require('fluent-ffmpeg')),AppError_1=__importDefault(require(a548_0x3fb1a4(0xd4))),GetTicketWbot_1=__importDefault(require(a548_0x3fb1a4(0xf6))),mime_types_1=__importDefault(require(a548_0x3fb1a4(0xef))),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require(a548_0x3fb1a4(0xe9))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require('./wbotMessageListener');fluent_ffmpeg_1[a548_0x3fb1a4(0xda)][a548_0x3fb1a4(0x116)](ffmpeg_static_1[a548_0x3fb1a4(0xda)]);const publicFolder=path_1[a548_0x3fb1a4(0xda)][a548_0x3fb1a4(0xfb)](__dirname,'..','..','..','public'),processAudio=async(_0x42fc4b,_0x198404)=>{const _0x2621b1=a548_0x3fb1a4,_0x534f6c=publicFolder+_0x2621b1(0xd0)+_0x198404+'/'+new Date()[_0x2621b1(0xf4)]()+'.mp3';return new Promise((_0x4b819b,_0x582550)=>{const _0x18f8f4=_0x2621b1;(0x0,child_process_1[_0x18f8f4(0xf8)])(ffmpeg_static_1[_0x18f8f4(0xda)]+_0x18f8f4(0x10d)+_0x42fc4b+_0x18f8f4(0x135)+_0x534f6c+_0x18f8f4(0x10e),(_0x329642,_0x474df6,_0x274ac8)=>{const _0xf0604e=_0x18f8f4;if(_0x329642)_0x582550(_0x329642);fs_1[_0xf0604e(0xda)][_0xf0604e(0x10a)](_0x42fc4b),_0x4b819b(_0x534f6c);});});},processAudioFile=async _0x50f334=>{const _0x32636b=a548_0x3fb1a4,_0x5d4597=publicFolder+'/'+new Date()[_0x32636b(0xf4)]()+_0x32636b(0xde);return new Promise((_0x2d5e70,_0x438b59)=>{const _0x5dc14e=_0x32636b;(0x0,child_process_1[_0x5dc14e(0xf8)])(ffmpeg_static_1['default']+_0x5dc14e(0x10d)+_0x50f334+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x5d4597,(_0x26deb0,_0x3f1027,_0x6cd8f5)=>{const _0x346c20=_0x5dc14e;if(_0x26deb0)_0x438b59(_0x26deb0);fs_1[_0x346c20(0xda)][_0x346c20(0x10a)](_0x50f334),_0x2d5e70(_0x5d4597);});});},getMessageOptions=async(_0x10b94a,_0x5eee3c,_0x12960f,_0x15398f)=>{const _0x38add4=a548_0x3fb1a4,_0x1de91d=mime_types_1[_0x38add4(0xda)][_0x38add4(0x120)](_0x5eee3c),_0x224a2a=_0x1de91d[_0x38add4(0x11f)]('/')[0x0];try{if(!_0x1de91d)throw new Error(_0x38add4(0xe4));let _0x4eb53c;if(_0x224a2a===_0x38add4(0x102))_0x4eb53c={'video':fs_1['default']['readFileSync'](_0x5eee3c),'caption':_0x12960f?_0x12960f:'','fileName':_0x10b94a};else{if(_0x224a2a==='audio'){const _0x402bc1=!![],_0x562031=await processAudio(_0x5eee3c,_0x15398f);_0x402bc1?_0x4eb53c={'audio':fs_1[_0x38add4(0xda)]['readFileSync'](_0x562031),'mimetype':_0x402bc1?'audio/mp4':_0x1de91d,'caption':_0x12960f?_0x12960f:null,'ptt':!![]}:_0x4eb53c={'audio':fs_1[_0x38add4(0xda)][_0x38add4(0x125)](_0x562031),'mimetype':_0x402bc1?_0x38add4(0x136):_0x1de91d,'caption':_0x12960f?_0x12960f:null,'ptt':!![]};}else{if(_0x224a2a===_0x38add4(0x12b))_0x4eb53c={'document':fs_1['default'][_0x38add4(0x125)](_0x5eee3c),'caption':_0x12960f?_0x12960f:null,'fileName':_0x10b94a,'mimetype':_0x1de91d};else _0x224a2a==='application'?_0x4eb53c={'document':fs_1[_0x38add4(0xda)][_0x38add4(0x125)](_0x5eee3c),'caption':_0x12960f?_0x12960f:null,'fileName':_0x10b94a,'mimetype':_0x1de91d}:_0x4eb53c={'image':fs_1[_0x38add4(0xda)]['readFileSync'](_0x5eee3c),'caption':_0x12960f?_0x12960f:null};}}return _0x4eb53c;}catch(_0x280879){return Sentry[_0x38add4(0x131)](_0x280879),console[_0x38add4(0x118)](_0x280879),null;}};exports[a548_0x3fb1a4(0xe5)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x1b1c55,ticket:_0x40c2f0,body:_0x5745ef})=>{const _0x8db05=a548_0x3fb1a4;try{const _0x3878c6=await(0x0,GetTicketWbot_1[_0x8db05(0xda)])(_0x40c2f0),_0x252f93=_0x1b1c55[_0x8db05(0x126)],_0xe61eec=_0x1b1c55[_0x8db05(0x119)][_0x8db05(0x11f)]('/')[0x0];let _0x5204c6;const _0x59b614=(0x0,Mustache_1['default'])(_0x5745ef,_0x40c2f0);var _0x7344a7=_0x1b1c55[_0x8db05(0x12f)];if(_0xe61eec===_0x8db05(0x102))_0x5204c6={'video':fs_1[_0x8db05(0xda)][_0x8db05(0x125)](_0x252f93),'caption':_0x59b614,'fileName':_0x1b1c55[_0x8db05(0xdc)]};else{if(_0xe61eec===_0x8db05(0x139)){const _0x5404b3=_0x1b1c55[_0x8db05(0xdc)][_0x8db05(0x12e)](_0x8db05(0xd9));if(_0x5404b3){const _0x4f8cb9=await processAudio(_0x1b1c55['path'],_0x40c2f0['companyId']);_0x5204c6={'audio':fs_1[_0x8db05(0xda)]['readFileSync'](_0x4f8cb9),'mimetype':_0x5404b3?_0x8db05(0x136):_0x1b1c55[_0x8db05(0x119)],'ptt':!![]},_0x7344a7=_0x4f8cb9[_0x8db05(0x11f)]('/')[_0x4f8cb9[_0x8db05(0x11f)]('/')['length']-0x1];}else{const _0x4b679a=await processAudioFile(_0x1b1c55[_0x8db05(0x126)]);_0x5204c6={'audio':fs_1[_0x8db05(0xda)][_0x8db05(0x125)](_0x4b679a),'mimetype':_0x5404b3?_0x8db05(0x136):_0x1b1c55[_0x8db05(0x119)]},_0x7344a7=_0x4b679a[_0x8db05(0x11f)]('/')[_0x4b679a[_0x8db05(0x11f)]('/')[_0x8db05(0x107)]-0x1];}}else{if(_0xe61eec===_0x8db05(0x12b)||_0xe61eec===_0x8db05(0x122))_0x5204c6={'document':fs_1[_0x8db05(0xda)]['readFileSync'](_0x252f93),'caption':_0x59b614,'fileName':_0x1b1c55[_0x8db05(0xdc)],'mimetype':_0x1b1c55[_0x8db05(0x119)]};else _0xe61eec===_0x8db05(0x105)?_0x5204c6={'document':fs_1[_0x8db05(0xda)]['readFileSync'](_0x252f93),'caption':_0x59b614,'fileName':_0x1b1c55[_0x8db05(0xdc)],'mimetype':_0x1b1c55[_0x8db05(0x119)]}:_0x5204c6={'image':fs_1[_0x8db05(0xda)][_0x8db05(0x125)](_0x252f93),'caption':_0x59b614};}}var _0x148da0=await _0x3878c6[_0x8db05(0xee)](_0x40c2f0[_0x8db05(0x13a)]['number']+'@'+(_0x40c2f0[_0x8db05(0xd2)]?'g.us':_0x8db05(0x130)),{..._0x5204c6});const _0xa69fe2=await(0x0,wbotMessageListener_1[_0x8db05(0xe6)])(_0x148da0),_0x14ce27={'id':_0x148da0['key']['id'],'ticketId':_0x40c2f0['id'],'contactId':undefined,'body':_0x5745ef?(0x0,Mustache_1[_0x8db05(0xda)])(_0x5745ef,_0x40c2f0):(0x0,wbotMessageListener_1[_0x8db05(0x108)])(_0x148da0),'fromMe':_0x148da0[_0x8db05(0xfc)]['fromMe'],'read':_0x148da0[_0x8db05(0xfc)][_0x8db05(0xf2)],'mediaUrl':_0x7344a7,'mediaType':_0xe61eec,'quotedMsgId':_0xa69fe2?.['id'],'ack':0x0,'remoteJid':_0x148da0[_0x8db05(0xfc)][_0x8db05(0xf0)],'participant':_0x148da0[_0x8db05(0xfc)][_0x8db05(0xf7)],'dataJson':JSON[_0x8db05(0x117)](_0x148da0)};return typeof _0x14ce27[_0x8db05(0x11d)]!=_0x8db05(0xeb)&&console[_0x8db05(0x112)](_0x8db05(0xe1),_0x14ce27[_0x8db05(0x11d)]),await _0x40c2f0['update']({'lastMessage':_0x14ce27[_0x8db05(0x11d)]}),await(0x0,CreateMessageService_1[_0x8db05(0xda)])({'messageData':_0x14ce27,'ticket':_0x40c2f0,'companyId':_0x40c2f0[_0x8db05(0x106)]}),_0x148da0;}catch(_0x1502ff){Sentry[_0x8db05(0x131)](_0x1502ff),console[_0x8db05(0x112)](_0x1502ff);throw new AppError_1[(_0x8db05(0xda))]('ERR_SENDING_WAPP_MSG');}};exports[a548_0x3fb1a4(0xda)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x26a977,_0x4ce2ce,_0x5527f0)=>{const _0x26c7d5=a548_0x3fb1a4;try{const _0x1e78da=await(0x0,GetTicketWbot_1[_0x26c7d5(0xda)])(_0x4ce2ce);_0x26a977[_0x26c7d5(0xec)](_0x26c7d5(0x127))&&(_0x26a977='./public'+_0x26a977['split'](_0x26c7d5(0xea))[0x1]);const _0x1c4102=_0x26a977,_0x5e4e0b=getMimeType(_0x26a977)[_0x26c7d5(0x11f)]('/')[0x0];let _0xc6c7f;if(_0x5e4e0b==='video')_0xc6c7f={'video':fs_1['default'][_0x26c7d5(0x125)](_0x1c4102),'caption':_0x5527f0,'fileName':extractFileName(_0x26a977)};else{if(_0x5e4e0b==='audio'){const _0x415ee5=_0x26a977[_0x26c7d5(0x12e)]('audio-record-site');if(_0x415ee5){const _0x42f3d8=await processAudio(_0x26a977,_0x4ce2ce['companyId']);_0xc6c7f={'audio':fs_1[_0x26c7d5(0xda)]['readFileSync'](_0x42f3d8),'mimetype':_0x415ee5?_0x26c7d5(0x136):getMimeType(_0x26a977),'ptt':!![]};}else{const _0x4d67e5=await processAudioFile(_0x26a977);_0xc6c7f={'audio':fs_1[_0x26c7d5(0xda)][_0x26c7d5(0x125)](_0x4d67e5),'mimetype':_0x415ee5?_0x26c7d5(0x136):getMimeType(_0x26a977)};}}else{if(_0x5e4e0b===_0x26c7d5(0x12b)||_0x5e4e0b===_0x26c7d5(0x122))_0xc6c7f={'document':fs_1[_0x26c7d5(0xda)][_0x26c7d5(0x125)](_0x1c4102),'caption':_0x5527f0,'fileName':extractFileName(_0x26a977),'mimetype':getMimeType(_0x26a977)};else _0x5e4e0b===_0x26c7d5(0x105)?_0xc6c7f={'document':fs_1[_0x26c7d5(0xda)][_0x26c7d5(0x125)](_0x1c4102),'caption':_0x5527f0,'fileName':extractFileName(_0x26a977),'mimetype':getMimeType(_0x26a977)}:_0xc6c7f={'image':fs_1[_0x26c7d5(0xda)]['readFileSync'](_0x1c4102),'caption':_0x5527f0};}}const _0x4f55ec=await _0x1e78da[_0x26c7d5(0xee)](_0x4ce2ce[_0x26c7d5(0x13a)]['number']+'@'+(_0x4ce2ce[_0x26c7d5(0xd2)]?'g.us':_0x26c7d5(0x130)),{..._0xc6c7f});return _0x4f55ec;}catch(_0x423a71){Sentry[_0x26c7d5(0x131)](_0x423a71),console[_0x26c7d5(0x118)](_0x423a71);throw new AppError_1[(_0x26c7d5(0xda))](_0x26c7d5(0x10c));}};exports[a548_0x3fb1a4(0xed)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x143e5c=>{const _0x22cc47=a548_0x3fb1a4,_0x6ff7e=_0x143e5c[_0x22cc47(0x11f)]('/');return _0x6ff7e[_0x6ff7e[_0x22cc47(0x107)]-0x1];},extractFilePath=_0x14eb31=>{const _0x1a7bf2=a548_0x3fb1a4,_0x2e244d=_0x14eb31[_0x1a7bf2(0x11f)]('/');return _0x2e244d[_0x1a7bf2(0xdd)](),_0x2e244d[_0x1a7bf2(0x113)]('/');},getMimeType=_0x93d675=>{const _0x2d3a6f=a548_0x3fb1a4,_0x5b31bd=_0x93d675[_0x2d3a6f(0x11f)]('.'),_0x4b633d=_0x5b31bd[_0x5b31bd[_0x2d3a6f(0x107)]-0x1],_0x3028f8={'jpg':_0x2d3a6f(0x11e),'jpeg':_0x2d3a6f(0x11e),'png':_0x2d3a6f(0xd1),'gif':_0x2d3a6f(0x124),'mp4':_0x2d3a6f(0xd3),'mp3':_0x2d3a6f(0x129),'m4a':_0x2d3a6f(0x136),'ogg':'audio/ogg','pdf':_0x2d3a6f(0xe3),'doc':_0x2d3a6f(0x137),'docx':_0x2d3a6f(0x110),'xls':_0x2d3a6f(0x133),'xlsx':_0x2d3a6f(0x132),'ppt':_0x2d3a6f(0x10f),'pptx':_0x2d3a6f(0x115),'txt':_0x2d3a6f(0x11a),'rtf':_0x2d3a6f(0xff),'csv':_0x2d3a6f(0x12d),'html':_0x2d3a6f(0x11c),'zip':_0x2d3a6f(0xd8),'rar':_0x2d3a6f(0x109),'7z':_0x2d3a6f(0x138),'3gp':'video/3gpp','3g2':'video/3gpp2','3ga':'video/3gpp','7gp':_0x2d3a6f(0x134),'7ga':'video/3gpp','3gpp':_0x2d3a6f(0xe8),'3gpp2':_0x2d3a6f(0x134),'7gpp':'video/3gpp','7gpp2':_0x2d3a6f(0x134),'3gpp-tt':_0x2d3a6f(0xe8),'3gpp2-tt':_0x2d3a6f(0x134),'7gpp-tt':'video/3gpp','7gpp2-tt':_0x2d3a6f(0x134),'3gpp-rtt':'video/3gpp','3gpp2-rtt':_0x2d3a6f(0x134),'7gpp-rtt':_0x2d3a6f(0xe8),'7gpp2-rtt':'video/3gpp2','3gpp-sms':'video/3gpp','3gpp2-sms':_0x2d3a6f(0x134),'7gpp-sms':_0x2d3a6f(0xe8),'7gpp2-sms':_0x2d3a6f(0x134),'pdfa':_0x2d3a6f(0xe3),'x-pdf':_0x2d3a6f(0xe3)};if(_0x3028f8[_0x4b633d])return _0x3028f8[_0x4b633d];return _0x2d3a6f(0x114);};