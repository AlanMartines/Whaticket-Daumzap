function a548_0x3495(_0x567606,_0x173fa3){const _0x26ba23=a548_0xf033();return a548_0x3495=function(_0x5cfca2,_0x296c8d){_0x5cfca2=_0x5cfca2-0x1c2;let _0xf033fc=_0x26ba23[_0x5cfca2];return _0xf033fc;},a548_0x3495(_0x567606,_0x173fa3);}const a548_0xab277f=a548_0x3495;(function(_0x360a70,_0x3ce988){const _0x83513b=a548_0x3495,_0x30bd5d=_0x360a70();while(!![]){try{const _0x4a22d1=-parseInt(_0x83513b(0x1ee))/0x1*(parseInt(_0x83513b(0x1dc))/0x2)+-parseInt(_0x83513b(0x1f2))/0x3*(parseInt(_0x83513b(0x224))/0x4)+-parseInt(_0x83513b(0x220))/0x5+parseInt(_0x83513b(0x1f9))/0x6*(-parseInt(_0x83513b(0x205))/0x7)+-parseInt(_0x83513b(0x206))/0x8*(parseInt(_0x83513b(0x20e))/0x9)+-parseInt(_0x83513b(0x1ff))/0xa*(-parseInt(_0x83513b(0x221))/0xb)+-parseInt(_0x83513b(0x1c5))/0xc*(-parseInt(_0x83513b(0x1fe))/0xd);if(_0x4a22d1===_0x3ce988)break;else _0x30bd5d['push'](_0x30bd5d['shift']());}catch(_0x26a841){_0x30bd5d['push'](_0x30bd5d['shift']());}}}(a548_0xf033,0xedc3d));function a548_0xf033(){const _0x5d3cb6=['readFileSync','SendWhatsAppMediaFileAddress','stringify','./public','participant','application','918264LLRpaG','getMessageOptions','log','video/mp4','create','21868873OTpeBr','17455030zngRPV','constructor','public','(((.+)+)+)+$','sendMessage','text/csv','28AlSsRG','21200BWBUVL','application/vnd.ms-powerpoint','application/vnd.ms-excel','getOwnPropertyDescriptor','writable','prototype','pop','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','3384GNcczz','application/pdf','contact','text','originalname','body\x20is\x20not\x20a\x20string','text/html','key','resolve','../../errors/AppError','trace','application/x-7z-compressed','fromMe','update','path','startsWith','g.us','application/zip','6819350wMFdUA','11EDFURY','companyId','../MessageServices/CreateMessageService','5556844vJHxDB','.mp3','/company','application/vnd.openxmlformats-officedocument.wordprocessingml.document','\x20-i\x20','s.whatsapp.net','body','document','image/png','36fkiwWU','includes','application/rtf','audio-record-site','string','lookup','video/3gpp2','remoteJid','search','Invalid\x20mimetype','getTime','image/jpeg','number','__importDefault','video','mime-types','\x20-y','configurable','text/plain','get','defineProperty','exec','../../helpers/GetTicketWbot','56024avJBzC','isGroup','video/3gpp','__importStar','audio','default','child_process','split','captureException','length','application/octet-stream','filename','application/x-rar-compressed','mimetype','toString','ffmpeg-static','__esModule','__setModuleDefault','52eNGiCS','/public','getBodyMessage','audio/mp4','3asQKKg'];a548_0xf033=function(){return _0x5d3cb6;};return a548_0xf033();}const a548_0x296c8d=(function(){let _0xeec6b5=!![];return function(_0x317f5a,_0x37cb8f){const _0x606f2b=_0xeec6b5?function(){if(_0x37cb8f){const _0x3eee88=_0x37cb8f['apply'](_0x317f5a,arguments);return _0x37cb8f=null,_0x3eee88;}}:function(){};return _0xeec6b5=![],_0x606f2b;};}()),a548_0x5cfca2=a548_0x296c8d(this,function(){const _0x241f1c=a548_0x3495;return a548_0x5cfca2['toString']()[_0x241f1c(0x1cd)](_0x241f1c(0x202))[_0x241f1c(0x1ea)]()[_0x241f1c(0x200)](a548_0x5cfca2)[_0x241f1c(0x1cd)](_0x241f1c(0x202));});a548_0x5cfca2();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a548_0xab277f(0x1fd)]?function(_0x2bb4ef,_0x1fefb9,_0x2571fd,_0x411e16){const _0x235b9c=a548_0xab277f;if(_0x411e16===undefined)_0x411e16=_0x2571fd;var _0x231eee=Object[_0x235b9c(0x209)](_0x1fefb9,_0x2571fd);(!_0x231eee||(_0x235b9c(0x1d8)in _0x231eee?!_0x1fefb9[_0x235b9c(0x1ec)]:_0x231eee[_0x235b9c(0x20a)]||_0x231eee[_0x235b9c(0x1d6)]))&&(_0x231eee={'enumerable':!![],'get':function(){return _0x1fefb9[_0x2571fd];}}),Object['defineProperty'](_0x2bb4ef,_0x411e16,_0x231eee);}:function(_0x4f97cb,_0x3a5b13,_0x32bce8,_0x3083fa){if(_0x3083fa===undefined)_0x3083fa=_0x32bce8;_0x4f97cb[_0x3083fa]=_0x3a5b13[_0x32bce8];}),__setModuleDefault=this&&this[a548_0xab277f(0x1ed)]||(Object[a548_0xab277f(0x1fd)]?function(_0x4bbc0f,_0x2dfc64){const _0x22df3c=a548_0xab277f;Object[_0x22df3c(0x1d9)](_0x4bbc0f,'default',{'enumerable':!![],'value':_0x2dfc64});}:function(_0x38d10c,_0x67bf9c){_0x38d10c['default']=_0x67bf9c;}),__importStar=this&&this[a548_0xab277f(0x1df)]||function(_0x2f1c82){const _0x353f8d=a548_0xab277f;if(_0x2f1c82&&_0x2f1c82[_0x353f8d(0x1ec)])return _0x2f1c82;var _0xdf622c={};if(_0x2f1c82!=null){for(var _0x2cc859 in _0x2f1c82)if(_0x2cc859!=='default'&&Object[_0x353f8d(0x20b)]['hasOwnProperty']['call'](_0x2f1c82,_0x2cc859))__createBinding(_0xdf622c,_0x2f1c82,_0x2cc859);}return __setModuleDefault(_0xdf622c,_0x2f1c82),_0xdf622c;},__importDefault=this&&this[a548_0xab277f(0x1d2)]||function(_0x67774f){const _0x179f5d=a548_0xab277f;return _0x67774f&&_0x67774f[_0x179f5d(0x1ec)]?_0x67774f:{'default':_0x67774f};};Object['defineProperty'](exports,a548_0xab277f(0x1ec),{'value':!![]}),exports[a548_0xab277f(0x1f4)]=exports[a548_0xab277f(0x1fa)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a548_0xab277f(0x1e2)),path_1=__importDefault(require(a548_0xab277f(0x21c))),fluent_ffmpeg_1=__importDefault(require('fluent-ffmpeg')),AppError_1=__importDefault(require(a548_0xab277f(0x217))),GetTicketWbot_1=__importDefault(require(a548_0xab277f(0x1db))),mime_types_1=__importDefault(require(a548_0xab277f(0x1d4))),Mustache_1=__importDefault(require('../../helpers/Mustache')),ffmpeg_static_1=__importDefault(require(a548_0xab277f(0x1eb))),CreateMessageService_1=__importDefault(require(a548_0xab277f(0x223))),wbotMessageListener_1=require('./wbotMessageListener');fluent_ffmpeg_1[a548_0xab277f(0x1e1)]['setFfmpegPath'](ffmpeg_static_1[a548_0xab277f(0x1e1)]);const publicFolder=path_1[a548_0xab277f(0x1e1)][a548_0xab277f(0x216)](__dirname,'..','..','..',a548_0xab277f(0x201)),processAudio=async(_0x11ef22,_0x3b2e1e)=>{const _0x2706d8=a548_0xab277f,_0x3837b4=publicFolder+_0x2706d8(0x226)+_0x3b2e1e+'/'+new Date()['getTime']()+_0x2706d8(0x225);return new Promise((_0x9bbb9a,_0x5dc19b)=>{const _0xc4d270=_0x2706d8;(0x0,child_process_1['exec'])(ffmpeg_static_1[_0xc4d270(0x1e1)]+'\x20-i\x20'+_0x11ef22+_0xc4d270(0x20d)+_0x3837b4+_0xc4d270(0x1d5),(_0x142a2b,_0x3ae229,_0x29f1f6)=>{const _0x25c94a=_0xc4d270;if(_0x142a2b)_0x5dc19b(_0x142a2b);fs_1[_0x25c94a(0x1e1)]['unlinkSync'](_0x11ef22),_0x9bbb9a(_0x3837b4);});});},processAudioFile=async _0x301a68=>{const _0x39a8e5=a548_0xab277f,_0x1e200c=publicFolder+'/'+new Date()[_0x39a8e5(0x1cf)]()+_0x39a8e5(0x225);return new Promise((_0x422e91,_0x715756)=>{const _0x1dd077=_0x39a8e5;(0x0,child_process_1[_0x1dd077(0x1da)])(ffmpeg_static_1[_0x1dd077(0x1e1)]+_0x1dd077(0x228)+_0x301a68+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x1e200c,(_0x381829,_0xd5c3fd,_0xf18b42)=>{const _0x5a84c0=_0x1dd077;if(_0x381829)_0x715756(_0x381829);fs_1[_0x5a84c0(0x1e1)]['unlinkSync'](_0x301a68),_0x422e91(_0x1e200c);});});},getMessageOptions=async(_0x2d24e7,_0x29362a,_0x3d8790,_0x49bbb5)=>{const _0x2670b4=a548_0xab277f,_0x369160=mime_types_1['default'][_0x2670b4(0x1ca)](_0x29362a),_0x40bc7c=_0x369160[_0x2670b4(0x1e3)]('/')[0x0];try{if(!_0x369160)throw new Error(_0x2670b4(0x1ce));let _0x1117fd;if(_0x40bc7c===_0x2670b4(0x1d3))_0x1117fd={'video':fs_1[_0x2670b4(0x1e1)][_0x2670b4(0x1f3)](_0x29362a),'caption':_0x3d8790?_0x3d8790:'','fileName':_0x2d24e7};else{if(_0x40bc7c===_0x2670b4(0x1e0)){const _0x221e1a=!![],_0x5554a1=await processAudio(_0x29362a,_0x49bbb5);_0x221e1a?_0x1117fd={'audio':fs_1[_0x2670b4(0x1e1)][_0x2670b4(0x1f3)](_0x5554a1),'mimetype':_0x221e1a?'audio/mp4':_0x369160,'caption':_0x3d8790?_0x3d8790:null,'ptt':!![]}:_0x1117fd={'audio':fs_1[_0x2670b4(0x1e1)][_0x2670b4(0x1f3)](_0x5554a1),'mimetype':_0x221e1a?_0x2670b4(0x1f1):_0x369160,'caption':_0x3d8790?_0x3d8790:null,'ptt':!![]};}else{if(_0x40bc7c===_0x2670b4(0x1c3))_0x1117fd={'document':fs_1[_0x2670b4(0x1e1)][_0x2670b4(0x1f3)](_0x29362a),'caption':_0x3d8790?_0x3d8790:null,'fileName':_0x2d24e7,'mimetype':_0x369160};else _0x40bc7c===_0x2670b4(0x1f8)?_0x1117fd={'document':fs_1[_0x2670b4(0x1e1)][_0x2670b4(0x1f3)](_0x29362a),'caption':_0x3d8790?_0x3d8790:null,'fileName':_0x2d24e7,'mimetype':_0x369160}:_0x1117fd={'image':fs_1[_0x2670b4(0x1e1)][_0x2670b4(0x1f3)](_0x29362a),'caption':_0x3d8790?_0x3d8790:null};}}return _0x1117fd;}catch(_0x18cd80){return Sentry[_0x2670b4(0x1e4)](_0x18cd80),console[_0x2670b4(0x1fb)](_0x18cd80),null;}};exports[a548_0xab277f(0x1fa)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x1f111f,ticket:_0x755281,body:_0x213bfc})=>{const _0x1d5244=a548_0xab277f;try{const _0x47d576=await(0x0,GetTicketWbot_1[_0x1d5244(0x1e1)])(_0x755281),_0x9d88d0=_0x1f111f[_0x1d5244(0x21c)],_0x4c6f93=_0x1f111f[_0x1d5244(0x1e9)][_0x1d5244(0x1e3)]('/')[0x0];let _0xddd2cf;const _0x1f97ac=(0x0,Mustache_1[_0x1d5244(0x1e1)])(_0x213bfc,_0x755281);var _0x2bc99b=_0x1f111f[_0x1d5244(0x1e7)];if(_0x4c6f93==='video')_0xddd2cf={'video':fs_1[_0x1d5244(0x1e1)][_0x1d5244(0x1f3)](_0x9d88d0),'caption':_0x1f97ac,'fileName':_0x1f111f[_0x1d5244(0x212)]};else{if(_0x4c6f93===_0x1d5244(0x1e0)){const _0x262b2e=_0x1f111f[_0x1d5244(0x212)][_0x1d5244(0x1c6)](_0x1d5244(0x1c8));if(_0x262b2e){const _0x3438cc=await processAudio(_0x1f111f[_0x1d5244(0x21c)],_0x755281[_0x1d5244(0x222)]);_0xddd2cf={'audio':fs_1['default'][_0x1d5244(0x1f3)](_0x3438cc),'mimetype':_0x262b2e?_0x1d5244(0x1f1):_0x1f111f[_0x1d5244(0x1e9)],'ptt':!![]},_0x2bc99b=_0x3438cc[_0x1d5244(0x1e3)]('/')[_0x3438cc[_0x1d5244(0x1e3)]('/')[_0x1d5244(0x1e5)]-0x1];}else{const _0x1fb33a=await processAudioFile(_0x1f111f[_0x1d5244(0x21c)]);_0xddd2cf={'audio':fs_1[_0x1d5244(0x1e1)][_0x1d5244(0x1f3)](_0x1fb33a),'mimetype':_0x262b2e?'audio/mp4':_0x1f111f['mimetype']},_0x2bc99b=_0x1fb33a[_0x1d5244(0x1e3)]('/')[_0x1fb33a[_0x1d5244(0x1e3)]('/')[_0x1d5244(0x1e5)]-0x1];}}else{if(_0x4c6f93===_0x1d5244(0x1c3)||_0x4c6f93==='text')_0xddd2cf={'document':fs_1['default'][_0x1d5244(0x1f3)](_0x9d88d0),'caption':_0x1f97ac,'fileName':_0x1f111f[_0x1d5244(0x212)],'mimetype':_0x1f111f['mimetype']};else _0x4c6f93===_0x1d5244(0x1f8)?_0xddd2cf={'document':fs_1[_0x1d5244(0x1e1)][_0x1d5244(0x1f3)](_0x9d88d0),'caption':_0x1f97ac,'fileName':_0x1f111f[_0x1d5244(0x212)],'mimetype':_0x1f111f[_0x1d5244(0x1e9)]}:_0xddd2cf={'image':fs_1[_0x1d5244(0x1e1)][_0x1d5244(0x1f3)](_0x9d88d0),'caption':_0x1f97ac};}}var _0x45ca26=await _0x47d576[_0x1d5244(0x203)](_0x755281[_0x1d5244(0x210)][_0x1d5244(0x1d1)]+'@'+(_0x755281[_0x1d5244(0x1dd)]?_0x1d5244(0x21e):_0x1d5244(0x229)),{..._0xddd2cf});const _0x5987f4=await(0x0,wbotMessageListener_1['verifyQuotedMessage'])(_0x45ca26),_0x716e26={'id':_0x45ca26['key']['id'],'ticketId':_0x755281['id'],'contactId':undefined,'body':_0x213bfc?(0x0,Mustache_1[_0x1d5244(0x1e1)])(_0x213bfc,_0x755281):(0x0,wbotMessageListener_1[_0x1d5244(0x1f0)])(_0x45ca26),'fromMe':_0x45ca26['key'][_0x1d5244(0x21a)],'read':_0x45ca26[_0x1d5244(0x215)]['fromMe'],'mediaUrl':_0x2bc99b,'mediaType':_0x4c6f93,'quotedMsgId':_0x5987f4?.['id'],'ack':0x0,'remoteJid':_0x45ca26[_0x1d5244(0x215)][_0x1d5244(0x1cc)],'participant':_0x45ca26[_0x1d5244(0x215)][_0x1d5244(0x1f7)],'dataJson':JSON[_0x1d5244(0x1f5)](_0x45ca26)};return typeof _0x716e26[_0x1d5244(0x1c2)]!=_0x1d5244(0x1c9)&&console[_0x1d5244(0x218)](_0x1d5244(0x213),_0x716e26[_0x1d5244(0x1c2)]),await _0x755281[_0x1d5244(0x21b)]({'lastMessage':_0x716e26['body']}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x716e26,'ticket':_0x755281,'companyId':_0x755281[_0x1d5244(0x222)]}),_0x45ca26;}catch(_0x3d54df){Sentry[_0x1d5244(0x1e4)](_0x3d54df),console['trace'](_0x3d54df);throw new AppError_1[(_0x1d5244(0x1e1))]('ERR_SENDING_WAPP_MSG');}};exports[a548_0xab277f(0x1e1)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x42ef7a,_0x168ccc,_0x5989a9)=>{const _0x1a6b4e=a548_0xab277f;try{const _0x259936=await(0x0,GetTicketWbot_1[_0x1a6b4e(0x1e1)])(_0x168ccc);_0x42ef7a[_0x1a6b4e(0x21d)]('http')&&(_0x42ef7a=_0x1a6b4e(0x1f6)+_0x42ef7a[_0x1a6b4e(0x1e3)](_0x1a6b4e(0x1ef))[0x1]);const _0x13d0e7=_0x42ef7a,_0x58178d=getMimeType(_0x42ef7a)[_0x1a6b4e(0x1e3)]('/')[0x0];let _0x39ad7c;if(_0x58178d==='video')_0x39ad7c={'video':fs_1['default']['readFileSync'](_0x13d0e7),'caption':_0x5989a9,'fileName':extractFileName(_0x42ef7a)};else{if(_0x58178d===_0x1a6b4e(0x1e0)){const _0x4ec492=_0x42ef7a[_0x1a6b4e(0x1c6)](_0x1a6b4e(0x1c8));if(_0x4ec492){const _0x18581d=await processAudio(_0x42ef7a,_0x168ccc[_0x1a6b4e(0x222)]);_0x39ad7c={'audio':fs_1[_0x1a6b4e(0x1e1)][_0x1a6b4e(0x1f3)](_0x18581d),'mimetype':_0x4ec492?_0x1a6b4e(0x1f1):getMimeType(_0x42ef7a),'ptt':!![]};}else{const _0x1b6693=await processAudioFile(_0x42ef7a);_0x39ad7c={'audio':fs_1[_0x1a6b4e(0x1e1)][_0x1a6b4e(0x1f3)](_0x1b6693),'mimetype':_0x4ec492?'audio/mp4':getMimeType(_0x42ef7a)};}}else{if(_0x58178d===_0x1a6b4e(0x1c3)||_0x58178d===_0x1a6b4e(0x211))_0x39ad7c={'document':fs_1[_0x1a6b4e(0x1e1)][_0x1a6b4e(0x1f3)](_0x13d0e7),'caption':_0x5989a9,'fileName':extractFileName(_0x42ef7a),'mimetype':getMimeType(_0x42ef7a)};else _0x58178d==='application'?_0x39ad7c={'document':fs_1[_0x1a6b4e(0x1e1)][_0x1a6b4e(0x1f3)](_0x13d0e7),'caption':_0x5989a9,'fileName':extractFileName(_0x42ef7a),'mimetype':getMimeType(_0x42ef7a)}:_0x39ad7c={'image':fs_1[_0x1a6b4e(0x1e1)]['readFileSync'](_0x13d0e7),'caption':_0x5989a9};}}const _0x27373c=await _0x259936[_0x1a6b4e(0x203)](_0x168ccc['contact'][_0x1a6b4e(0x1d1)]+'@'+(_0x168ccc['isGroup']?'g.us':'s.whatsapp.net'),{..._0x39ad7c});return _0x27373c;}catch(_0x51f760){Sentry[_0x1a6b4e(0x1e4)](_0x51f760),console['log'](_0x51f760);throw new AppError_1['default']('ERR_SENDING_WAPP_MSG');}};exports[a548_0xab277f(0x1f4)]=SendWhatsAppMediaFileAddress;const extractFileName=_0x2d29b0=>{const _0x81fd5e=a548_0xab277f,_0x23486d=_0x2d29b0[_0x81fd5e(0x1e3)]('/');return _0x23486d[_0x23486d[_0x81fd5e(0x1e5)]-0x1];},extractFilePath=_0x393e97=>{const _0x5e0409=a548_0xab277f,_0x4f9a82=_0x393e97[_0x5e0409(0x1e3)]('/');return _0x4f9a82[_0x5e0409(0x20c)](),_0x4f9a82['join']('/');},getMimeType=_0x2e8925=>{const _0x8f6a9=a548_0xab277f,_0x166769=_0x2e8925['split']('.'),_0x1f41ec=_0x166769[_0x166769[_0x8f6a9(0x1e5)]-0x1],_0x17fb73={'jpg':_0x8f6a9(0x1d0),'jpeg':_0x8f6a9(0x1d0),'png':_0x8f6a9(0x1c4),'gif':'image/gif','mp4':_0x8f6a9(0x1fc),'mp3':'audio/mp3','m4a':'audio/mp4','ogg':'audio/ogg','pdf':_0x8f6a9(0x20f),'doc':'application/msword','docx':_0x8f6a9(0x227),'xls':_0x8f6a9(0x208),'xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','ppt':_0x8f6a9(0x207),'pptx':'application/vnd.openxmlformats-officedocument.presentationml.presentation','txt':_0x8f6a9(0x1d7),'rtf':_0x8f6a9(0x1c7),'csv':_0x8f6a9(0x204),'html':_0x8f6a9(0x214),'zip':_0x8f6a9(0x21f),'rar':_0x8f6a9(0x1e8),'7z':_0x8f6a9(0x219),'3gp':_0x8f6a9(0x1de),'3g2':_0x8f6a9(0x1cb),'3ga':_0x8f6a9(0x1de),'7gp':_0x8f6a9(0x1cb),'7ga':_0x8f6a9(0x1de),'3gpp':_0x8f6a9(0x1de),'3gpp2':_0x8f6a9(0x1cb),'7gpp':_0x8f6a9(0x1de),'7gpp2':'video/3gpp2','3gpp-tt':_0x8f6a9(0x1de),'3gpp2-tt':_0x8f6a9(0x1cb),'7gpp-tt':_0x8f6a9(0x1de),'7gpp2-tt':'video/3gpp2','3gpp-rtt':'video/3gpp','3gpp2-rtt':_0x8f6a9(0x1cb),'7gpp-rtt':_0x8f6a9(0x1de),'7gpp2-rtt':_0x8f6a9(0x1cb),'3gpp-sms':_0x8f6a9(0x1de),'3gpp2-sms':_0x8f6a9(0x1cb),'7gpp-sms':_0x8f6a9(0x1de),'7gpp2-sms':'video/3gpp2','pdfa':_0x8f6a9(0x20f),'x-pdf':_0x8f6a9(0x20f)};if(_0x17fb73[_0x1f41ec])return _0x17fb73[_0x1f41ec];return _0x8f6a9(0x1e6);};