const a548_0x55c5e1=a548_0x1f86;(function(_0x37bcf9,_0x408d31){const _0xbfade2=a548_0x1f86,_0x567d04=_0x37bcf9();while(!![]){try{const _0x514b02=parseInt(_0xbfade2(0x148))/0x1*(-parseInt(_0xbfade2(0x137))/0x2)+-parseInt(_0xbfade2(0x177))/0x3*(-parseInt(_0xbfade2(0x15b))/0x4)+parseInt(_0xbfade2(0x113))/0x5*(parseInt(_0xbfade2(0x118))/0x6)+-parseInt(_0xbfade2(0x11f))/0x7*(-parseInt(_0xbfade2(0x138))/0x8)+parseInt(_0xbfade2(0x170))/0x9+parseInt(_0xbfade2(0x139))/0xa*(-parseInt(_0xbfade2(0x153))/0xb)+-parseInt(_0xbfade2(0x13d))/0xc*(parseInt(_0xbfade2(0x157))/0xd);if(_0x514b02===_0x408d31)break;else _0x567d04['push'](_0x567d04['shift']());}catch(_0x2a20b1){_0x567d04['push'](_0x567d04['shift']());}}}(a548_0x3843,0x9fb78));const a548_0x3f349e=(function(){let _0x49e890=!![];return function(_0x3c2ec8,_0x441706){const _0x39fcaa=_0x49e890?function(){const _0x5aa5a8=a548_0x1f86;if(_0x441706){const _0x2a55b2=_0x441706[_0x5aa5a8(0x15d)](_0x3c2ec8,arguments);return _0x441706=null,_0x2a55b2;}}:function(){};return _0x49e890=![],_0x39fcaa;};}()),a548_0x3eec26=a548_0x3f349e(this,function(){const _0x550f62=a548_0x1f86;return a548_0x3eec26['toString']()[_0x550f62(0x13e)](_0x550f62(0x14c))['toString']()[_0x550f62(0x110)](a548_0x3eec26)[_0x550f62(0x13e)](_0x550f62(0x14c));});a548_0x3eec26();function a548_0x1f86(_0x5a1eb0,_0x3e7065){const _0x4280a5=a548_0x3843();return a548_0x1f86=function(_0x3eec26,_0x3f349e){_0x3eec26=_0x3eec26-0x10a;let _0x3843f4=_0x4280a5[_0x3eec26];return _0x3843f4;},a548_0x1f86(_0x5a1eb0,_0x3e7065);}'use strict';var __createBinding=this&&this[a548_0x55c5e1(0x13c)]||(Object[a548_0x55c5e1(0x111)]?function(_0x4c5cd4,_0x425833,_0xf414a3,_0x31b54e){const _0x225521=a548_0x55c5e1;if(_0x31b54e===undefined)_0x31b54e=_0xf414a3;var _0x9b50ca=Object[_0x225521(0x150)](_0x425833,_0xf414a3);(!_0x9b50ca||(_0x225521(0x159)in _0x9b50ca?!_0x425833['__esModule']:_0x9b50ca[_0x225521(0x149)]||_0x9b50ca[_0x225521(0x152)]))&&(_0x9b50ca={'enumerable':!![],'get':function(){return _0x425833[_0xf414a3];}}),Object[_0x225521(0x176)](_0x4c5cd4,_0x31b54e,_0x9b50ca);}:function(_0x142fc1,_0x2c8c7c,_0x5a0943,_0x58c5cc){if(_0x58c5cc===undefined)_0x58c5cc=_0x5a0943;_0x142fc1[_0x58c5cc]=_0x2c8c7c[_0x5a0943];}),__setModuleDefault=this&&this[a548_0x55c5e1(0x15f)]||(Object[a548_0x55c5e1(0x111)]?function(_0x121f83,_0x4c99c8){const _0x5f4636=a548_0x55c5e1;Object[_0x5f4636(0x176)](_0x121f83,_0x5f4636(0x166),{'enumerable':!![],'value':_0x4c99c8});}:function(_0x357494,_0x11dc58){const _0x4a7e2c=a548_0x55c5e1;_0x357494[_0x4a7e2c(0x166)]=_0x11dc58;}),__importStar=this&&this[a548_0x55c5e1(0x10b)]||function(_0x29af4b){const _0x23bfa7=a548_0x55c5e1;if(_0x29af4b&&_0x29af4b[_0x23bfa7(0x154)])return _0x29af4b;var _0x254dd8={};if(_0x29af4b!=null){for(var _0x4dc7af in _0x29af4b)if(_0x4dc7af!==_0x23bfa7(0x166)&&Object[_0x23bfa7(0x173)]['hasOwnProperty'][_0x23bfa7(0x16b)](_0x29af4b,_0x4dc7af))__createBinding(_0x254dd8,_0x29af4b,_0x4dc7af);}return __setModuleDefault(_0x254dd8,_0x29af4b),_0x254dd8;},__importDefault=this&&this['__importDefault']||function(_0x44a964){return _0x44a964&&_0x44a964['__esModule']?_0x44a964:{'default':_0x44a964};};Object[a548_0x55c5e1(0x176)](exports,a548_0x55c5e1(0x154),{'value':!![]}),exports['SendWhatsAppMediaFileAddress']=exports[a548_0x55c5e1(0x134)]=void 0x0;const Sentry=__importStar(require('@sentry/node')),fs_1=__importDefault(require('fs')),child_process_1=require(a548_0x55c5e1(0x14d)),path_1=__importDefault(require(a548_0x55c5e1(0x15c))),fluent_ffmpeg_1=__importDefault(require(a548_0x55c5e1(0x13b))),AppError_1=__importDefault(require(a548_0x55c5e1(0x112))),GetTicketWbot_1=__importDefault(require(a548_0x55c5e1(0x127))),mime_types_1=__importDefault(require('mime-types')),Mustache_1=__importDefault(require(a548_0x55c5e1(0x12b))),ffmpeg_static_1=__importDefault(require(a548_0x55c5e1(0x129))),CreateMessageService_1=__importDefault(require(a548_0x55c5e1(0x11d))),wbotMessageListener_1=require(a548_0x55c5e1(0x140));fluent_ffmpeg_1[a548_0x55c5e1(0x166)][a548_0x55c5e1(0x16c)](ffmpeg_static_1[a548_0x55c5e1(0x166)]);const publicFolder=path_1[a548_0x55c5e1(0x166)][a548_0x55c5e1(0x10d)](__dirname,'..','..','..',a548_0x55c5e1(0x167)),processAudio=async(_0x30c170,_0x3a9729)=>{const _0x4cb699=a548_0x55c5e1,_0x5c8504=publicFolder+_0x4cb699(0x15a)+_0x3a9729+'/'+new Date()[_0x4cb699(0x14a)]()+_0x4cb699(0x14f);return new Promise((_0x30b1a8,_0x23d4d1)=>{const _0x265e4c=_0x4cb699;(0x0,child_process_1['exec'])(ffmpeg_static_1[_0x265e4c(0x166)]+_0x265e4c(0x142)+_0x30c170+'\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20'+_0x5c8504+'\x20-y',(_0x330c7e,_0x47674e,_0x3a1a3d)=>{const _0x1ce248=_0x265e4c;if(_0x330c7e)_0x23d4d1(_0x330c7e);fs_1[_0x1ce248(0x166)]['unlinkSync'](_0x30c170),_0x30b1a8(_0x5c8504);});});},processAudioFile=async _0x15a843=>{const _0x450a80=a548_0x55c5e1,_0x1aea10=publicFolder+'/'+new Date()['getTime']()+_0x450a80(0x14f);return new Promise((_0x1ee448,_0x4adafa)=>{const _0x9edc66=_0x450a80;(0x0,child_process_1[_0x9edc66(0x146)])(ffmpeg_static_1[_0x9edc66(0x166)]+_0x9edc66(0x142)+_0x15a843+_0x9edc66(0x172)+_0x1aea10,(_0x2470b3,_0xcc5b1a,_0x6636f)=>{const _0x11b0a6=_0x9edc66;if(_0x2470b3)_0x4adafa(_0x2470b3);fs_1['default'][_0x11b0a6(0x11e)](_0x15a843),_0x1ee448(_0x1aea10);});});},getMessageOptions=async(_0x44a5a7,_0x5f2538,_0x1b6b9f,_0x1112d1)=>{const _0x957f9=a548_0x55c5e1,_0x4a3d34=mime_types_1[_0x957f9(0x166)][_0x957f9(0x131)](_0x5f2538),_0x986fa9=_0x4a3d34['split']('/')[0x0];try{if(!_0x4a3d34)throw new Error(_0x957f9(0x163));let _0x154fa4;if(_0x986fa9===_0x957f9(0x122))_0x154fa4={'video':fs_1[_0x957f9(0x166)]['readFileSync'](_0x5f2538),'caption':_0x1b6b9f?_0x1b6b9f:'','fileName':_0x44a5a7};else{if(_0x986fa9===_0x957f9(0x161)){const _0x1eacdc=!![],_0x42e5aa=await processAudio(_0x5f2538,_0x1112d1);_0x1eacdc?_0x154fa4={'audio':fs_1[_0x957f9(0x166)][_0x957f9(0x130)](_0x42e5aa),'mimetype':_0x1eacdc?_0x957f9(0x12c):_0x4a3d34,'caption':_0x1b6b9f?_0x1b6b9f:null,'ptt':!![]}:_0x154fa4={'audio':fs_1[_0x957f9(0x166)][_0x957f9(0x130)](_0x42e5aa),'mimetype':_0x1eacdc?_0x957f9(0x12c):_0x4a3d34,'caption':_0x1b6b9f?_0x1b6b9f:null,'ptt':!![]};}else{if(_0x986fa9===_0x957f9(0x145))_0x154fa4={'document':fs_1['default'][_0x957f9(0x130)](_0x5f2538),'caption':_0x1b6b9f?_0x1b6b9f:null,'fileName':_0x44a5a7,'mimetype':_0x4a3d34};else _0x986fa9===_0x957f9(0x12e)?_0x154fa4={'document':fs_1['default'][_0x957f9(0x130)](_0x5f2538),'caption':_0x1b6b9f?_0x1b6b9f:null,'fileName':_0x44a5a7,'mimetype':_0x4a3d34}:_0x154fa4={'image':fs_1['default']['readFileSync'](_0x5f2538),'caption':_0x1b6b9f?_0x1b6b9f:null};}}return _0x154fa4;}catch(_0x4afbd0){return Sentry['captureException'](_0x4afbd0),console[_0x957f9(0x171)](_0x4afbd0),null;}};exports[a548_0x55c5e1(0x134)]=getMessageOptions;function a548_0x3843(){const _0x2b9555=['stringify','body\x20is\x20not\x20a\x20string','8148969kVSaTA','log','\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20','prototype','remoteJid','application/x-7z-compressed','defineProperty','139920KlECzy','startsWith','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','application/octet-stream','__importStar','filename','resolve','image/png','ERR_SENDING_WAPP_MSG','constructor','create','../../errors/AppError','145EGfdiW','originalname','join','string','application/x-rar-compressed','239826HduoqK','image/jpeg','number','application/zip','audio-record-site','../MessageServices/CreateMessageService','unlinkSync','7ZEZWrD','image/gif','trace','video','getBodyMessage','verifyQuotedMessage','captureException','application/vnd.openxmlformats-officedocument.presentationml.presentation','../../helpers/GetTicketWbot','application/msword','ffmpeg-static','mimetype','../../helpers/Mustache','audio/mp4','split','application','application/vnd.ms-excel','readFileSync','lookup','s.whatsapp.net','video/3gpp','getMessageOptions','isGroup','includes','2WIWbsA','9180664mlGmFr','290lqLRUh','/public','fluent-ffmpeg','__createBinding','40608YONCcH','search','audio/mp3','./wbotMessageListener','sendMessage','\x20-i\x20','text','g.us','document','exec','length','640973vpPGCa','writable','getTime','key','(((.+)+)+)+$','child_process','companyId','.mp3','getOwnPropertyDescriptor','video/3gpp2','configurable','117326jyFkox','__esModule','update','fromMe','7072UIpWoM','application/vnd.ms-powerpoint','get','/company','20exvnvk','path','apply','text/plain','__setModuleDefault','./public','audio','application/pdf','Invalid\x20mimetype','http','text/csv','default','public','body','contact','text/html','call','setFfmpegPath','audio/ogg'];a548_0x3843=function(){return _0x2b9555;};return a548_0x3843();}const SendWhatsAppMedia=async({media:_0x5e017d,ticket:_0x3f75f2,body:_0x462d6b})=>{const _0x3debc4=a548_0x55c5e1;try{const _0x5ab9c9=await(0x0,GetTicketWbot_1[_0x3debc4(0x166)])(_0x3f75f2),_0x309700=_0x5e017d[_0x3debc4(0x15c)],_0x4c8234=_0x5e017d[_0x3debc4(0x12a)]['split']('/')[0x0];let _0x516ffd;const _0xbf4aa8=(0x0,Mustache_1['default'])(_0x462d6b,_0x3f75f2);var _0x505f47=_0x5e017d[_0x3debc4(0x10c)];if(_0x4c8234===_0x3debc4(0x122))_0x516ffd={'video':fs_1[_0x3debc4(0x166)]['readFileSync'](_0x309700),'caption':_0xbf4aa8,'fileName':_0x5e017d[_0x3debc4(0x114)]};else{if(_0x4c8234===_0x3debc4(0x161)){const _0x36276a=_0x5e017d[_0x3debc4(0x114)][_0x3debc4(0x136)](_0x3debc4(0x11c));if(_0x36276a){const _0x32033c=await processAudio(_0x5e017d[_0x3debc4(0x15c)],_0x3f75f2[_0x3debc4(0x14e)]);_0x516ffd={'audio':fs_1[_0x3debc4(0x166)]['readFileSync'](_0x32033c),'mimetype':_0x36276a?_0x3debc4(0x12c):_0x5e017d['mimetype'],'ptt':!![]},_0x505f47=_0x32033c['split']('/')[_0x32033c[_0x3debc4(0x12d)]('/')[_0x3debc4(0x147)]-0x1];}else{const _0x4ef777=await processAudioFile(_0x5e017d[_0x3debc4(0x15c)]);_0x516ffd={'audio':fs_1[_0x3debc4(0x166)][_0x3debc4(0x130)](_0x4ef777),'mimetype':_0x36276a?_0x3debc4(0x12c):_0x5e017d[_0x3debc4(0x12a)]},_0x505f47=_0x4ef777[_0x3debc4(0x12d)]('/')[_0x4ef777[_0x3debc4(0x12d)]('/')[_0x3debc4(0x147)]-0x1];}}else{if(_0x4c8234===_0x3debc4(0x145)||_0x4c8234===_0x3debc4(0x143))_0x516ffd={'document':fs_1[_0x3debc4(0x166)][_0x3debc4(0x130)](_0x309700),'caption':_0xbf4aa8,'fileName':_0x5e017d['originalname'],'mimetype':_0x5e017d[_0x3debc4(0x12a)]};else _0x4c8234==='application'?_0x516ffd={'document':fs_1['default']['readFileSync'](_0x309700),'caption':_0xbf4aa8,'fileName':_0x5e017d[_0x3debc4(0x114)],'mimetype':_0x5e017d['mimetype']}:_0x516ffd={'image':fs_1['default'][_0x3debc4(0x130)](_0x309700),'caption':_0xbf4aa8};}}var _0x2b0a2f=await _0x5ab9c9[_0x3debc4(0x141)](_0x3f75f2[_0x3debc4(0x169)][_0x3debc4(0x11a)]+'@'+(_0x3f75f2[_0x3debc4(0x135)]?_0x3debc4(0x144):_0x3debc4(0x132)),{..._0x516ffd});const _0x55027d=await(0x0,wbotMessageListener_1[_0x3debc4(0x124)])(_0x2b0a2f),_0x534d44={'id':_0x2b0a2f[_0x3debc4(0x14b)]['id'],'ticketId':_0x3f75f2['id'],'contactId':undefined,'body':_0x462d6b?(0x0,Mustache_1[_0x3debc4(0x166)])(_0x462d6b,_0x3f75f2):(0x0,wbotMessageListener_1[_0x3debc4(0x123)])(_0x2b0a2f),'fromMe':_0x2b0a2f[_0x3debc4(0x14b)][_0x3debc4(0x156)],'read':_0x2b0a2f[_0x3debc4(0x14b)]['fromMe'],'mediaUrl':_0x505f47,'mediaType':_0x4c8234,'quotedMsgId':_0x55027d?.['id'],'ack':0x0,'remoteJid':_0x2b0a2f['key'][_0x3debc4(0x174)],'participant':_0x2b0a2f[_0x3debc4(0x14b)]['participant'],'dataJson':JSON[_0x3debc4(0x16e)](_0x2b0a2f)};return typeof _0x534d44[_0x3debc4(0x168)]!=_0x3debc4(0x116)&&console[_0x3debc4(0x121)](_0x3debc4(0x16f),_0x534d44['body']),await _0x3f75f2[_0x3debc4(0x155)]({'lastMessage':_0x534d44[_0x3debc4(0x168)]}),await(0x0,CreateMessageService_1[_0x3debc4(0x166)])({'messageData':_0x534d44,'ticket':_0x3f75f2,'companyId':_0x3f75f2[_0x3debc4(0x14e)]}),_0x2b0a2f;}catch(_0x596fd8){Sentry[_0x3debc4(0x125)](_0x596fd8),console['trace'](_0x596fd8);throw new AppError_1[(_0x3debc4(0x166))](_0x3debc4(0x10f));}};exports[a548_0x55c5e1(0x166)]=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x42a762,_0x57ba3e,_0x41f56c)=>{const _0x32ae5e=a548_0x55c5e1;try{const _0x6ee5cf=await(0x0,GetTicketWbot_1[_0x32ae5e(0x166)])(_0x57ba3e);_0x42a762[_0x32ae5e(0x178)](_0x32ae5e(0x164))&&(_0x42a762=_0x32ae5e(0x160)+_0x42a762[_0x32ae5e(0x12d)](_0x32ae5e(0x13a))[0x1]);const _0x14a30a=_0x42a762,_0x12ce4f=getMimeType(_0x42a762)[_0x32ae5e(0x12d)]('/')[0x0];let _0xad3bac;if(_0x12ce4f==='video')_0xad3bac={'video':fs_1[_0x32ae5e(0x166)][_0x32ae5e(0x130)](_0x14a30a),'caption':_0x41f56c,'fileName':extractFileName(_0x42a762)};else{if(_0x12ce4f===_0x32ae5e(0x161)){const _0x2511c5=_0x42a762['includes'](_0x32ae5e(0x11c));if(_0x2511c5){const _0x2727fe=await processAudio(_0x42a762,_0x57ba3e[_0x32ae5e(0x14e)]);_0xad3bac={'audio':fs_1['default']['readFileSync'](_0x2727fe),'mimetype':_0x2511c5?_0x32ae5e(0x12c):getMimeType(_0x42a762),'ptt':!![]};}else{const _0x27f449=await processAudioFile(_0x42a762);_0xad3bac={'audio':fs_1[_0x32ae5e(0x166)][_0x32ae5e(0x130)](_0x27f449),'mimetype':_0x2511c5?_0x32ae5e(0x12c):getMimeType(_0x42a762)};}}else{if(_0x12ce4f===_0x32ae5e(0x145)||_0x12ce4f===_0x32ae5e(0x143))_0xad3bac={'document':fs_1[_0x32ae5e(0x166)][_0x32ae5e(0x130)](_0x14a30a),'caption':_0x41f56c,'fileName':extractFileName(_0x42a762),'mimetype':getMimeType(_0x42a762)};else _0x12ce4f==='application'?_0xad3bac={'document':fs_1[_0x32ae5e(0x166)][_0x32ae5e(0x130)](_0x14a30a),'caption':_0x41f56c,'fileName':extractFileName(_0x42a762),'mimetype':getMimeType(_0x42a762)}:_0xad3bac={'image':fs_1[_0x32ae5e(0x166)][_0x32ae5e(0x130)](_0x14a30a),'caption':_0x41f56c};}}const _0x51dc12=await _0x6ee5cf['sendMessage'](_0x57ba3e[_0x32ae5e(0x169)][_0x32ae5e(0x11a)]+'@'+(_0x57ba3e[_0x32ae5e(0x135)]?_0x32ae5e(0x144):_0x32ae5e(0x132)),{..._0xad3bac});return _0x51dc12;}catch(_0x1253b7){Sentry[_0x32ae5e(0x125)](_0x1253b7),console['log'](_0x1253b7);throw new AppError_1[(_0x32ae5e(0x166))](_0x32ae5e(0x10f));}};exports['SendWhatsAppMediaFileAddress']=SendWhatsAppMediaFileAddress;const extractFileName=_0x10e402=>{const _0x53353a=a548_0x55c5e1,_0x124c5e=_0x10e402[_0x53353a(0x12d)]('/');return _0x124c5e[_0x124c5e[_0x53353a(0x147)]-0x1];},extractFilePath=_0x2c20b4=>{const _0x163be4=a548_0x55c5e1,_0x2476eb=_0x2c20b4[_0x163be4(0x12d)]('/');return _0x2476eb['pop'](),_0x2476eb[_0x163be4(0x115)]('/');},getMimeType=_0xdf2179=>{const _0x5a3c94=a548_0x55c5e1,_0x5d7d85=_0xdf2179['split']('.'),_0x24675e=_0x5d7d85[_0x5d7d85[_0x5a3c94(0x147)]-0x1],_0x5eed30={'jpg':_0x5a3c94(0x119),'jpeg':_0x5a3c94(0x119),'png':_0x5a3c94(0x10e),'gif':_0x5a3c94(0x120),'mp4':'video/mp4','mp3':_0x5a3c94(0x13f),'m4a':_0x5a3c94(0x12c),'ogg':_0x5a3c94(0x16d),'pdf':_0x5a3c94(0x162),'doc':_0x5a3c94(0x128),'docx':'application/vnd.openxmlformats-officedocument.wordprocessingml.document','xls':_0x5a3c94(0x12f),'xlsx':_0x5a3c94(0x179),'ppt':_0x5a3c94(0x158),'pptx':_0x5a3c94(0x126),'txt':_0x5a3c94(0x15e),'rtf':'application/rtf','csv':_0x5a3c94(0x165),'html':_0x5a3c94(0x16a),'zip':_0x5a3c94(0x11b),'rar':_0x5a3c94(0x117),'7z':_0x5a3c94(0x175),'3gp':_0x5a3c94(0x133),'3g2':_0x5a3c94(0x151),'3ga':_0x5a3c94(0x133),'7gp':_0x5a3c94(0x151),'7ga':'video/3gpp','3gpp':_0x5a3c94(0x133),'3gpp2':_0x5a3c94(0x151),'7gpp':_0x5a3c94(0x133),'7gpp2':_0x5a3c94(0x151),'3gpp-tt':'video/3gpp','3gpp2-tt':_0x5a3c94(0x151),'7gpp-tt':'video/3gpp','7gpp2-tt':_0x5a3c94(0x151),'3gpp-rtt':_0x5a3c94(0x133),'3gpp2-rtt':_0x5a3c94(0x151),'7gpp-rtt':'video/3gpp','7gpp2-rtt':_0x5a3c94(0x151),'3gpp-sms':'video/3gpp','3gpp2-sms':_0x5a3c94(0x151),'7gpp-sms':_0x5a3c94(0x133),'7gpp2-sms':_0x5a3c94(0x151),'pdfa':_0x5a3c94(0x162),'x-pdf':_0x5a3c94(0x162)};if(_0x5eed30[_0x24675e])return _0x5eed30[_0x24675e];return _0x5a3c94(0x10a);};