const a548_0x373b22=a548_0x3336;(function(_0x2f2938,_0x1dff6b){const _0x12e8f7=a548_0x3336,_0x5565fc=_0x2f2938();while(!![]){try{const _0x4a5929=parseInt(_0x12e8f7(0x1dd))/0x1+parseInt(_0x12e8f7(0x1ea))/0x2*(-parseInt(_0x12e8f7(0x1e1))/0x3)+parseInt(_0x12e8f7(0x1c7))/0x4*(parseInt(_0x12e8f7(0x1e3))/0x5)+parseInt(_0x12e8f7(0x1d7))/0x6*(-parseInt(_0x12e8f7(0x1b7))/0x7)+-parseInt(_0x12e8f7(0x1c9))/0x8+-parseInt(_0x12e8f7(0x1f3))/0x9*(-parseInt(_0x12e8f7(0x1db))/0xa)+-parseInt(_0x12e8f7(0x1e2))/0xb;if(_0x4a5929===_0x1dff6b)break;else _0x5565fc['push'](_0x5565fc['shift']());}catch(_0x353704){_0x5565fc['push'](_0x5565fc['shift']());}}}(a548_0x2eef,0x8069e));function a548_0x3336(_0x58c912,_0x61cab6){const _0x1e9d71=a548_0x2eef();return a548_0x3336=function(_0x182769,_0x3789d1){_0x182769=_0x182769-0x19e;let _0x2eef3e=_0x1e9d71[_0x182769];return _0x2eef3e;},a548_0x3336(_0x58c912,_0x61cab6);}const a548_0x3789d1=(function(){let _0x137b0f=!![];return function(_0x407be0,_0x3797c7){const _0x439ca6=_0x137b0f?function(){const _0x1c4d4d=a548_0x3336;if(_0x3797c7){const _0x4a3ff3=_0x3797c7[_0x1c4d4d(0x1f9)](_0x407be0,arguments);return _0x3797c7=null,_0x4a3ff3;}}:function(){};return _0x137b0f=![],_0x439ca6;};}()),a548_0x182769=a548_0x3789d1(this,function(){const _0x417cc1=a548_0x3336;return a548_0x182769['toString']()['search'](_0x417cc1(0x206))[_0x417cc1(0x1a6)]()[_0x417cc1(0x1a1)](a548_0x182769)['search'](_0x417cc1(0x206));});a548_0x182769();'use strict';var __createBinding=this&&this[a548_0x373b22(0x1c5)]||(Object['create']?function(_0x3e189d,_0x32141b,_0x3b15fd,_0x2a7fdf){const _0x58fad3=a548_0x373b22;if(_0x2a7fdf===undefined)_0x2a7fdf=_0x3b15fd;var _0x3f6467=Object[_0x58fad3(0x1ac)](_0x32141b,_0x3b15fd);(!_0x3f6467||('get'in _0x3f6467?!_0x32141b[_0x58fad3(0x1b0)]:_0x3f6467['writable']||_0x3f6467['configurable']))&&(_0x3f6467={'enumerable':!![],'get':function(){return _0x32141b[_0x3b15fd];}}),Object[_0x58fad3(0x1bf)](_0x3e189d,_0x2a7fdf,_0x3f6467);}:function(_0x368df8,_0x32016f,_0x21bf73,_0x189d97){if(_0x189d97===undefined)_0x189d97=_0x21bf73;_0x368df8[_0x189d97]=_0x32016f[_0x21bf73];}),__setModuleDefault=this&&this[a548_0x373b22(0x1aa)]||(Object[a548_0x373b22(0x1f6)]?function(_0x14737f,_0x183e8c){const _0x313568=a548_0x373b22;Object[_0x313568(0x1bf)](_0x14737f,_0x313568(0x1cb),{'enumerable':!![],'value':_0x183e8c});}:function(_0x102e2a,_0x37c233){const _0x146f72=a548_0x373b22;_0x102e2a[_0x146f72(0x1cb)]=_0x37c233;}),__importStar=this&&this[a548_0x373b22(0x1cd)]||function(_0x51a188){const _0x53fc21=a548_0x373b22;if(_0x51a188&&_0x51a188[_0x53fc21(0x1b0)])return _0x51a188;var _0x5c5cb8={};if(_0x51a188!=null){for(var _0x3cf47d in _0x51a188)if(_0x3cf47d!=='default'&&Object[_0x53fc21(0x1e0)][_0x53fc21(0x1ed)][_0x53fc21(0x205)](_0x51a188,_0x3cf47d))__createBinding(_0x5c5cb8,_0x51a188,_0x3cf47d);}return __setModuleDefault(_0x5c5cb8,_0x51a188),_0x5c5cb8;},__importDefault=this&&this[a548_0x373b22(0x1a7)]||function(_0x3fe424){return _0x3fe424&&_0x3fe424['__esModule']?_0x3fe424:{'default':_0x3fe424};};function a548_0x2eef(){const _0x412ce6=['1670778iTLTjn','32153nGjPzF','5poXFlo','\x20-i\x20','split','application/rtf','key','trace','application/vnd.ms-powerpoint','2vSredm','video/3gpp2','./wbotMessageListener','hasOwnProperty','application/vnd.openxmlformats-officedocument.wordprocessingml.document','../../helpers/Mustache','remoteJid','../../helpers/GetTicketWbot','companyId','2241RFXoWV','application/zip','@sentry/node','create','startsWith','application/msword','apply','lookup','image/gif','\x20-vn\x20-ab\x20128k\x20-ar\x2044100\x20-f\x20ipod\x20','application/x-7z-compressed','verifyQuotedMessage','filename','mimetype','g.us','audio','application','getMessageOptions','call','(((.+)+)+)+$','getBodyMessage','fromMe','application/octet-stream','constructor','application/x-rar-compressed','document','stringify','path','toString','__importDefault','log','/company','__setModuleDefault','ERR_SENDING_WAPP_MSG','getOwnPropertyDescriptor','sendMessage','image/png','SendWhatsAppMediaFileAddress','__esModule','video','public','body','\x20-y','./public','s.whatsapp.net','181699vrdKcC','contact','update','video/3gpp','pop','includes','text/csv','number','defineProperty','.mp3','resolve','image/jpeg','string','text','__createBinding','unlinkSync','2401164qpoarU','originalname','5949616yelEMS','text/plain','default','length','__importStar','ffmpeg-static','fluent-ffmpeg','mime-types','application/vnd.ms-excel','participant','application/vnd.openxmlformats-officedocument.presentationml.presentation','child_process','isGroup','application/pdf','132dTAHse','exec','audio/ogg','audio-record-site','30410lBBwnu','audio/mp4','1043087SgBAFL','captureException','readFileSync','prototype'];a548_0x2eef=function(){return _0x412ce6;};return a548_0x2eef();}Object[a548_0x373b22(0x1bf)](exports,a548_0x373b22(0x1b0),{'value':!![]}),exports[a548_0x373b22(0x1af)]=exports[a548_0x373b22(0x204)]=void 0x0;const Sentry=__importStar(require(a548_0x373b22(0x1f5))),fs_1=__importDefault(require('fs')),child_process_1=require(a548_0x373b22(0x1d4)),path_1=__importDefault(require('path')),fluent_ffmpeg_1=__importDefault(require(a548_0x373b22(0x1cf))),AppError_1=__importDefault(require('../../errors/AppError')),GetTicketWbot_1=__importDefault(require(a548_0x373b22(0x1f1))),mime_types_1=__importDefault(require(a548_0x373b22(0x1d0))),Mustache_1=__importDefault(require(a548_0x373b22(0x1ef))),ffmpeg_static_1=__importDefault(require(a548_0x373b22(0x1ce))),CreateMessageService_1=__importDefault(require('../MessageServices/CreateMessageService')),wbotMessageListener_1=require(a548_0x373b22(0x1ec));fluent_ffmpeg_1[a548_0x373b22(0x1cb)]['setFfmpegPath'](ffmpeg_static_1[a548_0x373b22(0x1cb)]);const publicFolder=path_1['default'][a548_0x373b22(0x1c1)](__dirname,'..','..','..',a548_0x373b22(0x1b2)),processAudio=async(_0x893f5a,_0x384ff1)=>{const _0x23ffef=a548_0x373b22,_0x336938=publicFolder+_0x23ffef(0x1a9)+_0x384ff1+'/'+new Date()['getTime']()+_0x23ffef(0x1c0);return new Promise((_0x280c78,_0x154837)=>{const _0x32068f=_0x23ffef;(0x0,child_process_1['exec'])(ffmpeg_static_1[_0x32068f(0x1cb)]+_0x32068f(0x1e4)+_0x893f5a+_0x32068f(0x1fc)+_0x336938+_0x32068f(0x1b4),(_0x6ee55d,_0x39c83f,_0x4bb696)=>{const _0x1151ec=_0x32068f;if(_0x6ee55d)_0x154837(_0x6ee55d);fs_1[_0x1151ec(0x1cb)][_0x1151ec(0x1c6)](_0x893f5a),_0x280c78(_0x336938);});});},processAudioFile=async _0x20dfda=>{const _0x3530bd=a548_0x373b22,_0x1ede49=publicFolder+'/'+new Date()['getTime']()+_0x3530bd(0x1c0);return new Promise((_0x301c04,_0x5c91f0)=>{const _0x965951=_0x3530bd;(0x0,child_process_1[_0x965951(0x1d8)])(ffmpeg_static_1[_0x965951(0x1cb)]+_0x965951(0x1e4)+_0x20dfda+'\x20-vn\x20-ar\x2044100\x20-ac\x202\x20-b:a\x20192k\x20'+_0x1ede49,(_0x1d9709,_0x187be2,_0x61c7bc)=>{const _0x24f968=_0x965951;if(_0x1d9709)_0x5c91f0(_0x1d9709);fs_1['default'][_0x24f968(0x1c6)](_0x20dfda),_0x301c04(_0x1ede49);});});},getMessageOptions=async(_0xdfa5f,_0x95bf4d,_0x4f1708,_0x428f1f)=>{const _0x5d57f0=a548_0x373b22,_0xfdab76=mime_types_1[_0x5d57f0(0x1cb)][_0x5d57f0(0x1fa)](_0x95bf4d),_0x14217a=_0xfdab76[_0x5d57f0(0x1e5)]('/')[0x0];try{if(!_0xfdab76)throw new Error('Invalid\x20mimetype');let _0x556684;if(_0x14217a===_0x5d57f0(0x1b1))_0x556684={'video':fs_1[_0x5d57f0(0x1cb)]['readFileSync'](_0x95bf4d),'caption':_0x4f1708?_0x4f1708:'','fileName':_0xdfa5f};else{if(_0x14217a===_0x5d57f0(0x202)){const _0x13bd1d=!![],_0x484ed8=await processAudio(_0x95bf4d,_0x428f1f);_0x13bd1d?_0x556684={'audio':fs_1[_0x5d57f0(0x1cb)][_0x5d57f0(0x1df)](_0x484ed8),'mimetype':_0x13bd1d?_0x5d57f0(0x1dc):_0xfdab76,'caption':_0x4f1708?_0x4f1708:null,'ptt':!![]}:_0x556684={'audio':fs_1[_0x5d57f0(0x1cb)][_0x5d57f0(0x1df)](_0x484ed8),'mimetype':_0x13bd1d?_0x5d57f0(0x1dc):_0xfdab76,'caption':_0x4f1708?_0x4f1708:null,'ptt':!![]};}else{if(_0x14217a===_0x5d57f0(0x1a3))_0x556684={'document':fs_1[_0x5d57f0(0x1cb)][_0x5d57f0(0x1df)](_0x95bf4d),'caption':_0x4f1708?_0x4f1708:null,'fileName':_0xdfa5f,'mimetype':_0xfdab76};else _0x14217a==='application'?_0x556684={'document':fs_1[_0x5d57f0(0x1cb)]['readFileSync'](_0x95bf4d),'caption':_0x4f1708?_0x4f1708:null,'fileName':_0xdfa5f,'mimetype':_0xfdab76}:_0x556684={'image':fs_1['default']['readFileSync'](_0x95bf4d),'caption':_0x4f1708?_0x4f1708:null};}}return _0x556684;}catch(_0x523335){return Sentry[_0x5d57f0(0x1de)](_0x523335),console[_0x5d57f0(0x1a8)](_0x523335),null;}};exports[a548_0x373b22(0x204)]=getMessageOptions;const SendWhatsAppMedia=async({media:_0x56fbb8,ticket:_0x19b0e8,body:_0x1ba140})=>{const _0xdbd0d7=a548_0x373b22;try{const _0x20a9d5=await(0x0,GetTicketWbot_1[_0xdbd0d7(0x1cb)])(_0x19b0e8),_0x1fcf55=_0x56fbb8['path'],_0x1b4f6c=_0x56fbb8[_0xdbd0d7(0x200)][_0xdbd0d7(0x1e5)]('/')[0x0];let _0x334177;const _0x23a13a=(0x0,Mustache_1['default'])(_0x1ba140,_0x19b0e8);var _0x1ab608=_0x56fbb8[_0xdbd0d7(0x1ff)];if(_0x1b4f6c==='video')_0x334177={'video':fs_1['default'][_0xdbd0d7(0x1df)](_0x1fcf55),'caption':_0x23a13a,'fileName':_0x56fbb8[_0xdbd0d7(0x1c8)]};else{if(_0x1b4f6c==='audio'){const _0x169379=_0x56fbb8[_0xdbd0d7(0x1c8)][_0xdbd0d7(0x1bc)](_0xdbd0d7(0x1da));if(_0x169379){const _0x242ef7=await processAudio(_0x56fbb8[_0xdbd0d7(0x1a5)],_0x19b0e8[_0xdbd0d7(0x1f2)]);_0x334177={'audio':fs_1[_0xdbd0d7(0x1cb)][_0xdbd0d7(0x1df)](_0x242ef7),'mimetype':_0x169379?_0xdbd0d7(0x1dc):_0x56fbb8[_0xdbd0d7(0x200)],'ptt':!![]},_0x1ab608=_0x242ef7[_0xdbd0d7(0x1e5)]('/')[_0x242ef7['split']('/')['length']-0x1];}else{const _0x3212e2=await processAudioFile(_0x56fbb8[_0xdbd0d7(0x1a5)]);_0x334177={'audio':fs_1['default']['readFileSync'](_0x3212e2),'mimetype':_0x169379?_0xdbd0d7(0x1dc):_0x56fbb8[_0xdbd0d7(0x200)]},_0x1ab608=_0x3212e2[_0xdbd0d7(0x1e5)]('/')[_0x3212e2['split']('/')[_0xdbd0d7(0x1cc)]-0x1];}}else{if(_0x1b4f6c==='document'||_0x1b4f6c===_0xdbd0d7(0x1c4))_0x334177={'document':fs_1[_0xdbd0d7(0x1cb)]['readFileSync'](_0x1fcf55),'caption':_0x23a13a,'fileName':_0x56fbb8['originalname'],'mimetype':_0x56fbb8[_0xdbd0d7(0x200)]};else _0x1b4f6c==='application'?_0x334177={'document':fs_1[_0xdbd0d7(0x1cb)][_0xdbd0d7(0x1df)](_0x1fcf55),'caption':_0x23a13a,'fileName':_0x56fbb8[_0xdbd0d7(0x1c8)],'mimetype':_0x56fbb8['mimetype']}:_0x334177={'image':fs_1[_0xdbd0d7(0x1cb)][_0xdbd0d7(0x1df)](_0x1fcf55),'caption':_0x23a13a};}}var _0x30a76b=await _0x20a9d5[_0xdbd0d7(0x1ad)](_0x19b0e8[_0xdbd0d7(0x1b8)][_0xdbd0d7(0x1be)]+'@'+(_0x19b0e8[_0xdbd0d7(0x1d5)]?'g.us':_0xdbd0d7(0x1b6)),{..._0x334177});const _0x12125c=await(0x0,wbotMessageListener_1[_0xdbd0d7(0x1fe)])(_0x30a76b),_0x37f8d6={'id':_0x30a76b[_0xdbd0d7(0x1e7)]['id'],'ticketId':_0x19b0e8['id'],'contactId':undefined,'body':_0x1ba140?(0x0,Mustache_1[_0xdbd0d7(0x1cb)])(_0x1ba140,_0x19b0e8):(0x0,wbotMessageListener_1[_0xdbd0d7(0x19e)])(_0x30a76b),'fromMe':_0x30a76b[_0xdbd0d7(0x1e7)][_0xdbd0d7(0x19f)],'read':_0x30a76b[_0xdbd0d7(0x1e7)][_0xdbd0d7(0x19f)],'mediaUrl':_0x1ab608,'mediaType':_0x1b4f6c,'quotedMsgId':_0x12125c?.['id'],'ack':0x0,'remoteJid':_0x30a76b['key'][_0xdbd0d7(0x1f0)],'participant':_0x30a76b[_0xdbd0d7(0x1e7)][_0xdbd0d7(0x1d2)],'dataJson':JSON[_0xdbd0d7(0x1a4)](_0x30a76b)};return typeof _0x37f8d6[_0xdbd0d7(0x1b3)]!=_0xdbd0d7(0x1c3)&&console['trace']('body\x20is\x20not\x20a\x20string',_0x37f8d6[_0xdbd0d7(0x1b3)]),await _0x19b0e8[_0xdbd0d7(0x1b9)]({'lastMessage':_0x37f8d6[_0xdbd0d7(0x1b3)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x37f8d6,'ticket':_0x19b0e8,'companyId':_0x19b0e8[_0xdbd0d7(0x1f2)]}),_0x30a76b;}catch(_0x3142ff){Sentry[_0xdbd0d7(0x1de)](_0x3142ff),console[_0xdbd0d7(0x1e8)](_0x3142ff);throw new AppError_1[(_0xdbd0d7(0x1cb))](_0xdbd0d7(0x1ab));}};exports['default']=SendWhatsAppMedia;const SendWhatsAppMediaFileAddress=async(_0x2ed9fe,_0xaab4d6,_0x42caaf)=>{const _0xc4d794=a548_0x373b22;try{const _0x2e9b65=await(0x0,GetTicketWbot_1['default'])(_0xaab4d6);_0x2ed9fe[_0xc4d794(0x1f7)]('http')&&(_0x2ed9fe=_0xc4d794(0x1b5)+_0x2ed9fe[_0xc4d794(0x1e5)]('/public')[0x1]);const _0x50bebe=_0x2ed9fe,_0x3a2987=getMimeType(_0x2ed9fe)[_0xc4d794(0x1e5)]('/')[0x0];let _0x27d7a4;if(_0x3a2987===_0xc4d794(0x1b1))_0x27d7a4={'video':fs_1[_0xc4d794(0x1cb)][_0xc4d794(0x1df)](_0x50bebe),'caption':_0x42caaf,'fileName':extractFileName(_0x2ed9fe)};else{if(_0x3a2987===_0xc4d794(0x202)){const _0x3c1b9c=_0x2ed9fe[_0xc4d794(0x1bc)](_0xc4d794(0x1da));if(_0x3c1b9c){const _0x415957=await processAudio(_0x2ed9fe,_0xaab4d6[_0xc4d794(0x1f2)]);_0x27d7a4={'audio':fs_1[_0xc4d794(0x1cb)][_0xc4d794(0x1df)](_0x415957),'mimetype':_0x3c1b9c?_0xc4d794(0x1dc):getMimeType(_0x2ed9fe),'ptt':!![]};}else{const _0x40456d=await processAudioFile(_0x2ed9fe);_0x27d7a4={'audio':fs_1[_0xc4d794(0x1cb)][_0xc4d794(0x1df)](_0x40456d),'mimetype':_0x3c1b9c?_0xc4d794(0x1dc):getMimeType(_0x2ed9fe)};}}else{if(_0x3a2987===_0xc4d794(0x1a3)||_0x3a2987===_0xc4d794(0x1c4))_0x27d7a4={'document':fs_1[_0xc4d794(0x1cb)][_0xc4d794(0x1df)](_0x50bebe),'caption':_0x42caaf,'fileName':extractFileName(_0x2ed9fe),'mimetype':getMimeType(_0x2ed9fe)};else _0x3a2987===_0xc4d794(0x203)?_0x27d7a4={'document':fs_1[_0xc4d794(0x1cb)]['readFileSync'](_0x50bebe),'caption':_0x42caaf,'fileName':extractFileName(_0x2ed9fe),'mimetype':getMimeType(_0x2ed9fe)}:_0x27d7a4={'image':fs_1[_0xc4d794(0x1cb)][_0xc4d794(0x1df)](_0x50bebe),'caption':_0x42caaf};}}const _0x3c08ad=await _0x2e9b65['sendMessage'](_0xaab4d6[_0xc4d794(0x1b8)][_0xc4d794(0x1be)]+'@'+(_0xaab4d6[_0xc4d794(0x1d5)]?_0xc4d794(0x201):'s.whatsapp.net'),{..._0x27d7a4});return _0x3c08ad;}catch(_0x5e47a9){Sentry['captureException'](_0x5e47a9),console[_0xc4d794(0x1a8)](_0x5e47a9);throw new AppError_1[(_0xc4d794(0x1cb))]('ERR_SENDING_WAPP_MSG');}};exports['SendWhatsAppMediaFileAddress']=SendWhatsAppMediaFileAddress;const extractFileName=_0x21c1e8=>{const _0x4120a8=a548_0x373b22,_0x5b1234=_0x21c1e8[_0x4120a8(0x1e5)]('/');return _0x5b1234[_0x5b1234[_0x4120a8(0x1cc)]-0x1];},extractFilePath=_0x12f7a9=>{const _0x2672dd=a548_0x373b22,_0xeeb06d=_0x12f7a9[_0x2672dd(0x1e5)]('/');return _0xeeb06d[_0x2672dd(0x1bb)](),_0xeeb06d['join']('/');},getMimeType=_0x23b7e9=>{const _0x1d1318=a548_0x373b22,_0x33cac9=_0x23b7e9[_0x1d1318(0x1e5)]('.'),_0x12a441=_0x33cac9[_0x33cac9[_0x1d1318(0x1cc)]-0x1],_0x413500={'jpg':_0x1d1318(0x1c2),'jpeg':_0x1d1318(0x1c2),'png':_0x1d1318(0x1ae),'gif':_0x1d1318(0x1fb),'mp4':'video/mp4','mp3':'audio/mp3','m4a':_0x1d1318(0x1dc),'ogg':_0x1d1318(0x1d9),'pdf':_0x1d1318(0x1d6),'doc':_0x1d1318(0x1f8),'docx':_0x1d1318(0x1ee),'xls':_0x1d1318(0x1d1),'xlsx':'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','ppt':_0x1d1318(0x1e9),'pptx':_0x1d1318(0x1d3),'txt':_0x1d1318(0x1ca),'rtf':_0x1d1318(0x1e6),'csv':_0x1d1318(0x1bd),'html':'text/html','zip':_0x1d1318(0x1f4),'rar':_0x1d1318(0x1a2),'7z':_0x1d1318(0x1fd),'3gp':_0x1d1318(0x1ba),'3g2':_0x1d1318(0x1eb),'3ga':_0x1d1318(0x1ba),'7gp':_0x1d1318(0x1eb),'7ga':_0x1d1318(0x1ba),'3gpp':'video/3gpp','3gpp2':_0x1d1318(0x1eb),'7gpp':_0x1d1318(0x1ba),'7gpp2':_0x1d1318(0x1eb),'3gpp-tt':_0x1d1318(0x1ba),'3gpp2-tt':_0x1d1318(0x1eb),'7gpp-tt':_0x1d1318(0x1ba),'7gpp2-tt':'video/3gpp2','3gpp-rtt':_0x1d1318(0x1ba),'3gpp2-rtt':_0x1d1318(0x1eb),'7gpp-rtt':_0x1d1318(0x1ba),'7gpp2-rtt':_0x1d1318(0x1eb),'3gpp-sms':_0x1d1318(0x1ba),'3gpp2-sms':_0x1d1318(0x1eb),'7gpp-sms':'video/3gpp','7gpp2-sms':_0x1d1318(0x1eb),'pdfa':'application/pdf','x-pdf':_0x1d1318(0x1d6)};if(_0x413500[_0x12a441])return _0x413500[_0x12a441];return _0x1d1318(0x1a0);};