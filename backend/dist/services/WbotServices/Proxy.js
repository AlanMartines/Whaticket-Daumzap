const a547_0x1f22c8=a547_0x52fc;(function(_0x5f432b,_0x5cef23){const _0x50bf4b=a547_0x52fc,_0x1c4fd5=_0x5f432b();while(!![]){try{const _0x16dbf9=-parseInt(_0x50bf4b(0xe1))/0x1+parseInt(_0x50bf4b(0xcc))/0x2+parseInt(_0x50bf4b(0xf9))/0x3+parseInt(_0x50bf4b(0xe8))/0x4+parseInt(_0x50bf4b(0xd1))/0x5+-parseInt(_0x50bf4b(0x10f))/0x6*(-parseInt(_0x50bf4b(0xeb))/0x7)+parseInt(_0x50bf4b(0xcd))/0x8*(-parseInt(_0x50bf4b(0xfe))/0x9);if(_0x16dbf9===_0x5cef23)break;else _0x1c4fd5['push'](_0x1c4fd5['shift']());}catch(_0x3b8750){_0x1c4fd5['push'](_0x1c4fd5['shift']());}}}(a547_0x9ee1,0xf0a8a));function a547_0x9ee1(){const _0xb5e27f=['redis','../../models/Contact','set','459043DsgfLF','log','env','number','remoteJid','key','SendMessageConnectedStaffMember','6634332CvjwKi','companyId','REDIS_URI','188510JAFeEa','(((.+)+)+)+$','get','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','../../models/Queue','parse','../../models/Ticket','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','findOne','Disconnect','search','userId','assistant','ResponseProxy','1699611mlDXWT','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','apply','../../models/User','contactId','23445495GZSNai','replace','map','sendMessage','user','default','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','connect','closed','queues','sair','__importDefault','__esModule','../TicketServices/ShowTicketService','getBodyMessage','includes','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','18TElTgS','pending','toLowerCase','toString','1583844CwVDRN','8LIWTTd','stringify','@s.whatsapp.net','open','4760020FtNyED','audio','createClient','del','../WbotServices/wbotMessageListener','constructor','disconnect','Desconectado\x20com\x20sucesso','queueId','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','fromMe','contact','ticketId'];a547_0x9ee1=function(){return _0xb5e27f;};return a547_0x9ee1();}const a547_0x137a59=(function(){let _0x248666=!![];return function(_0x385ecd,_0x17c73b){const _0x56e450=_0x248666?function(){const _0x389625=a547_0x52fc;if(_0x17c73b){const _0x2c5987=_0x17c73b[_0x389625(0xfb)](_0x385ecd,arguments);return _0x17c73b=null,_0x2c5987;}}:function(){};return _0x248666=![],_0x56e450;};}()),a547_0x1c4d61=a547_0x137a59(this,function(){const _0x2e4f37=a547_0x52fc;return a547_0x1c4d61[_0x2e4f37(0xcb)]()[_0x2e4f37(0xf5)](_0x2e4f37(0xec))['toString']()[_0x2e4f37(0xd6)](a547_0x1c4d61)[_0x2e4f37(0xf5)](_0x2e4f37(0xec));});a547_0x1c4d61();'use strict';var __importDefault=this&&this[a547_0x1f22c8(0x109)]||function(_0x53246e){return _0x53246e&&_0x53246e['__esModule']?_0x53246e:{'default':_0x53246e};};Object['defineProperty'](exports,a547_0x1f22c8(0x10a),{'value':!![]}),exports['SendMessageConnectedStaffMember']=exports['ResponseProxy']=exports[a547_0x1f22c8(0xf4)]=exports['CheckConnection']=void 0x0;const Ticket_1=__importDefault(require(a547_0x1f22c8(0xf1))),User_1=__importDefault(require(a547_0x1f22c8(0xfc))),redis_1=require(a547_0x1f22c8(0xde)),Contact_1=__importDefault(require(a547_0x1f22c8(0xdf))),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),wbotMessageListener_1=require(a547_0x1f22c8(0xd5)),ShowTicketService_1=__importDefault(require(a547_0x1f22c8(0x10b))),Queue_1=__importDefault(require(a547_0x1f22c8(0xef))),CheckConnection=async({waid:_0xa7666c,code:_0x17253d,companyId:_0x5e119c,wbot:_0x1c94c3})=>{const _0x40d808=a547_0x1f22c8,_0xc9ca29=await User_1[_0x40d808(0x103)][_0x40d808(0xf3)]({'where':{'waid':_0xa7666c,'companyId':_0x5e119c},'include':[{'model':Queue_1['default']}]});if(!_0xc9ca29)return![];const _0x13a24c=await Ticket_1[_0x40d808(0x103)][_0x40d808(0xf3)]({'where':{'iCode':_0x17253d,'companyId':_0x5e119c,'status':_0x40d808(0xc9)},'include':[{'model':Contact_1[_0x40d808(0x103)]},{'model':Queue_1['default']}]});if(!_0x13a24c)return await _0x1c94c3[_0x40d808(0x101)](_0xa7666c+_0x40d808(0xcf),{'text':_0x40d808(0x10e)}),!![];const _0x5c5074=_0xc9ca29[_0x40d808(0x107)][_0x40d808(0x100)](_0x21758a=>_0x21758a['id']),_0x5923f4=_0x13a24c?.[_0x40d808(0xd9)];if(_0x5923f4){if(!_0x5c5074[_0x40d808(0x10d)](_0x5923f4))return console[_0x40d808(0xe2)]('O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.'),await _0x1c94c3['sendMessage'](_0xa7666c+'@s.whatsapp.net',{'text':_0x40d808(0xda)}),!![];}else{if(_0x13a24c[_0x40d808(0xf6)]!==_0xc9ca29['id'])return console[_0x40d808(0xe2)](_0x40d808(0xf2)),await _0x1c94c3[_0x40d808(0x101)](_0xa7666c+'@s.whatsapp.net',{'text':_0x40d808(0xee)}),!![];}if(_0x13a24c['contact'][_0x40d808(0xe4)]===_0xa7666c)return await _0x1c94c3[_0x40d808(0x101)](_0xa7666c+_0x40d808(0xcf),{'text':_0x40d808(0x104)}),!![];const _0x2e9fa1=(0x0,redis_1[_0x40d808(0xd3)])({'url':process[_0x40d808(0xe3)]['REDIS_URI']});await _0x2e9fa1[_0x40d808(0x105)]();let _0x3967db={'type':'user','ticketId':_0x13a24c['id'],'userId':_0xc9ca29['id'],'number':_0xa7666c,'companyId':_0x5e119c};await _0x2e9fa1[_0x40d808(0xe0)](_0x13a24c[_0x40d808(0xdc)][_0x40d808(0xe4)],JSON[_0x40d808(0xce)](_0x3967db),{'EX':0x15180}),_0x3967db={'type':_0x40d808(0xf7),'ticketId':_0x13a24c['id'],'number':_0x13a24c['contact'][_0x40d808(0xe4)],'userId':_0xc9ca29['id'],'companyId':_0x5e119c},await _0x2e9fa1[_0x40d808(0xe0)](_0xa7666c,JSON[_0x40d808(0xce)](_0x3967db),{'EX':0x15180}),await _0x2e9fa1[_0x40d808(0xd7)]();const _0x53b7f0=await(0x0,UpdateTicketService_1[_0x40d808(0x103)])({'ticketData':{'status':_0x40d808(0xd0),'userId':_0xc9ca29['id']},'ticketId':_0x13a24c['id'],'companyId':_0x5e119c});return await _0x1c94c3[_0x40d808(0x101)](_0xa7666c+_0x40d808(0xcf),{'text':_0x40d808(0xfa)}),!![];};exports['CheckConnection']=CheckConnection;const Disconnect=async({msg:_0x27a01b,companyId:_0x3ec24a,wbot:_0x2bbb0d})=>{const _0x45f1e3=a547_0x1f22c8;let _0x1ec1f2=![];const _0x390d04=(0x0,redis_1[_0x45f1e3(0xd3)])({'url':process[_0x45f1e3(0xe3)][_0x45f1e3(0xea)]});await _0x390d04['connect']();const _0x206459=_0x27a01b['key']['remoteJid'][_0x45f1e3(0xff)](_0x45f1e3(0xcf),''),_0x5e12ff=await _0x390d04['get'](_0x206459);if(_0x5e12ff){const _0x492142=JSON[_0x45f1e3(0xf0)](_0x5e12ff);if(_0x492142['type']==_0x45f1e3(0xf7)&&_0x492142[_0x45f1e3(0xe9)]==_0x3ec24a){const _0x168e47=await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x45f1e3(0x106),'userId':_0x492142[_0x45f1e3(0xf6)]},'ticketId':_0x492142[_0x45f1e3(0xdd)],'companyId':_0x3ec24a});await _0x390d04[_0x45f1e3(0xd4)](_0x206459),await _0x390d04[_0x45f1e3(0xd4)](_0x492142[_0x45f1e3(0xe4)]),await _0x2bbb0d[_0x45f1e3(0x101)](_0x206459+_0x45f1e3(0xcf),{'text':_0x45f1e3(0xd8)}),_0x1ec1f2=!![];}}return _0x390d04['disconnect'](),_0x1ec1f2;};exports[a547_0x1f22c8(0xf4)]=Disconnect;const ResponseProxy=async({msg:_0x152789,companyId:_0xfe39e1,wbot:_0x2fa67a})=>{const _0xdbe294=a547_0x1f22c8,_0x339ac5=(0x0,wbotMessageListener_1[_0xdbe294(0x10c)])(_0x152789),_0x2e6c34=_0x152789['key']['remoteJid'][_0xdbe294(0xff)](_0xdbe294(0xcf),'');if(_0x152789[_0xdbe294(0xe6)]['fromMe'])return![];const _0x1cefbd=(0x0,redis_1['createClient'])({'url':process[_0xdbe294(0xe3)][_0xdbe294(0xea)]});await _0x1cefbd[_0xdbe294(0x105)]();const _0x2a399a=await _0x1cefbd[_0xdbe294(0xed)](_0x2e6c34);if(!_0x2a399a)return![];const _0x4f17b2=JSON[_0xdbe294(0xf0)](_0x2a399a);if(_0x4f17b2['type']!=='assistant')return![];if(_0x339ac5[_0xdbe294(0xca)]()===_0xdbe294(0x108)){const _0xea2f3=await(0x0,exports[_0xdbe294(0xf4)])({'msg':_0x152789,'companyId':_0xfe39e1,'wbot':_0x2fa67a});if(_0xea2f3)return;}if(_0x339ac5[_0xdbe294(0xca)]()==_0xdbe294(0xd2)){}const _0x5883c9=await(0x0,ShowTicketService_1[_0xdbe294(0x103)])(_0x4f17b2['ticketId'],_0xfe39e1);let _0x155095={'id':_0x152789[_0xdbe294(0xe6)]['id'],'ticketId':_0x4f17b2[_0xdbe294(0xdd)],'body':_0x339ac5,'contactId':_0x5883c9[_0xdbe294(0xfd)],'fromMe':!![],'read':!![]};return await _0x2fa67a[_0xdbe294(0x101)](_0x4f17b2['number']+'@s.whatsapp.net',{'forward':_0x152789}),!![];};exports[a547_0x1f22c8(0xf8)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x3d6927,companyId:_0x17bc39,wbot:_0x4192cf,body:_0x4ba621})=>{const _0x1c58af=a547_0x1f22c8;if(_0x3d6927[_0x1c58af(0xe6)][_0x1c58af(0xdb)])return![];const _0x590dbe=_0x3d6927['key'][_0x1c58af(0xe5)]['replace'](_0x1c58af(0xcf),''),_0x1c2d55=(0x0,redis_1[_0x1c58af(0xd3)])({'url':process[_0x1c58af(0xe3)][_0x1c58af(0xea)]});await _0x1c2d55[_0x1c58af(0x105)]();const _0x2fabcf=await _0x1c2d55[_0x1c58af(0xed)](_0x590dbe);if(!_0x2fabcf)return![];const _0x379cbf=JSON[_0x1c58af(0xf0)](_0x2fabcf);if(_0x379cbf['type']!=_0x1c58af(0x102)||_0x379cbf[_0x1c58af(0xe9)]!=_0x17bc39)return![];return await _0x4192cf[_0x1c58af(0x101)](_0x379cbf[_0x1c58af(0xe4)]+'@s.whatsapp.net',{'forward':_0x3d6927}),!![];};function a547_0x52fc(_0x50624f,_0x177072){const _0x48ac95=a547_0x9ee1();return a547_0x52fc=function(_0x1c4d61,_0x137a59){_0x1c4d61=_0x1c4d61-0xc9;let _0x9ee1c4=_0x48ac95[_0x1c4d61];return _0x9ee1c4;},a547_0x52fc(_0x50624f,_0x177072);}exports[a547_0x1f22c8(0xe7)]=SendMessageConnectedStaffMember;