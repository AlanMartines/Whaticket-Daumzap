const a547_0x5424e9=a547_0x81fc;(function(_0x4277e5,_0x3e8061){const _0x442564=a547_0x81fc,_0x3b2493=_0x4277e5();while(!![]){try{const _0x2988d7=parseInt(_0x442564(0xf5))/0x1*(-parseInt(_0x442564(0xc6))/0x2)+parseInt(_0x442564(0xc4))/0x3+parseInt(_0x442564(0xce))/0x4+-parseInt(_0x442564(0xd1))/0x5+-parseInt(_0x442564(0xec))/0x6*(-parseInt(_0x442564(0xd3))/0x7)+parseInt(_0x442564(0xf0))/0x8*(-parseInt(_0x442564(0xb9))/0x9)+-parseInt(_0x442564(0xc7))/0xa*(-parseInt(_0x442564(0xda))/0xb);if(_0x2988d7===_0x3e8061)break;else _0x3b2493['push'](_0x3b2493['shift']());}catch(_0x3ea662){_0x3b2493['push'](_0x3b2493['shift']());}}}(a547_0x2329,0xe5881));const a547_0x2a1a43=(function(){let _0x90d2e0=!![];return function(_0x47dbe3,_0x3bed96){const _0x14166d=_0x90d2e0?function(){if(_0x3bed96){const _0x2dbfdc=_0x3bed96['apply'](_0x47dbe3,arguments);return _0x3bed96=null,_0x2dbfdc;}}:function(){};return _0x90d2e0=![],_0x14166d;};}()),a547_0x2e80d5=a547_0x2a1a43(this,function(){const _0x5586eb=a547_0x81fc;return a547_0x2e80d5[_0x5586eb(0xca)]()[_0x5586eb(0xcc)](_0x5586eb(0xc5))['toString']()['constructor'](a547_0x2e80d5)[_0x5586eb(0xcc)](_0x5586eb(0xc5));});a547_0x2e80d5();'use strict';function a547_0x81fc(_0x282679,_0x856e22){const _0x55f7e7=a547_0x2329();return a547_0x81fc=function(_0x2e80d5,_0x2a1a43){_0x2e80d5=_0x2e80d5-0xb7;let _0x232980=_0x55f7e7[_0x2e80d5];return _0x232980;},a547_0x81fc(_0x282679,_0x856e22);}var __importDefault=this&&this[a547_0x5424e9(0xdb)]||function(_0x7d26f2){const _0x4a295d=a547_0x5424e9;return _0x7d26f2&&_0x7d26f2[_0x4a295d(0xf1)]?_0x7d26f2:{'default':_0x7d26f2};};Object['defineProperty'](exports,a547_0x5424e9(0xf1),{'value':!![]}),exports[a547_0x5424e9(0xb7)]=exports[a547_0x5424e9(0xe9)]=exports[a547_0x5424e9(0xd4)]=exports[a547_0x5424e9(0xd6)]=void 0x0;function a547_0x2329(){const _0x334327=['createClient','ResponseProxy','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','pending','42RqeNOQ','../../models/Ticket','userId','type','9032IfCdWM','__esModule','user','remoteJid','get','16381mbGjAF','Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!','SendMessageConnectedStaffMember','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','4410OzLLdp','@s.whatsapp.net','../../models/Contact','contactId','disconnect','connect','fromMe','REDIS_URI','redis','sendMessage','../TicketServices/ShowTicketService','3344007zyxkGQ','(((.+)+)+)+$','134IohuRd','11661250IHxmtv','log','parse','toString','companyId','search','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','4943008JvFPht','ticketId','del','5278435AAANrE','findOne','130039ObhnXN','Disconnect','queueId','CheckConnection','../TicketServices/UpdateTicketService','replace','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','11YmegbS','__importDefault','sair','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','assistant','../../models/User','default','number','stringify','../WbotServices/wbotMessageListener','contact','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','env','key'];a547_0x2329=function(){return _0x334327;};return a547_0x2329();}const Ticket_1=__importDefault(require(a547_0x5424e9(0xed))),User_1=__importDefault(require(a547_0x5424e9(0xdf))),redis_1=require(a547_0x5424e9(0xc1)),Contact_1=__importDefault(require(a547_0x5424e9(0xbb))),UpdateTicketService_1=__importDefault(require(a547_0x5424e9(0xd7))),wbotMessageListener_1=require(a547_0x5424e9(0xe3)),ShowTicketService_1=__importDefault(require(a547_0x5424e9(0xc3))),Queue_1=__importDefault(require('../../models/Queue')),CheckConnection=async({waid:_0x5c60e5,code:_0x2fc162,companyId:_0x48634d,wbot:_0xb7f629})=>{const _0x527689=a547_0x5424e9,_0x474b54=await User_1[_0x527689(0xe0)][_0x527689(0xd2)]({'where':{'waid':_0x5c60e5,'companyId':_0x48634d},'include':[{'model':Queue_1[_0x527689(0xe0)]}]});if(!_0x474b54)return![];const _0x2f131e=await Ticket_1[_0x527689(0xe0)][_0x527689(0xd2)]({'where':{'iCode':_0x2fc162,'companyId':_0x48634d,'status':_0x527689(0xeb)},'include':[{'model':Contact_1[_0x527689(0xe0)]},{'model':Queue_1[_0x527689(0xe0)]}]});if(!_0x2f131e)return await _0xb7f629[_0x527689(0xc2)](_0x5c60e5+_0x527689(0xba),{'text':_0x527689(0xf6)}),!![];const _0x37da10=_0x474b54['queues']['map'](_0x37da62=>_0x37da62['id']),_0x4fdac7=_0x2f131e?.[_0x527689(0xd5)];if(_0x4fdac7){if(!_0x37da10['includes'](_0x4fdac7))return console[_0x527689(0xc8)](_0x527689(0xdd)),await _0xb7f629[_0x527689(0xc2)](_0x5c60e5+_0x527689(0xba),{'text':_0x527689(0xcd)}),!![];}else{if(_0x2f131e[_0x527689(0xee)]!==_0x474b54['id'])return console[_0x527689(0xc8)](_0x527689(0xea)),await _0xb7f629[_0x527689(0xc2)](_0x5c60e5+_0x527689(0xba),{'text':_0x527689(0xe5)}),!![];}if(_0x2f131e[_0x527689(0xe4)][_0x527689(0xe1)]===_0x5c60e5)return await _0xb7f629[_0x527689(0xc2)](_0x5c60e5+'@s.whatsapp.net',{'text':_0x527689(0xb8)}),!![];const _0x172b2d=(0x0,redis_1['createClient'])({'url':process['env'][_0x527689(0xc0)]});await _0x172b2d[_0x527689(0xbe)]();let _0x1972bc={'type':_0x527689(0xf2),'ticketId':_0x2f131e['id'],'userId':_0x474b54['id'],'number':_0x5c60e5,'companyId':_0x48634d};await _0x172b2d['set'](_0x2f131e['contact']['number'],JSON['stringify'](_0x1972bc),{'EX':0x15180}),_0x1972bc={'type':'assistant','ticketId':_0x2f131e['id'],'number':_0x2f131e[_0x527689(0xe4)]['number'],'userId':_0x474b54['id'],'companyId':_0x48634d},await _0x172b2d['set'](_0x5c60e5,JSON[_0x527689(0xe2)](_0x1972bc),{'EX':0x15180}),await _0x172b2d[_0x527689(0xbd)]();const _0x2ad301=await(0x0,UpdateTicketService_1[_0x527689(0xe0)])({'ticketData':{'status':'open','userId':_0x474b54['id']},'ticketId':_0x2f131e['id'],'companyId':_0x48634d});return await _0xb7f629['sendMessage'](_0x5c60e5+_0x527689(0xba),{'text':_0x527689(0xd9)}),!![];};exports[a547_0x5424e9(0xd6)]=CheckConnection;const Disconnect=async({msg:_0x1ab9f4,companyId:_0x26208e,wbot:_0x3d0151})=>{const _0x47f2f6=a547_0x5424e9;let _0x161cd6=![];const _0x579828=(0x0,redis_1[_0x47f2f6(0xe8)])({'url':process[_0x47f2f6(0xe6)]['REDIS_URI']});await _0x579828[_0x47f2f6(0xbe)]();const _0x5887b2=_0x1ab9f4[_0x47f2f6(0xe7)][_0x47f2f6(0xf3)]['replace'](_0x47f2f6(0xba),''),_0x3ff5c6=await _0x579828[_0x47f2f6(0xf4)](_0x5887b2);if(_0x3ff5c6){const _0x89d980=JSON[_0x47f2f6(0xc9)](_0x3ff5c6);if(_0x89d980[_0x47f2f6(0xef)]==_0x47f2f6(0xde)&&_0x89d980[_0x47f2f6(0xcb)]==_0x26208e){const _0x2fd58d=await(0x0,UpdateTicketService_1[_0x47f2f6(0xe0)])({'ticketData':{'status':'closed','userId':_0x89d980[_0x47f2f6(0xee)]},'ticketId':_0x89d980[_0x47f2f6(0xcf)],'companyId':_0x26208e});await _0x579828[_0x47f2f6(0xd0)](_0x5887b2),await _0x579828['del'](_0x89d980[_0x47f2f6(0xe1)]),await _0x3d0151['sendMessage'](_0x5887b2+_0x47f2f6(0xba),{'text':'Desconectado\x20com\x20sucesso'}),_0x161cd6=!![];}}return _0x579828[_0x47f2f6(0xbd)](),_0x161cd6;};exports[a547_0x5424e9(0xd4)]=Disconnect;const ResponseProxy=async({msg:_0x3edf71,companyId:_0x319480,wbot:_0x1f9188})=>{const _0x6ab70f=a547_0x5424e9,_0x2fd166=(0x0,wbotMessageListener_1['getBodyMessage'])(_0x3edf71),_0x161f4a=_0x3edf71[_0x6ab70f(0xe7)][_0x6ab70f(0xf3)][_0x6ab70f(0xd8)](_0x6ab70f(0xba),'');if(_0x3edf71['key'][_0x6ab70f(0xbf)])return![];const _0x1c12f7=(0x0,redis_1[_0x6ab70f(0xe8)])({'url':process['env'][_0x6ab70f(0xc0)]});await _0x1c12f7['connect']();const _0x3017ca=await _0x1c12f7[_0x6ab70f(0xf4)](_0x161f4a);if(!_0x3017ca)return![];const _0x1453ed=JSON[_0x6ab70f(0xc9)](_0x3017ca);if(_0x1453ed['type']!==_0x6ab70f(0xde))return![];if(_0x2fd166['toLowerCase']()===_0x6ab70f(0xdc)){const _0x22f5ea=await(0x0,exports[_0x6ab70f(0xd4)])({'msg':_0x3edf71,'companyId':_0x319480,'wbot':_0x1f9188});if(_0x22f5ea)return;}if(_0x2fd166['toLowerCase']()=='audio'){}const _0x143f01=await(0x0,ShowTicketService_1[_0x6ab70f(0xe0)])(_0x1453ed[_0x6ab70f(0xcf)],_0x319480);let _0x2c9d9b={'id':_0x3edf71[_0x6ab70f(0xe7)]['id'],'ticketId':_0x1453ed[_0x6ab70f(0xcf)],'body':_0x2fd166,'contactId':_0x143f01[_0x6ab70f(0xbc)],'fromMe':!![],'read':!![]};return await _0x1f9188['sendMessage'](_0x1453ed[_0x6ab70f(0xe1)]+_0x6ab70f(0xba),{'forward':_0x3edf71}),!![];};exports['ResponseProxy']=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x138192,companyId:_0x4ebd1e,wbot:_0x51249d,body:_0xc605c})=>{const _0x3fd187=a547_0x5424e9;if(_0x138192[_0x3fd187(0xe7)][_0x3fd187(0xbf)])return![];const _0xb46283=_0x138192[_0x3fd187(0xe7)][_0x3fd187(0xf3)][_0x3fd187(0xd8)]('@s.whatsapp.net',''),_0x5f1de5=(0x0,redis_1[_0x3fd187(0xe8)])({'url':process[_0x3fd187(0xe6)][_0x3fd187(0xc0)]});await _0x5f1de5[_0x3fd187(0xbe)]();const _0x5c45b4=await _0x5f1de5[_0x3fd187(0xf4)](_0xb46283);if(!_0x5c45b4)return![];const _0x128577=JSON['parse'](_0x5c45b4);if(_0x128577[_0x3fd187(0xef)]!=_0x3fd187(0xf2)||_0x128577[_0x3fd187(0xcb)]!=_0x4ebd1e)return![];return await _0x51249d[_0x3fd187(0xc2)](_0x128577[_0x3fd187(0xe1)]+'@s.whatsapp.net',{'forward':_0x138192}),!![];};exports[a547_0x5424e9(0xb7)]=SendMessageConnectedStaffMember;