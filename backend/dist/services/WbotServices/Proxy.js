const a547_0x58e7cf=a547_0xa1b5;(function(_0x171030,_0xe1452c){const _0x2b6250=a547_0xa1b5,_0x21a9a4=_0x171030();while(!![]){try{const _0x4f4bf3=parseInt(_0x2b6250(0x1f1))/0x1+parseInt(_0x2b6250(0x211))/0x2*(parseInt(_0x2b6250(0x1e4))/0x3)+-parseInt(_0x2b6250(0x1e7))/0x4+parseInt(_0x2b6250(0x1de))/0x5*(parseInt(_0x2b6250(0x218))/0x6)+parseInt(_0x2b6250(0x21d))/0x7*(parseInt(_0x2b6250(0x1f0))/0x8)+-parseInt(_0x2b6250(0x210))/0x9+-parseInt(_0x2b6250(0x1df))/0xa;if(_0x4f4bf3===_0xe1452c)break;else _0x21a9a4['push'](_0x21a9a4['shift']());}catch(_0x356f33){_0x21a9a4['push'](_0x21a9a4['shift']());}}}(a547_0xfd8b,0x656c0));const a547_0x31cd95=(function(){let _0x5a662d=!![];return function(_0xceb5ef,_0x26ed7a){const _0x4c21da=_0x5a662d?function(){const _0xa73e96=a547_0xa1b5;if(_0x26ed7a){const _0x4bd175=_0x26ed7a[_0xa73e96(0x1f9)](_0xceb5ef,arguments);return _0x26ed7a=null,_0x4bd175;}}:function(){};return _0x5a662d=![],_0x4c21da;};}()),a547_0xe8b37c=a547_0x31cd95(this,function(){const _0x2da58b=a547_0xa1b5;return a547_0xe8b37c[_0x2da58b(0x1fa)]()['search'](_0x2da58b(0x20e))['toString']()[_0x2da58b(0x20f)](a547_0xe8b37c)[_0x2da58b(0x1ed)]('(((.+)+)+)+$');});a547_0xe8b37c();'use strict';function a547_0xfd8b(){const _0x5219a7=['redis','findOne','16VkVulq','536854rZHjfB','createClient','toLowerCase','@s.whatsapp.net','queues','../../models/Ticket','contact','assistant','apply','toString','default','parse','fromMe','key','Disconnect','../TicketServices/UpdateTicketService','ticketId','ResponseProxy','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','stringify','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','log','user','remoteJid','sendMessage','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','__esModule','env','(((.+)+)+)+$','constructor','3988881yRgXRU','4KeuOLo','get','set','audio','type','../../models/User','del','366nLZGtR','userId','connect','number','replace','61257fzxvon','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','includes','defineProperty','open','26465NzXHAD','3597220feerwN','disconnect','../WbotServices/wbotMessageListener','closed','contactId','651894RyGxAD','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','__importDefault','373880LMRDyw','sair','queueId','REDIS_URI','CheckConnection','SendMessageConnectedStaffMember','search'];a547_0xfd8b=function(){return _0x5219a7;};return a547_0xfd8b();}var __importDefault=this&&this[a547_0x58e7cf(0x1e6)]||function(_0x1d01cc){const _0x32a890=a547_0x58e7cf;return _0x1d01cc&&_0x1d01cc[_0x32a890(0x20c)]?_0x1d01cc:{'default':_0x1d01cc};};Object[a547_0x58e7cf(0x220)](exports,a547_0x58e7cf(0x20c),{'value':!![]}),exports['SendMessageConnectedStaffMember']=exports[a547_0x58e7cf(0x202)]=exports[a547_0x58e7cf(0x1ff)]=exports[a547_0x58e7cf(0x1eb)]=void 0x0;const Ticket_1=__importDefault(require(a547_0x58e7cf(0x1f6))),User_1=__importDefault(require(a547_0x58e7cf(0x216))),redis_1=require(a547_0x58e7cf(0x1ee)),Contact_1=__importDefault(require('../../models/Contact')),UpdateTicketService_1=__importDefault(require(a547_0x58e7cf(0x200))),wbotMessageListener_1=require(a547_0x58e7cf(0x1e1)),ShowTicketService_1=__importDefault(require('../TicketServices/ShowTicketService')),Queue_1=__importDefault(require('../../models/Queue')),CheckConnection=async({waid:_0x2f5682,code:_0x3581b3,companyId:_0x4fcac9,wbot:_0x24164b})=>{const _0x163f0e=a547_0x58e7cf,_0x2dc6c2=await User_1[_0x163f0e(0x1fb)][_0x163f0e(0x1ef)]({'where':{'waid':_0x2f5682,'companyId':_0x4fcac9},'include':[{'model':Queue_1['default']}]});if(!_0x2dc6c2)return![];const _0x149d8a=await Ticket_1[_0x163f0e(0x1fb)][_0x163f0e(0x1ef)]({'where':{'iCode':_0x3581b3,'companyId':_0x4fcac9,'status':'pending'},'include':[{'model':Contact_1[_0x163f0e(0x1fb)]},{'model':Queue_1['default']}]});if(!_0x149d8a)return await _0x24164b['sendMessage'](_0x2f5682+_0x163f0e(0x1f4),{'text':'Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!'}),!![];const _0x3fe9ef=_0x2dc6c2[_0x163f0e(0x1f5)]['map'](_0xfc4549=>_0xfc4549['id']),_0x1f9132=_0x149d8a?.[_0x163f0e(0x1e9)];if(_0x1f9132){if(!_0x3fe9ef[_0x163f0e(0x21f)](_0x1f9132))return console[_0x163f0e(0x207)](_0x163f0e(0x203)),await _0x24164b[_0x163f0e(0x20a)](_0x2f5682+_0x163f0e(0x1f4),{'text':_0x163f0e(0x1e5)}),!![];}else{if(_0x149d8a[_0x163f0e(0x219)]!==_0x2dc6c2['id'])return console[_0x163f0e(0x207)](_0x163f0e(0x204)),await _0x24164b[_0x163f0e(0x20a)](_0x2f5682+_0x163f0e(0x1f4),{'text':_0x163f0e(0x206)}),!![];}if(_0x149d8a[_0x163f0e(0x1f7)][_0x163f0e(0x21b)]===_0x2f5682)return await _0x24164b[_0x163f0e(0x20a)](_0x2f5682+_0x163f0e(0x1f4),{'text':_0x163f0e(0x21e)}),!![];const _0x4cadd0=(0x0,redis_1[_0x163f0e(0x1f2)])({'url':process['env'][_0x163f0e(0x1ea)]});await _0x4cadd0['connect']();let _0x462fac={'type':'user','ticketId':_0x149d8a['id'],'userId':_0x2dc6c2['id'],'number':_0x2f5682,'companyId':_0x4fcac9};await _0x4cadd0[_0x163f0e(0x213)](_0x149d8a[_0x163f0e(0x1f7)]['number'],JSON[_0x163f0e(0x205)](_0x462fac),{'EX':0x15180}),_0x462fac={'type':_0x163f0e(0x1f8),'ticketId':_0x149d8a['id'],'number':_0x149d8a[_0x163f0e(0x1f7)][_0x163f0e(0x21b)],'userId':_0x2dc6c2['id'],'companyId':_0x4fcac9},await _0x4cadd0[_0x163f0e(0x213)](_0x2f5682,JSON[_0x163f0e(0x205)](_0x462fac),{'EX':0x15180}),await _0x4cadd0[_0x163f0e(0x1e0)]();const _0x5268e4=await(0x0,UpdateTicketService_1[_0x163f0e(0x1fb)])({'ticketData':{'status':_0x163f0e(0x221),'userId':_0x2dc6c2['id']},'ticketId':_0x149d8a['id'],'companyId':_0x4fcac9});return await _0x24164b['sendMessage'](_0x2f5682+_0x163f0e(0x1f4),{'text':_0x163f0e(0x20b)}),!![];};exports['CheckConnection']=CheckConnection;function a547_0xa1b5(_0x5f3329,_0x4aec9f){const _0x4b1abb=a547_0xfd8b();return a547_0xa1b5=function(_0xe8b37c,_0x31cd95){_0xe8b37c=_0xe8b37c-0x1de;let _0xfd8b40=_0x4b1abb[_0xe8b37c];return _0xfd8b40;},a547_0xa1b5(_0x5f3329,_0x4aec9f);}const Disconnect=async({msg:_0x52673c,companyId:_0x3ca002,wbot:_0xbf6ce})=>{const _0x3b30ff=a547_0x58e7cf;let _0x5486a3=![];const _0x53c5f8=(0x0,redis_1[_0x3b30ff(0x1f2)])({'url':process['env']['REDIS_URI']});await _0x53c5f8[_0x3b30ff(0x21a)]();const _0x26848b=_0x52673c['key'][_0x3b30ff(0x209)]['replace']('@s.whatsapp.net',''),_0xe09ba3=await _0x53c5f8['get'](_0x26848b);if(_0xe09ba3){const _0x2a9d86=JSON['parse'](_0xe09ba3);if(_0x2a9d86[_0x3b30ff(0x215)]==_0x3b30ff(0x1f8)&&_0x2a9d86['companyId']==_0x3ca002){const _0x32a27d=await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x3b30ff(0x1e2),'userId':_0x2a9d86['userId']},'ticketId':_0x2a9d86[_0x3b30ff(0x201)],'companyId':_0x3ca002});await _0x53c5f8['del'](_0x26848b),await _0x53c5f8[_0x3b30ff(0x217)](_0x2a9d86['number']),await _0xbf6ce[_0x3b30ff(0x20a)](_0x26848b+_0x3b30ff(0x1f4),{'text':'Desconectado\x20com\x20sucesso'}),_0x5486a3=!![];}}return _0x53c5f8[_0x3b30ff(0x1e0)](),_0x5486a3;};exports[a547_0x58e7cf(0x1ff)]=Disconnect;const ResponseProxy=async({msg:_0x231a61,companyId:_0x310e38,wbot:_0x1154e4})=>{const _0x12c2b0=a547_0x58e7cf,_0x3a907c=(0x0,wbotMessageListener_1['getBodyMessage'])(_0x231a61),_0x1203d8=_0x231a61[_0x12c2b0(0x1fe)][_0x12c2b0(0x209)][_0x12c2b0(0x21c)](_0x12c2b0(0x1f4),'');if(_0x231a61['key'][_0x12c2b0(0x1fd)])return![];const _0x5ec245=(0x0,redis_1[_0x12c2b0(0x1f2)])({'url':process[_0x12c2b0(0x20d)][_0x12c2b0(0x1ea)]});await _0x5ec245[_0x12c2b0(0x21a)]();const _0x40a3a2=await _0x5ec245[_0x12c2b0(0x212)](_0x1203d8);if(!_0x40a3a2)return![];const _0x3505c0=JSON[_0x12c2b0(0x1fc)](_0x40a3a2);if(_0x3505c0['type']!==_0x12c2b0(0x1f8))return![];if(_0x3a907c[_0x12c2b0(0x1f3)]()===_0x12c2b0(0x1e8)){const _0x23e579=await(0x0,exports[_0x12c2b0(0x1ff)])({'msg':_0x231a61,'companyId':_0x310e38,'wbot':_0x1154e4});if(_0x23e579)return;}if(_0x3a907c[_0x12c2b0(0x1f3)]()==_0x12c2b0(0x214)){}const _0x40afc8=await(0x0,ShowTicketService_1[_0x12c2b0(0x1fb)])(_0x3505c0[_0x12c2b0(0x201)],_0x310e38);let _0x4bf3b5={'id':_0x231a61[_0x12c2b0(0x1fe)]['id'],'ticketId':_0x3505c0[_0x12c2b0(0x201)],'body':_0x3a907c,'contactId':_0x40afc8[_0x12c2b0(0x1e3)],'fromMe':!![],'read':!![]};return await _0x1154e4[_0x12c2b0(0x20a)](_0x3505c0[_0x12c2b0(0x21b)]+_0x12c2b0(0x1f4),{'forward':_0x231a61}),!![];};exports[a547_0x58e7cf(0x202)]=ResponseProxy;const SendMessageConnectedStaffMember=async({msg:_0x5dc041,companyId:_0x3eba98,wbot:_0x2173d8,body:_0x36049c})=>{const _0x2dfa25=a547_0x58e7cf;if(_0x5dc041[_0x2dfa25(0x1fe)][_0x2dfa25(0x1fd)])return![];const _0x3b726c=_0x5dc041[_0x2dfa25(0x1fe)][_0x2dfa25(0x209)][_0x2dfa25(0x21c)]('@s.whatsapp.net',''),_0x5b07f3=(0x0,redis_1[_0x2dfa25(0x1f2)])({'url':process[_0x2dfa25(0x20d)][_0x2dfa25(0x1ea)]});await _0x5b07f3['connect']();const _0xacca4d=await _0x5b07f3[_0x2dfa25(0x212)](_0x3b726c);if(!_0xacca4d)return![];const _0x30f929=JSON[_0x2dfa25(0x1fc)](_0xacca4d);if(_0x30f929[_0x2dfa25(0x215)]!=_0x2dfa25(0x208)||_0x30f929['companyId']!=_0x3eba98)return![];return await _0x2173d8[_0x2dfa25(0x20a)](_0x30f929[_0x2dfa25(0x21b)]+'@s.whatsapp.net',{'forward':_0x5dc041}),!![];};exports[a547_0x58e7cf(0x1ec)]=SendMessageConnectedStaffMember;