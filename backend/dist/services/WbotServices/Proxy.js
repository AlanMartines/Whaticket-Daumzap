const a547_0x137cd4=a547_0x430c;(function(_0x747119,_0x1d3349){const _0x3e3a54=a547_0x430c,_0x22ee4a=_0x747119();while(!![]){try{const _0x3b6d97=parseInt(_0x3e3a54(0xc0))/0x1+-parseInt(_0x3e3a54(0xa0))/0x2*(parseInt(_0x3e3a54(0xcc))/0x3)+-parseInt(_0x3e3a54(0xcb))/0x4+-parseInt(_0x3e3a54(0xa7))/0x5*(-parseInt(_0x3e3a54(0xad))/0x6)+parseInt(_0x3e3a54(0xba))/0x7*(-parseInt(_0x3e3a54(0xcd))/0x8)+-parseInt(_0x3e3a54(0xa3))/0x9*(parseInt(_0x3e3a54(0x98))/0xa)+-parseInt(_0x3e3a54(0x94))/0xb*(-parseInt(_0x3e3a54(0x91))/0xc);if(_0x3b6d97===_0x1d3349)break;else _0x22ee4a['push'](_0x22ee4a['shift']());}catch(_0x1164ea){_0x22ee4a['push'](_0x22ee4a['shift']());}}}(a547_0x4139,0x5a2a1));const a547_0x4aaff8=(function(){let _0x5774aa=!![];return function(_0x2b90ad,_0x157109){const _0x5e3e78=_0x5774aa?function(){const _0x353469=a547_0x430c;if(_0x157109){const _0x5bc768=_0x157109[_0x353469(0x9b)](_0x2b90ad,arguments);return _0x157109=null,_0x5bc768;}}:function(){};return _0x5774aa=![],_0x5e3e78;};}()),a547_0xf23e96=a547_0x4aaff8(this,function(){const _0x3c8bce=a547_0x430c;return a547_0xf23e96[_0x3c8bce(0xb8)]()['search'](_0x3c8bce(0xce))['toString']()[_0x3c8bce(0xc3)](a547_0xf23e96)[_0x3c8bce(0xaf)](_0x3c8bce(0xce));});a547_0xf23e96();'use strict';var __importDefault=this&&this[a547_0x137cd4(0xc5)]||function(_0xb61147){const _0x58ee78=a547_0x137cd4;return _0xb61147&&_0xb61147[_0x58ee78(0x9c)]?_0xb61147:{'default':_0xb61147};};function a547_0x4139(){const _0x3e16c0=['apply','__esModule','Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.','defineProperty','companyId','2566jUkMYC','createClient','Disconnect','144mgrjWH','default','ticketId','connect','1337885OeDXik','number','toLowerCase','../TicketServices/ShowTicketService','open','sendMessage','12NbLqqj','get','search','pending','SendMessageConnectedStaffMember','fromMe','../../models/Queue','remoteJid','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','../TicketServices/UpdateTicketService','redis','toString','parse','768271gEDXDX','assistant','userId','ResponseProxy','del','getBodyMessage','644979fiOQwf','queues','@s.whatsapp.net','constructor','log','__importDefault','CheckConnection','REDIS_URI','../../models/Ticket','../../models/User','env','962568WjaprN','27cnNvxz','16bOSvgG','(((.+)+)+)+$','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','type','map','sair','user','queueId','../../models/Contact','contactId','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.','replace','204BNZYoi','set','findOne','1529hIdwZs','key','includes','contact','213430XaHEeh','audio','stringify'];a547_0x4139=function(){return _0x3e16c0;};return a547_0x4139();}Object[a547_0x137cd4(0x9e)](exports,a547_0x137cd4(0x9c),{'value':!![]}),exports[a547_0x137cd4(0xb1)]=exports[a547_0x137cd4(0xbd)]=exports['Disconnect']=exports[a547_0x137cd4(0xc6)]=void 0x0;const Ticket_1=__importDefault(require(a547_0x137cd4(0xc8))),User_1=__importDefault(require(a547_0x137cd4(0xc9))),redis_1=require(a547_0x137cd4(0xb7)),Contact_1=__importDefault(require(a547_0x137cd4(0xd5))),UpdateTicketService_1=__importDefault(require(a547_0x137cd4(0xb6))),wbotMessageListener_1=require('../WbotServices/wbotMessageListener'),ShowTicketService_1=__importDefault(require(a547_0x137cd4(0xaa))),Queue_1=__importDefault(require(a547_0x137cd4(0xb3))),CheckConnection=async({waid:_0x188f8a,code:_0x454a6a,companyId:_0x2f5f6e,wbot:_0x26cabd})=>{const _0x398089=a547_0x137cd4,_0x5b5dab=await User_1[_0x398089(0xa4)][_0x398089(0x93)]({'where':{'waid':_0x188f8a,'companyId':_0x2f5f6e},'include':[{'model':Queue_1['default']}]});if(!_0x5b5dab)return![];const _0x282b6b=await Ticket_1[_0x398089(0xa4)][_0x398089(0x93)]({'where':{'iCode':_0x454a6a,'companyId':_0x2f5f6e,'status':_0x398089(0xb0)},'include':[{'model':Contact_1[_0x398089(0xa4)]},{'model':Queue_1[_0x398089(0xa4)]}]});if(!_0x282b6b)return await _0x26cabd[_0x398089(0xac)](_0x188f8a+'@s.whatsapp.net',{'text':'Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!'}),!![];const _0x6082be=_0x5b5dab[_0x398089(0xc1)][_0x398089(0xd1)](_0x42fd12=>_0x42fd12['id']),_0x241719=_0x282b6b?.[_0x398089(0xd4)];if(_0x241719){if(!_0x6082be[_0x398089(0x96)](_0x241719))return console[_0x398089(0xc4)](_0x398089(0xd7)),await _0x26cabd['sendMessage'](_0x188f8a+'@s.whatsapp.net',{'text':_0x398089(0xcf)}),!![];}else{if(_0x282b6b[_0x398089(0xbc)]!==_0x5b5dab['id'])return console[_0x398089(0xc4)]('O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.'),await _0x26cabd[_0x398089(0xac)](_0x188f8a+_0x398089(0xc2),{'text':_0x398089(0x9d)}),!![];}if(_0x282b6b['contact'][_0x398089(0xa8)]===_0x188f8a)return await _0x26cabd['sendMessage'](_0x188f8a+_0x398089(0xc2),{'text':'Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!'}),!![];const _0x1dafc1=(0x0,redis_1[_0x398089(0xa1)])({'url':process[_0x398089(0xca)][_0x398089(0xc7)]});await _0x1dafc1['connect']();let _0x3d96bc={'type':'user','ticketId':_0x282b6b['id'],'userId':_0x5b5dab['id'],'number':_0x188f8a,'companyId':_0x2f5f6e};await _0x1dafc1[_0x398089(0x92)](_0x282b6b[_0x398089(0x97)][_0x398089(0xa8)],JSON[_0x398089(0x9a)](_0x3d96bc),{'EX':0x15180}),_0x3d96bc={'type':'assistant','ticketId':_0x282b6b['id'],'number':_0x282b6b[_0x398089(0x97)][_0x398089(0xa8)],'userId':_0x5b5dab['id'],'companyId':_0x2f5f6e},await _0x1dafc1['set'](_0x188f8a,JSON[_0x398089(0x9a)](_0x3d96bc),{'EX':0x15180}),await _0x1dafc1['disconnect']();const _0x5b1879=await(0x0,UpdateTicketService_1[_0x398089(0xa4)])({'ticketData':{'status':_0x398089(0xab),'userId':_0x5b5dab['id']},'ticketId':_0x282b6b['id'],'companyId':_0x2f5f6e});return await _0x26cabd['sendMessage'](_0x188f8a+_0x398089(0xc2),{'text':_0x398089(0xb5)}),!![];};exports[a547_0x137cd4(0xc6)]=CheckConnection;const Disconnect=async({msg:_0x56bae7,companyId:_0x464bb5,wbot:_0x181467})=>{const _0x9999b3=a547_0x137cd4;let _0x1aa203=![];const _0x3e6419=(0x0,redis_1[_0x9999b3(0xa1)])({'url':process['env'][_0x9999b3(0xc7)]});await _0x3e6419[_0x9999b3(0xa6)]();const _0x3624a8=_0x56bae7[_0x9999b3(0x95)][_0x9999b3(0xb4)]['replace'](_0x9999b3(0xc2),''),_0xe9205=await _0x3e6419['get'](_0x3624a8);if(_0xe9205){const _0x2019ea=JSON[_0x9999b3(0xb9)](_0xe9205);if(_0x2019ea['type']==_0x9999b3(0xbb)&&_0x2019ea[_0x9999b3(0x9f)]==_0x464bb5){const _0x40d2d2=await(0x0,UpdateTicketService_1[_0x9999b3(0xa4)])({'ticketData':{'status':'closed','userId':_0x2019ea[_0x9999b3(0xbc)]},'ticketId':_0x2019ea['ticketId'],'companyId':_0x464bb5});await _0x3e6419[_0x9999b3(0xbe)](_0x3624a8),await _0x3e6419['del'](_0x2019ea['number']),await _0x181467[_0x9999b3(0xac)](_0x3624a8+_0x9999b3(0xc2),{'text':'Desconectado\x20com\x20sucesso'}),_0x1aa203=!![];}}return _0x3e6419['disconnect'](),_0x1aa203;};exports[a547_0x137cd4(0xa2)]=Disconnect;const ResponseProxy=async({msg:_0x35640d,companyId:_0x9bc214,wbot:_0x4aa5fd})=>{const _0x997ebe=a547_0x137cd4,_0x6bf4bf=(0x0,wbotMessageListener_1[_0x997ebe(0xbf)])(_0x35640d),_0x583314=_0x35640d['key'][_0x997ebe(0xb4)][_0x997ebe(0xd8)](_0x997ebe(0xc2),'');if(_0x35640d[_0x997ebe(0x95)][_0x997ebe(0xb2)])return![];const _0xe22b4=(0x0,redis_1[_0x997ebe(0xa1)])({'url':process[_0x997ebe(0xca)][_0x997ebe(0xc7)]});await _0xe22b4[_0x997ebe(0xa6)]();const _0x1d52c3=await _0xe22b4[_0x997ebe(0xae)](_0x583314);if(!_0x1d52c3)return![];const _0x553a5b=JSON[_0x997ebe(0xb9)](_0x1d52c3);if(_0x553a5b[_0x997ebe(0xd0)]!=='assistant')return![];if(_0x6bf4bf[_0x997ebe(0xa9)]()===_0x997ebe(0xd2)){const _0x455ea0=await(0x0,exports['Disconnect'])({'msg':_0x35640d,'companyId':_0x9bc214,'wbot':_0x4aa5fd});if(_0x455ea0)return;}if(_0x6bf4bf[_0x997ebe(0xa9)]()==_0x997ebe(0x99)){}const _0x4a0161=await(0x0,ShowTicketService_1[_0x997ebe(0xa4)])(_0x553a5b[_0x997ebe(0xa5)],_0x9bc214);let _0xbbd034={'id':_0x35640d[_0x997ebe(0x95)]['id'],'ticketId':_0x553a5b[_0x997ebe(0xa5)],'body':_0x6bf4bf,'contactId':_0x4a0161[_0x997ebe(0xd6)],'fromMe':!![],'read':!![]};return await _0x4aa5fd[_0x997ebe(0xac)](_0x553a5b['number']+_0x997ebe(0xc2),{'forward':_0x35640d}),!![];};exports[a547_0x137cd4(0xbd)]=ResponseProxy;function a547_0x430c(_0x319f25,_0x590414){const _0x1cfa6a=a547_0x4139();return a547_0x430c=function(_0xf23e96,_0x4aaff8){_0xf23e96=_0xf23e96-0x91;let _0x41393f=_0x1cfa6a[_0xf23e96];return _0x41393f;},a547_0x430c(_0x319f25,_0x590414);}const SendMessageConnectedStaffMember=async({msg:_0x1cb50c,companyId:_0x4d1cea,wbot:_0x1e931e,body:_0x1d1b08})=>{const _0x24c63f=a547_0x137cd4;if(_0x1cb50c[_0x24c63f(0x95)][_0x24c63f(0xb2)])return![];const _0x2d53a9=_0x1cb50c[_0x24c63f(0x95)][_0x24c63f(0xb4)][_0x24c63f(0xd8)](_0x24c63f(0xc2),''),_0x52b2de=(0x0,redis_1[_0x24c63f(0xa1)])({'url':process['env'][_0x24c63f(0xc7)]});await _0x52b2de[_0x24c63f(0xa6)]();const _0x5cec2f=await _0x52b2de[_0x24c63f(0xae)](_0x2d53a9);if(!_0x5cec2f)return![];const _0x10e326=JSON[_0x24c63f(0xb9)](_0x5cec2f);if(_0x10e326['type']!=_0x24c63f(0xd3)||_0x10e326[_0x24c63f(0x9f)]!=_0x4d1cea)return![];return await _0x1e931e[_0x24c63f(0xac)](_0x10e326['number']+_0x24c63f(0xc2),{'forward':_0x1cb50c}),!![];};exports[a547_0x137cd4(0xb1)]=SendMessageConnectedStaffMember;