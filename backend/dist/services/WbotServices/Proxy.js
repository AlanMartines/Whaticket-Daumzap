const a547_0x480876=a547_0x4921;(function(_0x324157,_0x570c84){const _0xaec426=a547_0x4921,_0x5d6243=_0x324157();while(!![]){try{const _0x43c9e6=parseInt(_0xaec426(0xf0))/0x1*(parseInt(_0xaec426(0xea))/0x2)+parseInt(_0xaec426(0xe0))/0x3+parseInt(_0xaec426(0xef))/0x4*(-parseInt(_0xaec426(0x112))/0x5)+-parseInt(_0xaec426(0x10e))/0x6*(parseInt(_0xaec426(0x110))/0x7)+-parseInt(_0xaec426(0xcc))/0x8*(-parseInt(_0xaec426(0xe6))/0x9)+-parseInt(_0xaec426(0xe2))/0xa*(-parseInt(_0xaec426(0x102))/0xb)+parseInt(_0xaec426(0xd9))/0xc*(-parseInt(_0xaec426(0x10a))/0xd);if(_0x43c9e6===_0x570c84)break;else _0x5d6243['push'](_0x5d6243['shift']());}catch(_0x461421){_0x5d6243['push'](_0x5d6243['shift']());}}}(a547_0x2f42,0x58c41));const a547_0x3d243b=(function(){let _0x37c349=!![];return function(_0x542929,_0x13e2b1){const _0x2427b8=_0x37c349?function(){const _0x504367=a547_0x4921;if(_0x13e2b1){const _0x49a1ba=_0x13e2b1[_0x504367(0xee)](_0x542929,arguments);return _0x13e2b1=null,_0x49a1ba;}}:function(){};return _0x37c349=![],_0x2427b8;};}()),a547_0x3ef2d7=a547_0x3d243b(this,function(){const _0x3d3513=a547_0x4921;return a547_0x3ef2d7['toString']()['search'](_0x3d3513(0xdf))[_0x3d3513(0xfe)]()[_0x3d3513(0xcd)](a547_0x3ef2d7)[_0x3d3513(0xf8)](_0x3d3513(0xdf));});a547_0x3ef2d7();'use strict';var __importDefault=this&&this[a547_0x480876(0xe4)]||function(_0xee4d0e){const _0x301b53=a547_0x480876;return _0xee4d0e&&_0xee4d0e[_0x301b53(0x10c)]?_0xee4d0e:{'default':_0xee4d0e};};Object['defineProperty'](exports,a547_0x480876(0x10c),{'value':!![]}),exports[a547_0x480876(0x105)]=exports[a547_0x480876(0xd6)]=exports[a547_0x480876(0xfa)]=exports[a547_0x480876(0xec)]=void 0x0;const Ticket_1=__importDefault(require(a547_0x480876(0x10d))),User_1=__importDefault(require('../../models/User')),redis_1=require(a547_0x480876(0xd1)),Contact_1=__importDefault(require('../../models/Contact')),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),wbotMessageListener_1=require(a547_0x480876(0xe7)),ShowTicketService_1=__importDefault(require(a547_0x480876(0xe8))),Queue_1=__importDefault(require(a547_0x480876(0x106))),CheckConnection=async({waid:_0x47e7f6,code:_0x3759da,companyId:_0x54f4e5,wbot:_0xbf18a5})=>{const _0x1bfe8e=a547_0x480876,_0x535fc3=await User_1[_0x1bfe8e(0xe5)][_0x1bfe8e(0xd7)]({'where':{'waid':_0x47e7f6,'companyId':_0x54f4e5},'include':[{'model':Queue_1[_0x1bfe8e(0xe5)]}]});if(!_0x535fc3)return![];const _0x1a238d=await Ticket_1['default'][_0x1bfe8e(0xd7)]({'where':{'iCode':_0x3759da,'companyId':_0x54f4e5,'status':_0x1bfe8e(0x10f)},'include':[{'model':Contact_1[_0x1bfe8e(0xe5)]},{'model':Queue_1[_0x1bfe8e(0xe5)]}]});if(!_0x1a238d)return await _0xbf18a5[_0x1bfe8e(0xdb)](_0x47e7f6+_0x1bfe8e(0x104),{'text':'Ticket\x20não\x20encontrado\x20ou\x20já\x20foi\x20aberto!'}),!![];const _0x24c894=_0x535fc3[_0x1bfe8e(0xfb)]['map'](_0x51c4c0=>_0x51c4c0['id']),_0x398dc8=_0x1a238d?.[_0x1bfe8e(0x109)];if(_0x398dc8){if(!_0x24c894[_0x1bfe8e(0xf7)](_0x398dc8))return console[_0x1bfe8e(0xe3)](_0x1bfe8e(0xe1)),await _0xbf18a5[_0x1bfe8e(0xdb)](_0x47e7f6+_0x1bfe8e(0x104),{'text':_0x1bfe8e(0xf9)}),!![];}else{if(_0x1a238d[_0x1bfe8e(0x111)]!==_0x535fc3['id'])return console[_0x1bfe8e(0xe3)](_0x1bfe8e(0xcf)),await _0xbf18a5[_0x1bfe8e(0xdb)](_0x47e7f6+_0x1bfe8e(0x104),{'text':'Você\x20não\x20tem\x20acesso\x20a\x20este\x20ticket.'}),!![];}if(_0x1a238d[_0x1bfe8e(0xde)][_0x1bfe8e(0xf3)]===_0x47e7f6)return await _0xbf18a5[_0x1bfe8e(0xdb)](_0x47e7f6+_0x1bfe8e(0x104),{'text':_0x1bfe8e(0xd8)}),!![];const _0x185639=(0x0,redis_1[_0x1bfe8e(0xf6)])({'url':process[_0x1bfe8e(0x108)][_0x1bfe8e(0xf5)]});await _0x185639[_0x1bfe8e(0x10b)]();let _0x20eaf2={'type':_0x1bfe8e(0xdd),'ticketId':_0x1a238d['id'],'userId':_0x535fc3['id'],'number':_0x47e7f6,'companyId':_0x54f4e5};await _0x185639[_0x1bfe8e(0x103)](_0x1a238d[_0x1bfe8e(0xde)][_0x1bfe8e(0xf3)],JSON[_0x1bfe8e(0xff)](_0x20eaf2),{'EX':0x15180}),_0x20eaf2={'type':_0x1bfe8e(0xd2),'ticketId':_0x1a238d['id'],'number':_0x1a238d[_0x1bfe8e(0xde)][_0x1bfe8e(0xf3)],'userId':_0x535fc3['id'],'companyId':_0x54f4e5},await _0x185639[_0x1bfe8e(0x103)](_0x47e7f6,JSON[_0x1bfe8e(0xff)](_0x20eaf2),{'EX':0x15180}),await _0x185639['disconnect']();const _0x165569=await(0x0,UpdateTicketService_1[_0x1bfe8e(0xe5)])({'ticketData':{'status':_0x1bfe8e(0xeb),'userId':_0x535fc3['id']},'ticketId':_0x1a238d['id'],'companyId':_0x54f4e5});return await _0xbf18a5[_0x1bfe8e(0xdb)](_0x47e7f6+'@s.whatsapp.net',{'text':_0x1bfe8e(0xfc)}),!![];};exports[a547_0x480876(0xec)]=CheckConnection;const Disconnect=async({msg:_0x22b1ac,companyId:_0x3b1133,wbot:_0xeb9e4e})=>{const _0x441cb1=a547_0x480876;let _0x4c891c=![];const _0x1fafee=(0x0,redis_1[_0x441cb1(0xf6)])({'url':process[_0x441cb1(0x108)][_0x441cb1(0xf5)]});await _0x1fafee['connect']();const _0x12d8dd=_0x22b1ac[_0x441cb1(0xd0)][_0x441cb1(0x100)][_0x441cb1(0x101)](_0x441cb1(0x104),''),_0x3ef425=await _0x1fafee['get'](_0x12d8dd);if(_0x3ef425){const _0x4a8646=JSON[_0x441cb1(0xdc)](_0x3ef425);if(_0x4a8646[_0x441cb1(0xed)]=='assistant'&&_0x4a8646[_0x441cb1(0xd5)]==_0x3b1133){const _0x5374f9=await(0x0,UpdateTicketService_1[_0x441cb1(0xe5)])({'ticketData':{'status':_0x441cb1(0xd4),'userId':_0x4a8646[_0x441cb1(0x111)]},'ticketId':_0x4a8646[_0x441cb1(0xf4)],'companyId':_0x3b1133});await _0x1fafee[_0x441cb1(0xe9)](_0x12d8dd),await _0x1fafee['del'](_0x4a8646[_0x441cb1(0xf3)]),await _0xeb9e4e[_0x441cb1(0xdb)](_0x12d8dd+'@s.whatsapp.net',{'text':_0x441cb1(0x107)}),_0x4c891c=!![];}}return _0x1fafee['disconnect'](),_0x4c891c;};exports[a547_0x480876(0xfa)]=Disconnect;function a547_0x2f42(){const _0x4baee2=['266210MfpTQy','log','__importDefault','default','4636143ovrvFB','../WbotServices/wbotMessageListener','../TicketServices/ShowTicketService','del','3490HScrtc','open','CheckConnection','type','apply','2772rZopDt','331OsDFwp','audio','fromMe','number','ticketId','REDIS_URI','createClient','includes','search','Você\x20não\x20tem\x20acesso\x20a\x20esta\x20fila.','Disconnect','queues','Conectado\x20com\x20sucesso,\x20agora\x20responda\x20ao\x20cliente.\x20Para\x20sair\x20da\x20conversa,\x20digite:\x0asair','sair','toString','stringify','remoteJid','replace','77oEbaiE','set','@s.whatsapp.net','SendMessageConnectedStaffMember','../../models/Queue','Desconectado\x20com\x20sucesso','env','queueId','143EfptMa','connect','__esModule','../../models/Ticket','12Qrprsj','pending','794962dCLewC','userId','990EXbYOl','getBodyMessage','8UVzQUa','constructor','get','O\x20usuário\x20NÃO\x20tem\x20acesso\x20ao\x20ticket.','key','redis','assistant','toLowerCase','closed','companyId','ResponseProxy','findOne','Você\x20não\x20pode\x20se\x20conectar\x20consigo\x20mesmo!','865572nZyIFE','contactId','sendMessage','parse','user','contact','(((.+)+)+)+$','726909cHkonP','O\x20usuário\x20NÃO\x20tem\x20acesso\x20à\x20fila\x20do\x20ticket.'];a547_0x2f42=function(){return _0x4baee2;};return a547_0x2f42();}const ResponseProxy=async({msg:_0x14531c,companyId:_0x95887,wbot:_0x299461})=>{const _0x448166=a547_0x480876,_0x9f730b=(0x0,wbotMessageListener_1[_0x448166(0xcb)])(_0x14531c),_0x4ed575=_0x14531c[_0x448166(0xd0)][_0x448166(0x100)][_0x448166(0x101)]('@s.whatsapp.net','');if(_0x14531c[_0x448166(0xd0)][_0x448166(0xf2)])return![];const _0x75500c=(0x0,redis_1['createClient'])({'url':process['env'][_0x448166(0xf5)]});await _0x75500c[_0x448166(0x10b)]();const _0x3e3443=await _0x75500c['get'](_0x4ed575);if(!_0x3e3443)return![];const _0x5984bf=JSON[_0x448166(0xdc)](_0x3e3443);if(_0x5984bf[_0x448166(0xed)]!==_0x448166(0xd2))return![];if(_0x9f730b[_0x448166(0xd3)]()===_0x448166(0xfd)){const _0x1825ca=await(0x0,exports[_0x448166(0xfa)])({'msg':_0x14531c,'companyId':_0x95887,'wbot':_0x299461});if(_0x1825ca)return;}if(_0x9f730b[_0x448166(0xd3)]()==_0x448166(0xf1)){}const _0x4a2284=await(0x0,ShowTicketService_1['default'])(_0x5984bf['ticketId'],_0x95887);let _0x2d5d9d={'id':_0x14531c[_0x448166(0xd0)]['id'],'ticketId':_0x5984bf[_0x448166(0xf4)],'body':_0x9f730b,'contactId':_0x4a2284[_0x448166(0xda)],'fromMe':!![],'read':!![]};return await _0x299461[_0x448166(0xdb)](_0x5984bf['number']+_0x448166(0x104),{'forward':_0x14531c}),!![];};exports[a547_0x480876(0xd6)]=ResponseProxy;function a547_0x4921(_0x48800b,_0x143f91){const _0x5f47a7=a547_0x2f42();return a547_0x4921=function(_0x3ef2d7,_0x3d243b){_0x3ef2d7=_0x3ef2d7-0xcb;let _0x2f4240=_0x5f47a7[_0x3ef2d7];return _0x2f4240;},a547_0x4921(_0x48800b,_0x143f91);}const SendMessageConnectedStaffMember=async({msg:_0xb48006,companyId:_0x13f151,wbot:_0x2d40c1,body:_0x4e6426})=>{const _0x8d137c=a547_0x480876;if(_0xb48006[_0x8d137c(0xd0)][_0x8d137c(0xf2)])return![];const _0x533616=_0xb48006[_0x8d137c(0xd0)][_0x8d137c(0x100)]['replace'](_0x8d137c(0x104),''),_0x3d727b=(0x0,redis_1[_0x8d137c(0xf6)])({'url':process['env'][_0x8d137c(0xf5)]});await _0x3d727b[_0x8d137c(0x10b)]();const _0x186dc4=await _0x3d727b[_0x8d137c(0xce)](_0x533616);if(!_0x186dc4)return![];const _0x562529=JSON[_0x8d137c(0xdc)](_0x186dc4);if(_0x562529['type']!=_0x8d137c(0xdd)||_0x562529[_0x8d137c(0xd5)]!=_0x13f151)return![];return await _0x2d40c1['sendMessage'](_0x562529['number']+_0x8d137c(0x104),{'forward':_0xb48006}),!![];};exports['SendMessageConnectedStaffMember']=SendMessageConnectedStaffMember;