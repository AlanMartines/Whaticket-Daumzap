const a561_0x4a9620=a561_0x3681;(function(_0x31755e,_0x1f9fde){const _0x3fa0d1=a561_0x3681,_0xd43d4d=_0x31755e();while(!![]){try{const _0x433c38=parseInt(_0x3fa0d1(0x1c4))/0x1*(-parseInt(_0x3fa0d1(0x1b4))/0x2)+-parseInt(_0x3fa0d1(0x1ae))/0x3*(parseInt(_0x3fa0d1(0x1c8))/0x4)+-parseInt(_0x3fa0d1(0x1a4))/0x5+-parseInt(_0x3fa0d1(0x1b5))/0x6+-parseInt(_0x3fa0d1(0x1c0))/0x7*(-parseInt(_0x3fa0d1(0x1b9))/0x8)+-parseInt(_0x3fa0d1(0x1a1))/0x9*(parseInt(_0x3fa0d1(0x1ca))/0xa)+parseInt(_0x3fa0d1(0x1a3))/0xb*(parseInt(_0x3fa0d1(0x1d2))/0xc);if(_0x433c38===_0x1f9fde)break;else _0xd43d4d['push'](_0xd43d4d['shift']());}catch(_0x5b3b04){_0xd43d4d['push'](_0xd43d4d['shift']());}}}(a561_0x47c7,0x90499));function a561_0x47c7(){const _0x3d26d9=['657965fVxgtp','./AssociateWhatsappQueue','findOne','__setModuleDefault','4uivZTj','ERR_WAPP_GREETING_REQUIRED','__esModule','../../errors/AppError','18664zsqlsG','validate','10YvLTHb','get','boolean','__createBinding','search','create','configurable','prototype','12cRbSkV','default','plan','(((.+)+)+)+$','7772679rYOHaz','test','22786742cqQZvy','774495YQEsGa','Check-token','length','hasOwnProperty','message','toString','../../models/Whatsapp','min','update','constructor','153OxuWKf','required','getOwnPropertyDescriptor','yup','object','writable','191908qyxcLT','5244924hnRYvZ','defineProperty','__importStar','connections','88zoIxpg','../../models/Plan','../../models/Company','OPENING','string','shape','Check-name'];a561_0x47c7=function(){return _0x3d26d9;};return a561_0x47c7();}const a561_0x6f122=(function(){let _0x143bff=!![];return function(_0x53364f,_0x16ba08){const _0x4b5982=_0x143bff?function(){if(_0x16ba08){const _0x2a553b=_0x16ba08['apply'](_0x53364f,arguments);return _0x16ba08=null,_0x2a553b;}}:function(){};return _0x143bff=![],_0x4b5982;};}()),a561_0x3c1675=a561_0x6f122(this,function(){const _0x5cdec7=a561_0x3681;return a561_0x3c1675['toString']()[_0x5cdec7(0x1ce)](_0x5cdec7(0x1a0))[_0x5cdec7(0x1a9)]()[_0x5cdec7(0x1ad)](a561_0x3c1675)[_0x5cdec7(0x1ce)](_0x5cdec7(0x1a0));});a561_0x3c1675();'use strict';var __createBinding=this&&this[a561_0x4a9620(0x1cd)]||(Object['create']?function(_0x34baa9,_0x4084f4,_0x2cae64,_0x56ac97){const _0x1e8d71=a561_0x4a9620;if(_0x56ac97===undefined)_0x56ac97=_0x2cae64;var _0x2113d6=Object[_0x1e8d71(0x1b0)](_0x4084f4,_0x2cae64);(!_0x2113d6||(_0x1e8d71(0x1cb)in _0x2113d6?!_0x4084f4[_0x1e8d71(0x1c6)]:_0x2113d6[_0x1e8d71(0x1b3)]||_0x2113d6[_0x1e8d71(0x1d0)]))&&(_0x2113d6={'enumerable':!![],'get':function(){return _0x4084f4[_0x2cae64];}}),Object[_0x1e8d71(0x1b6)](_0x34baa9,_0x56ac97,_0x2113d6);}:function(_0x502585,_0xa0838b,_0x1e9aaf,_0x48e3dc){if(_0x48e3dc===undefined)_0x48e3dc=_0x1e9aaf;_0x502585[_0x48e3dc]=_0xa0838b[_0x1e9aaf];}),__setModuleDefault=this&&this[a561_0x4a9620(0x1c3)]||(Object[a561_0x4a9620(0x1cf)]?function(_0x3154de,_0x13ec36){const _0x5b95e6=a561_0x4a9620;Object[_0x5b95e6(0x1b6)](_0x3154de,_0x5b95e6(0x1d3),{'enumerable':!![],'value':_0x13ec36});}:function(_0x592cb2,_0x5c6c13){const _0x2f7826=a561_0x4a9620;_0x592cb2[_0x2f7826(0x1d3)]=_0x5c6c13;}),__importStar=this&&this[a561_0x4a9620(0x1b7)]||function(_0xbc6a9b){const _0x4ba93e=a561_0x4a9620;if(_0xbc6a9b&&_0xbc6a9b[_0x4ba93e(0x1c6)])return _0xbc6a9b;var _0x2c5ced={};if(_0xbc6a9b!=null){for(var _0x55950f in _0xbc6a9b)if(_0x55950f!==_0x4ba93e(0x1d3)&&Object[_0x4ba93e(0x1d1)][_0x4ba93e(0x1a7)]['call'](_0xbc6a9b,_0x55950f))__createBinding(_0x2c5ced,_0xbc6a9b,_0x55950f);}return __setModuleDefault(_0x2c5ced,_0xbc6a9b),_0x2c5ced;},__importDefault=this&&this['__importDefault']||function(_0x4b33ce){return _0x4b33ce&&_0x4b33ce['__esModule']?_0x4b33ce:{'default':_0x4b33ce};};Object[a561_0x4a9620(0x1b6)](exports,a561_0x4a9620(0x1c6),{'value':!![]});function a561_0x3681(_0x47b196,_0x5d1c47){const _0x15ead2=a561_0x47c7();return a561_0x3681=function(_0x3c1675,_0x6f122){_0x3c1675=_0x3c1675-0x19f;let _0x47c7d5=_0x15ead2[_0x3c1675];return _0x47c7d5;},a561_0x3681(_0x47b196,_0x5d1c47);}const Yup=__importStar(require(a561_0x4a9620(0x1b1))),AppError_1=__importDefault(require(a561_0x4a9620(0x1c7))),Whatsapp_1=__importDefault(require(a561_0x4a9620(0x1aa))),Company_1=__importDefault(require(a561_0x4a9620(0x1bb))),Plan_1=__importDefault(require(a561_0x4a9620(0x1ba))),AssociateWhatsappQueue_1=__importDefault(require(a561_0x4a9620(0x1c1))),CreateWhatsAppService=async({name:_0x194af6,status:status=a561_0x4a9620(0x1bc),queueIds:queueIds=[],greetingMessage:_0x32eaef,complationMessage:_0x120a76,outOfHoursMessage:_0x59f326,ratingMessage:_0x4c4e43,isDefault:isDefault=![],companyId:_0x5e4628,token:token='',provider:provider='beta',timeSendQueue:_0x7b0058,sendIdQueue:_0x23c3ed,promptId:_0x3f4ae8,integrationId:_0x56c4ef,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x5ba22b,importOldMessages:_0x11003e,importRecentMessages:_0x23f13b,closedTicketsPostImported:_0x592263,importOldMessagesGroups:_0x1ce0f0})=>{const _0x54418f=a561_0x4a9620,_0x532b6d=await Company_1[_0x54418f(0x1d3)][_0x54418f(0x1c2)]({'where':{'id':_0x5e4628},'include':[{'model':Plan_1[_0x54418f(0x1d3)],'as':_0x54418f(0x19f)}]});if(_0x532b6d!==null){const _0x4a2d32=await Whatsapp_1[_0x54418f(0x1d3)]['count']({'where':{'companyId':_0x5e4628}});if(_0x4a2d32>=_0x532b6d[_0x54418f(0x19f)][_0x54418f(0x1b8)])throw new AppError_1[(_0x54418f(0x1d3))]('Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20'+_0x4a2d32);}const _0x47ef55=Yup[_0x54418f(0x1b2)]()[_0x54418f(0x1be)]({'name':Yup[_0x54418f(0x1bd)]()[_0x54418f(0x1af)]()['min'](0x2)[_0x54418f(0x1a2)](_0x54418f(0x1bf),'Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão',async _0x5cb1a0=>{const _0x4df3ac=_0x54418f;if(!_0x5cb1a0)return![];const _0x2468ae=await Whatsapp_1[_0x4df3ac(0x1d3)][_0x4df3ac(0x1c2)]({'where':{'name':_0x5cb1a0}});return!_0x2468ae;}),'isDefault':Yup[_0x54418f(0x1cc)]()[_0x54418f(0x1af)]()});try{await _0x47ef55[_0x54418f(0x1c9)]({'name':_0x194af6,'status':status,'isDefault':isDefault});}catch(_0x9cb3fb){throw new AppError_1[(_0x54418f(0x1d3))](_0x9cb3fb['message']);}const _0x11cb3d=await Whatsapp_1[_0x54418f(0x1d3)][_0x54418f(0x1c2)]({'where':{'companyId':_0x5e4628}});isDefault=!_0x11cb3d;let _0x1a30ae=null;isDefault&&(_0x1a30ae=await Whatsapp_1[_0x54418f(0x1d3)][_0x54418f(0x1c2)]({'where':{'isDefault':!![],'companyId':_0x5e4628}}),_0x1a30ae&&await _0x1a30ae[_0x54418f(0x1ac)]({'isDefault':![],'companyId':_0x5e4628}));if(queueIds[_0x54418f(0x1a6)]>0x1&&!_0x32eaef)throw new AppError_1[(_0x54418f(0x1d3))](_0x54418f(0x1c5));if(token!==null&&token!==''){const _0x223884=Yup[_0x54418f(0x1b2)]()['shape']({'token':Yup['string']()[_0x54418f(0x1af)]()[_0x54418f(0x1ab)](0x2)['test'](_0x54418f(0x1a5),'This\x20whatsapp\x20token\x20is\x20already\x20used.',async _0x564ad5=>{const _0x2b44aa=_0x54418f;if(!_0x564ad5)return![];const _0x5c54b9=await Whatsapp_1[_0x2b44aa(0x1d3)][_0x2b44aa(0x1c2)]({'where':{'token':_0x564ad5}});return!_0x5c54b9;})});try{await _0x223884[_0x54418f(0x1c9)]({'token':token});}catch(_0x3c7f8d){throw new AppError_1[(_0x54418f(0x1d3))](_0x3c7f8d[_0x54418f(0x1a8)]);}}const _0x4857d4=await Whatsapp_1[_0x54418f(0x1d3)]['create']({'name':_0x194af6,'status':status,'greetingMessage':_0x32eaef,'complationMessage':_0x120a76,'outOfHoursMessage':_0x59f326,'ratingMessage':_0x4c4e43,'isDefault':isDefault,'companyId':_0x5e4628,'token':token,'provider':provider,'timeSendQueue':_0x7b0058,'sendIdQueue':_0x23c3ed,'promptId':_0x3f4ae8&&_0x3f4ae8>0x0?_0x3f4ae8:null,'integrationId':_0x56c4ef&&_0x56c4ef>0x0?_0x56c4ef:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x5ba22b,'importOldMessages':_0x11003e,'importRecentMessages':_0x23f13b,'closedTicketsPostImported':_0x592263,'importOldMessagesGroups':_0x1ce0f0},{'include':['queues']});return await(0x0,AssociateWhatsappQueue_1[_0x54418f(0x1d3)])(_0x4857d4,queueIds),{'whatsapp':_0x4857d4,'oldDefaultWhatsapp':_0x1a30ae};};exports['default']=CreateWhatsAppService;