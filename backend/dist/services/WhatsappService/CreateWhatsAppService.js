const a561_0x368cdc=a561_0xfd4e;function a561_0xfd4e(_0x217fed,_0x15989a){const _0x257d20=a561_0x10fc();return a561_0xfd4e=function(_0x125aeb,_0x40a602){_0x125aeb=_0x125aeb-0xb2;let _0x10fc16=_0x257d20[_0x125aeb];return _0x10fc16;},a561_0xfd4e(_0x217fed,_0x15989a);}(function(_0x43a9a1,_0x304473){const _0x8a4aad=a561_0xfd4e,_0x45a055=_0x43a9a1();while(!![]){try{const _0x88453e=parseInt(_0x8a4aad(0xb9))/0x1*(-parseInt(_0x8a4aad(0xb4))/0x2)+parseInt(_0x8a4aad(0xdc))/0x3+-parseInt(_0x8a4aad(0xd2))/0x4+parseInt(_0x8a4aad(0xd6))/0x5+-parseInt(_0x8a4aad(0xdd))/0x6+parseInt(_0x8a4aad(0xcc))/0x7+-parseInt(_0x8a4aad(0xc3))/0x8*(-parseInt(_0x8a4aad(0xc1))/0x9);if(_0x88453e===_0x304473)break;else _0x45a055['push'](_0x45a055['shift']());}catch(_0x5115c6){_0x45a055['push'](_0x45a055['shift']());}}}(a561_0x10fc,0x8f6c1));const a561_0x40a602=(function(){let _0xa77816=!![];return function(_0x565216,_0x3e206f){const _0x360db1=_0xa77816?function(){const _0x301eb1=a561_0xfd4e;if(_0x3e206f){const _0x99a5f0=_0x3e206f[_0x301eb1(0xbc)](_0x565216,arguments);return _0x3e206f=null,_0x99a5f0;}}:function(){};return _0xa77816=![],_0x360db1;};}()),a561_0x125aeb=a561_0x40a602(this,function(){const _0x5187df=a561_0xfd4e;return a561_0x125aeb[_0x5187df(0xcd)]()['search'](_0x5187df(0xd3))[_0x5187df(0xcd)]()[_0x5187df(0xbe)](a561_0x125aeb)[_0x5187df(0xb2)](_0x5187df(0xd3));});a561_0x125aeb();'use strict';function a561_0x10fc(){const _0x5f5621=['./AssociateWhatsappQueue','2818MnYgYi','call','../../models/Plan','defineProperty','string','157DEtdzC','findOne','getOwnPropertyDescriptor','apply','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','constructor','plan','beta','1281339DdBIwc','validate','40CmCgYI','__setModuleDefault','hasOwnProperty','yup','../../errors/AppError','connections','configurable','required','test','5590340yMwhvS','toString','../../models/Company','object','create','writable','4645672EXaUit','(((.+)+)+)+$','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','default','404850BUaoqf','OPENING','prototype','../../models/Whatsapp','__esModule','__importDefault','1401087pmtAiI','530316vleYHr','This\x20whatsapp\x20token\x20is\x20already\x20used.','queues','search'];a561_0x10fc=function(){return _0x5f5621;};return a561_0x10fc();}var __createBinding=this&&this['__createBinding']||(Object[a561_0x368cdc(0xd0)]?function(_0x4aa97f,_0x35e827,_0xa73a66,_0x45782a){const _0x1ef198=a561_0x368cdc;if(_0x45782a===undefined)_0x45782a=_0xa73a66;var _0x4ecab2=Object[_0x1ef198(0xbb)](_0x35e827,_0xa73a66);(!_0x4ecab2||('get'in _0x4ecab2?!_0x35e827[_0x1ef198(0xda)]:_0x4ecab2[_0x1ef198(0xd1)]||_0x4ecab2[_0x1ef198(0xc9)]))&&(_0x4ecab2={'enumerable':!![],'get':function(){return _0x35e827[_0xa73a66];}}),Object[_0x1ef198(0xb7)](_0x4aa97f,_0x45782a,_0x4ecab2);}:function(_0x254502,_0x34bb32,_0x2a6ffc,_0x99e075){if(_0x99e075===undefined)_0x99e075=_0x2a6ffc;_0x254502[_0x99e075]=_0x34bb32[_0x2a6ffc];}),__setModuleDefault=this&&this[a561_0x368cdc(0xc4)]||(Object[a561_0x368cdc(0xd0)]?function(_0x494ef9,_0x5e2c88){const _0x97f200=a561_0x368cdc;Object[_0x97f200(0xb7)](_0x494ef9,_0x97f200(0xd5),{'enumerable':!![],'value':_0x5e2c88});}:function(_0x13a17b,_0xcb7c91){const _0x1cda7f=a561_0x368cdc;_0x13a17b[_0x1cda7f(0xd5)]=_0xcb7c91;}),__importStar=this&&this['__importStar']||function(_0x3ece63){const _0xd0171e=a561_0x368cdc;if(_0x3ece63&&_0x3ece63['__esModule'])return _0x3ece63;var _0x2cf984={};if(_0x3ece63!=null){for(var _0x3ea778 in _0x3ece63)if(_0x3ea778!==_0xd0171e(0xd5)&&Object[_0xd0171e(0xd8)][_0xd0171e(0xc5)][_0xd0171e(0xb5)](_0x3ece63,_0x3ea778))__createBinding(_0x2cf984,_0x3ece63,_0x3ea778);}return __setModuleDefault(_0x2cf984,_0x3ece63),_0x2cf984;},__importDefault=this&&this[a561_0x368cdc(0xdb)]||function(_0x40fe18){const _0x58b8d7=a561_0x368cdc;return _0x40fe18&&_0x40fe18[_0x58b8d7(0xda)]?_0x40fe18:{'default':_0x40fe18};};Object['defineProperty'](exports,a561_0x368cdc(0xda),{'value':!![]});const Yup=__importStar(require(a561_0x368cdc(0xc6))),AppError_1=__importDefault(require(a561_0x368cdc(0xc7))),Whatsapp_1=__importDefault(require(a561_0x368cdc(0xd9))),Company_1=__importDefault(require(a561_0x368cdc(0xce))),Plan_1=__importDefault(require(a561_0x368cdc(0xb6))),AssociateWhatsappQueue_1=__importDefault(require(a561_0x368cdc(0xb3))),CreateWhatsAppService=async({name:_0x49f980,status:status=a561_0x368cdc(0xd7),queueIds:queueIds=[],greetingMessage:_0x1995d0,complationMessage:_0xe4c912,outOfHoursMessage:_0x328769,ratingMessage:_0x118fc4,isDefault:isDefault=![],companyId:_0xccd58b,token:token='',provider:provider=a561_0x368cdc(0xc0),timeSendQueue:_0x272961,sendIdQueue:_0x5b4a9f,promptId:_0x659304,integrationId:_0x12b0b3,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x2f9dbf,importOldMessages:_0x353ef9,importRecentMessages:_0x2fa1f0,closedTicketsPostImported:_0xa01f3c,importOldMessagesGroups:_0x10b491})=>{const _0x9fd115=a561_0x368cdc,_0x2bbd53=await Company_1[_0x9fd115(0xd5)][_0x9fd115(0xba)]({'where':{'id':_0xccd58b},'include':[{'model':Plan_1['default'],'as':_0x9fd115(0xbf)}]});if(_0x2bbd53!==null){const _0x4b7f3e=await Whatsapp_1[_0x9fd115(0xd5)]['count']({'where':{'companyId':_0xccd58b}});if(_0x4b7f3e>=_0x2bbd53['plan'][_0x9fd115(0xc8)])throw new AppError_1[(_0x9fd115(0xd5))](_0x9fd115(0xd4)+_0x4b7f3e);}const _0x32c0ab=Yup[_0x9fd115(0xcf)]()['shape']({'name':Yup[_0x9fd115(0xb8)]()['required']()['min'](0x2)[_0x9fd115(0xcb)]('Check-name',_0x9fd115(0xbd),async _0x16f4d5=>{const _0x1a8ae8=_0x9fd115;if(!_0x16f4d5)return![];const _0x434803=await Whatsapp_1[_0x1a8ae8(0xd5)][_0x1a8ae8(0xba)]({'where':{'name':_0x16f4d5}});return!_0x434803;}),'isDefault':Yup['boolean']()[_0x9fd115(0xca)]()});try{await _0x32c0ab['validate']({'name':_0x49f980,'status':status,'isDefault':isDefault});}catch(_0x37ab26){throw new AppError_1[(_0x9fd115(0xd5))](_0x37ab26['message']);}const _0x1bea3c=await Whatsapp_1['default']['findOne']({'where':{'companyId':_0xccd58b}});isDefault=!_0x1bea3c;let _0x2c1946=null;isDefault&&(_0x2c1946=await Whatsapp_1['default']['findOne']({'where':{'isDefault':!![],'companyId':_0xccd58b}}),_0x2c1946&&await _0x2c1946['update']({'isDefault':![],'companyId':_0xccd58b}));if(queueIds['length']>0x1&&!_0x1995d0)throw new AppError_1[(_0x9fd115(0xd5))]('ERR_WAPP_GREETING_REQUIRED');if(token!==null&&token!==''){const _0x26b7a5=Yup[_0x9fd115(0xcf)]()['shape']({'token':Yup['string']()[_0x9fd115(0xca)]()['min'](0x2)[_0x9fd115(0xcb)]('Check-token',_0x9fd115(0xde),async _0x450c2b=>{const _0x2a0376=_0x9fd115;if(!_0x450c2b)return![];const _0x523ca3=await Whatsapp_1[_0x2a0376(0xd5)][_0x2a0376(0xba)]({'where':{'token':_0x450c2b}});return!_0x523ca3;})});try{await _0x26b7a5[_0x9fd115(0xc2)]({'token':token});}catch(_0x563c55){throw new AppError_1[(_0x9fd115(0xd5))](_0x563c55['message']);}}const _0x379acf=await Whatsapp_1[_0x9fd115(0xd5)][_0x9fd115(0xd0)]({'name':_0x49f980,'status':status,'greetingMessage':_0x1995d0,'complationMessage':_0xe4c912,'outOfHoursMessage':_0x328769,'ratingMessage':_0x118fc4,'isDefault':isDefault,'companyId':_0xccd58b,'token':token,'provider':provider,'timeSendQueue':_0x272961,'sendIdQueue':_0x5b4a9f,'promptId':_0x659304&&_0x659304>0x0?_0x659304:null,'integrationId':_0x12b0b3&&_0x12b0b3>0x0?_0x12b0b3:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x2f9dbf,'importOldMessages':_0x353ef9,'importRecentMessages':_0x2fa1f0,'closedTicketsPostImported':_0xa01f3c,'importOldMessagesGroups':_0x10b491},{'include':[_0x9fd115(0xdf)]});return await(0x0,AssociateWhatsappQueue_1['default'])(_0x379acf,queueIds),{'whatsapp':_0x379acf,'oldDefaultWhatsapp':_0x2c1946};};exports[a561_0x368cdc(0xd5)]=CreateWhatsAppService;