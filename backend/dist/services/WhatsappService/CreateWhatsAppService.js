const a561_0x45d63e=a561_0x13cb;(function(_0x3f1e9c,_0x386c1a){const _0x2c5a8d=a561_0x13cb,_0x19c688=_0x3f1e9c();while(!![]){try{const _0x24dce1=-parseInt(_0x2c5a8d(0x9c))/0x1*(-parseInt(_0x2c5a8d(0x83))/0x2)+parseInt(_0x2c5a8d(0x90))/0x3*(parseInt(_0x2c5a8d(0x6d))/0x4)+parseInt(_0x2c5a8d(0x8e))/0x5*(parseInt(_0x2c5a8d(0x77))/0x6)+parseInt(_0x2c5a8d(0x79))/0x7+-parseInt(_0x2c5a8d(0x9a))/0x8+-parseInt(_0x2c5a8d(0x7f))/0x9*(parseInt(_0x2c5a8d(0x70))/0xa)+parseInt(_0x2c5a8d(0x6b))/0xb*(-parseInt(_0x2c5a8d(0x84))/0xc);if(_0x24dce1===_0x386c1a)break;else _0x19c688['push'](_0x19c688['shift']());}catch(_0xbc3973){_0x19c688['push'](_0x19c688['shift']());}}}(a561_0x1f6f,0x5841f));const a561_0x1d87b5=(function(){let _0x505852=!![];return function(_0x15b857,_0x28910b){const _0x3e0128=_0x505852?function(){const _0x58c4c8=a561_0x13cb;if(_0x28910b){const _0x7cb39f=_0x28910b[_0x58c4c8(0xa0)](_0x15b857,arguments);return _0x28910b=null,_0x7cb39f;}}:function(){};return _0x505852=![],_0x3e0128;};}()),a561_0x76b85f=a561_0x1d87b5(this,function(){const _0x17c420=a561_0x13cb;return a561_0x76b85f['toString']()['search'](_0x17c420(0x78))[_0x17c420(0x6e)]()[_0x17c420(0x7c)](a561_0x76b85f)['search'](_0x17c420(0x78));});a561_0x76b85f();'use strict';function a561_0x13cb(_0x567a2b,_0x38219c){const _0x477051=a561_0x1f6f();return a561_0x13cb=function(_0x76b85f,_0x1d87b5){_0x76b85f=_0x76b85f-0x6b;let _0x1f6f62=_0x477051[_0x76b85f];return _0x1f6f62;},a561_0x13cb(_0x567a2b,_0x38219c);}var __createBinding=this&&this[a561_0x45d63e(0x7a)]||(Object[a561_0x45d63e(0x74)]?function(_0x40807c,_0x20da62,_0x555093,_0x30a24b){const _0x23786b=a561_0x45d63e;if(_0x30a24b===undefined)_0x30a24b=_0x555093;var _0x2d97cf=Object[_0x23786b(0x9e)](_0x20da62,_0x555093);(!_0x2d97cf||(_0x23786b(0x71)in _0x2d97cf?!_0x20da62[_0x23786b(0x88)]:_0x2d97cf[_0x23786b(0x72)]||_0x2d97cf[_0x23786b(0x9b)]))&&(_0x2d97cf={'enumerable':!![],'get':function(){return _0x20da62[_0x555093];}}),Object['defineProperty'](_0x40807c,_0x30a24b,_0x2d97cf);}:function(_0x43c9c8,_0x49dfbb,_0x6ed945,_0x1e3a2c){if(_0x1e3a2c===undefined)_0x1e3a2c=_0x6ed945;_0x43c9c8[_0x1e3a2c]=_0x49dfbb[_0x6ed945];}),__setModuleDefault=this&&this[a561_0x45d63e(0x81)]||(Object[a561_0x45d63e(0x74)]?function(_0x12756b,_0x439cdc){const _0x4ad0aa=a561_0x45d63e;Object['defineProperty'](_0x12756b,_0x4ad0aa(0x86),{'enumerable':!![],'value':_0x439cdc});}:function(_0x26b6ac,_0x58adc8){const _0x127c8e=a561_0x45d63e;_0x26b6ac[_0x127c8e(0x86)]=_0x58adc8;}),__importStar=this&&this[a561_0x45d63e(0x8b)]||function(_0x4c0d60){const _0xf4a815=a561_0x45d63e;if(_0x4c0d60&&_0x4c0d60['__esModule'])return _0x4c0d60;var _0x145885={};if(_0x4c0d60!=null){for(var _0x39ab03 in _0x4c0d60)if(_0x39ab03!==_0xf4a815(0x86)&&Object['prototype'][_0xf4a815(0x89)][_0xf4a815(0x9d)](_0x4c0d60,_0x39ab03))__createBinding(_0x145885,_0x4c0d60,_0x39ab03);}return __setModuleDefault(_0x145885,_0x4c0d60),_0x145885;},__importDefault=this&&this[a561_0x45d63e(0x96)]||function(_0x1fa96a){const _0x11e169=a561_0x45d63e;return _0x1fa96a&&_0x1fa96a[_0x11e169(0x88)]?_0x1fa96a:{'default':_0x1fa96a};};Object[a561_0x45d63e(0x93)](exports,a561_0x45d63e(0x88),{'value':!![]});function a561_0x1f6f(){const _0x1a101b=['../../models/Plan','required','2924920fOcJHI','configurable','302875JTnygN','call','getOwnPropertyDescriptor','boolean','apply','3591115rCMEgU','test','148eLkvTG','toString','../../models/Whatsapp','30CDZVzk','get','writable','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','create','plan','min','27546OBdZJg','(((.+)+)+)+$','723114qYgvwI','__createBinding','beta','constructor','This\x20whatsapp\x20token\x20is\x20already\x20used.','ERR_WAPP_GREETING_REQUIRED','1701702RpgOgp','OPENING','__setModuleDefault','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','2ytWTkg','12ZOotgT','shape','default','Check-name','__esModule','hasOwnProperty','findOne','__importStar','./AssociateWhatsappQueue','object','685pICBRE','length','47487mVNEGb','validate','queues','defineProperty','message','string','__importDefault','Check-token'];a561_0x1f6f=function(){return _0x1a101b;};return a561_0x1f6f();}const Yup=__importStar(require('yup')),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require(a561_0x45d63e(0x6f))),Company_1=__importDefault(require('../../models/Company')),Plan_1=__importDefault(require(a561_0x45d63e(0x98))),AssociateWhatsappQueue_1=__importDefault(require(a561_0x45d63e(0x8c))),CreateWhatsAppService=async({name:_0x47ea75,status:status=a561_0x45d63e(0x80),queueIds:queueIds=[],greetingMessage:_0x714533,complationMessage:_0x1e04a2,outOfHoursMessage:_0x1f5a1e,ratingMessage:_0x5c8bfe,isDefault:isDefault=![],companyId:_0x5e857d,token:token='',provider:provider=a561_0x45d63e(0x7b),timeSendQueue:_0x1e8bc9,sendIdQueue:_0x210065,promptId:_0x18e5f1,integrationId:_0xc8f553,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0x5eb8b7,importOldMessages:_0x124388,importRecentMessages:_0x36078e,closedTicketsPostImported:_0x3f4a34,importOldMessagesGroups:_0x385c4c})=>{const _0x3f4c65=a561_0x45d63e,_0x395012=await Company_1[_0x3f4c65(0x86)][_0x3f4c65(0x8a)]({'where':{'id':_0x5e857d},'include':[{'model':Plan_1[_0x3f4c65(0x86)],'as':_0x3f4c65(0x75)}]});if(_0x395012!==null){const _0x469b67=await Whatsapp_1[_0x3f4c65(0x86)]['count']({'where':{'companyId':_0x5e857d}});if(_0x469b67>=_0x395012[_0x3f4c65(0x75)]['connections'])throw new AppError_1['default'](_0x3f4c65(0x73)+_0x469b67);}const _0x28505a=Yup[_0x3f4c65(0x8d)]()[_0x3f4c65(0x85)]({'name':Yup[_0x3f4c65(0x95)]()[_0x3f4c65(0x99)]()[_0x3f4c65(0x76)](0x2)[_0x3f4c65(0x6c)](_0x3f4c65(0x87),_0x3f4c65(0x82),async _0x2da1e2=>{const _0x486426=_0x3f4c65;if(!_0x2da1e2)return![];const _0x4c23ed=await Whatsapp_1[_0x486426(0x86)][_0x486426(0x8a)]({'where':{'name':_0x2da1e2}});return!_0x4c23ed;}),'isDefault':Yup[_0x3f4c65(0x9f)]()[_0x3f4c65(0x99)]()});try{await _0x28505a['validate']({'name':_0x47ea75,'status':status,'isDefault':isDefault});}catch(_0x453fac){throw new AppError_1[(_0x3f4c65(0x86))](_0x453fac[_0x3f4c65(0x94)]);}const _0x2010c1=await Whatsapp_1[_0x3f4c65(0x86)][_0x3f4c65(0x8a)]({'where':{'companyId':_0x5e857d}});isDefault=!_0x2010c1;let _0x579b34=null;isDefault&&(_0x579b34=await Whatsapp_1[_0x3f4c65(0x86)]['findOne']({'where':{'isDefault':!![],'companyId':_0x5e857d}}),_0x579b34&&await _0x579b34['update']({'isDefault':![],'companyId':_0x5e857d}));if(queueIds[_0x3f4c65(0x8f)]>0x1&&!_0x714533)throw new AppError_1[(_0x3f4c65(0x86))](_0x3f4c65(0x7e));if(token!==null&&token!==''){const _0x120c90=Yup['object']()[_0x3f4c65(0x85)]({'token':Yup[_0x3f4c65(0x95)]()['required']()['min'](0x2)['test'](_0x3f4c65(0x97),_0x3f4c65(0x7d),async _0x3be689=>{const _0x5d7c2d=_0x3f4c65;if(!_0x3be689)return![];const _0x2f983e=await Whatsapp_1[_0x5d7c2d(0x86)]['findOne']({'where':{'token':_0x3be689}});return!_0x2f983e;})});try{await _0x120c90[_0x3f4c65(0x91)]({'token':token});}catch(_0x31ae05){throw new AppError_1[(_0x3f4c65(0x86))](_0x31ae05[_0x3f4c65(0x94)]);}}const _0x4bdad4=await Whatsapp_1[_0x3f4c65(0x86)][_0x3f4c65(0x74)]({'name':_0x47ea75,'status':status,'greetingMessage':_0x714533,'complationMessage':_0x1e04a2,'outOfHoursMessage':_0x1f5a1e,'ratingMessage':_0x5c8bfe,'isDefault':isDefault,'companyId':_0x5e857d,'token':token,'provider':provider,'timeSendQueue':_0x1e8bc9,'sendIdQueue':_0x210065,'promptId':_0x18e5f1&&_0x18e5f1>0x0?_0x18e5f1:null,'integrationId':_0xc8f553&&_0xc8f553>0x0?_0xc8f553:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0x5eb8b7,'importOldMessages':_0x124388,'importRecentMessages':_0x36078e,'closedTicketsPostImported':_0x3f4a34,'importOldMessagesGroups':_0x385c4c},{'include':[_0x3f4c65(0x92)]});return await(0x0,AssociateWhatsappQueue_1[_0x3f4c65(0x86)])(_0x4bdad4,queueIds),{'whatsapp':_0x4bdad4,'oldDefaultWhatsapp':_0x579b34};};exports['default']=CreateWhatsAppService;