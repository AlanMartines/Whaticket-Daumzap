const a561_0xe4975d=a561_0x4715;function a561_0x4715(_0x16bca3,_0x1585d2){const _0x58b8c8=a561_0x4030();return a561_0x4715=function(_0x1b57ee,_0x1a44db){_0x1b57ee=_0x1b57ee-0x1c0;let _0x40304a=_0x58b8c8[_0x1b57ee];return _0x40304a;},a561_0x4715(_0x16bca3,_0x1585d2);}(function(_0x331049,_0x1ba2f3){const _0x3179dc=a561_0x4715,_0x2aeed5=_0x331049();while(!![]){try{const _0x49eb02=parseInt(_0x3179dc(0x1df))/0x1+-parseInt(_0x3179dc(0x1c6))/0x2+-parseInt(_0x3179dc(0x1d8))/0x3+parseInt(_0x3179dc(0x1d9))/0x4+parseInt(_0x3179dc(0x1c5))/0x5+-parseInt(_0x3179dc(0x1cf))/0x6+parseInt(_0x3179dc(0x1de))/0x7*(parseInt(_0x3179dc(0x1d6))/0x8);if(_0x49eb02===_0x1ba2f3)break;else _0x2aeed5['push'](_0x2aeed5['shift']());}catch(_0x50fcec){_0x2aeed5['push'](_0x2aeed5['shift']());}}}(a561_0x4030,0x4708c));const a561_0x1a44db=(function(){let _0x38c5cf=!![];return function(_0x2dd6cc,_0x16c4c2){const _0x401f3f=_0x38c5cf?function(){const _0x2a41c5=a561_0x4715;if(_0x16c4c2){const _0xf5d93e=_0x16c4c2[_0x2a41c5(0x1ea)](_0x2dd6cc,arguments);return _0x16c4c2=null,_0xf5d93e;}}:function(){};return _0x38c5cf=![],_0x401f3f;};}()),a561_0x1b57ee=a561_0x1a44db(this,function(){const _0x5c6c72=a561_0x4715;return a561_0x1b57ee[_0x5c6c72(0x1c8)]()['search'](_0x5c6c72(0x1c9))[_0x5c6c72(0x1c8)]()[_0x5c6c72(0x1e1)](a561_0x1b57ee)[_0x5c6c72(0x1ec)](_0x5c6c72(0x1c9));});function a561_0x4030(){const _0x443e2f=['string','shape','length','4337767rALaez','179935JUGskk','__importDefault','constructor','validate','findOne','required','test','This\x20whatsapp\x20token\x20is\x20already\x20used.','__importStar','ERR_WAPP_GREETING_REQUIRED','Check-token','apply','update','search','default','OPENING','count','yup','Esse\x20nome\x20já\x20está\x20sendo\x20utilizado\x20por\x20outra\x20conexão','defineProperty','queues','object','writable','beta','Check-name','2000075qxXAaX','348844gMotkS','Número\x20máximo\x20de\x20conexões\x20já\x20alcançado:\x20','toString','(((.+)+)+)+$','get','boolean','create','../../models/Company','__setModuleDefault','2958366CrosqY','__esModule','getOwnPropertyDescriptor','connections','./AssociateWhatsappQueue','plan','call','8JZpImE','message','1227399oOvWiV','671764ReAPUp','min'];a561_0x4030=function(){return _0x443e2f;};return a561_0x4030();}a561_0x1b57ee();'use strict';var __createBinding=this&&this['__createBinding']||(Object[a561_0xe4975d(0x1cc)]?function(_0xd6bea3,_0x30a56d,_0x271369,_0x3e3f90){const _0x2dd356=a561_0xe4975d;if(_0x3e3f90===undefined)_0x3e3f90=_0x271369;var _0x580187=Object[_0x2dd356(0x1d1)](_0x30a56d,_0x271369);(!_0x580187||(_0x2dd356(0x1ca)in _0x580187?!_0x30a56d[_0x2dd356(0x1d0)]:_0x580187[_0x2dd356(0x1c2)]||_0x580187['configurable']))&&(_0x580187={'enumerable':!![],'get':function(){return _0x30a56d[_0x271369];}}),Object[_0x2dd356(0x1f2)](_0xd6bea3,_0x3e3f90,_0x580187);}:function(_0x2eece5,_0x172005,_0x133d75,_0x522f29){if(_0x522f29===undefined)_0x522f29=_0x133d75;_0x2eece5[_0x522f29]=_0x172005[_0x133d75];}),__setModuleDefault=this&&this[a561_0xe4975d(0x1ce)]||(Object['create']?function(_0x8fe07b,_0x4a5955){const _0x2b3f86=a561_0xe4975d;Object[_0x2b3f86(0x1f2)](_0x8fe07b,'default',{'enumerable':!![],'value':_0x4a5955});}:function(_0x25168a,_0x198bca){const _0x1729e0=a561_0xe4975d;_0x25168a[_0x1729e0(0x1ed)]=_0x198bca;}),__importStar=this&&this[a561_0xe4975d(0x1e7)]||function(_0x3d2b27){const _0x36f4f9=a561_0xe4975d;if(_0x3d2b27&&_0x3d2b27[_0x36f4f9(0x1d0)])return _0x3d2b27;var _0xf40677={};if(_0x3d2b27!=null){for(var _0x450f74 in _0x3d2b27)if(_0x450f74!==_0x36f4f9(0x1ed)&&Object['prototype']['hasOwnProperty'][_0x36f4f9(0x1d5)](_0x3d2b27,_0x450f74))__createBinding(_0xf40677,_0x3d2b27,_0x450f74);}return __setModuleDefault(_0xf40677,_0x3d2b27),_0xf40677;},__importDefault=this&&this[a561_0xe4975d(0x1e0)]||function(_0x31b7e7){const _0x109616=a561_0xe4975d;return _0x31b7e7&&_0x31b7e7[_0x109616(0x1d0)]?_0x31b7e7:{'default':_0x31b7e7};};Object[a561_0xe4975d(0x1f2)](exports,a561_0xe4975d(0x1d0),{'value':!![]});const Yup=__importStar(require(a561_0xe4975d(0x1f0))),AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Company_1=__importDefault(require(a561_0xe4975d(0x1cd))),Plan_1=__importDefault(require('../../models/Plan')),AssociateWhatsappQueue_1=__importDefault(require(a561_0xe4975d(0x1d3))),CreateWhatsAppService=async({name:_0x1508e7,status:status=a561_0xe4975d(0x1ee),queueIds:queueIds=[],greetingMessage:_0x200c8e,complationMessage:_0x4490d8,outOfHoursMessage:_0x48e773,ratingMessage:_0x1514f9,isDefault:isDefault=![],companyId:_0x59d35d,token:token='',provider:provider=a561_0xe4975d(0x1c3),timeSendQueue:_0x3783fd,sendIdQueue:_0x2c19f3,promptId:_0x2b2459,integrationId:_0x3dade2,maxUseBotQueues:maxUseBotQueues=0x3,timeUseBotQueues:timeUseBotQueues=0x0,expiresTicket:expiresTicket=0x0,expiresInactiveMessage:expiresInactiveMessage='',allowGroup:_0xe59112,importOldMessages:_0x51b87a,importRecentMessages:_0x4d7880,closedTicketsPostImported:_0x1706ca,importOldMessagesGroups:_0x23eb5c})=>{const _0x1bd996=a561_0xe4975d,_0x24c8fa=await Company_1[_0x1bd996(0x1ed)][_0x1bd996(0x1e3)]({'where':{'id':_0x59d35d},'include':[{'model':Plan_1[_0x1bd996(0x1ed)],'as':_0x1bd996(0x1d4)}]});if(_0x24c8fa!==null){const _0x21a8da=await Whatsapp_1['default'][_0x1bd996(0x1ef)]({'where':{'companyId':_0x59d35d}});if(_0x21a8da>=_0x24c8fa[_0x1bd996(0x1d4)][_0x1bd996(0x1d2)])throw new AppError_1[(_0x1bd996(0x1ed))](_0x1bd996(0x1c7)+_0x21a8da);}const _0x5b7819=Yup['object']()[_0x1bd996(0x1dc)]({'name':Yup[_0x1bd996(0x1db)]()[_0x1bd996(0x1e4)]()[_0x1bd996(0x1da)](0x2)[_0x1bd996(0x1e5)](_0x1bd996(0x1c4),_0x1bd996(0x1f1),async _0x235bd0=>{const _0x250c3d=_0x1bd996;if(!_0x235bd0)return![];const _0x1047f3=await Whatsapp_1[_0x250c3d(0x1ed)][_0x250c3d(0x1e3)]({'where':{'name':_0x235bd0}});return!_0x1047f3;}),'isDefault':Yup[_0x1bd996(0x1cb)]()[_0x1bd996(0x1e4)]()});try{await _0x5b7819[_0x1bd996(0x1e2)]({'name':_0x1508e7,'status':status,'isDefault':isDefault});}catch(_0x49ac4a){throw new AppError_1[(_0x1bd996(0x1ed))](_0x49ac4a[_0x1bd996(0x1d7)]);}const _0x4d037d=await Whatsapp_1[_0x1bd996(0x1ed)][_0x1bd996(0x1e3)]({'where':{'companyId':_0x59d35d}});isDefault=!_0x4d037d;let _0x5df448=null;isDefault&&(_0x5df448=await Whatsapp_1[_0x1bd996(0x1ed)][_0x1bd996(0x1e3)]({'where':{'isDefault':!![],'companyId':_0x59d35d}}),_0x5df448&&await _0x5df448[_0x1bd996(0x1eb)]({'isDefault':![],'companyId':_0x59d35d}));if(queueIds[_0x1bd996(0x1dd)]>0x1&&!_0x200c8e)throw new AppError_1[(_0x1bd996(0x1ed))](_0x1bd996(0x1e8));if(token!==null&&token!==''){const _0x3c5583=Yup[_0x1bd996(0x1c1)]()['shape']({'token':Yup[_0x1bd996(0x1db)]()[_0x1bd996(0x1e4)]()[_0x1bd996(0x1da)](0x2)[_0x1bd996(0x1e5)](_0x1bd996(0x1e9),_0x1bd996(0x1e6),async _0x58bb0f=>{const _0x5b3137=_0x1bd996;if(!_0x58bb0f)return![];const _0xb0faf0=await Whatsapp_1[_0x5b3137(0x1ed)][_0x5b3137(0x1e3)]({'where':{'token':_0x58bb0f}});return!_0xb0faf0;})});try{await _0x3c5583[_0x1bd996(0x1e2)]({'token':token});}catch(_0x2fb082){throw new AppError_1[(_0x1bd996(0x1ed))](_0x2fb082[_0x1bd996(0x1d7)]);}}const _0xb5e0e9=await Whatsapp_1[_0x1bd996(0x1ed)][_0x1bd996(0x1cc)]({'name':_0x1508e7,'status':status,'greetingMessage':_0x200c8e,'complationMessage':_0x4490d8,'outOfHoursMessage':_0x48e773,'ratingMessage':_0x1514f9,'isDefault':isDefault,'companyId':_0x59d35d,'token':token,'provider':provider,'timeSendQueue':_0x3783fd,'sendIdQueue':_0x2c19f3,'promptId':_0x2b2459&&_0x2b2459>0x0?_0x2b2459:null,'integrationId':_0x3dade2&&_0x3dade2>0x0?_0x3dade2:null,'maxUseBotQueues':maxUseBotQueues,'timeUseBotQueues':timeUseBotQueues,'expiresTicket':expiresTicket,'expiresInactiveMessage':expiresInactiveMessage,'allowGroup':_0xe59112,'importOldMessages':_0x51b87a,'importRecentMessages':_0x4d7880,'closedTicketsPostImported':_0x1706ca,'importOldMessagesGroups':_0x23eb5c},{'include':[_0x1bd996(0x1c0)]});return await(0x0,AssociateWhatsappQueue_1['default'])(_0xb5e0e9,queueIds),{'whatsapp':_0xb5e0e9,'oldDefaultWhatsapp':_0x5df448};};exports['default']=CreateWhatsAppService;