const a563_0x5938ce=a563_0x4333;(function(_0x5141fe,_0x3a5df6){const _0x5badf6=a563_0x4333,_0xdd6447=_0x5141fe();while(!![]){try{const _0x8a0e62=-parseInt(_0x5badf6(0x142))/0x1*(parseInt(_0x5badf6(0x11a))/0x2)+-parseInt(_0x5badf6(0x121))/0x3*(parseInt(_0x5badf6(0x12d))/0x4)+-parseInt(_0x5badf6(0x138))/0x5*(-parseInt(_0x5badf6(0x11b))/0x6)+parseInt(_0x5badf6(0x124))/0x7*(-parseInt(_0x5badf6(0x13b))/0x8)+-parseInt(_0x5badf6(0x113))/0x9+parseInt(_0x5badf6(0x12c))/0xa+-parseInt(_0x5badf6(0x146))/0xb*(-parseInt(_0x5badf6(0x130))/0xc);if(_0x8a0e62===_0x3a5df6)break;else _0xdd6447['push'](_0xdd6447['shift']());}catch(_0x3372ab){_0xdd6447['push'](_0xdd6447['shift']());}}}(a563_0x1abd,0xb4daa));const a563_0x8066a=(function(){let _0x2e2cc1=!![];return function(_0xfa6387,_0x567ae2){const _0x3d9368=_0x2e2cc1?function(){const _0x344d8f=a563_0x4333;if(_0x567ae2){const _0x4e54eb=_0x567ae2[_0x344d8f(0x122)](_0xfa6387,arguments);return _0x567ae2=null,_0x4e54eb;}}:function(){};return _0x2e2cc1=![],_0x3d9368;};}()),a563_0x2c40d1=a563_0x8066a(this,function(){const _0xe15cc4=a563_0x4333;return a563_0x2c40d1[_0xe15cc4(0x116)]()[_0xe15cc4(0x145)](_0xe15cc4(0x11c))[_0xe15cc4(0x116)]()['constructor'](a563_0x2c40d1)[_0xe15cc4(0x145)](_0xe15cc4(0x11c));});a563_0x2c40d1();'use strict';var __importDefault=this&&this[a563_0x5938ce(0x129)]||function(_0x146ff1){return _0x146ff1&&_0x146ff1['__esModule']?_0x146ff1:{'default':_0x146ff1};};Object[a563_0x5938ce(0x13c)](exports,a563_0x5938ce(0x126),{'value':!![]}),exports[a563_0x5938ce(0x132)]=void 0x0;const AppError_1=__importDefault(require(a563_0x5938ce(0x118))),Whatsapp_1=__importDefault(require('../../models/Whatsapp')),Ticket_1=__importDefault(require('../../models/Ticket')),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),wbot_1=require(a563_0x5938ce(0x12a)),socket_1=require(a563_0x5938ce(0x125)),wbotMessageListener_1=require(a563_0x5938ce(0x11d)),moment_1=__importDefault(require('moment')),sequelize_1=require(a563_0x5938ce(0x136)),date_fns_1=require('date-fns'),closeImportedTickets=async _0x2f309a=>{const _0x18c97d=a563_0x5938ce;console['log'](_0x18c97d(0x132));const _0x51cf73=await Ticket_1[_0x18c97d(0x128)][_0x18c97d(0x137)]({'where':{'status':_0x18c97d(0x12f),'whatsappId':_0x2f309a,'imported':{[sequelize_1['Op']['lt']]:(0x0,date_fns_1[_0x18c97d(0x115)])(new Date(),{'hours':0x5})}}});for(const _0x25b93a of _0x51cf73){await new Promise(_0x298c1f=>setTimeout(_0x298c1f,0x14a)),await(0x0,UpdateTicketService_1[_0x18c97d(0x128)])({'ticketData':{'status':_0x18c97d(0x111)},'ticketId':_0x25b93a['id'],'companyId':_0x25b93a[_0x18c97d(0x11e)]});}let _0x20fe7a=await Whatsapp_1[_0x18c97d(0x128)][_0x18c97d(0x143)](_0x2f309a);_0x20fe7a['update']({'statusImportMessages':null});const _0x42cfe7=(0x0,socket_1['getIO'])();_0x42cfe7['to'](_0x18c97d(0x114)+_0x20fe7a[_0x18c97d(0x11e)]+_0x18c97d(0x119))[_0x18c97d(0x147)](_0x18c97d(0x123)+_0x20fe7a[_0x18c97d(0x11e)],{'action':_0x18c97d(0x127)});};exports['closeImportedTickets']=closeImportedTickets;function a563_0x4333(_0xeae7f1,_0x2a91cb){const _0x7b638a=a563_0x1abd();return a563_0x4333=function(_0x2c40d1,_0x8066a){_0x2c40d1=_0x2c40d1-0x111;let _0x1abd88=_0x7b638a[_0x2c40d1];return _0x1abd88;},a563_0x4333(_0xeae7f1,_0x2a91cb);}function a563_0x1abd(){const _0x49f30b=['../../libs/wbot','set','5443660TLLkbR','2884tNjSDm','getIO','pending','131940VKhuCa','update','closeImportedTickets','format','sort','processImportMessagesWppId','sequelize','findAll','3372665iJHZKN','messageTimestamp','low','80vpDMkh','defineProperty','closedTicketsPostImported','log','ERROR_IMPORTING_MESSAGE','push','key','1bxLRTP','findByPk','ERR_NOT_MESSAGE_TO_IMPORT','search','1067SFsSFO','emit','closed','dataMessages','326718YRFbwc','company-','add','toString','has','../../errors/AppError','-mainchannel','2192214huEQVM','12dBZEXn','(((.+)+)+)+$','../WbotServices/wbotMessageListener','companyId','DD/MM/YY\x20HH:mm:ss','renderButtonCloseTickets','1500fRSBmo','apply','importMessages-','508382yAqOIX','../../libs/socket','__esModule','refresh','default','__importDefault'];a563_0x1abd=function(){return _0x49f30b;};return a563_0x1abd();}function compareMessageTimestamps(_0x3ee242,_0x434fa4){const _0x306200=a563_0x5938ce;return _0x3ee242[_0x306200(0x139)]-_0x434fa4['messageTimestamp'];}function removeDuplicateById(_0x18af92){const _0x58980c=a563_0x5938ce,_0x119e8b=new Map(),_0x172e0b=[];for(const _0x350404 of _0x18af92){const _0x39dcd6=_0x350404[_0x58980c(0x141)]['id'];!_0x119e8b[_0x58980c(0x117)](_0x39dcd6)&&(_0x119e8b[_0x58980c(0x12b)](_0x39dcd6,!![]),_0x172e0b[_0x58980c(0x140)](_0x350404));}return _0x172e0b[_0x58980c(0x134)](compareMessageTimestamps);}const ImportWhatsAppService=async _0x256ed8=>{const _0x2e8c35=a563_0x5938ce,_0x22295d=(0x0,wbot_1['getWbot'])(_0x256ed8['id']);try{const _0xebc441=(0x0,socket_1[_0x2e8c35(0x12e)])(),_0x5f378b=removeDuplicateById(wbot_1[_0x2e8c35(0x112)][_0x256ed8['id']]);console['log'](_0x2e8c35(0x135));const _0x298405=_0x5f378b['length'];let _0x15b713=0x0;while(_0x15b713<_0x298405){try{const _0xbd1d19=_0x5f378b[_0x15b713];await(0x0,wbotMessageListener_1['handleMessage'])(_0xbd1d19,_0x22295d,_0x256ed8[_0x2e8c35(0x11e)],!![]);if(_0x15b713%0x2===0x0){const _0x243540=Math['floor'](_0xbd1d19[_0x2e8c35(0x139)][_0x2e8c35(0x13a)]*0x3e8);_0xebc441[_0x2e8c35(0x147)](_0x2e8c35(0x123)+_0x256ed8['companyId'],{'action':_0x2e8c35(0x131),'status':{'this':_0x15b713+0x1,'all':_0x298405,'date':(0x0,moment_1[_0x2e8c35(0x128)])(_0x243540)[_0x2e8c35(0x133)](_0x2e8c35(0x11f))}});}_0x15b713+0x1===_0x298405&&(wbot_1[_0x2e8c35(0x112)][_0x256ed8['id']]=[],_0x256ed8[_0x2e8c35(0x13d)]&&await(0x0,exports[_0x2e8c35(0x132)])(_0x256ed8['id']),await _0x256ed8[_0x2e8c35(0x131)]({'statusImportMessages':_0x256ed8[_0x2e8c35(0x13d)]?null:_0x2e8c35(0x120),'importOldMessages':null,'importRecentMessages':null}),_0xebc441['to'](_0x2e8c35(0x114)+_0x256ed8[_0x2e8c35(0x11e)]+_0x2e8c35(0x119))[_0x2e8c35(0x147)](_0x2e8c35(0x123)+_0x256ed8[_0x2e8c35(0x11e)],{'action':_0x2e8c35(0x127)}));}catch(_0x1a776f){console[_0x2e8c35(0x13e)](_0x1a776f),console['log'](_0x2e8c35(0x13f));}_0x15b713++;}}catch(_0x15edd3){console[_0x2e8c35(0x13e)](_0x15edd3);throw new AppError_1[(_0x2e8c35(0x128))](_0x2e8c35(0x144),0x193);}return'whatsapps';};exports[a563_0x5938ce(0x128)]=ImportWhatsAppService;