function a563_0x34ff(_0x491bc3,_0x1e698a){const _0x3a790d=a563_0x4632();return a563_0x34ff=function(_0xb32ec2,_0x2e5fa5){_0xb32ec2=_0xb32ec2-0x1b0;let _0x463227=_0x3a790d[_0xb32ec2];return _0x463227;},a563_0x34ff(_0x491bc3,_0x1e698a);}const a563_0x105483=a563_0x34ff;(function(_0x22fe82,_0x277169){const _0x4b17e4=a563_0x34ff,_0x218a44=_0x22fe82();while(!![]){try{const _0x3f19ad=-parseInt(_0x4b17e4(0x1c9))/0x1*(-parseInt(_0x4b17e4(0x1bd))/0x2)+-parseInt(_0x4b17e4(0x1ca))/0x3*(parseInt(_0x4b17e4(0x1d7))/0x4)+-parseInt(_0x4b17e4(0x1e1))/0x5+-parseInt(_0x4b17e4(0x1cc))/0x6+parseInt(_0x4b17e4(0x1b0))/0x7*(parseInt(_0x4b17e4(0x1b9))/0x8)+-parseInt(_0x4b17e4(0x1bb))/0x9+parseInt(_0x4b17e4(0x1b4))/0xa*(parseInt(_0x4b17e4(0x1e0))/0xb);if(_0x3f19ad===_0x277169)break;else _0x218a44['push'](_0x218a44['shift']());}catch(_0x470c02){_0x218a44['push'](_0x218a44['shift']());}}}(a563_0x4632,0x8b408));const a563_0x2e5fa5=(function(){let _0x467f08=!![];return function(_0x3f3350,_0x140fc9){const _0x1ba0fb=_0x467f08?function(){const _0x49a4fb=a563_0x34ff;if(_0x140fc9){const _0x3ddb5b=_0x140fc9[_0x49a4fb(0x1b3)](_0x3f3350,arguments);return _0x140fc9=null,_0x3ddb5b;}}:function(){};return _0x467f08=![],_0x1ba0fb;};}()),a563_0xb32ec2=a563_0x2e5fa5(this,function(){const _0x2e4bba=a563_0x34ff;return a563_0xb32ec2[_0x2e4bba(0x1e3)]()[_0x2e4bba(0x1d2)]('(((.+)+)+)+$')[_0x2e4bba(0x1e3)]()['constructor'](a563_0xb32ec2)[_0x2e4bba(0x1d2)]('(((.+)+)+)+$');});a563_0xb32ec2();'use strict';function a563_0x4632(){const _0x3d006f=['11850146sspith','1537835tjSMVg','closedTicketsPostImported','toString','../../libs/wbot','14QbxDkJ','ERR_NOT_MESSAGE_TO_IMPORT','getWbot','apply','20aEKgAN','dataMessages','getIO','__esModule','importMessages-','1800936YFRSrz','sort','4106997ltcGJQ','floor','646YfkwrX','closeImportedTickets','length','closed','findAll','findByPk','../../models/Ticket','companyId','defineProperty','pending','default','refresh','323AdWxYs','39669BQDeCL','../../errors/AppError','5789676ACLPNm','moment','__importDefault','sequelize','ERROR_IMPORTING_MESSAGE','emit','search','format','messageTimestamp','key','-mainchannel','124WsadWK','push','../WbotServices/wbotMessageListener','update','log','../../models/Whatsapp','DD/MM/YY\x20HH:mm:ss','company-','renderButtonCloseTickets'];a563_0x4632=function(){return _0x3d006f;};return a563_0x4632();}var __importDefault=this&&this[a563_0x105483(0x1ce)]||function(_0x275e4d){const _0x40481f=a563_0x105483;return _0x275e4d&&_0x275e4d[_0x40481f(0x1b7)]?_0x275e4d:{'default':_0x275e4d};};Object[a563_0x105483(0x1c5)](exports,a563_0x105483(0x1b7),{'value':!![]}),exports[a563_0x105483(0x1be)]=void 0x0;const AppError_1=__importDefault(require(a563_0x105483(0x1cb))),Whatsapp_1=__importDefault(require(a563_0x105483(0x1dc))),Ticket_1=__importDefault(require(a563_0x105483(0x1c3))),UpdateTicketService_1=__importDefault(require('../TicketServices/UpdateTicketService')),wbot_1=require(a563_0x105483(0x1e4)),socket_1=require('../../libs/socket'),wbotMessageListener_1=require(a563_0x105483(0x1d9)),moment_1=__importDefault(require(a563_0x105483(0x1cd))),sequelize_1=require(a563_0x105483(0x1cf)),date_fns_1=require('date-fns'),closeImportedTickets=async _0x1ac409=>{const _0x27e3e2=a563_0x105483;console[_0x27e3e2(0x1db)](_0x27e3e2(0x1be));const _0x14177a=await Ticket_1['default'][_0x27e3e2(0x1c1)]({'where':{'status':_0x27e3e2(0x1c6),'whatsappId':_0x1ac409,'imported':{[sequelize_1['Op']['lt']]:(0x0,date_fns_1['add'])(new Date(),{'hours':0x5})}}});for(const _0x5cf24b of _0x14177a){await new Promise(_0x529691=>setTimeout(_0x529691,0x14a)),await(0x0,UpdateTicketService_1['default'])({'ticketData':{'status':_0x27e3e2(0x1c0)},'ticketId':_0x5cf24b['id'],'companyId':_0x5cf24b[_0x27e3e2(0x1c4)]});}let _0x578261=await Whatsapp_1['default'][_0x27e3e2(0x1c2)](_0x1ac409);_0x578261['update']({'statusImportMessages':null});const _0x5676be=(0x0,socket_1[_0x27e3e2(0x1b6)])();_0x5676be['to'](_0x27e3e2(0x1de)+_0x578261[_0x27e3e2(0x1c4)]+'-mainchannel')[_0x27e3e2(0x1d1)](_0x27e3e2(0x1b8)+_0x578261[_0x27e3e2(0x1c4)],{'action':_0x27e3e2(0x1c8)});};exports[a563_0x105483(0x1be)]=closeImportedTickets;function compareMessageTimestamps(_0x8290f5,_0x593114){const _0x55cbb4=a563_0x105483;return _0x8290f5[_0x55cbb4(0x1d4)]-_0x593114[_0x55cbb4(0x1d4)];}function removeDuplicateById(_0x340e4c){const _0x23a36a=a563_0x105483,_0x518e95=new Map(),_0x2fa2f3=[];for(const _0x3d3458 of _0x340e4c){const _0x17f95f=_0x3d3458[_0x23a36a(0x1d5)]['id'];!_0x518e95['has'](_0x17f95f)&&(_0x518e95['set'](_0x17f95f,!![]),_0x2fa2f3[_0x23a36a(0x1d8)](_0x3d3458));}return _0x2fa2f3[_0x23a36a(0x1ba)](compareMessageTimestamps);}const ImportWhatsAppService=async _0x71b439=>{const _0x346c80=a563_0x105483,_0x57f29b=(0x0,wbot_1[_0x346c80(0x1b2)])(_0x71b439['id']);try{const _0x47e92b=(0x0,socket_1[_0x346c80(0x1b6)])(),_0x3d330a=removeDuplicateById(wbot_1[_0x346c80(0x1b5)][_0x71b439['id']]);console['log']('processImportMessagesWppId');const _0x25ef83=_0x3d330a[_0x346c80(0x1bf)];let _0x56f843=0x0;while(_0x56f843<_0x25ef83){try{const _0x32d7f9=_0x3d330a[_0x56f843];await(0x0,wbotMessageListener_1['handleMessage'])(_0x32d7f9,_0x57f29b,_0x71b439[_0x346c80(0x1c4)],!![]);if(_0x56f843%0x2===0x0){const _0x252321=Math[_0x346c80(0x1bc)](_0x32d7f9[_0x346c80(0x1d4)]['low']*0x3e8);_0x47e92b[_0x346c80(0x1d1)](_0x346c80(0x1b8)+_0x71b439[_0x346c80(0x1c4)],{'action':_0x346c80(0x1da),'status':{'this':_0x56f843+0x1,'all':_0x25ef83,'date':(0x0,moment_1[_0x346c80(0x1c7)])(_0x252321)[_0x346c80(0x1d3)](_0x346c80(0x1dd))}});}_0x56f843+0x1===_0x25ef83&&(wbot_1[_0x346c80(0x1b5)][_0x71b439['id']]=[],_0x71b439['closedTicketsPostImported']&&await(0x0,exports[_0x346c80(0x1be)])(_0x71b439['id']),await _0x71b439['update']({'statusImportMessages':_0x71b439[_0x346c80(0x1e2)]?null:_0x346c80(0x1df),'importOldMessages':null,'importRecentMessages':null}),_0x47e92b['to'](_0x346c80(0x1de)+_0x71b439[_0x346c80(0x1c4)]+_0x346c80(0x1d6))['emit'](_0x346c80(0x1b8)+_0x71b439[_0x346c80(0x1c4)],{'action':_0x346c80(0x1c8)}));}catch(_0x34929f){console[_0x346c80(0x1db)](_0x34929f),console['log'](_0x346c80(0x1d0));}_0x56f843++;}}catch(_0x3a5f0d){console[_0x346c80(0x1db)](_0x3a5f0d);throw new AppError_1['default'](_0x346c80(0x1b1),0x193);}return'whatsapps';};exports[a563_0x105483(0x1c7)]=ImportWhatsAppService;