function a563_0x338d(){const _0x26f67c=['1163272WpbAYj','handleMessage','log','emit','length','152bdMPsD','update','defineProperty','sequelize','getWbot','whatsapps','closedTicketsPostImported','sort','49222hcQFWE','messageTimestamp','findByPk','DD/MM/YY\x20HH:mm:ss','../../models/Whatsapp','push','(((.+)+)+)+$','refresh','95283exAGBP','273320rCVGcC','floor','companyId','company-','../../libs/wbot','60Ckngye','moment','set','__esModule','format','search','closeImportedTickets','24185askYnP','386132vbdIHM','__importDefault','../TicketServices/UpdateTicketService','-mainchannel','low','../WbotServices/wbotMessageListener','processImportMessagesWppId','ERROR_IMPORTING_MESSAGE','closed','../../libs/socket','default','toString','date-fns','importMessages-','add','33EyjmpP','55hLsTOO','has','key','getIO','26565DOuRvi','../../models/Ticket','pending'];a563_0x338d=function(){return _0x26f67c;};return a563_0x338d();}const a563_0x5c8c67=a563_0x4dda;(function(_0x180cd8,_0x5e5fa9){const _0x1927af=a563_0x4dda,_0x3db819=_0x180cd8();while(!![]){try{const _0x1fd77c=-parseInt(_0x1927af(0x132))/0x1+parseInt(_0x1927af(0x11c))/0x2*(parseInt(_0x1927af(0x107))/0x3)+parseInt(_0x1927af(0x10f))/0x4+-parseInt(_0x1927af(0x10c))/0x5+-parseInt(_0x1927af(0x12a))/0x6*(-parseInt(_0x1927af(0x131))/0x7)+parseInt(_0x1927af(0x114))/0x8*(parseInt(_0x1927af(0x124))/0x9)+parseInt(_0x1927af(0x125))/0xa*(-parseInt(_0x1927af(0x108))/0xb);if(_0x1fd77c===_0x5e5fa9)break;else _0x3db819['push'](_0x3db819['shift']());}catch(_0x32bcaa){_0x3db819['push'](_0x3db819['shift']());}}}(a563_0x338d,0x41b51));const a563_0x5e5f6c=(function(){let _0x83cb2a=!![];return function(_0x2f496b,_0x587b29){const _0x756b6a=_0x83cb2a?function(){if(_0x587b29){const _0x5928bb=_0x587b29['apply'](_0x2f496b,arguments);return _0x587b29=null,_0x5928bb;}}:function(){};return _0x83cb2a=![],_0x756b6a;};}()),a563_0x340e9b=a563_0x5e5f6c(this,function(){const _0x52d196=a563_0x4dda;return a563_0x340e9b['toString']()[_0x52d196(0x12f)](_0x52d196(0x122))[_0x52d196(0x103)]()['constructor'](a563_0x340e9b)[_0x52d196(0x12f)](_0x52d196(0x122));});a563_0x340e9b();'use strict';var __importDefault=this&&this[a563_0x5c8c67(0x133)]||function(_0x527b08){const _0x47eb93=a563_0x5c8c67;return _0x527b08&&_0x527b08[_0x47eb93(0x12d)]?_0x527b08:{'default':_0x527b08};};Object[a563_0x5c8c67(0x116)](exports,'__esModule',{'value':!![]}),exports[a563_0x5c8c67(0x130)]=void 0x0;const AppError_1=__importDefault(require('../../errors/AppError')),Whatsapp_1=__importDefault(require(a563_0x5c8c67(0x120))),Ticket_1=__importDefault(require(a563_0x5c8c67(0x10d))),UpdateTicketService_1=__importDefault(require(a563_0x5c8c67(0x134))),wbot_1=require(a563_0x5c8c67(0x129)),socket_1=require(a563_0x5c8c67(0x13b)),wbotMessageListener_1=require(a563_0x5c8c67(0x137)),moment_1=__importDefault(require(a563_0x5c8c67(0x12b))),sequelize_1=require(a563_0x5c8c67(0x117)),date_fns_1=require(a563_0x5c8c67(0x104)),closeImportedTickets=async _0xaabd64=>{const _0x36906d=a563_0x5c8c67;console[_0x36906d(0x111)](_0x36906d(0x130));const _0x59d57d=await Ticket_1['default']['findAll']({'where':{'status':_0x36906d(0x10e),'whatsappId':_0xaabd64,'imported':{[sequelize_1['Op']['lt']]:(0x0,date_fns_1[_0x36906d(0x106)])(new Date(),{'hours':0x5})}}});for(const _0x288046 of _0x59d57d){await new Promise(_0x1ae0c7=>setTimeout(_0x1ae0c7,0x14a)),await(0x0,UpdateTicketService_1[_0x36906d(0x102)])({'ticketData':{'status':_0x36906d(0x13a)},'ticketId':_0x288046['id'],'companyId':_0x288046[_0x36906d(0x127)]});}let _0xebef42=await Whatsapp_1['default'][_0x36906d(0x11e)](_0xaabd64);_0xebef42['update']({'statusImportMessages':null});const _0x298b6e=(0x0,socket_1[_0x36906d(0x10b)])();_0x298b6e['to'](_0x36906d(0x128)+_0xebef42['companyId']+_0x36906d(0x135))[_0x36906d(0x112)](_0x36906d(0x105)+_0xebef42[_0x36906d(0x127)],{'action':_0x36906d(0x123)});};function a563_0x4dda(_0x4eb0f6,_0x11827e){const _0x544b58=a563_0x338d();return a563_0x4dda=function(_0x340e9b,_0x5e5f6c){_0x340e9b=_0x340e9b-0x102;let _0x338d2d=_0x544b58[_0x340e9b];return _0x338d2d;},a563_0x4dda(_0x4eb0f6,_0x11827e);}exports['closeImportedTickets']=closeImportedTickets;function compareMessageTimestamps(_0x31d19f,_0x12fe53){return _0x31d19f['messageTimestamp']-_0x12fe53['messageTimestamp'];}function removeDuplicateById(_0x3fb909){const _0x4ea8ae=a563_0x5c8c67,_0x5d88ae=new Map(),_0x4888f4=[];for(const _0xf09d79 of _0x3fb909){const _0x177ac5=_0xf09d79[_0x4ea8ae(0x10a)]['id'];!_0x5d88ae[_0x4ea8ae(0x109)](_0x177ac5)&&(_0x5d88ae[_0x4ea8ae(0x12c)](_0x177ac5,!![]),_0x4888f4[_0x4ea8ae(0x121)](_0xf09d79));}return _0x4888f4[_0x4ea8ae(0x11b)](compareMessageTimestamps);}const ImportWhatsAppService=async _0x1f2636=>{const _0x362025=a563_0x5c8c67,_0x5cc277=(0x0,wbot_1[_0x362025(0x118)])(_0x1f2636['id']);try{const _0x4b85b8=(0x0,socket_1[_0x362025(0x10b)])(),_0x382077=removeDuplicateById(wbot_1['dataMessages'][_0x1f2636['id']]);console[_0x362025(0x111)](_0x362025(0x138));const _0x3ecf60=_0x382077[_0x362025(0x113)];let _0x39fbad=0x0;while(_0x39fbad<_0x3ecf60){try{const _0x354030=_0x382077[_0x39fbad];await(0x0,wbotMessageListener_1[_0x362025(0x110)])(_0x354030,_0x5cc277,_0x1f2636[_0x362025(0x127)],!![]);if(_0x39fbad%0x2===0x0){const _0x2edfd0=Math[_0x362025(0x126)](_0x354030[_0x362025(0x11d)][_0x362025(0x136)]*0x3e8);_0x4b85b8[_0x362025(0x112)]('importMessages-'+_0x1f2636[_0x362025(0x127)],{'action':'update','status':{'this':_0x39fbad+0x1,'all':_0x3ecf60,'date':(0x0,moment_1[_0x362025(0x102)])(_0x2edfd0)[_0x362025(0x12e)](_0x362025(0x11f))}});}_0x39fbad+0x1===_0x3ecf60&&(wbot_1['dataMessages'][_0x1f2636['id']]=[],_0x1f2636[_0x362025(0x11a)]&&await(0x0,exports[_0x362025(0x130)])(_0x1f2636['id']),await _0x1f2636[_0x362025(0x115)]({'statusImportMessages':_0x1f2636['closedTicketsPostImported']?null:'renderButtonCloseTickets','importOldMessages':null,'importRecentMessages':null}),_0x4b85b8['to'](_0x362025(0x128)+_0x1f2636['companyId']+_0x362025(0x135))['emit'](_0x362025(0x105)+_0x1f2636[_0x362025(0x127)],{'action':_0x362025(0x123)}));}catch(_0x4934f5){console[_0x362025(0x111)](_0x4934f5),console[_0x362025(0x111)](_0x362025(0x139));}_0x39fbad++;}}catch(_0x247fb2){console[_0x362025(0x111)](_0x247fb2);throw new AppError_1[(_0x362025(0x102))]('ERR_NOT_MESSAGE_TO_IMPORT',0x193);}return _0x362025(0x119);};exports[a563_0x5c8c67(0x102)]=ImportWhatsAppService;