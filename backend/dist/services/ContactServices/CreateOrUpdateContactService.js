const a413_0x215ba7=a413_0x5288;function a413_0x5288(_0x388bda,_0x817e8e){const _0x3d12f4=a413_0x5807();return a413_0x5288=function(_0x375d9e,_0x316054){_0x375d9e=_0x375d9e-0x14b;let _0x58075b=_0x3d12f4[_0x375d9e];return _0x58075b;},a413_0x5288(_0x388bda,_0x817e8e);}(function(_0x3d87c2,_0x25eae3){const _0x5540e4=a413_0x5288,_0xafcfdf=_0x3d87c2();while(!![]){try{const _0x423f0e=-parseInt(_0x5540e4(0x169))/0x1+parseInt(_0x5540e4(0x16e))/0x2*(parseInt(_0x5540e4(0x166))/0x3)+parseInt(_0x5540e4(0x178))/0x4*(parseInt(_0x5540e4(0x165))/0x5)+-parseInt(_0x5540e4(0x16c))/0x6*(parseInt(_0x5540e4(0x171))/0x7)+parseInt(_0x5540e4(0x153))/0x8*(-parseInt(_0x5540e4(0x15d))/0x9)+parseInt(_0x5540e4(0x177))/0xa+parseInt(_0x5540e4(0x160))/0xb*(parseInt(_0x5540e4(0x151))/0xc);if(_0x423f0e===_0x25eae3)break;else _0xafcfdf['push'](_0xafcfdf['shift']());}catch(_0x2f1b37){_0xafcfdf['push'](_0xafcfdf['shift']());}}}(a413_0x5807,0x4be3f));const a413_0x316054=(function(){let _0x4a004f=!![];return function(_0x105719,_0x188b8b){const _0x363543=_0x4a004f?function(){const _0x44240f=a413_0x5288;if(_0x188b8b){const _0x4ac8eb=_0x188b8b[_0x44240f(0x15f)](_0x105719,arguments);return _0x188b8b=null,_0x4ac8eb;}}:function(){};return _0x4a004f=![],_0x363543;};}()),a413_0x375d9e=a413_0x316054(this,function(){const _0x269202=a413_0x5288;return a413_0x375d9e['toString']()[_0x269202(0x14b)](_0x269202(0x173))[_0x269202(0x15a)]()[_0x269202(0x157)](a413_0x375d9e)['search'](_0x269202(0x173));});a413_0x375d9e();'use strict';var __importDefault=this&&this[a413_0x215ba7(0x167)]||function(_0x437dd0){return _0x437dd0&&_0x437dd0['__esModule']?_0x437dd0:{'default':_0x437dd0};};function a413_0x5807(){const _0x14db01=['search','isNil','log','endsWith','../../libs/socket','updatedAt','84WzvCrw','default','24veSrYz','update','Error\x20getting\x20profile\x20picture\x202:\x20','../WbotServices/GetProfilePicUrl','constructor','lodash','-mainchannel','toString','replace','getTime','1468953UyCEXz','FRONTEND_URL','apply','1187406rbAwbh','create','getIO','__esModule','/nopicture.png','125FYYGFL','370497osAqkN','__importDefault','company-','495447jIZEGX','name','profilePicUrl','174XjWwmN','env','4cYEYSu','changed','-contact','60893xicjPQ','findOne','(((.+)+)+)+$','ceil','match','emit','3894960QzVLLU','24976KOYOWl'];a413_0x5807=function(){return _0x14db01;};return a413_0x5807();}Object['defineProperty'](exports,a413_0x215ba7(0x163),{'value':!![]});const socket_1=require(a413_0x215ba7(0x14f)),Contact_1=__importDefault(require('../../models/Contact')),lodash_1=require(a413_0x215ba7(0x158)),GetProfilePicUrl_1=__importDefault(require(a413_0x215ba7(0x156))),CreateOrUpdateContactService=async({name:_0x378377,number:_0x5b0e3d,remoteJid:_0x532202,isGroup:_0x51c5b7,email:email='',companyId:_0x4ab4ae,extraInfo:extraInfo=[],disableBot:disableBot=![],whatsappId:_0x25ba86},_0x4ac4b6,_0x161364)=>{const _0x562b32=a413_0x215ba7,_0x195e9a=_0x51c5b7?_0x5b0e3d:_0x5b0e3d[_0x562b32(0x15b)](/[^0-9]/g,''),_0x502ebc=(0x0,socket_1[_0x562b32(0x162)])();let _0x145095;_0x145095=await Contact_1['default'][_0x562b32(0x172)]({'where':{'number':_0x195e9a,'companyId':_0x4ab4ae}});if(_0x145095){if(_0x378377&&(!_0x145095[_0x562b32(0x16a)]||_0x145095['name'][_0x562b32(0x175)](/^[0-9]*$/))&&!_0x378377[_0x562b32(0x175)](/^[0-9]*$/)){_0x145095[_0x562b32(0x16f)](_0x562b32(0x16a),!![]),_0x145095[_0x562b32(0x16f)](_0x562b32(0x150),!![]);let _0x2ce15e;try{_0x2ce15e=await(0x0,GetProfilePicUrl_1[_0x562b32(0x152)])(_0x5b0e3d,_0x4ab4ae);}catch(_0x10a314){console[_0x562b32(0x14d)](_0x562b32(0x155)+_0x10a314);}_0x2ce15e?.[_0x562b32(0x14e)]('nopicture.png')&&(_0x2ce15e=_0x145095[_0x562b32(0x16b)]),_0x145095['update']({'name':_0x378377,'profilePicUrl':_0x2ce15e});}const _0x3630cb=new Date(_0x145095[_0x562b32(0x150)]),_0x580a23=new Date(),_0x12c52f=_0x580a23[_0x562b32(0x15c)]()-_0x3630cb['getTime'](),_0x66b738=Math[_0x562b32(0x174)](_0x12c52f/(0x3e8*0xe10*0x18));if(_0x66b738>=0x3){let _0x2908b6;try{_0x2908b6=await(0x0,GetProfilePicUrl_1['default'])(_0x5b0e3d,_0x4ab4ae);}catch(_0x31be06){console[_0x562b32(0x14d)]('Error\x20getting\x20profile\x20picture:\x20'+_0x31be06);}_0x145095[_0x562b32(0x16f)]('updatedAt',!![]),!_0x2908b6?.[_0x562b32(0x14e)]('nopicture.png')?_0x145095['update']({'profilePicUrl':_0x2908b6,'updatedAt':new Date()}):_0x145095[_0x562b32(0x154)]({'updatedAt':new Date()});}(0x0,lodash_1[_0x562b32(0x14c)])(_0x145095['whatsappId']===null)&&_0x145095[_0x562b32(0x154)]({'whatsappId':_0x25ba86}),_0x502ebc['to'](_0x562b32(0x168)+_0x4ab4ae+'-mainchannel')['emit'](_0x562b32(0x168)+_0x4ab4ae+_0x562b32(0x170),{'action':_0x562b32(0x154),'contact':_0x145095});}else{let _0xf3c4e0;try{_0xf3c4e0=await(0x0,GetProfilePicUrl_1['default'])(_0x5b0e3d,_0x4ab4ae);}catch(_0x51d9dd){_0xf3c4e0=process[_0x562b32(0x16d)][_0x562b32(0x15e)]+_0x562b32(0x164);}_0x145095=await Contact_1['default'][_0x562b32(0x161)]({'name':_0x378377,'number':_0x195e9a,'profilePicUrl':_0xf3c4e0,'email':email,'isGroup':_0x51c5b7,'extraInfo':extraInfo,'companyId':_0x4ab4ae,'disableBot':disableBot,'whatsappId':_0x25ba86}),_0x502ebc['to'](_0x562b32(0x168)+_0x4ab4ae+_0x562b32(0x159))[_0x562b32(0x176)]('company-'+_0x4ab4ae+_0x562b32(0x170),{'action':_0x562b32(0x161),'contact':_0x145095});}return _0x145095;};exports[a413_0x215ba7(0x152)]=CreateOrUpdateContactService;