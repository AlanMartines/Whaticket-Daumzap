const a413_0x2310eb=a413_0x1cee;(function(_0x1f0539,_0x48ecd8){const _0x2ddd7c=a413_0x1cee,_0xea084f=_0x1f0539();while(!![]){try{const _0xadc604=-parseInt(_0x2ddd7c(0x153))/0x1*(parseInt(_0x2ddd7c(0x161))/0x2)+-parseInt(_0x2ddd7c(0x179))/0x3*(parseInt(_0x2ddd7c(0x178))/0x4)+-parseInt(_0x2ddd7c(0x177))/0x5*(-parseInt(_0x2ddd7c(0x168))/0x6)+-parseInt(_0x2ddd7c(0x15c))/0x7+parseInt(_0x2ddd7c(0x16d))/0x8+-parseInt(_0x2ddd7c(0x16e))/0x9+-parseInt(_0x2ddd7c(0x163))/0xa*(-parseInt(_0x2ddd7c(0x158))/0xb);if(_0xadc604===_0x48ecd8)break;else _0xea084f['push'](_0xea084f['shift']());}catch(_0x4b288b){_0xea084f['push'](_0xea084f['shift']());}}}(a413_0x2f5e,0x8b27b));const a413_0xc99721=(function(){let _0x4b5bbb=!![];return function(_0xf829fc,_0x4cd332){const _0x516f3a=_0x4b5bbb?function(){const _0x913c47=a413_0x1cee;if(_0x4cd332){const _0x29be57=_0x4cd332[_0x913c47(0x176)](_0xf829fc,arguments);return _0x4cd332=null,_0x29be57;}}:function(){};return _0x4b5bbb=![],_0x516f3a;};}()),a413_0x17304b=a413_0xc99721(this,function(){const _0x2a1295=a413_0x1cee;return a413_0x17304b[_0x2a1295(0x15f)]()['search'](_0x2a1295(0x17a))[_0x2a1295(0x15f)]()['constructor'](a413_0x17304b)[_0x2a1295(0x171)]('(((.+)+)+)+$');});function a413_0x1cee(_0x4d75a9,_0x31d15f){const _0x39d308=a413_0x2f5e();return a413_0x1cee=function(_0x17304b,_0xc99721){_0x17304b=_0x17304b-0x151;let _0x2f5ed6=_0x39d308[_0x17304b];return _0x2f5ed6;},a413_0x1cee(_0x4d75a9,_0x31d15f);}a413_0x17304b();'use strict';var __importDefault=this&&this[a413_0x2310eb(0x154)]||function(_0x5a69a1){const _0xd41e4e=a413_0x2310eb;return _0x5a69a1&&_0x5a69a1[_0xd41e4e(0x162)]?_0x5a69a1:{'default':_0x5a69a1};};Object['defineProperty'](exports,'__esModule',{'value':!![]});function a413_0x2f5e(){const _0x365df6=['2omEgFi','__esModule','378790kvkOgh','../../models/Contact','name','getTime','isNil','36UgWoin','update','emit','-contact','getIO','1853984jMOQvd','5192226TwMGZS','Error\x20getting\x20profile\x20picture\x202:\x20','findOne','search','default','create','../WbotServices/GetProfilePicUrl','/nopicture.png','apply','528610NTzTSg','4lonSed','1900878TtmuKF','(((.+)+)+)+$','replace','Error\x20getting\x20profile\x20picture:\x20','168669kXYTwp','__importDefault','updatedAt','../../libs/socket','ceil','341fOtKAc','changed','company-','-mainchannel','637987koTZBS','nopicture.png','endsWith','toString','whatsappId'];a413_0x2f5e=function(){return _0x365df6;};return a413_0x2f5e();}const socket_1=require(a413_0x2310eb(0x156)),Contact_1=__importDefault(require(a413_0x2310eb(0x164))),lodash_1=require('lodash'),GetProfilePicUrl_1=__importDefault(require(a413_0x2310eb(0x174))),CreateOrUpdateContactService=async({name:_0x4a34db,number:_0x15b63a,remoteJid:_0x598457,isGroup:_0x4e4ffe,email:email='',companyId:_0x3f6e60,extraInfo:extraInfo=[],disableBot:disableBot=![],whatsappId:_0x35e3f5},_0x11a64b,_0x221bca)=>{const _0x54daab=a413_0x2310eb,_0x56c354=_0x4e4ffe?_0x15b63a:_0x15b63a[_0x54daab(0x151)](/[^0-9]/g,''),_0x4c0e9b=(0x0,socket_1[_0x54daab(0x16c)])();let _0x442f75;_0x442f75=await Contact_1['default'][_0x54daab(0x170)]({'where':{'number':_0x56c354,'companyId':_0x3f6e60}});if(_0x442f75){if(_0x4a34db&&(!_0x442f75[_0x54daab(0x165)]||_0x442f75[_0x54daab(0x165)]['match'](/^[0-9]*$/))&&!_0x4a34db['match'](/^[0-9]*$/)){_0x442f75[_0x54daab(0x159)](_0x54daab(0x165),!![]),_0x442f75['changed']('updatedAt',!![]);let _0x54ccee;try{_0x54ccee=await(0x0,GetProfilePicUrl_1[_0x54daab(0x172)])(_0x15b63a,_0x3f6e60);}catch(_0x37a5f0){console['log'](_0x54daab(0x16f)+_0x37a5f0);}_0x54ccee?.[_0x54daab(0x15e)](_0x54daab(0x15d))&&(_0x54ccee=_0x442f75['profilePicUrl']),_0x442f75[_0x54daab(0x169)]({'name':_0x4a34db,'profilePicUrl':_0x54ccee});}const _0x3ed88c=new Date(_0x442f75['updatedAt']),_0x50e60e=new Date(),_0x126765=_0x50e60e[_0x54daab(0x166)]()-_0x3ed88c[_0x54daab(0x166)](),_0xfbaaf2=Math[_0x54daab(0x157)](_0x126765/(0x3e8*0xe10*0x18));if(_0xfbaaf2>=0x3){let _0x13dd6d;try{_0x13dd6d=await(0x0,GetProfilePicUrl_1[_0x54daab(0x172)])(_0x15b63a,_0x3f6e60);}catch(_0x3f019e){console['log'](_0x54daab(0x152)+_0x3f019e);}_0x442f75['changed'](_0x54daab(0x155),!![]),!_0x13dd6d?.['endsWith']('nopicture.png')?_0x442f75['update']({'profilePicUrl':_0x13dd6d,'updatedAt':new Date()}):_0x442f75[_0x54daab(0x169)]({'updatedAt':new Date()});}(0x0,lodash_1[_0x54daab(0x167)])(_0x442f75[_0x54daab(0x160)]===null)&&_0x442f75[_0x54daab(0x169)]({'whatsappId':_0x35e3f5}),_0x4c0e9b['to']('company-'+_0x3f6e60+_0x54daab(0x15b))[_0x54daab(0x16a)](_0x54daab(0x15a)+_0x3f6e60+_0x54daab(0x16b),{'action':_0x54daab(0x169),'contact':_0x442f75});}else{let _0x436853;try{_0x436853=await(0x0,GetProfilePicUrl_1['default'])(_0x15b63a,_0x3f6e60);}catch(_0x394332){_0x436853=process['env']['FRONTEND_URL']+_0x54daab(0x175);}_0x442f75=await Contact_1['default'][_0x54daab(0x173)]({'name':_0x4a34db,'number':_0x56c354,'profilePicUrl':_0x436853,'email':email,'isGroup':_0x4e4ffe,'extraInfo':extraInfo,'companyId':_0x3f6e60,'disableBot':disableBot,'whatsappId':_0x35e3f5}),_0x4c0e9b['to']('company-'+_0x3f6e60+'-mainchannel')['emit'](_0x54daab(0x15a)+_0x3f6e60+'-contact',{'action':'create','contact':_0x442f75});}return _0x442f75;};exports[a413_0x2310eb(0x172)]=CreateOrUpdateContactService;