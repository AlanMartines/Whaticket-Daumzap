const a249_0x4e38c1=a249_0x4ec6;(function(_0x3d0049,_0x5ab57a){const _0x44f747=a249_0x4ec6,_0x411c45=_0x3d0049();while(!![]){try{const _0x1602be=-parseInt(_0x44f747(0xd8))/0x1+parseInt(_0x44f747(0xdf))/0x2*(parseInt(_0x44f747(0xe5))/0x3)+parseInt(_0x44f747(0xd6))/0x4*(parseInt(_0x44f747(0xc3))/0x5)+parseInt(_0x44f747(0xda))/0x6+parseInt(_0x44f747(0xe3))/0x7*(parseInt(_0x44f747(0xe6))/0x8)+parseInt(_0x44f747(0xd0))/0x9*(-parseInt(_0x44f747(0xf4))/0xa)+-parseInt(_0x44f747(0xf7))/0xb*(parseInt(_0x44f747(0xc9))/0xc);if(_0x1602be===_0x5ab57a)break;else _0x411c45['push'](_0x411c45['shift']());}catch(_0x5af9d1){_0x411c45['push'](_0x411c45['shift']());}}}(a249_0x53a9,0xce57a));const a249_0x45e77b=(function(){let _0x27482a=!![];return function(_0x1e1051,_0x255bbb){const _0x273c47=_0x27482a?function(){const _0x16d7f4=a249_0x4ec6;if(_0x255bbb){const _0x2d6509=_0x255bbb[_0x16d7f4(0xf6)](_0x1e1051,arguments);return _0x255bbb=null,_0x2d6509;}}:function(){};return _0x27482a=![],_0x273c47;};}()),a249_0x4a8783=a249_0x45e77b(this,function(){const _0x5ebdad=a249_0x4ec6;return a249_0x4a8783['toString']()[_0x5ebdad(0xeb)](_0x5ebdad(0xc6))[_0x5ebdad(0xce)]()[_0x5ebdad(0xd5)](a249_0x4a8783)[_0x5ebdad(0xeb)](_0x5ebdad(0xc6));});a249_0x4a8783();'use strict';var __importDefault=this&&this[a249_0x4e38c1(0xef)]||function(_0x3ce512){const _0x3cf9e5=a249_0x4e38c1;return _0x3ce512&&_0x3ce512[_0x3cf9e5(0xd9)]?_0x3ce512:{'default':_0x3ce512};};Object[a249_0x4e38c1(0xf9)](exports,a249_0x4e38c1(0xd9),{'value':!![]});const socket_1=require('../libs/socket'),Message_1=__importDefault(require('../models/Message')),logger_1=require(a249_0x4e38c1(0xd2)),GetTicketWbot_1=__importDefault(require(a249_0x4e38c1(0xcb))),cache_1=require(a249_0x4e38c1(0xe2)),SetTicketMessagesAsRead=async _0x23f899=>{const _0x5ae7c8=a249_0x4e38c1;async function _0x3b412a(_0x31274f,_0x5db0ad,_0x2a7e4d,_0x36f4ef){const _0x12a11a=a249_0x4ec6;await _0x31274f[_0x12a11a(0xc8)](_0x5db0ad,_0x2a7e4d,[_0x36f4ef],_0x12a11a(0xf3));}await _0x23f899[_0x5ae7c8(0xe4)]({'unreadMessages':0x0});try{const _0x2a1bbb=await(0x0,GetTicketWbot_1[_0x5ae7c8(0xdb)])(_0x23f899),_0x4f379=await Message_1[_0x5ae7c8(0xdb)][_0x5ae7c8(0xd4)]({'where':{'ticketId':_0x23f899['id'],'fromMe':![],'read':![]},'order':[['createdAt',_0x5ae7c8(0xde)]]});_0x4f379[_0x5ae7c8(0xfa)](async _0x1ec998=>{const _0x2ac81f=_0x5ae7c8,_0x3d3a0c=JSON['parse'](_0x1ec998[_0x2ac81f(0xf2)]);_0x3d3a0c[_0x2ac81f(0xe0)]&&await _0x2a1bbb[_0x2ac81f(0xc7)]([_0x3d3a0c[_0x2ac81f(0xe0)]]);});if(_0x4f379[_0x5ae7c8(0xdd)]>0x0){const _0x458019=JSON[_0x5ae7c8(0xd7)](_0x4f379[0x0][_0x5ae7c8(0xf2)]),_0x25b0d7=_0x23f899[_0x5ae7c8(0xcc)]?_0x23f899[_0x5ae7c8(0xc4)][_0x5ae7c8(0xf8)]['substring'](0xc,0x0)+'-'+_0x23f899[_0x5ae7c8(0xc4)][_0x5ae7c8(0xf8)][_0x5ae7c8(0xf0)](0xc)+_0x5ae7c8(0xea):_0x23f899[_0x5ae7c8(0xc4)]['number']+_0x5ae7c8(0xcf);_0x458019[_0x5ae7c8(0xe0)]&&_0x458019[_0x5ae7c8(0xe0)][_0x5ae7c8(0xe8)]===![]&&await _0x2a1bbb[_0x5ae7c8(0xf1)]({'markRead':!![],'lastMessages':[_0x458019]},_0x25b0d7);}await Message_1[_0x5ae7c8(0xdb)]['update']({'read':!![]},{'where':{'ticketId':_0x23f899['id'],'read':![]}}),await cache_1[_0x5ae7c8(0xec)][_0x5ae7c8(0xc2)](_0x5ae7c8(0xc5)+_0x23f899['contactId']+_0x5ae7c8(0xe7),'0');}catch(_0x19f756){logger_1[_0x5ae7c8(0xd1)][_0x5ae7c8(0xd3)](_0x5ae7c8(0xcd)+_0x19f756);}const _0x50329c=(0x0,socket_1['getIO'])();_0x50329c['to']('company-'+_0x23f899['companyId']+'-'+_0x23f899[_0x5ae7c8(0xca)])['to'](_0x5ae7c8(0xee)+_0x23f899[_0x5ae7c8(0xdc)]+_0x5ae7c8(0xf5))[_0x5ae7c8(0xe9)](_0x5ae7c8(0xee)+_0x23f899['companyId']+_0x5ae7c8(0xe1),{'action':_0x5ae7c8(0xed),'ticketId':_0x23f899['id']});};function a249_0x53a9(){const _0x3ef450=['read','1277170oHTTZF','-notification','apply','18145941EaxLVK','number','defineProperty','map','set','43390PVPKsg','contact','contacts:','(((.+)+)+)+$','readMessages','sendReceipt','12gyYiYA','status','./GetTicketWbot','isGroup','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','toString','@s.whatsapp.net','36OYpCtJ','logger','../utils/logger','warn','findAll','constructor','372WyVnHE','parse','1053218IErhco','__esModule','4508736swTTJk','default','companyId','length','DESC','104pvOiDN','key','-ticket','../libs/cache','455581qfdPFN','update','72912gJFKfp','152qHauSY',':unreads','fromMe','emit','@g.us','search','cacheLayer','updateUnread','company-','__importDefault','substring','chatModify','dataJson'];a249_0x53a9=function(){return _0x3ef450;};return a249_0x53a9();}function a249_0x4ec6(_0xdc1121,_0x827d81){const _0x301b01=a249_0x53a9();return a249_0x4ec6=function(_0x4a8783,_0x45e77b){_0x4a8783=_0x4a8783-0xc2;let _0x53a90d=_0x301b01[_0x4a8783];return _0x53a90d;},a249_0x4ec6(_0xdc1121,_0x827d81);}exports[a249_0x4e38c1(0xdb)]=SetTicketMessagesAsRead;