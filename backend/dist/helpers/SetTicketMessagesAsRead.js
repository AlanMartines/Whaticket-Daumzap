const a249_0x135596=a249_0x356c;(function(_0x3e18f9,_0x51c328){const _0x5d0754=a249_0x356c,_0x154395=_0x3e18f9();while(!![]){try{const _0x48975d=parseInt(_0x5d0754(0x8d))/0x1+parseInt(_0x5d0754(0x7a))/0x2*(-parseInt(_0x5d0754(0x95))/0x3)+-parseInt(_0x5d0754(0x7d))/0x4*(parseInt(_0x5d0754(0x80))/0x5)+-parseInt(_0x5d0754(0x76))/0x6+-parseInt(_0x5d0754(0x6f))/0x7*(parseInt(_0x5d0754(0x75))/0x8)+parseInt(_0x5d0754(0x7f))/0x9+-parseInt(_0x5d0754(0x7c))/0xa*(-parseInt(_0x5d0754(0x70))/0xb);if(_0x48975d===_0x51c328)break;else _0x154395['push'](_0x154395['shift']());}catch(_0x4cf2a8){_0x154395['push'](_0x154395['shift']());}}}(a249_0x4482,0xd51bd));const a249_0x1f51a7=(function(){let _0x325390=!![];return function(_0x11f164,_0x300772){const _0x4ad2c4=_0x325390?function(){if(_0x300772){const _0x550fee=_0x300772['apply'](_0x11f164,arguments);return _0x300772=null,_0x550fee;}}:function(){};return _0x325390=![],_0x4ad2c4;};}()),a249_0x5062d9=a249_0x1f51a7(this,function(){const _0x65789c=a249_0x356c;return a249_0x5062d9['toString']()[_0x65789c(0x8f)](_0x65789c(0x6c))['toString']()[_0x65789c(0x86)](a249_0x5062d9)[_0x65789c(0x8f)](_0x65789c(0x6c));});a249_0x5062d9();function a249_0x356c(_0x82e215,_0x53e86d){const _0x228473=a249_0x4482();return a249_0x356c=function(_0x5062d9,_0x1f51a7){_0x5062d9=_0x5062d9-0x6a;let _0x44820c=_0x228473[_0x5062d9];return _0x44820c;},a249_0x356c(_0x82e215,_0x53e86d);}'use strict';var __importDefault=this&&this[a249_0x135596(0x98)]||function(_0x473451){const _0x5dd3bd=a249_0x135596;return _0x473451&&_0x473451[_0x5dd3bd(0x97)]?_0x473451:{'default':_0x473451};};function a249_0x4482(){const _0x1c5752=['default','warn','7GZhNvK','33rSGchE','isGroup','../models/Message','logger','@g.us','5258376djcLtM','2267334fbkrGm','./GetTicketWbot','../utils/logger','company-','518aEUqfC','update','5683580uaiwdM','1018060xcbCUN','sendReceipt','9478161AQCLwL','5Ncftpq','key','getIO','readMessages','contacts:','contact','constructor','parse','-ticket','fromMe','substring',':unreads','Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20','814128aZhjJQ','defineProperty','search','status','length','../libs/cache','set','updateUnread','16329pScWsX','chatModify','__esModule','__importDefault','../libs/socket','emit','number','companyId','(((.+)+)+)+$'];a249_0x4482=function(){return _0x1c5752;};return a249_0x4482();}Object[a249_0x135596(0x8e)](exports,a249_0x135596(0x97),{'value':!![]});const socket_1=require(a249_0x135596(0x99)),Message_1=__importDefault(require(a249_0x135596(0x72))),logger_1=require(a249_0x135596(0x78)),GetTicketWbot_1=__importDefault(require(a249_0x135596(0x77))),cache_1=require(a249_0x135596(0x92)),SetTicketMessagesAsRead=async _0x152e59=>{const _0x552e5e=a249_0x135596;async function _0x48b84a(_0x48b4d1,_0x52e7ed,_0x5b3389,_0x17617b){const _0x4d2bc0=a249_0x356c;await _0x48b4d1[_0x4d2bc0(0x7e)](_0x52e7ed,_0x5b3389,[_0x17617b],'read');}await _0x152e59[_0x552e5e(0x7b)]({'unreadMessages':0x0});try{const _0x35ea38=await(0x0,GetTicketWbot_1[_0x552e5e(0x6d)])(_0x152e59),_0x4bc263=await Message_1[_0x552e5e(0x6d)]['findAll']({'where':{'ticketId':_0x152e59['id'],'fromMe':![],'read':![]},'order':[['createdAt','DESC']]});_0x4bc263['map'](async _0x66b40d=>{const _0x13f5e1=_0x552e5e,_0x2b570b=JSON['parse'](_0x66b40d['dataJson']);_0x2b570b['key']&&await _0x35ea38[_0x13f5e1(0x83)]([_0x2b570b[_0x13f5e1(0x81)]]);});if(_0x4bc263[_0x552e5e(0x91)]>0x0){const _0x5abd18=JSON[_0x552e5e(0x87)](_0x4bc263[0x0]['dataJson']),_0x196e46=_0x152e59[_0x552e5e(0x71)]?_0x152e59[_0x552e5e(0x85)]['number'][_0x552e5e(0x8a)](0xc,0x0)+'-'+_0x152e59[_0x552e5e(0x85)][_0x552e5e(0x6a)][_0x552e5e(0x8a)](0xc)+_0x552e5e(0x74):_0x152e59['contact']['number']+'@s.whatsapp.net';_0x5abd18[_0x552e5e(0x81)]&&_0x5abd18['key'][_0x552e5e(0x89)]===![]&&await _0x35ea38[_0x552e5e(0x96)]({'markRead':!![],'lastMessages':[_0x5abd18]},_0x196e46);}await Message_1['default'][_0x552e5e(0x7b)]({'read':!![]},{'where':{'ticketId':_0x152e59['id'],'read':![]}}),await cache_1['cacheLayer'][_0x552e5e(0x93)](_0x552e5e(0x84)+_0x152e59['contactId']+_0x552e5e(0x8b),'0');}catch(_0x3ae1ee){logger_1[_0x552e5e(0x73)][_0x552e5e(0x6e)](_0x552e5e(0x8c)+_0x3ae1ee);}const _0x3edfd2=(0x0,socket_1[_0x552e5e(0x82)])();_0x3edfd2['to'](_0x552e5e(0x79)+_0x152e59[_0x552e5e(0x6b)]+'-'+_0x152e59[_0x552e5e(0x90)])['to'](_0x552e5e(0x79)+_0x152e59[_0x552e5e(0x6b)]+'-notification')[_0x552e5e(0x9a)]('company-'+_0x152e59[_0x552e5e(0x6b)]+_0x552e5e(0x88),{'action':_0x552e5e(0x94),'ticketId':_0x152e59['id']});};exports['default']=SetTicketMessagesAsRead;