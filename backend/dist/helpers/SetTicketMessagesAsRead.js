const a249_0x1aece7=a249_0x310e;function a249_0x310e(_0x45a08d,_0x1c551f){const _0x5afa44=a249_0x101e();return a249_0x310e=function(_0x20810e,_0x29192b){_0x20810e=_0x20810e-0x9b;let _0x101e73=_0x5afa44[_0x20810e];return _0x101e73;},a249_0x310e(_0x45a08d,_0x1c551f);}(function(_0x3974c8,_0x1aa99f){const _0xaf6442=a249_0x310e,_0x3093bb=_0x3974c8();while(!![]){try{const _0xf5fbeb=-parseInt(_0xaf6442(0xc7))/0x1+parseInt(_0xaf6442(0xbc))/0x2+parseInt(_0xaf6442(0xaf))/0x3+-parseInt(_0xaf6442(0xaa))/0x4+parseInt(_0xaf6442(0x9e))/0x5+parseInt(_0xaf6442(0x9f))/0x6*(-parseInt(_0xaf6442(0xa7))/0x7)+parseInt(_0xaf6442(0x9d))/0x8*(parseInt(_0xaf6442(0xa3))/0x9);if(_0xf5fbeb===_0x1aa99f)break;else _0x3093bb['push'](_0x3093bb['shift']());}catch(_0x495fec){_0x3093bb['push'](_0x3093bb['shift']());}}}(a249_0x101e,0xca275));const a249_0x29192b=(function(){let _0x15fcd5=!![];return function(_0xcb5ab3,_0x32d337){const _0x53914a=_0x15fcd5?function(){const _0x2da0a2=a249_0x310e;if(_0x32d337){const _0x1b6a32=_0x32d337[_0x2da0a2(0xc8)](_0xcb5ab3,arguments);return _0x32d337=null,_0x1b6a32;}}:function(){};return _0x15fcd5=![],_0x53914a;};}()),a249_0x20810e=a249_0x29192b(this,function(){const _0x5f0255=a249_0x310e;return a249_0x20810e[_0x5f0255(0xa9)]()[_0x5f0255(0xc5)]('(((.+)+)+)+$')[_0x5f0255(0xa9)]()[_0x5f0255(0xb8)](a249_0x20810e)[_0x5f0255(0xc5)](_0x5f0255(0xba));});a249_0x20810e();'use strict';var __importDefault=this&&this[a249_0x1aece7(0xc1)]||function(_0x735af8){const _0x47bfeb=a249_0x1aece7;return _0x735af8&&_0x735af8[_0x47bfeb(0xb7)]?_0x735af8:{'default':_0x735af8};};Object[a249_0x1aece7(0xc3)](exports,a249_0x1aece7(0xb7),{'value':!![]});function a249_0x101e(){const _0x1d1a67=['update','toString','5569728xYmxfG','../libs/cache','warn','number','../models/Message','1713834nVHXut','-ticket',':unreads','readMessages','set','cacheLayer','findAll','parse','__esModule','constructor','contactId','(((.+)+)+)+$','read','1044722GNgoWB','key','-notification','chatModify','getIO','__importDefault','default','defineProperty','substring','search','./GetTicketWbot','41980mzQsmh','apply','sendReceipt','length','3112LNrNTz','7871640oGRRay','6ZsPLsg','company-','contacts:','companyId','5787XkLSer','contact','logger','emit','4589627szpOvd'];a249_0x101e=function(){return _0x1d1a67;};return a249_0x101e();}const socket_1=require('../libs/socket'),Message_1=__importDefault(require(a249_0x1aece7(0xae))),logger_1=require('../utils/logger'),GetTicketWbot_1=__importDefault(require(a249_0x1aece7(0xc6))),cache_1=require(a249_0x1aece7(0xab)),SetTicketMessagesAsRead=async _0x209020=>{const _0x3424ea=a249_0x1aece7;async function _0x21adac(_0x2434dc,_0x208f6a,_0x5a3db8,_0x197ab4){const _0x55c6af=a249_0x310e;await _0x2434dc[_0x55c6af(0x9b)](_0x208f6a,_0x5a3db8,[_0x197ab4],_0x55c6af(0xbb));}await _0x209020[_0x3424ea(0xa8)]({'unreadMessages':0x0});try{const _0x1d38bd=await(0x0,GetTicketWbot_1['default'])(_0x209020),_0xd1f6af=await Message_1['default'][_0x3424ea(0xb5)]({'where':{'ticketId':_0x209020['id'],'fromMe':![],'read':![]},'order':[['createdAt','DESC']]});_0xd1f6af['map'](async _0x9a6399=>{const _0x55d3b4=_0x3424ea,_0x178608=JSON[_0x55d3b4(0xb6)](_0x9a6399['dataJson']);_0x178608[_0x55d3b4(0xbd)]&&await _0x1d38bd[_0x55d3b4(0xb2)]([_0x178608[_0x55d3b4(0xbd)]]);});if(_0xd1f6af[_0x3424ea(0x9c)]>0x0){const _0x5175c9=JSON[_0x3424ea(0xb6)](_0xd1f6af[0x0]['dataJson']),_0x19d51f=_0x209020['isGroup']?_0x209020[_0x3424ea(0xa4)][_0x3424ea(0xad)][_0x3424ea(0xc4)](0xc,0x0)+'-'+_0x209020[_0x3424ea(0xa4)][_0x3424ea(0xad)]['substring'](0xc)+'@g.us':_0x209020[_0x3424ea(0xa4)][_0x3424ea(0xad)]+'@s.whatsapp.net';_0x5175c9[_0x3424ea(0xbd)]&&_0x5175c9['key']['fromMe']===![]&&await _0x1d38bd[_0x3424ea(0xbf)]({'markRead':!![],'lastMessages':[_0x5175c9]},_0x19d51f);}await Message_1['default'][_0x3424ea(0xa8)]({'read':!![]},{'where':{'ticketId':_0x209020['id'],'read':![]}}),await cache_1[_0x3424ea(0xb4)][_0x3424ea(0xb3)](_0x3424ea(0xa1)+_0x209020[_0x3424ea(0xb9)]+_0x3424ea(0xb1),'0');}catch(_0x40bf6c){logger_1[_0x3424ea(0xa5)][_0x3424ea(0xac)]('Could\x20not\x20mark\x20messages\x20as\x20read.\x20Maybe\x20whatsapp\x20session\x20disconnected?\x20Err:\x20'+_0x40bf6c);}const _0x144427=(0x0,socket_1[_0x3424ea(0xc0)])();_0x144427['to'](_0x3424ea(0xa0)+_0x209020[_0x3424ea(0xa2)]+'-'+_0x209020['status'])['to']('company-'+_0x209020[_0x3424ea(0xa2)]+_0x3424ea(0xbe))[_0x3424ea(0xa6)](_0x3424ea(0xa0)+_0x209020[_0x3424ea(0xa2)]+_0x3424ea(0xb0),{'action':'updateUnread','ticketId':_0x209020['id']});};exports[a249_0x1aece7(0xc2)]=SetTicketMessagesAsRead;