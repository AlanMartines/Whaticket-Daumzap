const a244_0x41f4c6=a244_0x4f98;(function(_0x315832,_0xaa3cb){const _0x13f9a0=a244_0x4f98,_0x2517c2=_0x315832();while(!![]){try{const _0x10ee67=parseInt(_0x13f9a0(0x14d))/0x1*(parseInt(_0x13f9a0(0x161))/0x2)+parseInt(_0x13f9a0(0x170))/0x3*(-parseInt(_0x13f9a0(0x156))/0x4)+-parseInt(_0x13f9a0(0x167))/0x5+-parseInt(_0x13f9a0(0x164))/0x6+-parseInt(_0x13f9a0(0x173))/0x7*(-parseInt(_0x13f9a0(0x17e))/0x8)+-parseInt(_0x13f9a0(0x15c))/0x9*(parseInt(_0x13f9a0(0x17f))/0xa)+parseInt(_0x13f9a0(0x16e))/0xb*(parseInt(_0x13f9a0(0x175))/0xc);if(_0x10ee67===_0xaa3cb)break;else _0x2517c2['push'](_0x2517c2['shift']());}catch(_0x3983d0){_0x2517c2['push'](_0x2517c2['shift']());}}}(a244_0xcdf5,0x88a49));function a244_0xcdf5(){const _0x539e7b=['contact','constructor','mediaPath','66GODhbM','body','3HUuAWM','update','../services/ContactServices/CreateOrUpdateContactService','3832010SyeUbF','sendMessage','633672hopxKn','key','../helpers/SetTicketMessagesAsRead','fileName','getMessageOptions','../services/WbotServices/SendWhatsAppMedia','split','remoteJid','string','16kNXFkH','832330pXINwD','SendPresenceStatus','number','../services/WbotServices/CheckNumber','verifyMessage','fromMe','g.us','839uyWRHD','toString','__esModule','default','mime','participant','s.whatsapp.net','unknown','SendMessage','1509424GkEKBM','body\x20is\x20not\x20a\x20string','toLocaleString','companyId','isGroup','../services/WbotServices/wbotMessageListener','63qoLxLA','__importDefault','replace','jid','./SendPresenceStatus','2206vncVLl','verifyQuotedMessage','trace','3171624NTbpfD','../helpers/Mustache','../services/MessageServices/CreateMessageService','1444165hEhKVp','(((.+)+)+)+$','lookup','finalName'];a244_0xcdf5=function(){return _0x539e7b;};return a244_0xcdf5();}const a244_0x377ad1=(function(){let _0x553c8d=!![];return function(_0x494b99,_0x13e48f){const _0xffbd16=_0x553c8d?function(){if(_0x13e48f){const _0x5d39b7=_0x13e48f['apply'](_0x494b99,arguments);return _0x13e48f=null,_0x5d39b7;}}:function(){};return _0x553c8d=![],_0xffbd16;};}()),a244_0x1a6cbf=a244_0x377ad1(this,function(){const _0x194ab6=a244_0x4f98;return a244_0x1a6cbf[_0x194ab6(0x14e)]()['search']('(((.+)+)+)+$')[_0x194ab6(0x14e)]()[_0x194ab6(0x16c)](a244_0x1a6cbf)['search'](_0x194ab6(0x168));});a244_0x1a6cbf();'use strict';var __importDefault=this&&this[a244_0x41f4c6(0x15d)]||function(_0xf13d86){const _0x3f71d3=a244_0x41f4c6;return _0xf13d86&&_0xf13d86[_0x3f71d3(0x14f)]?_0xf13d86:{'default':_0xf13d86};};Object['defineProperty'](exports,a244_0x41f4c6(0x14f),{'value':!![]}),exports[a244_0x41f4c6(0x155)]=void 0x0;const GetWhatsappWbot_1=__importDefault(require('./GetWhatsappWbot')),SendWhatsAppMedia_1=require(a244_0x41f4c6(0x17a)),CreateOrUpdateContactService_1=__importDefault(require(a244_0x41f4c6(0x172))),FindOrCreateTicketService_1=__importDefault(require('../services/TicketServices/FindOrCreateTicketService')),CheckNumber_1=__importDefault(require(a244_0x41f4c6(0x149))),SetTicketMessagesAsRead_1=__importDefault(require(a244_0x41f4c6(0x177))),Mustache_1=__importDefault(require(a244_0x41f4c6(0x165))),wbotMessageListener_1=require(a244_0x41f4c6(0x15b)),mime_1=__importDefault(require(a244_0x41f4c6(0x151))),CreateMessageService_1=__importDefault(require(a244_0x41f4c6(0x166))),SendPresenceStatus_1=require(a244_0x41f4c6(0x160)),SendMessage=async(_0x2010c2,_0x50c0e6)=>{const _0x66cd56=a244_0x41f4c6;try{const _0x1f694a=await(0x0,GetWhatsappWbot_1['default'])(_0x2010c2),_0x277414=_0x50c0e6[_0x66cd56(0x181)],_0x384d2f=_0x50c0e6['body'],_0x204917=_0x2010c2[_0x66cd56(0x159)],_0x5b8a60=await(0x0,CheckNumber_1[_0x66cd56(0x150)])(_0x277414[_0x66cd56(0x158)](),_0x204917),_0xdad272=_0x5b8a60[_0x66cd56(0x15f)][_0x66cd56(0x15e)](/\D/g,''),_0x1646b6={'name':''+_0xdad272,'number':_0xdad272,'isGroup':![],'companyId':_0x204917},_0x238254=await(0x0,CreateOrUpdateContactService_1[_0x66cd56(0x150)])(_0x1646b6,_0x1f694a,_0x5b8a60[_0x66cd56(0x15f)]),_0x4c0839=await(0x0,FindOrCreateTicketService_1['default'])(_0x238254,_0x2010c2['id'],0x0,_0x204917),_0xc78003=_0x4c0839[_0x66cd56(0x16b)][_0x66cd56(0x181)]+'@'+(_0x4c0839[_0x66cd56(0x15a)]?_0x66cd56(0x14c):_0x66cd56(0x153));let _0x2c4daa;if(_0x50c0e6['mediaPath']){const _0x342b70=await(0x0,SendWhatsAppMedia_1[_0x66cd56(0x179)])(_0x50c0e6[_0x66cd56(0x178)],_0x50c0e6[_0x66cd56(0x16d)],_0x50c0e6[_0x66cd56(0x16f)],_0x204917);if(_0x342b70){await(0x0,SendPresenceStatus_1[_0x66cd56(0x180)])(_0x1f694a,_0xc78003,0x0,0x2710);let _0x318096=_0x2c4daa=await _0x1f694a[_0x66cd56(0x174)](_0xc78003,{..._0x342b70});const _0x276dce=mime_1['default'][_0x66cd56(0x169)](_0x50c0e6[_0x66cd56(0x16d)]),_0x5e16b8=await(0x0,wbotMessageListener_1[_0x66cd56(0x162)])(_0x318096),_0xe55a4d={'id':_0x318096[_0x66cd56(0x176)]['id'],'ticketId':_0x4c0839['id'],'contactId':_0x318096[_0x66cd56(0x176)]['fromMe']?undefined:_0x238254['id'],'body':_0x384d2f?(0x0,Mustache_1[_0x66cd56(0x150)])(_0x384d2f,_0x4c0839):_0x50c0e6['fileName'],'fromMe':_0x318096[_0x66cd56(0x176)][_0x66cd56(0x14b)],'read':_0x318096['key'][_0x66cd56(0x14b)],'mediaUrl':_0x50c0e6[_0x66cd56(0x16a)],'mediaType':typeof _0x276dce===_0x66cd56(0x17d)?_0x276dce[_0x66cd56(0x17b)]('/')[0x0]:_0x66cd56(0x154),'quotedMsgId':_0x5e16b8?.['id'],'ack':0x0,'remoteJid':_0x318096['key'][_0x66cd56(0x17c)],'participant':_0x318096[_0x66cd56(0x176)][_0x66cd56(0x152)],'dataJson':JSON['stringify'](_0x318096)};typeof _0xe55a4d['body']!=_0x66cd56(0x17d)&&console[_0x66cd56(0x163)](_0x66cd56(0x157),_0xe55a4d[_0x66cd56(0x16f)]),await _0x4c0839[_0x66cd56(0x171)]({'lastMessage':_0xe55a4d[_0x66cd56(0x16f)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0xe55a4d,'ticket':_0x4c0839,'companyId':_0x4c0839[_0x66cd56(0x159)]});}}else{const _0x33ea0b='â€Ž\x20'+_0x50c0e6[_0x66cd56(0x16f)];await(0x0,SendPresenceStatus_1[_0x66cd56(0x180)])(_0x1f694a,_0xc78003);const _0x2e6319=await _0x1f694a[_0x66cd56(0x174)](_0xc78003,{'text':(0x0,Mustache_1['default'])(_0x33ea0b,_0x4c0839)});await(0x0,wbotMessageListener_1[_0x66cd56(0x14a)])(_0x2e6319,_0x4c0839,_0x4c0839[_0x66cd56(0x16b)]);}return typeof _0x384d2f!='string'&&console[_0x66cd56(0x163)]('body\x20is\x20not\x20a\x20string',_0x384d2f),await _0x4c0839['update']({'lastMessage':_0x384d2f}),(0x0,SetTicketMessagesAsRead_1['default'])(_0x4c0839),_0x2c4daa;}catch(_0x42aa2d){throw new Error(_0x42aa2d);}};function a244_0x4f98(_0x4fb9bc,_0x24aa65){const _0x2805b6=a244_0xcdf5();return a244_0x4f98=function(_0x1a6cbf,_0x377ad1){_0x1a6cbf=_0x1a6cbf-0x149;let _0xcdf5df=_0x2805b6[_0x1a6cbf];return _0xcdf5df;},a244_0x4f98(_0x4fb9bc,_0x24aa65);}exports[a244_0x41f4c6(0x155)]=SendMessage;