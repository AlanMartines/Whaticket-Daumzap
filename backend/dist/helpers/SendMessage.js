const a244_0x531767=a244_0x4e96;function a244_0x554b(){const _0x522ab4=['body','fromMe','constructor','verifyMessage','finalName','toString','default','1680462GNnced','__importDefault','split','6pJtBHT','sendMessage','mime','jid','update','../services/TicketServices/FindOrCreateTicketService','verifyQuotedMessage','toLocaleString','./SendPresenceStatus','57Jpfaco','../services/WbotServices/SendWhatsAppMedia','g.us','s.whatsapp.net','stringify','number','companyId','SendMessage','14282wwmkbK','getMessageOptions','../services/MessageServices/CreateMessageService','120064IvUJtA','1415631JoxiVS','382400Ppcgjz','replace','trace','../services/WbotServices/wbotMessageListener','fileName','string','body\x20is\x20not\x20a\x20string','key','../services/ContactServices/CreateOrUpdateContactService','mediaPath','./GetWhatsappWbot','781948weOFZf','contact','../helpers/Mustache','search','defineProperty','__esModule','(((.+)+)+)+$','SendPresenceStatus','1372285gkvUpw','../helpers/SetTicketMessagesAsRead'];a244_0x554b=function(){return _0x522ab4;};return a244_0x554b();}(function(_0x22a106,_0x37c348){const _0x508b54=a244_0x4e96,_0x337337=_0x22a106();while(!![]){try{const _0x43d473=-parseInt(_0x508b54(0x1d4))/0x1+-parseInt(_0x508b54(0x1d1))/0x2*(-parseInt(_0x508b54(0x1fe))/0x3)+parseInt(_0x508b54(0x1e1))/0x4+-parseInt(_0x508b54(0x1e9))/0x5*(-parseInt(_0x508b54(0x1f5))/0x6)+-parseInt(_0x508b54(0x1d5))/0x7+parseInt(_0x508b54(0x1d6))/0x8+-parseInt(_0x508b54(0x1f2))/0x9;if(_0x43d473===_0x37c348)break;else _0x337337['push'](_0x337337['shift']());}catch(_0xd2c594){_0x337337['push'](_0x337337['shift']());}}}(a244_0x554b,0x23418));function a244_0x4e96(_0x1c8f4f,_0x2b25f0){const _0x204014=a244_0x554b();return a244_0x4e96=function(_0x19830d,_0x412064){_0x19830d=_0x19830d-0x1cd;let _0x554ba8=_0x204014[_0x19830d];return _0x554ba8;},a244_0x4e96(_0x1c8f4f,_0x2b25f0);}const a244_0x412064=(function(){let _0x2391ad=!![];return function(_0x61f138,_0x1ea141){const _0x499034=_0x2391ad?function(){if(_0x1ea141){const _0x4f2534=_0x1ea141['apply'](_0x61f138,arguments);return _0x1ea141=null,_0x4f2534;}}:function(){};return _0x2391ad=![],_0x499034;};}()),a244_0x19830d=a244_0x412064(this,function(){const _0x5237ff=a244_0x4e96;return a244_0x19830d[_0x5237ff(0x1f0)]()['search']('(((.+)+)+)+$')[_0x5237ff(0x1f0)]()[_0x5237ff(0x1ed)](a244_0x19830d)[_0x5237ff(0x1e4)](_0x5237ff(0x1e7));});a244_0x19830d();'use strict';var __importDefault=this&&this[a244_0x531767(0x1f3)]||function(_0x2cda35){return _0x2cda35&&_0x2cda35['__esModule']?_0x2cda35:{'default':_0x2cda35};};Object[a244_0x531767(0x1e5)](exports,a244_0x531767(0x1e6),{'value':!![]}),exports['SendMessage']=void 0x0;const GetWhatsappWbot_1=__importDefault(require(a244_0x531767(0x1e0))),SendWhatsAppMedia_1=require(a244_0x531767(0x1ff)),CreateOrUpdateContactService_1=__importDefault(require(a244_0x531767(0x1de))),FindOrCreateTicketService_1=__importDefault(require(a244_0x531767(0x1fa))),CheckNumber_1=__importDefault(require('../services/WbotServices/CheckNumber')),SetTicketMessagesAsRead_1=__importDefault(require(a244_0x531767(0x1ea))),Mustache_1=__importDefault(require(a244_0x531767(0x1e3))),wbotMessageListener_1=require(a244_0x531767(0x1d9)),mime_1=__importDefault(require(a244_0x531767(0x1f7))),CreateMessageService_1=__importDefault(require(a244_0x531767(0x1d3))),SendPresenceStatus_1=require(a244_0x531767(0x1fd)),SendMessage=async(_0x3c1f26,_0x4951e1)=>{const _0x3eba32=a244_0x531767;try{const _0x4df079=await(0x0,GetWhatsappWbot_1[_0x3eba32(0x1f1)])(_0x3c1f26),_0x4d454c=_0x4951e1[_0x3eba32(0x1ce)],_0xb099d5=_0x4951e1[_0x3eba32(0x1eb)],_0x2bc065=_0x3c1f26[_0x3eba32(0x1cf)],_0x3237bc=await(0x0,CheckNumber_1[_0x3eba32(0x1f1)])(_0x4d454c[_0x3eba32(0x1fc)](),_0x2bc065),_0x105cbf=_0x3237bc[_0x3eba32(0x1f8)][_0x3eba32(0x1d7)](/\D/g,''),_0x50b3f9={'name':''+_0x105cbf,'number':_0x105cbf,'isGroup':![],'companyId':_0x2bc065},_0x3d5804=await(0x0,CreateOrUpdateContactService_1['default'])(_0x50b3f9,_0x4df079,_0x3237bc[_0x3eba32(0x1f8)]),_0x1a02f9=await(0x0,FindOrCreateTicketService_1['default'])(_0x3d5804,_0x3c1f26['id'],0x0,_0x2bc065),_0x3e8a68=_0x1a02f9['contact'][_0x3eba32(0x1ce)]+'@'+(_0x1a02f9['isGroup']?_0x3eba32(0x200):_0x3eba32(0x201));let _0x4e14e6;if(_0x4951e1[_0x3eba32(0x1df)]){const _0x74753c=await(0x0,SendWhatsAppMedia_1[_0x3eba32(0x1d2)])(_0x4951e1['fileName'],_0x4951e1['mediaPath'],_0x4951e1[_0x3eba32(0x1eb)],_0x2bc065);if(_0x74753c){await(0x0,SendPresenceStatus_1[_0x3eba32(0x1e8)])(_0x4df079,_0x3e8a68,0x0,0x2710);let _0x67dcb2=_0x4e14e6=await _0x4df079[_0x3eba32(0x1f6)](_0x3e8a68,{..._0x74753c});const _0x321cc5=mime_1[_0x3eba32(0x1f1)]['lookup'](_0x4951e1['mediaPath']),_0x11fd09=await(0x0,wbotMessageListener_1[_0x3eba32(0x1fb)])(_0x67dcb2),_0x5ef8c1={'id':_0x67dcb2['key']['id'],'ticketId':_0x1a02f9['id'],'contactId':_0x67dcb2[_0x3eba32(0x1dd)][_0x3eba32(0x1ec)]?undefined:_0x3d5804['id'],'body':_0xb099d5?(0x0,Mustache_1[_0x3eba32(0x1f1)])(_0xb099d5,_0x1a02f9):_0x4951e1[_0x3eba32(0x1da)],'fromMe':_0x67dcb2['key'][_0x3eba32(0x1ec)],'read':_0x67dcb2[_0x3eba32(0x1dd)]['fromMe'],'mediaUrl':_0x4951e1[_0x3eba32(0x1ef)],'mediaType':typeof _0x321cc5===_0x3eba32(0x1db)?_0x321cc5[_0x3eba32(0x1f4)]('/')[0x0]:'unknown','quotedMsgId':_0x11fd09?.['id'],'ack':0x0,'remoteJid':_0x67dcb2[_0x3eba32(0x1dd)]['remoteJid'],'participant':_0x67dcb2['key']['participant'],'dataJson':JSON[_0x3eba32(0x1cd)](_0x67dcb2)};typeof _0x5ef8c1['body']!=_0x3eba32(0x1db)&&console[_0x3eba32(0x1d8)](_0x3eba32(0x1dc),_0x5ef8c1[_0x3eba32(0x1eb)]),await _0x1a02f9[_0x3eba32(0x1f9)]({'lastMessage':_0x5ef8c1[_0x3eba32(0x1eb)]}),await(0x0,CreateMessageService_1['default'])({'messageData':_0x5ef8c1,'ticket':_0x1a02f9,'companyId':_0x1a02f9[_0x3eba32(0x1cf)]});}}else{const _0x51049a='â€Ž\x20'+_0x4951e1['body'];await(0x0,SendPresenceStatus_1[_0x3eba32(0x1e8)])(_0x4df079,_0x3e8a68);const _0x22a901=await _0x4df079['sendMessage'](_0x3e8a68,{'text':(0x0,Mustache_1[_0x3eba32(0x1f1)])(_0x51049a,_0x1a02f9)});await(0x0,wbotMessageListener_1[_0x3eba32(0x1ee)])(_0x22a901,_0x1a02f9,_0x1a02f9[_0x3eba32(0x1e2)]);}return typeof _0xb099d5!=_0x3eba32(0x1db)&&console[_0x3eba32(0x1d8)]('body\x20is\x20not\x20a\x20string',_0xb099d5),await _0x1a02f9[_0x3eba32(0x1f9)]({'lastMessage':_0xb099d5}),(0x0,SetTicketMessagesAsRead_1[_0x3eba32(0x1f1)])(_0x1a02f9),_0x4e14e6;}catch(_0x4398eb){throw new Error(_0x4398eb);}};exports[a244_0x531767(0x1d0)]=SendMessage;