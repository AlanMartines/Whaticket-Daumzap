function a255_0x20d0(_0xe0952a,_0x486825){const _0x19762b=a255_0x5ced();return a255_0x20d0=function(_0x2b0416,_0x22ad92){_0x2b0416=_0x2b0416-0xaa;let _0x5ced24=_0x19762b[_0x2b0416];return _0x5ced24;},a255_0x20d0(_0xe0952a,_0x486825);}const a255_0x1bfd55=a255_0x20d0;(function(_0x3e782b,_0x2da604){const _0x145de6=a255_0x20d0,_0x279600=_0x3e782b();while(!![]){try{const _0x135326=parseInt(_0x145de6(0xc1))/0x1*(-parseInt(_0x145de6(0xf8))/0x2)+parseInt(_0x145de6(0xdf))/0x3+parseInt(_0x145de6(0xd8))/0x4+-parseInt(_0x145de6(0xc3))/0x5*(parseInt(_0x145de6(0xe5))/0x6)+parseInt(_0x145de6(0xef))/0x7+-parseInt(_0x145de6(0xc9))/0x8*(-parseInt(_0x145de6(0xca))/0x9)+parseInt(_0x145de6(0xb0))/0xa*(-parseInt(_0x145de6(0xaf))/0xb);if(_0x135326===_0x2da604)break;else _0x279600['push'](_0x279600['shift']());}catch(_0x2e87cd){_0x279600['push'](_0x279600['shift']());}}}(a255_0x5ced,0xf2cab));function a255_0x5ced(){const _0x336650=['\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','test','leaveTickets','leaveNotification','search','22bhMZcV','5344420qOHFmR','Usuário\x20conectado:\x20','then','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','allTicket','secret',']:\x20Canal:\x20','basic','email','status-','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','notification','FRONTEND_URL','findByPk','env','__esModule','Usuário\x20desconectado:\x20','218402EPatfP','\x20pelo\x20usuário\x20','8357320veetGd','data','(((.+)+)+)+$','logger','parse','\x20da\x20empresa\x20','12968wSJYam','3393RshmcD','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','-notification','leave','CounterManager','error','SOCKET_ADMIN','message','save','joinNotification','verify','../models/Ticket','constructor','toString','7197096KEImyZ','auth','Erro\x20de\x20autenticação:\x20','__importDefault','connection','decrementCounter','apply','3962649hAONIM','info','Erro\x20ao\x20buscar\x20ticket\x20','getIO','query','leaveChatbox[','6goOCCH','instrument','queue-','debug','admin','../errors/AppError','Usuário\x20não\x20encontrado','profile','use','Server','3082471PctoQO','company-','jsonwebtoken','user','passwordHash','joinChatBox','@socket.io/admin-ui','handshake','queues','4LgRXJm','Admin\x20','default','incrementCounter','companyId','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','forEach','Socket\x20IO\x20não\x20inicializado','../utils/logger','join','ticket-','number','leaveChatBox','Usuário\x20','string','userId','../models/Queue','initIO','Token\x20não\x20fornecido','joinChatbox[','defineProperty','development',']:\x20Usuário:\x20'];a255_0x5ced=function(){return _0x336650;};return a255_0x5ced();}const a255_0x22ad92=(function(){let _0x13172f=!![];return function(_0x2a3a35,_0xe61b73){const _0xa07b13=_0x13172f?function(){const _0x40cc53=a255_0x20d0;if(_0xe61b73){const _0x524b5d=_0xe61b73[_0x40cc53(0xde)](_0x2a3a35,arguments);return _0xe61b73=null,_0x524b5d;}}:function(){};return _0x13172f=![],_0xa07b13;};}()),a255_0x2b0416=a255_0x22ad92(this,function(){const _0x44d180=a255_0x20d0;return a255_0x2b0416[_0x44d180(0xd7)]()[_0x44d180(0xae)](_0x44d180(0xc5))[_0x44d180(0xd7)]()[_0x44d180(0xd6)](a255_0x2b0416)[_0x44d180(0xae)](_0x44d180(0xc5));});a255_0x2b0416();'use strict';var __importDefault=this&&this[a255_0x1bfd55(0xdb)]||function(_0x3f2f76){return _0x3f2f76&&_0x3f2f76['__esModule']?_0x3f2f76:{'default':_0x3f2f76};};Object[a255_0x1bfd55(0x10c)](exports,a255_0x1bfd55(0xbf),{'value':!![]}),exports[a255_0x1bfd55(0xe2)]=exports[a255_0x1bfd55(0x109)]=void 0x0;const socket_io_1=require('socket.io'),admin_ui_1=require(a255_0x1bfd55(0xf5)),jsonwebtoken_1=require(a255_0x1bfd55(0xf1)),AppError_1=__importDefault(require(a255_0x1bfd55(0xea))),logger_1=require(a255_0x1bfd55(0x100)),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require(a255_0x1bfd55(0x108))),Ticket_1=__importDefault(require(a255_0x1bfd55(0xd5))),auth_1=__importDefault(require('../config/auth')),counter_1=require('./counter');let io;const initIO=_0x365d27=>{const _0x423952=a255_0x1bfd55;return io=new socket_io_1[(_0x423952(0xee))](_0x365d27,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x423952(0xbe)][_0x423952(0xbc)]}}),process[_0x423952(0xbe)][_0x423952(0xd0)]&&JSON[_0x423952(0xc7)](process[_0x423952(0xbe)][_0x423952(0xd0)])&&User_1[_0x423952(0xfa)][_0x423952(0xbd)](0x1)[_0x423952(0xb2)](_0x1b0742=>{const _0x1fb269=_0x423952;(0x0,admin_ui_1[_0x1fb269(0xe6)])(io,{'auth':{'type':_0x1fb269(0xb7),'username':_0x1b0742[_0x1fb269(0xb8)],'password':_0x1b0742[_0x1fb269(0xf3)]},'mode':_0x1fb269(0x10d)});}),io[_0x423952(0xed)](async(_0x19d568,_0x11ff76)=>{const _0x52ec5e=_0x423952;try{const _0x208268=_0x19d568[_0x52ec5e(0xf6)][_0x52ec5e(0xd9)]['token']||_0x19d568[_0x52ec5e(0xf6)][_0x52ec5e(0xe3)]['token'];if(!_0x208268)throw new Error(_0x52ec5e(0x10a));const _0x5951be=(0x0,jsonwebtoken_1[_0x52ec5e(0xd4)])(_0x208268,auth_1[_0x52ec5e(0xfa)][_0x52ec5e(0xb5)]);if(!_0x5951be||typeof _0x5951be['id']!==_0x52ec5e(0x103))throw new Error('Token\x20inválido');const _0x22388c=await User_1[_0x52ec5e(0xfa)][_0x52ec5e(0xbd)](_0x5951be['id'],{'include':[Queue_1[_0x52ec5e(0xfa)]]});if(!_0x22388c)throw new Error(_0x52ec5e(0xeb));_0x19d568[_0x52ec5e(0xc4)][_0x52ec5e(0xf2)]=_0x22388c,_0x11ff76();}catch(_0xb32439){logger_1[_0x52ec5e(0xc6)][_0x52ec5e(0xcf)](_0x52ec5e(0xda)+_0xb32439[_0x52ec5e(0xd1)]),_0x11ff76(new Error('Falha\x20na\x20autenticação'));}}),io['on'](_0x423952(0xdc),async _0x1221b6=>{const _0xc8c39b=_0x423952,_0x1104aa=_0x1221b6[_0xc8c39b(0xc4)][_0xc8c39b(0xf2)],_0x3a9bb7=new counter_1[(_0xc8c39b(0xce))]();logger_1[_0xc8c39b(0xc6)][_0xc8c39b(0xe0)](_0xc8c39b(0xb1)+_0x1104aa['id']),_0x1104aa['online']=!![],await _0x1104aa[_0xc8c39b(0xd2)](),_0x1221b6[_0xc8c39b(0x101)](_0xc8c39b(0xf0)+_0x1104aa[_0xc8c39b(0xfc)]+'-mainchannel'),_0x1221b6[_0xc8c39b(0x101)](_0xc8c39b(0xf0)+_0x1104aa[_0xc8c39b(0xfc)]),_0x1221b6[_0xc8c39b(0x101)]('user-'+_0x1104aa['id']),_0x1221b6['on'](_0xc8c39b(0xf4),async _0x5c0358=>{const _0x307210=_0xc8c39b;if(typeof _0x5c0358!==_0x307210(0x106)||!/^\d+$/[_0x307210(0xab)](_0x5c0358)){logger_1[_0x307210(0xc6)]['warn']('ID\x20de\x20ticket\x20inválido:\x20'+_0x5c0358);return;}try{const _0x574daa=await Ticket_1['default'][_0x307210(0xbd)](_0x5c0358);if(_0x574daa&&_0x574daa[_0x307210(0xfc)]===_0x1104aa[_0x307210(0xfc)]&&(_0x574daa[_0x307210(0x107)]===_0x1104aa['id']||_0x1104aa['profile']==='admin'||_0x1104aa[_0x307210(0xb4)])){const _0x5ae162=_0x3a9bb7[_0x307210(0xfb)](_0x307210(0x102)+_0x5c0358);_0x5ae162===0x1&&_0x1221b6[_0x307210(0x101)](_0x5c0358),logger_1['logger']['debug'](_0x307210(0x10b)+_0x5ae162+_0x307210(0xb6)+_0x5c0358+_0x307210(0xc2)+_0x1104aa['id']);}else logger_1['logger']['warn'](_0x307210(0xba)+_0x5c0358+_0x307210(0xc2)+_0x1104aa['id']);}catch(_0xc5b214){logger_1[_0x307210(0xc6)][_0x307210(0xcf)](_0x307210(0xe1)+_0x5c0358+':\x20'+_0xc5b214[_0x307210(0xd1)]);}}),_0x1221b6['on'](_0xc8c39b(0x104),_0x1ff047=>{const _0x25273d=_0xc8c39b;if(typeof _0x1ff047===_0x25273d(0x106)&&/^\d+$/[_0x25273d(0xab)](_0x1ff047)){const _0x2e0920=_0x3a9bb7[_0x25273d(0xdd)](_0x25273d(0x102)+_0x1ff047);_0x2e0920===0x0&&_0x1221b6[_0x25273d(0xcd)](_0x1ff047),logger_1[_0x25273d(0xc6)][_0x25273d(0xe8)](_0x25273d(0xe4)+_0x2e0920+_0x25273d(0xb6)+_0x1ff047+_0x25273d(0xc2)+_0x1104aa['id']);}}),_0x1221b6['on'](_0xc8c39b(0xd3),()=>{const _0x30aae5=_0xc8c39b,_0x5a20af=_0x3a9bb7['incrementCounter'](_0x30aae5(0xbb));_0x5a20af===0x1&&(_0x1104aa[_0x30aae5(0xec)]===_0x30aae5(0xe9)||_0x1104aa['allTicket']?_0x1221b6['join'](_0x30aae5(0xf0)+_0x1104aa[_0x30aae5(0xfc)]+_0x30aae5(0xcc)):_0x1104aa[_0x30aae5(0xf7)][_0x30aae5(0xfe)](_0x29a95a=>{const _0x1393ea=_0x30aae5;logger_1[_0x1393ea(0xc6)]['debug']('Usuário\x20'+_0x1104aa['id']+_0x1393ea(0xc8)+_0x1104aa[_0x1393ea(0xfc)]+_0x1393ea(0xaa)+_0x29a95a['id']+'.'),_0x1221b6['join']('queue-'+_0x29a95a['id']+_0x1393ea(0xcc));})),logger_1[_0x30aae5(0xc6)][_0x30aae5(0xe8)]('joinNotification['+_0x5a20af+']:\x20Usuário:\x20'+_0x1104aa['id']);}),_0x1221b6['on'](_0xc8c39b(0xad),()=>{const _0x4fbdde=_0xc8c39b,_0x22df91=_0x3a9bb7[_0x4fbdde(0xdd)](_0x4fbdde(0xbb));_0x22df91===0x0&&(_0x1104aa[_0x4fbdde(0xec)]==='admin'||_0x1104aa[_0x4fbdde(0xb4)]?_0x1221b6['leave'](_0x4fbdde(0xf0)+_0x1104aa[_0x4fbdde(0xfc)]+'-notification'):_0x1104aa['queues'][_0x4fbdde(0xfe)](_0x3ac944=>{const _0x223850=_0x4fbdde;logger_1[_0x223850(0xc6)]['debug'](_0x223850(0x105)+_0x1104aa['id']+_0x223850(0xc8)+_0x1104aa['companyId']+_0x223850(0x10f)+_0x3ac944['id']+'.'),_0x1221b6[_0x223850(0xcd)](_0x223850(0xe7)+_0x3ac944['id']+_0x223850(0xcc));})),logger_1[_0x4fbdde(0xc6)]['debug']('leaveNotification['+_0x22df91+_0x4fbdde(0x10e)+_0x1104aa['id']);}),_0x1221b6['on']('joinTickets',_0x19f058=>{const _0x5d1957=_0xc8c39b;_0x3a9bb7[_0x5d1957(0xfb)]('status-'+_0x19f058)===0x1&&(_0x1104aa[_0x5d1957(0xec)]==='admin'||_0x1104aa['allTicket']?(logger_1[_0x5d1957(0xc6)][_0x5d1957(0xe8)](_0x5d1957(0xf9)+_0x1104aa['id']+_0x5d1957(0xc8)+_0x1104aa['companyId']+_0x5d1957(0xfd)+_0x19f058+'.'),_0x1221b6[_0x5d1957(0x101)](_0x5d1957(0xf0)+_0x1104aa[_0x5d1957(0xfc)]+'-'+_0x19f058)):_0x1104aa[_0x5d1957(0xf7)]['forEach'](_0x2056a5=>{const _0x343e0a=_0x5d1957;logger_1['logger'][_0x343e0a(0xe8)](_0x343e0a(0x105)+_0x1104aa['id']+_0x343e0a(0xc8)+_0x1104aa[_0x343e0a(0xfc)]+_0x343e0a(0xb3)+_0x2056a5['id']+'.'),_0x1221b6[_0x343e0a(0x101)](_0x343e0a(0xe7)+_0x2056a5['id']+'-'+_0x19f058);}));}),_0x1221b6['on'](_0xc8c39b(0xac),_0x7d8fed=>{const _0x4bbf77=_0xc8c39b;_0x3a9bb7[_0x4bbf77(0xdd)](_0x4bbf77(0xb9)+_0x7d8fed)===0x0&&(_0x1104aa[_0x4bbf77(0xec)]===_0x4bbf77(0xe9)||_0x1104aa['allTicket']?(logger_1[_0x4bbf77(0xc6)][_0x4bbf77(0xe8)]('Admin\x20'+_0x1104aa['id']+_0x4bbf77(0xc8)+_0x1104aa['companyId']+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20'+_0x7d8fed+'.'),_0x1221b6[_0x4bbf77(0xcd)](_0x4bbf77(0xf0)+_0x1104aa[_0x4bbf77(0xfc)]+'-'+_0x7d8fed)):_0x1104aa[_0x4bbf77(0xf7)]['forEach'](_0x4e279f=>{const _0x597ac0=_0x4bbf77;logger_1['logger'][_0x597ac0(0xe8)](_0x597ac0(0x105)+_0x1104aa['id']+_0x597ac0(0xc8)+_0x1104aa[_0x597ac0(0xfc)]+_0x597ac0(0xcb)+_0x4e279f['id']+'.'),_0x1221b6[_0x597ac0(0xcd)](_0x597ac0(0xe7)+_0x4e279f['id']+'-'+_0x7d8fed);}));}),_0x1221b6['on']('disconnect',async()=>{const _0x37cc83=_0xc8c39b;logger_1['logger']['info'](_0x37cc83(0xc0)+_0x1104aa['id']),_0x1104aa['online']=![],await _0x1104aa[_0x37cc83(0xd2)]();});}),io;};exports[a255_0x1bfd55(0x109)]=initIO;const getIO=()=>{const _0x7a533a=a255_0x1bfd55;if(!io)throw new AppError_1['default'](_0x7a533a(0xff));return io;};exports[a255_0x1bfd55(0xe2)]=getIO;