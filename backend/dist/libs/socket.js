const a255_0x5cd177=a255_0x4b4e;(function(_0x41a320,_0x1bc5f9){const _0x6de169=a255_0x4b4e,_0x27b6c0=_0x41a320();while(!![]){try{const _0x405691=-parseInt(_0x6de169(0x237))/0x1*(-parseInt(_0x6de169(0x1f8))/0x2)+-parseInt(_0x6de169(0x211))/0x3*(parseInt(_0x6de169(0x1e7))/0x4)+-parseInt(_0x6de169(0x218))/0x5*(parseInt(_0x6de169(0x216))/0x6)+-parseInt(_0x6de169(0x1f5))/0x7*(parseInt(_0x6de169(0x22d))/0x8)+-parseInt(_0x6de169(0x23a))/0x9*(-parseInt(_0x6de169(0x205))/0xa)+parseInt(_0x6de169(0x1ff))/0xb*(-parseInt(_0x6de169(0x21f))/0xc)+parseInt(_0x6de169(0x21a))/0xd;if(_0x405691===_0x1bc5f9)break;else _0x27b6c0['push'](_0x27b6c0['shift']());}catch(_0x574751){_0x27b6c0['push'](_0x27b6c0['shift']());}}}(a255_0x3980,0x92e62));const a255_0x50cb67=(function(){let _0x489efe=!![];return function(_0x3cd147,_0xffd072){const _0x2b0612=_0x489efe?function(){if(_0xffd072){const _0x1075a8=_0xffd072['apply'](_0x3cd147,arguments);return _0xffd072=null,_0x1075a8;}}:function(){};return _0x489efe=![],_0x2b0612;};}()),a255_0x5147cf=a255_0x50cb67(this,function(){const _0x3333a6=a255_0x4b4e;return a255_0x5147cf[_0x3333a6(0x1ec)]()[_0x3333a6(0x1f4)](_0x3333a6(0x215))['toString']()[_0x3333a6(0x20f)](a255_0x5147cf)['search'](_0x3333a6(0x215));});a255_0x5147cf();function a255_0x3980(){const _0x2fdd3b=['error','instrument','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','connection','Token\x20não\x20fornecido','__esModule','admin','\x20pelo\x20usuário\x20','queues','auth','development','handshake','ID\x20de\x20ticket\x20inválido:\x20','ticket-','message','allTicket','FRONTEND_URL','passwordHash','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','../models/Ticket','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','447968ErSZxv','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','../errors/AppError','Erro\x20de\x20autenticação:\x20','leaveTickets','toString','verify','Usuário\x20','token','SOCKET_ADMIN','online','use','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','search','237769zqCqlS','../utils/logger','CounterManager','2zfEEwv','forEach','secret','joinChatBox','__importDefault','Admin\x20','company-','78133TPJiJZ','basic','string','env','socket.io','query','530sYYuEV',']:\x20Usuário:\x20','status-','email','notification','jsonwebtoken','data','leave','./counter','-notification','constructor','getIO','12EoAboJ','Token\x20inválido','debug','queue-','(((.+)+)+)+$','1474878DIfnMe','-mainchannel','10EnGtWO','disconnect','23093174rrIzxf',']:\x20Canal:\x20','default','then','joinTickets','444xsErOd','initIO','profile','companyId','joinChatbox[','logger','info','joinNotification','decrementCounter','joinNotification[','Server','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','\x20da\x20empresa\x20','Erro\x20ao\x20buscar\x20ticket\x20','144knzatk','test','userId','../config/auth','findByPk','incrementCounter','user','@socket.io/admin-ui','parse','leaveChatbox[','209917VYVAhR','leaveChatBox','join','72882abFvAp'];a255_0x3980=function(){return _0x2fdd3b;};return a255_0x3980();}'use strict';function a255_0x4b4e(_0xb4710e,_0x4c87ff){const _0x1f22f4=a255_0x3980();return a255_0x4b4e=function(_0x5147cf,_0x50cb67){_0x5147cf=_0x5147cf-0x1d8;let _0x39806d=_0x1f22f4[_0x5147cf];return _0x39806d;},a255_0x4b4e(_0xb4710e,_0x4c87ff);}var __importDefault=this&&this[a255_0x5cd177(0x1fc)]||function(_0x26fca4){const _0x26b115=a255_0x5cd177;return _0x26fca4&&_0x26fca4[_0x26b115(0x240)]?_0x26fca4:{'default':_0x26fca4};};Object['defineProperty'](exports,a255_0x5cd177(0x240),{'value':!![]}),exports[a255_0x5cd177(0x210)]=exports[a255_0x5cd177(0x220)]=void 0x0;const socket_io_1=require(a255_0x5cd177(0x203)),admin_ui_1=require(a255_0x5cd177(0x234)),jsonwebtoken_1=require(a255_0x5cd177(0x20a)),AppError_1=__importDefault(require(a255_0x5cd177(0x1e9))),logger_1=require(a255_0x5cd177(0x1f6)),User_1=__importDefault(require('../models/User')),Queue_1=__importDefault(require('../models/Queue')),Ticket_1=__importDefault(require(a255_0x5cd177(0x1e5))),auth_1=__importDefault(require(a255_0x5cd177(0x230))),counter_1=require(a255_0x5cd177(0x20d));let io;const initIO=_0x45bee7=>{const _0x5ef2c0=a255_0x5cd177;return io=new socket_io_1[(_0x5ef2c0(0x229))](_0x45bee7,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x5ef2c0(0x202)][_0x5ef2c0(0x1e2)]}}),process[_0x5ef2c0(0x202)][_0x5ef2c0(0x1f0)]&&JSON[_0x5ef2c0(0x235)](process[_0x5ef2c0(0x202)][_0x5ef2c0(0x1f0)])&&User_1[_0x5ef2c0(0x21c)][_0x5ef2c0(0x231)](0x1)[_0x5ef2c0(0x21d)](_0x59a1ac=>{const _0x436f35=_0x5ef2c0;(0x0,admin_ui_1[_0x436f35(0x23c)])(io,{'auth':{'type':_0x436f35(0x200),'username':_0x59a1ac[_0x436f35(0x208)],'password':_0x59a1ac[_0x436f35(0x1e3)]},'mode':_0x436f35(0x1dc)});}),io[_0x5ef2c0(0x1f2)](async(_0x447a4d,_0x2b9c3a)=>{const _0x5e3f99=_0x5ef2c0;try{const _0x316024=_0x447a4d[_0x5e3f99(0x1dd)][_0x5e3f99(0x1db)][_0x5e3f99(0x1ef)]||_0x447a4d[_0x5e3f99(0x1dd)][_0x5e3f99(0x204)]['token'];if(!_0x316024)throw new Error(_0x5e3f99(0x23f));const _0x3757b8=(0x0,jsonwebtoken_1[_0x5e3f99(0x1ed)])(_0x316024,auth_1['default'][_0x5e3f99(0x1fa)]);if(!_0x3757b8||typeof _0x3757b8['id']!=='number')throw new Error(_0x5e3f99(0x212));const _0x4ad15c=await User_1[_0x5e3f99(0x21c)][_0x5e3f99(0x231)](_0x3757b8['id'],{'include':[Queue_1['default']]});if(!_0x4ad15c)throw new Error('Usuário\x20não\x20encontrado');_0x447a4d[_0x5e3f99(0x20b)][_0x5e3f99(0x233)]=_0x4ad15c,_0x2b9c3a();}catch(_0x55d1e5){logger_1['logger'][_0x5e3f99(0x23b)](_0x5e3f99(0x1ea)+_0x55d1e5['message']),_0x2b9c3a(new Error('Falha\x20na\x20autenticação'));}}),io['on'](_0x5ef2c0(0x23e),async _0x20a519=>{const _0x43e8ae=_0x5ef2c0,_0x2984ac=_0x20a519[_0x43e8ae(0x20b)]['user'],_0xe1754d=new counter_1[(_0x43e8ae(0x1f7))]();logger_1[_0x43e8ae(0x224)][_0x43e8ae(0x225)]('Usuário\x20conectado:\x20'+_0x2984ac['id']),_0x2984ac[_0x43e8ae(0x1f1)]=!![],await _0x2984ac['save'](),_0x20a519[_0x43e8ae(0x239)](_0x43e8ae(0x1fe)+_0x2984ac['companyId']+_0x43e8ae(0x217)),_0x20a519[_0x43e8ae(0x239)](_0x43e8ae(0x1fe)+_0x2984ac[_0x43e8ae(0x222)]),_0x20a519[_0x43e8ae(0x239)]('user-'+_0x2984ac['id']),_0x20a519['on'](_0x43e8ae(0x1fb),async _0x127b30=>{const _0x5b12a6=_0x43e8ae;if(typeof _0x127b30!==_0x5b12a6(0x201)||!/^\d+$/[_0x5b12a6(0x22e)](_0x127b30)){logger_1[_0x5b12a6(0x224)]['warn'](_0x5b12a6(0x1de)+_0x127b30);return;}try{const _0x1b1e9b=await Ticket_1[_0x5b12a6(0x21c)][_0x5b12a6(0x231)](_0x127b30);if(_0x1b1e9b&&_0x1b1e9b[_0x5b12a6(0x222)]===_0x2984ac[_0x5b12a6(0x222)]&&(_0x1b1e9b[_0x5b12a6(0x22f)]===_0x2984ac['id']||_0x2984ac[_0x5b12a6(0x221)]===_0x5b12a6(0x1d8)||_0x2984ac[_0x5b12a6(0x1e1)])){const _0x54758c=_0xe1754d['incrementCounter']('ticket-'+_0x127b30);_0x54758c===0x1&&_0x20a519[_0x5b12a6(0x239)](_0x127b30),logger_1['logger']['debug'](_0x5b12a6(0x223)+_0x54758c+']:\x20Canal:\x20'+_0x127b30+_0x5b12a6(0x1d9)+_0x2984ac['id']);}else logger_1[_0x5b12a6(0x224)]['warn'](_0x5b12a6(0x1e6)+_0x127b30+_0x5b12a6(0x1d9)+_0x2984ac['id']);}catch(_0x5e30bf){logger_1[_0x5b12a6(0x224)][_0x5b12a6(0x23b)](_0x5b12a6(0x22c)+_0x127b30+':\x20'+_0x5e30bf[_0x5b12a6(0x1e0)]);}}),_0x20a519['on'](_0x43e8ae(0x238),_0x5a0935=>{const _0x4bc980=_0x43e8ae;if(typeof _0x5a0935==='string'&&/^\d+$/['test'](_0x5a0935)){const _0x23bfe3=_0xe1754d[_0x4bc980(0x227)](_0x4bc980(0x1df)+_0x5a0935);_0x23bfe3===0x0&&_0x20a519['leave'](_0x5a0935),logger_1['logger'][_0x4bc980(0x213)](_0x4bc980(0x236)+_0x23bfe3+_0x4bc980(0x21b)+_0x5a0935+_0x4bc980(0x1d9)+_0x2984ac['id']);}}),_0x20a519['on'](_0x43e8ae(0x226),()=>{const _0x247347=_0x43e8ae,_0x341acf=_0xe1754d[_0x247347(0x232)](_0x247347(0x209));_0x341acf===0x1&&(_0x2984ac[_0x247347(0x221)]==='admin'||_0x2984ac[_0x247347(0x1e1)]?_0x20a519[_0x247347(0x239)]('company-'+_0x2984ac[_0x247347(0x222)]+_0x247347(0x20e)):_0x2984ac['queues'][_0x247347(0x1f9)](_0x7161fb=>{const _0x45fa91=_0x247347;logger_1[_0x45fa91(0x224)]['debug'](_0x45fa91(0x1ee)+_0x2984ac['id']+_0x45fa91(0x22b)+_0x2984ac[_0x45fa91(0x222)]+'\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20'+_0x7161fb['id']+'.'),_0x20a519[_0x45fa91(0x239)](_0x45fa91(0x214)+_0x7161fb['id']+_0x45fa91(0x20e));})),logger_1['logger'][_0x247347(0x213)](_0x247347(0x228)+_0x341acf+_0x247347(0x206)+_0x2984ac['id']);}),_0x20a519['on']('leaveNotification',()=>{const _0x3b0412=_0x43e8ae,_0x57b116=_0xe1754d[_0x3b0412(0x227)](_0x3b0412(0x209));_0x57b116===0x0&&(_0x2984ac[_0x3b0412(0x221)]===_0x3b0412(0x1d8)||_0x2984ac[_0x3b0412(0x1e1)]?_0x20a519[_0x3b0412(0x20c)](_0x3b0412(0x1fe)+_0x2984ac[_0x3b0412(0x222)]+'-notification'):_0x2984ac[_0x3b0412(0x1da)]['forEach'](_0x78e9c1=>{const _0xa50f39=_0x3b0412;logger_1[_0xa50f39(0x224)][_0xa50f39(0x213)](_0xa50f39(0x1ee)+_0x2984ac['id']+_0xa50f39(0x22b)+_0x2984ac[_0xa50f39(0x222)]+_0xa50f39(0x1f3)+_0x78e9c1['id']+'.'),_0x20a519[_0xa50f39(0x20c)]('queue-'+_0x78e9c1['id']+_0xa50f39(0x20e));})),logger_1['logger']['debug']('leaveNotification['+_0x57b116+']:\x20Usuário:\x20'+_0x2984ac['id']);}),_0x20a519['on'](_0x43e8ae(0x21e),_0x54dc05=>{const _0x5e72ef=_0x43e8ae;_0xe1754d[_0x5e72ef(0x232)](_0x5e72ef(0x207)+_0x54dc05)===0x1&&(_0x2984ac[_0x5e72ef(0x221)]===_0x5e72ef(0x1d8)||_0x2984ac[_0x5e72ef(0x1e1)]?(logger_1[_0x5e72ef(0x224)][_0x5e72ef(0x213)](_0x5e72ef(0x1fd)+_0x2984ac['id']+_0x5e72ef(0x22b)+_0x2984ac['companyId']+_0x5e72ef(0x23d)+_0x54dc05+'.'),_0x20a519[_0x5e72ef(0x239)](_0x5e72ef(0x1fe)+_0x2984ac[_0x5e72ef(0x222)]+'-'+_0x54dc05)):_0x2984ac[_0x5e72ef(0x1da)][_0x5e72ef(0x1f9)](_0x40a794=>{const _0x428a9c=_0x5e72ef;logger_1[_0x428a9c(0x224)]['debug'](_0x428a9c(0x1ee)+_0x2984ac['id']+'\x20da\x20empresa\x20'+_0x2984ac[_0x428a9c(0x222)]+_0x428a9c(0x1e8)+_0x40a794['id']+'.'),_0x20a519[_0x428a9c(0x239)](_0x428a9c(0x214)+_0x40a794['id']+'-'+_0x54dc05);}));}),_0x20a519['on'](_0x43e8ae(0x1eb),_0x22d159=>{const _0x40fe93=_0x43e8ae;_0xe1754d['decrementCounter'](_0x40fe93(0x207)+_0x22d159)===0x0&&(_0x2984ac[_0x40fe93(0x221)]===_0x40fe93(0x1d8)||_0x2984ac[_0x40fe93(0x1e1)]?(logger_1[_0x40fe93(0x224)][_0x40fe93(0x213)](_0x40fe93(0x1fd)+_0x2984ac['id']+_0x40fe93(0x22b)+_0x2984ac['companyId']+_0x40fe93(0x22a)+_0x22d159+'.'),_0x20a519[_0x40fe93(0x20c)](_0x40fe93(0x1fe)+_0x2984ac[_0x40fe93(0x222)]+'-'+_0x22d159)):_0x2984ac[_0x40fe93(0x1da)][_0x40fe93(0x1f9)](_0x255c77=>{const _0x7088b7=_0x40fe93;logger_1[_0x7088b7(0x224)][_0x7088b7(0x213)](_0x7088b7(0x1ee)+_0x2984ac['id']+_0x7088b7(0x22b)+_0x2984ac[_0x7088b7(0x222)]+_0x7088b7(0x1e4)+_0x255c77['id']+'.'),_0x20a519['leave']('queue-'+_0x255c77['id']+'-'+_0x22d159);}));}),_0x20a519['on'](_0x43e8ae(0x219),async()=>{const _0x137663=_0x43e8ae;logger_1[_0x137663(0x224)]['info']('Usuário\x20desconectado:\x20'+_0x2984ac['id']),_0x2984ac[_0x137663(0x1f1)]=![],await _0x2984ac['save']();});}),io;};exports[a255_0x5cd177(0x220)]=initIO;const getIO=()=>{const _0x1c73b3=a255_0x5cd177;if(!io)throw new AppError_1[(_0x1c73b3(0x21c))]('Socket\x20IO\x20não\x20inicializado');return io;};exports[a255_0x5cd177(0x210)]=getIO;