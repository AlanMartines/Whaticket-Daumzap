const a255_0x4ddb07=a255_0x31fd;(function(_0x58592e,_0x10e282){const _0x388849=a255_0x31fd,_0x3853c0=_0x58592e();while(!![]){try{const _0x107d36=-parseInt(_0x388849(0x129))/0x1*(parseInt(_0x388849(0x12d))/0x2)+-parseInt(_0x388849(0x133))/0x3*(parseInt(_0x388849(0x169))/0x4)+parseInt(_0x388849(0x16f))/0x5+parseInt(_0x388849(0x148))/0x6*(parseInt(_0x388849(0x168))/0x7)+parseInt(_0x388849(0x17d))/0x8+-parseInt(_0x388849(0x182))/0x9+parseInt(_0x388849(0x17c))/0xa;if(_0x107d36===_0x10e282)break;else _0x3853c0['push'](_0x3853c0['shift']());}catch(_0x51a71f){_0x3853c0['push'](_0x3853c0['shift']());}}}(a255_0x4acb,0x436be));const a255_0x1ab385=(function(){let _0x367e54=!![];return function(_0x3d27f0,_0x7ac1eb){const _0x3fb7ac=_0x367e54?function(){const _0x93cf13=a255_0x31fd;if(_0x7ac1eb){const _0x5deb49=_0x7ac1eb[_0x93cf13(0x177)](_0x3d27f0,arguments);return _0x7ac1eb=null,_0x5deb49;}}:function(){};return _0x367e54=![],_0x3fb7ac;};}()),a255_0x46f851=a255_0x1ab385(this,function(){const _0x3d933f=a255_0x31fd;return a255_0x46f851[_0x3d933f(0x140)]()[_0x3d933f(0x17a)](_0x3d933f(0x12f))['toString']()[_0x3d933f(0x136)](a255_0x46f851)['search']('(((.+)+)+)+$');});function a255_0x4acb(){const _0x58ae7d=['\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','../models/Queue','3009870bFLgqb','../models/Ticket','allTicket','leave','number','leaveNotification[','\x20pelo\x20usuário\x20','__esModule','Erro\x20ao\x20buscar\x20ticket\x20','queues','-notification','leaveTickets','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','passwordHash','warn','info','debug','Socket\x20IO\x20não\x20inicializado','error','382116dMXGIs','parse','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','-mainchannel','2PprctB','\x20da\x20empresa\x20','(((.+)+)+)+$','secret','auth','message','1122skKMUw','instrument','ID\x20de\x20ticket\x20inválido:\x20','constructor','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','joinChatbox[','leaveNotification','getIO','token','disconnect','save','forEach','notification','toString','SOCKET_ADMIN','defineProperty','userId','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','jsonwebtoken','company-','Server','60JvXjwY','data','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','./counter','ticket-',']:\x20Canal:\x20','joinChatBox','basic','Usuário\x20desconectado:\x20','profile','findByPk','join','user','use','Admin\x20','user-','then','string','CounterManager','\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','Usuário\x20conectado:\x20','__importDefault','leaveChatbox[','FRONTEND_URL','env','decrementCounter','email','default','joinNotification','admin','handshake','companyId','297339uvLXqW','3644sHHKNB','verify','leaveChatBox','../models/User','queue-','@socket.io/admin-ui','509810IdeqEY','logger','test','incrementCounter','Erro\x20de\x20autenticação:\x20','initIO','../config/auth',']:\x20Usuário:\x20','apply','online','../utils/logger','search','Usuário\x20','6778210ojsnZn','1030920lyEWvM','status-','Usuário\x20não\x20encontrado'];a255_0x4acb=function(){return _0x58ae7d;};return a255_0x4acb();}a255_0x46f851();'use strict';var __importDefault=this&&this[a255_0x4ddb07(0x15d)]||function(_0x80009a){const _0x109a9f=a255_0x4ddb07;return _0x80009a&&_0x80009a[_0x109a9f(0x11d)]?_0x80009a:{'default':_0x80009a};};Object[a255_0x4ddb07(0x142)](exports,a255_0x4ddb07(0x11d),{'value':!![]}),exports[a255_0x4ddb07(0x13a)]=exports[a255_0x4ddb07(0x174)]=void 0x0;const socket_io_1=require('socket.io'),admin_ui_1=require(a255_0x4ddb07(0x16e)),jsonwebtoken_1=require(a255_0x4ddb07(0x145)),AppError_1=__importDefault(require('../errors/AppError')),logger_1=require(a255_0x4ddb07(0x179)),User_1=__importDefault(require(a255_0x4ddb07(0x16c))),Queue_1=__importDefault(require(a255_0x4ddb07(0x181))),Ticket_1=__importDefault(require(a255_0x4ddb07(0x183))),auth_1=__importDefault(require(a255_0x4ddb07(0x175))),counter_1=require(a255_0x4ddb07(0x14b));let io;function a255_0x31fd(_0x16c011,_0x241760){const _0x76e2f8=a255_0x4acb();return a255_0x31fd=function(_0x46f851,_0x1ab385){_0x46f851=_0x46f851-0x11a;let _0x4acb15=_0x76e2f8[_0x46f851];return _0x4acb15;},a255_0x31fd(_0x16c011,_0x241760);}const initIO=_0x418b37=>{const _0x16cbe3=a255_0x4ddb07;return io=new socket_io_1[(_0x16cbe3(0x147))](_0x418b37,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x16cbe3(0x160)][_0x16cbe3(0x15f)]}}),process['env'][_0x16cbe3(0x141)]&&JSON[_0x16cbe3(0x12a)](process[_0x16cbe3(0x160)][_0x16cbe3(0x141)])&&User_1[_0x16cbe3(0x163)]['findByPk'](0x1)[_0x16cbe3(0x158)](_0x419483=>{const _0x233ea8=_0x16cbe3;(0x0,admin_ui_1[_0x233ea8(0x134)])(io,{'auth':{'type':_0x233ea8(0x14f),'username':_0x419483[_0x233ea8(0x162)],'password':_0x419483[_0x233ea8(0x123)]},'mode':'development'});}),io[_0x16cbe3(0x155)](async(_0x156d76,_0x350ace)=>{const _0x10a652=_0x16cbe3;try{const _0x5d934a=_0x156d76[_0x10a652(0x166)][_0x10a652(0x131)]['token']||_0x156d76[_0x10a652(0x166)]['query'][_0x10a652(0x13b)];if(!_0x5d934a)throw new Error('Token\x20não\x20fornecido');const _0x37e31a=(0x0,jsonwebtoken_1[_0x10a652(0x16a)])(_0x5d934a,auth_1[_0x10a652(0x163)][_0x10a652(0x130)]);if(!_0x37e31a||typeof _0x37e31a['id']!==_0x10a652(0x11a))throw new Error('Token\x20inválido');const _0x166410=await User_1[_0x10a652(0x163)]['findByPk'](_0x37e31a['id'],{'include':[Queue_1[_0x10a652(0x163)]]});if(!_0x166410)throw new Error(_0x10a652(0x17f));_0x156d76[_0x10a652(0x149)]['user']=_0x166410,_0x350ace();}catch(_0x438ae6){logger_1[_0x10a652(0x170)][_0x10a652(0x128)](_0x10a652(0x173)+_0x438ae6['message']),_0x350ace(new Error('Falha\x20na\x20autenticação'));}}),io['on']('connection',async _0x5cafd1=>{const _0x1625b5=_0x16cbe3,_0x29d2ba=_0x5cafd1[_0x1625b5(0x149)][_0x1625b5(0x154)],_0x37d11e=new counter_1[(_0x1625b5(0x15a))]();logger_1[_0x1625b5(0x170)][_0x1625b5(0x125)](_0x1625b5(0x15c)+_0x29d2ba['id']),_0x29d2ba[_0x1625b5(0x178)]=!![],await _0x29d2ba[_0x1625b5(0x13d)](),_0x5cafd1['join'](_0x1625b5(0x146)+_0x29d2ba[_0x1625b5(0x167)]+_0x1625b5(0x12c)),_0x5cafd1[_0x1625b5(0x153)](_0x1625b5(0x146)+_0x29d2ba[_0x1625b5(0x167)]),_0x5cafd1['join'](_0x1625b5(0x157)+_0x29d2ba['id']),_0x5cafd1['on'](_0x1625b5(0x14e),async _0xadf565=>{const _0x55369e=_0x1625b5;if(typeof _0xadf565!=='string'||!/^\d+$/[_0x55369e(0x171)](_0xadf565)){logger_1[_0x55369e(0x170)][_0x55369e(0x124)](_0x55369e(0x135)+_0xadf565);return;}try{const _0x57cdf1=await Ticket_1[_0x55369e(0x163)][_0x55369e(0x152)](_0xadf565);if(_0x57cdf1&&_0x57cdf1[_0x55369e(0x167)]===_0x29d2ba[_0x55369e(0x167)]&&(_0x57cdf1[_0x55369e(0x143)]===_0x29d2ba['id']||_0x29d2ba[_0x55369e(0x151)]===_0x55369e(0x165)||_0x29d2ba['allTicket'])){const _0x72b48b=_0x37d11e[_0x55369e(0x172)](_0x55369e(0x14c)+_0xadf565);_0x72b48b===0x1&&_0x5cafd1[_0x55369e(0x153)](_0xadf565),logger_1[_0x55369e(0x170)][_0x55369e(0x126)](_0x55369e(0x138)+_0x72b48b+_0x55369e(0x14d)+_0xadf565+'\x20pelo\x20usuário\x20'+_0x29d2ba['id']);}else logger_1[_0x55369e(0x170)]['warn'](_0x55369e(0x137)+_0xadf565+_0x55369e(0x11c)+_0x29d2ba['id']);}catch(_0x175cfd){logger_1['logger']['error'](_0x55369e(0x11e)+_0xadf565+':\x20'+_0x175cfd[_0x55369e(0x132)]);}}),_0x5cafd1['on'](_0x1625b5(0x16b),_0x5ad880=>{const _0x43dff4=_0x1625b5;if(typeof _0x5ad880===_0x43dff4(0x159)&&/^\d+$/['test'](_0x5ad880)){const _0x5415e2=_0x37d11e[_0x43dff4(0x161)](_0x43dff4(0x14c)+_0x5ad880);_0x5415e2===0x0&&_0x5cafd1[_0x43dff4(0x185)](_0x5ad880),logger_1[_0x43dff4(0x170)][_0x43dff4(0x126)](_0x43dff4(0x15e)+_0x5415e2+']:\x20Canal:\x20'+_0x5ad880+_0x43dff4(0x11c)+_0x29d2ba['id']);}}),_0x5cafd1['on'](_0x1625b5(0x164),()=>{const _0x20980b=_0x1625b5,_0x1c1755=_0x37d11e[_0x20980b(0x172)](_0x20980b(0x13f));_0x1c1755===0x1&&(_0x29d2ba[_0x20980b(0x151)]===_0x20980b(0x165)||_0x29d2ba[_0x20980b(0x184)]?_0x5cafd1[_0x20980b(0x153)]('company-'+_0x29d2ba[_0x20980b(0x167)]+_0x20980b(0x120)):_0x29d2ba[_0x20980b(0x11f)][_0x20980b(0x13e)](_0x3d7f00=>{const _0x154e78=_0x20980b;logger_1[_0x154e78(0x170)][_0x154e78(0x126)]('Usuário\x20'+_0x29d2ba['id']+'\x20da\x20empresa\x20'+_0x29d2ba['companyId']+_0x154e78(0x12b)+_0x3d7f00['id']+'.'),_0x5cafd1[_0x154e78(0x153)](_0x154e78(0x16d)+_0x3d7f00['id']+_0x154e78(0x120));})),logger_1['logger'][_0x20980b(0x126)]('joinNotification['+_0x1c1755+_0x20980b(0x176)+_0x29d2ba['id']);}),_0x5cafd1['on'](_0x1625b5(0x139),()=>{const _0x540895=_0x1625b5,_0x279327=_0x37d11e[_0x540895(0x161)](_0x540895(0x13f));_0x279327===0x0&&(_0x29d2ba['profile']===_0x540895(0x165)||_0x29d2ba[_0x540895(0x184)]?_0x5cafd1[_0x540895(0x185)](_0x540895(0x146)+_0x29d2ba['companyId']+_0x540895(0x120)):_0x29d2ba[_0x540895(0x11f)]['forEach'](_0x51289f=>{const _0x2d7502=_0x540895;logger_1[_0x2d7502(0x170)][_0x2d7502(0x126)]('Usuário\x20'+_0x29d2ba['id']+'\x20da\x20empresa\x20'+_0x29d2ba[_0x2d7502(0x167)]+_0x2d7502(0x180)+_0x51289f['id']+'.'),_0x5cafd1['leave'](_0x2d7502(0x16d)+_0x51289f['id']+_0x2d7502(0x120));})),logger_1['logger'][_0x540895(0x126)](_0x540895(0x11b)+_0x279327+_0x540895(0x176)+_0x29d2ba['id']);}),_0x5cafd1['on']('joinTickets',_0x1480e1=>{const _0x1350e4=_0x1625b5;_0x37d11e[_0x1350e4(0x172)](_0x1350e4(0x17e)+_0x1480e1)===0x1&&(_0x29d2ba['profile']===_0x1350e4(0x165)||_0x29d2ba[_0x1350e4(0x184)]?(logger_1['logger'][_0x1350e4(0x126)](_0x1350e4(0x156)+_0x29d2ba['id']+_0x1350e4(0x12e)+_0x29d2ba['companyId']+_0x1350e4(0x144)+_0x1480e1+'.'),_0x5cafd1[_0x1350e4(0x153)](_0x1350e4(0x146)+_0x29d2ba[_0x1350e4(0x167)]+'-'+_0x1480e1)):_0x29d2ba[_0x1350e4(0x11f)][_0x1350e4(0x13e)](_0x2761fa=>{const _0x50ec08=_0x1350e4;logger_1[_0x50ec08(0x170)][_0x50ec08(0x126)](_0x50ec08(0x17b)+_0x29d2ba['id']+_0x50ec08(0x12e)+_0x29d2ba['companyId']+_0x50ec08(0x122)+_0x2761fa['id']+'.'),_0x5cafd1[_0x50ec08(0x153)](_0x50ec08(0x16d)+_0x2761fa['id']+'-'+_0x1480e1);}));}),_0x5cafd1['on'](_0x1625b5(0x121),_0x2a5dee=>{const _0x33cad3=_0x1625b5;_0x37d11e['decrementCounter']('status-'+_0x2a5dee)===0x0&&(_0x29d2ba[_0x33cad3(0x151)]==='admin'||_0x29d2ba['allTicket']?(logger_1['logger'][_0x33cad3(0x126)](_0x33cad3(0x156)+_0x29d2ba['id']+_0x33cad3(0x12e)+_0x29d2ba[_0x33cad3(0x167)]+_0x33cad3(0x14a)+_0x2a5dee+'.'),_0x5cafd1['leave'](_0x33cad3(0x146)+_0x29d2ba[_0x33cad3(0x167)]+'-'+_0x2a5dee)):_0x29d2ba[_0x33cad3(0x11f)][_0x33cad3(0x13e)](_0x38b7a3=>{const _0x588b60=_0x33cad3;logger_1['logger'][_0x588b60(0x126)](_0x588b60(0x17b)+_0x29d2ba['id']+'\x20da\x20empresa\x20'+_0x29d2ba[_0x588b60(0x167)]+_0x588b60(0x15b)+_0x38b7a3['id']+'.'),_0x5cafd1[_0x588b60(0x185)]('queue-'+_0x38b7a3['id']+'-'+_0x2a5dee);}));}),_0x5cafd1['on'](_0x1625b5(0x13c),async()=>{const _0x1c13af=_0x1625b5;logger_1[_0x1c13af(0x170)]['info'](_0x1c13af(0x150)+_0x29d2ba['id']),_0x29d2ba[_0x1c13af(0x178)]=![],await _0x29d2ba[_0x1c13af(0x13d)]();});}),io;};exports['initIO']=initIO;const getIO=()=>{const _0x366c48=a255_0x4ddb07;if(!io)throw new AppError_1[(_0x366c48(0x163))](_0x366c48(0x127));return io;};exports['getIO']=getIO;