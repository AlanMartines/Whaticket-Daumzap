const a255_0x1a3390=a255_0x3bd4;(function(_0x201c46,_0x36279e){const _0x57ddff=a255_0x3bd4,_0x3bdb5f=_0x201c46();while(!![]){try{const _0x315106=-parseInt(_0x57ddff(0x21e))/0x1*(-parseInt(_0x57ddff(0x247))/0x2)+parseInt(_0x57ddff(0x236))/0x3*(-parseInt(_0x57ddff(0x240))/0x4)+-parseInt(_0x57ddff(0x24e))/0x5*(-parseInt(_0x57ddff(0x248))/0x6)+-parseInt(_0x57ddff(0x22a))/0x7*(-parseInt(_0x57ddff(0x22c))/0x8)+-parseInt(_0x57ddff(0x24b))/0x9*(parseInt(_0x57ddff(0x235))/0xa)+-parseInt(_0x57ddff(0x234))/0xb+parseInt(_0x57ddff(0x23a))/0xc*(parseInt(_0x57ddff(0x210))/0xd);if(_0x315106===_0x36279e)break;else _0x3bdb5f['push'](_0x3bdb5f['shift']());}catch(_0x487371){_0x3bdb5f['push'](_0x3bdb5f['shift']());}}}(a255_0x9e3e,0xad6d7));const a255_0x14c6da=(function(){let _0x566fe4=!![];return function(_0x1ff4bf,_0x249fb1){const _0x26649a=_0x566fe4?function(){const _0x455202=a255_0x3bd4;if(_0x249fb1){const _0x404283=_0x249fb1[_0x455202(0x253)](_0x1ff4bf,arguments);return _0x249fb1=null,_0x404283;}}:function(){};return _0x566fe4=![],_0x26649a;};}()),a255_0x3d0874=a255_0x14c6da(this,function(){const _0x14a768=a255_0x3bd4;return a255_0x3d0874['toString']()['search'](_0x14a768(0x200))[_0x14a768(0x23b)]()[_0x14a768(0x21f)](a255_0x3d0874)[_0x14a768(0x24d)](_0x14a768(0x200));});a255_0x3d0874();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x94447c){const _0x1dd8f0=a255_0x3bd4;return _0x94447c&&_0x94447c[_0x1dd8f0(0x21b)]?_0x94447c:{'default':_0x94447c};};Object[a255_0x1a3390(0x21a)](exports,a255_0x1a3390(0x21b),{'value':!![]}),exports[a255_0x1a3390(0x233)]=exports[a255_0x1a3390(0x20e)]=void 0x0;const socket_io_1=require(a255_0x1a3390(0x245)),admin_ui_1=require('@socket.io/admin-ui'),jsonwebtoken_1=require(a255_0x1a3390(0x1fd)),AppError_1=__importDefault(require(a255_0x1a3390(0x250))),logger_1=require(a255_0x1a3390(0x1fe)),User_1=__importDefault(require(a255_0x1a3390(0x22b))),Queue_1=__importDefault(require(a255_0x1a3390(0x224))),Ticket_1=__importDefault(require(a255_0x1a3390(0x212))),auth_1=__importDefault(require(a255_0x1a3390(0x244))),counter_1=require(a255_0x1a3390(0x249));let io;const initIO=_0x5200d8=>{const _0x3695ef=a255_0x1a3390;return io=new socket_io_1[(_0x3695ef(0x24c))](_0x5200d8,{'connectionStateRecovery':{'maxDisconnectionDuration':0x5*0x3c*0x3e8,'skipMiddlewares':!![]},'cors':{'credentials':!![],'origin':process[_0x3695ef(0x1ff)]['FRONTEND_URL']}}),process[_0x3695ef(0x1ff)][_0x3695ef(0x1f5)]&&JSON[_0x3695ef(0x1f0)](process[_0x3695ef(0x1ff)][_0x3695ef(0x1f5)])&&User_1['default'][_0x3695ef(0x1ef)](0x1)[_0x3695ef(0x213)](_0x4cb08a=>{const _0x45a291=_0x3695ef;(0x0,admin_ui_1[_0x45a291(0x205)])(io,{'auth':{'type':_0x45a291(0x203),'username':_0x4cb08a[_0x45a291(0x225)],'password':_0x4cb08a[_0x45a291(0x255)]},'mode':_0x45a291(0x1ee)});}),io['use'](async(_0x7fc60a,_0x1715cc)=>{const _0x329234=_0x3695ef;try{const _0x53052e=_0x7fc60a[_0x329234(0x221)][_0x329234(0x227)][_0x329234(0x1f9)]||_0x7fc60a[_0x329234(0x221)][_0x329234(0x241)]['token'];if(!_0x53052e)throw new Error(_0x329234(0x206));const _0x1a0578=(0x0,jsonwebtoken_1[_0x329234(0x239)])(_0x53052e,auth_1[_0x329234(0x22f)][_0x329234(0x242)]);if(!_0x1a0578||typeof _0x1a0578['id']!=='number')throw new Error('Token\x20inválido');const _0xd7d60c=await User_1['default'][_0x329234(0x1ef)](_0x1a0578['id'],{'include':[Queue_1[_0x329234(0x22f)]]});if(!_0xd7d60c)throw new Error(_0x329234(0x252));_0x7fc60a[_0x329234(0x1f4)]['user']=_0xd7d60c,_0x1715cc();}catch(_0x36c517){logger_1[_0x329234(0x232)]['error']('Erro\x20de\x20autenticação:\x20'+_0x36c517[_0x329234(0x1f1)]),_0x1715cc(new Error(_0x329234(0x215)));}}),io['on'](_0x3695ef(0x20c),async _0xadaef1=>{const _0x448fd3=_0x3695ef,_0x209ab=_0xadaef1[_0x448fd3(0x1f4)][_0x448fd3(0x229)],_0x384eb0=new counter_1[(_0x448fd3(0x222))]();logger_1[_0x448fd3(0x232)]['info'](_0x448fd3(0x202)+_0x209ab['id']),_0x209ab[_0x448fd3(0x254)]=!![],await _0x209ab[_0x448fd3(0x251)](),_0xadaef1['join'](_0x448fd3(0x20a)+_0x209ab[_0x448fd3(0x204)]+_0x448fd3(0x23d)),_0xadaef1[_0x448fd3(0x207)](_0x448fd3(0x20a)+_0x209ab['companyId']),_0xadaef1[_0x448fd3(0x207)](_0x448fd3(0x230)+_0x209ab['id']),_0xadaef1['on'](_0x448fd3(0x228),async _0x193761=>{const _0x11915b=_0x448fd3;if(typeof _0x193761!==_0x11915b(0x24f)||!/^\d+$/[_0x11915b(0x20b)](_0x193761)){logger_1[_0x11915b(0x232)]['warn'](_0x11915b(0x209)+_0x193761);return;}try{const _0x26d0f0=await Ticket_1[_0x11915b(0x22f)][_0x11915b(0x1ef)](_0x193761);if(_0x26d0f0&&_0x26d0f0[_0x11915b(0x204)]===_0x209ab[_0x11915b(0x204)]&&(_0x26d0f0[_0x11915b(0x1f7)]===_0x209ab['id']||_0x209ab[_0x11915b(0x218)]===_0x11915b(0x246)||_0x209ab[_0x11915b(0x23f)])){const _0x3d3b0c=_0x384eb0[_0x11915b(0x256)]('ticket-'+_0x193761);_0x3d3b0c===0x1&&_0xadaef1['join'](_0x193761),logger_1[_0x11915b(0x232)][_0x11915b(0x201)]('joinChatbox['+_0x3d3b0c+_0x11915b(0x1f8)+_0x193761+_0x11915b(0x22e)+_0x209ab['id']);}else logger_1[_0x11915b(0x232)][_0x11915b(0x22d)](_0x11915b(0x214)+_0x193761+_0x11915b(0x22e)+_0x209ab['id']);}catch(_0x11657c){logger_1[_0x11915b(0x232)][_0x11915b(0x243)](_0x11915b(0x20d)+_0x193761+':\x20'+_0x11657c[_0x11915b(0x1f1)]);}}),_0xadaef1['on'](_0x448fd3(0x257),_0x16a4dc=>{const _0x276de0=_0x448fd3;if(typeof _0x16a4dc==='string'&&/^\d+$/[_0x276de0(0x20b)](_0x16a4dc)){const _0x33d97a=_0x384eb0[_0x276de0(0x208)](_0x276de0(0x1f2)+_0x16a4dc);_0x33d97a===0x0&&_0xadaef1[_0x276de0(0x216)](_0x16a4dc),logger_1[_0x276de0(0x232)][_0x276de0(0x201)]('leaveChatbox['+_0x33d97a+_0x276de0(0x1f8)+_0x16a4dc+'\x20pelo\x20usuário\x20'+_0x209ab['id']);}}),_0xadaef1['on'](_0x448fd3(0x1fc),()=>{const _0x4ab3a5=_0x448fd3,_0x99a401=_0x384eb0[_0x4ab3a5(0x256)]('notification');_0x99a401===0x1&&(_0x209ab[_0x4ab3a5(0x218)]===_0x4ab3a5(0x246)||_0x209ab[_0x4ab3a5(0x23f)]?_0xadaef1[_0x4ab3a5(0x207)](_0x4ab3a5(0x20a)+_0x209ab['companyId']+_0x4ab3a5(0x231)):_0x209ab['queues'][_0x4ab3a5(0x20f)](_0x1837c6=>{const _0x15a11d=_0x4ab3a5;logger_1[_0x15a11d(0x232)][_0x15a11d(0x201)]('Usuário\x20'+_0x209ab['id']+_0x15a11d(0x1f6)+_0x209ab['companyId']+_0x15a11d(0x24a)+_0x1837c6['id']+'.'),_0xadaef1[_0x15a11d(0x207)](_0x15a11d(0x23c)+_0x1837c6['id']+_0x15a11d(0x231));})),logger_1['logger'][_0x4ab3a5(0x201)]('joinNotification['+_0x99a401+']:\x20Usuário:\x20'+_0x209ab['id']);}),_0xadaef1['on'](_0x448fd3(0x21d),()=>{const _0x257ee8=_0x448fd3,_0x59ce20=_0x384eb0['decrementCounter'](_0x257ee8(0x220));_0x59ce20===0x0&&(_0x209ab[_0x257ee8(0x218)]===_0x257ee8(0x246)||_0x209ab[_0x257ee8(0x23f)]?_0xadaef1[_0x257ee8(0x216)](_0x257ee8(0x20a)+_0x209ab[_0x257ee8(0x204)]+_0x257ee8(0x231)):_0x209ab[_0x257ee8(0x237)]['forEach'](_0x5a5aec=>{const _0x3fdbef=_0x257ee8;logger_1['logger'][_0x3fdbef(0x201)](_0x3fdbef(0x1f3)+_0x209ab['id']+'\x20da\x20empresa\x20'+_0x209ab['companyId']+_0x3fdbef(0x1fa)+_0x5a5aec['id']+'.'),_0xadaef1[_0x3fdbef(0x216)](_0x3fdbef(0x23c)+_0x5a5aec['id']+_0x3fdbef(0x231));})),logger_1[_0x257ee8(0x232)]['debug'](_0x257ee8(0x226)+_0x59ce20+']:\x20Usuário:\x20'+_0x209ab['id']);}),_0xadaef1['on'](_0x448fd3(0x238),_0x5959dc=>{const _0x18d490=_0x448fd3;_0x384eb0[_0x18d490(0x256)](_0x18d490(0x1fb)+_0x5959dc)===0x1&&(_0x209ab[_0x18d490(0x218)]==='admin'||_0x209ab[_0x18d490(0x23f)]?(logger_1[_0x18d490(0x232)][_0x18d490(0x201)](_0x18d490(0x217)+_0x209ab['id']+'\x20da\x20empresa\x20'+_0x209ab['companyId']+_0x18d490(0x23e)+_0x5959dc+'.'),_0xadaef1['join'](_0x18d490(0x20a)+_0x209ab[_0x18d490(0x204)]+'-'+_0x5959dc)):_0x209ab[_0x18d490(0x237)]['forEach'](_0x117c1a=>{const _0x33929a=_0x18d490;logger_1[_0x33929a(0x232)][_0x33929a(0x201)](_0x33929a(0x1f3)+_0x209ab['id']+_0x33929a(0x1f6)+_0x209ab[_0x33929a(0x204)]+_0x33929a(0x223)+_0x117c1a['id']+'.'),_0xadaef1[_0x33929a(0x207)](_0x33929a(0x23c)+_0x117c1a['id']+'-'+_0x5959dc);}));}),_0xadaef1['on']('leaveTickets',_0x176e27=>{const _0xab43c0=_0x448fd3;_0x384eb0[_0xab43c0(0x208)](_0xab43c0(0x1fb)+_0x176e27)===0x0&&(_0x209ab[_0xab43c0(0x218)]===_0xab43c0(0x246)||_0x209ab[_0xab43c0(0x23f)]?(logger_1[_0xab43c0(0x232)][_0xab43c0(0x201)](_0xab43c0(0x217)+_0x209ab['id']+_0xab43c0(0x1f6)+_0x209ab['companyId']+_0xab43c0(0x21c)+_0x176e27+'.'),_0xadaef1[_0xab43c0(0x216)](_0xab43c0(0x20a)+_0x209ab['companyId']+'-'+_0x176e27)):_0x209ab[_0xab43c0(0x237)][_0xab43c0(0x20f)](_0xc6f999=>{const _0x4efe8b=_0xab43c0;logger_1[_0x4efe8b(0x232)][_0x4efe8b(0x201)](_0x4efe8b(0x1f3)+_0x209ab['id']+'\x20da\x20empresa\x20'+_0x209ab[_0x4efe8b(0x204)]+'\x20saiu\x20do\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20'+_0xc6f999['id']+'.'),_0xadaef1[_0x4efe8b(0x216)](_0x4efe8b(0x23c)+_0xc6f999['id']+'-'+_0x176e27);}));}),_0xadaef1['on'](_0x448fd3(0x219),async()=>{const _0x231c1d=_0x448fd3;logger_1[_0x231c1d(0x232)]['info']('Usuário\x20desconectado:\x20'+_0x209ab['id']),_0x209ab[_0x231c1d(0x254)]=![],await _0x209ab[_0x231c1d(0x251)]();});}),io;};exports[a255_0x1a3390(0x20e)]=initIO;const getIO=()=>{const _0x21155=a255_0x1a3390;if(!io)throw new AppError_1[(_0x21155(0x22f))](_0x21155(0x211));return io;};function a255_0x3bd4(_0x1f95dd,_0x5dedb2){const _0x5450c3=a255_0x9e3e();return a255_0x3bd4=function(_0x3d0874,_0x14c6da){_0x3d0874=_0x3d0874-0x1ee;let _0x9e3eb6=_0x5450c3[_0x3d0874];return _0x9e3eb6;},a255_0x3bd4(_0x1f95dd,_0x5dedb2);}function a255_0x9e3e(){const _0x3891b7=['passwordHash','incrementCounter','leaveChatBox','development','findByPk','parse','message','ticket-','Usuário\x20','data','SOCKET_ADMIN','\x20da\x20empresa\x20','userId',']:\x20Canal:\x20','token','\x20saiu\x20do\x20canal\x20de\x20notificação\x20da\x20fila\x20','status-','joinNotification','jsonwebtoken','../utils/logger','env','(((.+)+)+)+$','debug','Usuário\x20conectado:\x20','basic','companyId','instrument','Token\x20não\x20fornecido','join','decrementCounter','ID\x20de\x20ticket\x20inválido:\x20','company-','test','connection','Erro\x20ao\x20buscar\x20ticket\x20','initIO','forEach','5187vcEUoc','Socket\x20IO\x20não\x20inicializado','../models/Ticket','then','Tentativa\x20não\x20autorizada\x20de\x20entrar\x20no\x20ticket\x20','Falha\x20na\x20autenticação','leave','Admin\x20','profile','disconnect','defineProperty','__esModule','\x20saiu\x20do\x20canal\x20de\x20tickets\x20','leaveNotification','27HvKezr','constructor','notification','handshake','CounterManager','\x20entrou\x20no\x20canal\x20de\x20tickets\x20pendentes\x20da\x20fila\x20','../models/Queue','email','leaveNotification[','auth','joinChatBox','user','3023741SyRsAK','../models/User','24kPHbhL','warn','\x20pelo\x20usuário\x20','default','user-','-notification','logger','getIO','178717eVhfcg','11333230FHEkPm','2103iJKeFS','queues','joinTickets','verify','4284PtwIqh','toString','queue-','-mainchannel','\x20entrou\x20no\x20canal\x20de\x20tickets\x20','allTicket','3088PwqZrT','query','secret','error','../config/auth','socket.io','admin','63622XnrNjc','207744jQVAOF','./counter','\x20entrou\x20no\x20canal\x20de\x20notificação\x20da\x20fila\x20','9JpYyGU','Server','search','15rlmTrO','string','../errors/AppError','save','Usuário\x20não\x20encontrado','apply','online'];a255_0x9e3e=function(){return _0x3891b7;};return a255_0x9e3e();}exports[a255_0x1a3390(0x233)]=getIO;