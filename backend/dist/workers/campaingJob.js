function a572_0x105b(_0x8a09e5,_0x54b71d){const _0x1a3571=a572_0x1492();return a572_0x105b=function(_0x43cebb,_0x1ccd29){_0x43cebb=_0x43cebb-0x15e;let _0x149252=_0x1a3571[_0x43cebb];return _0x149252;},a572_0x105b(_0x8a09e5,_0x54b71d);}function a572_0x1492(){const _0x3413f2=['{email}','getCampaignValidMessages','(((.+)+)+)+$','EM_ANDAMENTO','diff','../libs/socket','1qvGfpw','-mainchannel','handleVerifyCampaigns','apply','options','whatsapp','scheduledAt','message1','sendMessage','keys','isNil','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20whatsapp\x20not\x20found','60fbmBDw','trimEnd','completed','Job\x20','save','-campaign','contacts','DispatchCampaign','Campanhas\x20encontradas:\x20',';Contato=','message2','findByPk','35tjNKHz','public','fileListId','handlePrepareContact','__createBinding','randomValue','error','email','writable','Error','logger','push','../helpers/SendPresenceStatus','company-','../models/ContactList','contactList','parse','emit','__esModule','reject','replace','lte','path','search','get','@s.whatsapp.net','all','VerifyCampaigns','findAll','400644qRuHOO','key','getCampaign','getContact','update','messageInterval','configurable','getProcessedMessage','number','name','greaterInterval','company','Registro\x20enviado\x20pra\x20fila\x20de\x20disparo:\x20Campanha=','../models/ContactListItem','captureException','length','Worker','calculateDelay','3696856eicYGr','6ngIAvW','3229645DZkFzO','getSettings','\x20failed\x20with\x20error:\x20','lodash','mediaPath','defineProperty','confirmationRequestedAt','campaign.contactList\x20is\x20null\x20or\x20undefined','companyId','handleProcessCampaign','parseToMilliseconds','getMessageOptions','../utils/logger','ProcessCampaign','confirmationMessage2','getIO','trimStart','message','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20not\x20found','info','create','prototype','campaignQueue\x20->\x20DispatchCampaign\x20->\x20error:\x20wbot\x20user\x20not\x20found','fileList','1229162IsFMtb','1199024sjRUUl','ContactList\x20not\x20found\x20or\x20empty','message5','confirmationMessage4','call','__importDefault','confirmationMessage','set','variables','forEach','contactId','275852IoWRTF','confirmationMessage3','getOwnPropertyDescriptor','contact','mediaName','verifyAndFinalizeCampaign','confirmationMessage5','PrepareContact','includes','add','campaignId','campaignQueue','moment/moment','../helpers/GetWhatsappWbot','resolve','sequelize','isEmpty','deliveredAt','handleDispatchCampaign','confirmation','data','toString','isWhatsappValid','9CEEjbD','../models/Whatsapp','value','{numero}','getTime','@sentry/node','SendPresenceStatus','../..','findOrCreate','getCampaignValidConfirmationMessages','addSeconds','shipping','longerIntervalAfter','message3','confirmationMessage1',')\x20completed','map','default','Disparo\x20de\x20campanha\x20solicitado:\x20Campanha=','65eWjXLE','differenceInSeconds','message4',',\x20Delay\x20Inicial=','781674LCsozJ','Campanha\x20enviada\x20para:\x20Campanha='];a572_0x1492=function(){return _0x3413f2;};return a572_0x1492();}const a572_0x52bc47=a572_0x105b;(function(_0xc62d5b,_0x349896){const _0xb5299f=a572_0x105b,_0x8dfc4=_0xc62d5b();while(!![]){try{const _0xc54382=parseInt(_0xb5299f(0x1a0))/0x1*(-parseInt(_0xb5299f(0x16a))/0x2)+parseInt(_0xb5299f(0x1e8))/0x3*(parseInt(_0xb5299f(0x15f))/0x4)+-parseInt(_0xb5299f(0x1e9))/0x5+-parseInt(_0xb5299f(0x198))/0x6*(-parseInt(_0xb5299f(0x1b8))/0x7)+parseInt(_0xb5299f(0x1e7))/0x8*(parseInt(_0xb5299f(0x181))/0x9)+parseInt(_0xb5299f(0x1ac))/0xa*(-parseInt(_0xb5299f(0x15e))/0xb)+-parseInt(_0xb5299f(0x1d5))/0xc*(-parseInt(_0xb5299f(0x194))/0xd);if(_0xc54382===_0x349896)break;else _0x8dfc4['push'](_0x8dfc4['shift']());}catch(_0x436edf){_0x8dfc4['push'](_0x8dfc4['shift']());}}}(a572_0x1492,0x67eaa));const a572_0x1ccd29=(function(){let _0x2d1732=!![];return function(_0x5602dd,_0x49e785){const _0x425365=_0x2d1732?function(){const _0x44bc87=a572_0x105b;if(_0x49e785){const _0x2b45ca=_0x49e785[_0x44bc87(0x1a3)](_0x5602dd,arguments);return _0x49e785=null,_0x2b45ca;}}:function(){};return _0x2d1732=![],_0x425365;};}()),a572_0x43cebb=a572_0x1ccd29(this,function(){const _0x39d980=a572_0x105b;return a572_0x43cebb[_0x39d980(0x17f)]()[_0x39d980(0x1cf)](_0x39d980(0x19c))[_0x39d980(0x17f)]()['constructor'](a572_0x43cebb)[_0x39d980(0x1cf)]('(((.+)+)+)+$');});a572_0x43cebb();'use strict';var __createBinding=this&&this[a572_0x52bc47(0x1bc)]||(Object[a572_0x52bc47(0x1fd)]?function(_0x67d10e,_0x4c3597,_0x49af2f,_0x1a2c39){const _0x566f6f=a572_0x52bc47;if(_0x1a2c39===undefined)_0x1a2c39=_0x49af2f;var _0x25f2ea=Object[_0x566f6f(0x16c)](_0x4c3597,_0x49af2f);(!_0x25f2ea||(_0x566f6f(0x1d0)in _0x25f2ea?!_0x4c3597['__esModule']:_0x25f2ea[_0x566f6f(0x1c0)]||_0x25f2ea[_0x566f6f(0x1db)]))&&(_0x25f2ea={'enumerable':!![],'get':function(){return _0x4c3597[_0x49af2f];}}),Object[_0x566f6f(0x1ee)](_0x67d10e,_0x1a2c39,_0x25f2ea);}:function(_0x5753ed,_0xecb328,_0x3c17cb,_0x1127fe){if(_0x1127fe===undefined)_0x1127fe=_0x3c17cb;_0x5753ed[_0x1127fe]=_0xecb328[_0x3c17cb];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a572_0x52bc47(0x1fd)]?function(_0x3c6fc2,_0x369d04){const _0x5e739f=a572_0x52bc47;Object[_0x5e739f(0x1ee)](_0x3c6fc2,_0x5e739f(0x192),{'enumerable':!![],'value':_0x369d04});}:function(_0x586eb8,_0x571d0d){const _0x3f01ac=a572_0x52bc47;_0x586eb8[_0x3f01ac(0x192)]=_0x571d0d;}),__importStar=this&&this['__importStar']||function(_0xadfaeb){const _0x31612e=a572_0x52bc47;if(_0xadfaeb&&_0xadfaeb[_0x31612e(0x1ca)])return _0xadfaeb;var _0x23cefe={};if(_0xadfaeb!=null){for(var _0x3f7ad9 in _0xadfaeb)if(_0x3f7ad9!==_0x31612e(0x192)&&Object[_0x31612e(0x1fe)]['hasOwnProperty'][_0x31612e(0x163)](_0xadfaeb,_0x3f7ad9))__createBinding(_0x23cefe,_0xadfaeb,_0x3f7ad9);}return __setModuleDefault(_0x23cefe,_0xadfaeb),_0x23cefe;},__importDefault=this&&this[a572_0x52bc47(0x164)]||function(_0x3d7e6c){const _0x418ce0=a572_0x52bc47;return _0x3d7e6c&&_0x3d7e6c[_0x418ce0(0x1ca)]?_0x3d7e6c:{'default':_0x3d7e6c};};Object[a572_0x52bc47(0x1ee)](exports,a572_0x52bc47(0x1ca),{'value':!![]});const bullmq_1=require('bullmq'),Campaign_1=__importDefault(require('../models/Campaign')),sequelize_1=require(a572_0x52bc47(0x179)),logger_1=require(a572_0x52bc47(0x1f5)),moment_1=__importDefault(require(a572_0x52bc47(0x176))),Sentry=__importStar(require(a572_0x52bc47(0x186))),ContactList_1=__importDefault(require(a572_0x52bc47(0x1c6))),ContactListItem_1=__importDefault(require(a572_0x52bc47(0x1e2))),Whatsapp_1=__importDefault(require(a572_0x52bc47(0x182))),CampaignShipping_1=__importDefault(require('../models/CampaignShipping')),queues_1=require('../queues'),lodash_1=require(a572_0x52bc47(0x1ec)),date_fns_1=require('date-fns'),GetWhatsappWbot_1=__importDefault(require(a572_0x52bc47(0x177))),path_1=__importDefault(require(a572_0x52bc47(0x1ce))),ShowService_1=__importDefault(require('../services/FileServices/ShowService')),SendWhatsAppMedia_1=require('../services/WbotServices/SendWhatsAppMedia'),socket_1=require(a572_0x52bc47(0x19f)),CampaignSetting_1=__importDefault(require('../models/CampaignSetting')),SendPresenceStatus_1=require(a572_0x52bc47(0x1c4));class CampaingJob{constructor(_0x7dbf85,_0x50d33d){const _0x2f1c24=a572_0x52bc47,_0x584168=new bullmq_1[(_0x2f1c24(0x1e5))](_0x7dbf85,async _0xd42ad=>{const _0x1e3cd8=_0x2f1c24;if(_0xd42ad[_0x1e3cd8(0x1de)]===_0x1e3cd8(0x1d3))await this[_0x1e3cd8(0x1a2)](_0xd42ad);else{if(_0xd42ad[_0x1e3cd8(0x1de)]===_0x1e3cd8(0x1f6))await this[_0x1e3cd8(0x1f2)](_0xd42ad);else{if(_0xd42ad[_0x1e3cd8(0x1de)]===_0x1e3cd8(0x171))await this['handlePrepareContact'](_0xd42ad);else _0xd42ad[_0x1e3cd8(0x1de)]===_0x1e3cd8(0x1b3)&&await this[_0x1e3cd8(0x17c)](_0xd42ad);}}},{'useWorkerThreads':![],'concurrency':0x64,'connection':_0x50d33d,'removeOnFail':{'count':0x0}});_0x584168['on'](_0x2f1c24(0x1ae),async _0x158c7e=>{const _0x54ddf9=_0x2f1c24;logger_1[_0x54ddf9(0x1c2)][_0x54ddf9(0x1fc)]('Job\x20'+_0x158c7e[_0x54ddf9(0x1de)]+'\x20('+_0x158c7e['id']+_0x54ddf9(0x190));}),_0x584168['on']('failed',async(_0x26aac4,_0x3c916f)=>{const _0x496d81=_0x2f1c24;logger_1['logger'][_0x496d81(0x1be)](_0x496d81(0x1af)+_0x26aac4[_0x496d81(0x1de)]+_0x496d81(0x1eb)+_0x3c916f[_0x496d81(0x1fa)]);});}async[a572_0x52bc47(0x1d8)](_0x4331a6){const _0x10c2d9=a572_0x52bc47;return ContactListItem_1['default'][_0x10c2d9(0x1b7)](_0x4331a6,{'attributes':['id',_0x10c2d9(0x1de),_0x10c2d9(0x1dd),'email']});}async[a572_0x52bc47(0x1bb)](_0x3aab0a){const _0x2c84a2=a572_0x52bc47;try{const {contactId:_0x4ed5b8,campaignId:_0x18fc29,delay:_0x246bf5,variables:_0x484ed3}=_0x3aab0a['data'],_0x4d3d5c=await this[_0x2c84a2(0x1d7)](_0x18fc29),_0x3b76e0=await this['getContact'](_0x4ed5b8),_0x4009f6={};_0x4009f6[_0x2c84a2(0x1dd)]=_0x3b76e0[_0x2c84a2(0x1dd)],_0x4009f6[_0x2c84a2(0x169)]=_0x4ed5b8,_0x4009f6[_0x2c84a2(0x174)]=_0x18fc29;const _0x7cbdc7=this['getCampaignValidMessages'](_0x4d3d5c);if(_0x7cbdc7[_0x2c84a2(0x1e4)]){const _0x98bb98=(0x0,queues_1[_0x2c84a2(0x1bd)])(0x0,_0x7cbdc7[_0x2c84a2(0x1e4)]),_0x4d2961=this[_0x2c84a2(0x1dc)](_0x7cbdc7[_0x98bb98],_0x484ed3,_0x3b76e0);_0x4009f6[_0x2c84a2(0x1fa)]='‌\x20'+_0x4d2961;}if(_0x4d3d5c[_0x2c84a2(0x17d)]){const _0x82ea29=this[_0x2c84a2(0x18a)](_0x4d3d5c);if(_0x82ea29[_0x2c84a2(0x1e4)]){const _0x2d38dd=(0x0,queues_1[_0x2c84a2(0x1bd)])(0x0,_0x82ea29['length']),_0x202563=this[_0x2c84a2(0x1dc)](_0x82ea29[_0x2d38dd],_0x484ed3,_0x3b76e0);_0x4009f6[_0x2c84a2(0x165)]='‌\x20'+_0x202563;}}const [_0x4b50b2,_0x3a8e72]=await CampaignShipping_1[_0x2c84a2(0x192)][_0x2c84a2(0x189)]({'where':{'campaignId':_0x4009f6['campaignId'],'contactId':_0x4009f6['contactId']},'defaults':_0x4009f6});!_0x3a8e72&&_0x4b50b2[_0x2c84a2(0x17b)]===null&&_0x4b50b2[_0x2c84a2(0x1ef)]===null&&(_0x4b50b2[_0x2c84a2(0x166)](_0x4009f6),await _0x4b50b2[_0x2c84a2(0x1b0)]());if(_0x4b50b2[_0x2c84a2(0x17b)]===null&&_0x4b50b2[_0x2c84a2(0x1ef)]===null){const _0x353eaf=await queues_1[_0x2c84a2(0x175)][_0x2c84a2(0x173)](_0x2c84a2(0x1b3),{'campaignId':_0x4d3d5c['id'],'campaignShippingId':_0x4b50b2['id'],'contactListItemId':_0x4ed5b8},{'removeOnComplete':!![],'delay':_0x246bf5});await _0x4b50b2[_0x2c84a2(0x1d9)]({'jobId':_0x353eaf['id']});}await this[_0x2c84a2(0x16f)](_0x4d3d5c);}catch(_0x21e35b){Sentry[_0x2c84a2(0x1e3)](_0x21e35b),logger_1['logger'][_0x2c84a2(0x1be)]('campaignQueue\x20->\x20PrepareContact\x20->\x20error:\x20'+_0x21e35b['message']);}}async['verifyAndFinalizeCampaign'](_0x1dd7ef){const _0x559b68=a572_0x52bc47;if(!_0x1dd7ef['contactList'])throw new sequelize_1[(_0x559b68(0x1c1))](_0x559b68(0x1f0));const {contacts:_0x2d00c6}=_0x1dd7ef[_0x559b68(0x1c7)],_0x18dd8f=_0x2d00c6[_0x559b68(0x1e4)],_0x55976a=await CampaignShipping_1['default']['count']({'where':{'campaignId':_0x1dd7ef['id'],'deliveredAt':{[sequelize_1['Op']['not']]:null}}});_0x18dd8f===_0x55976a&&await _0x1dd7ef[_0x559b68(0x1d9)]({'status':'FINALIZADA','completedAt':(0x0,moment_1['default'])()});const _0x16af92=(0x0,socket_1[_0x559b68(0x1f8)])();_0x16af92['to']('company-'+_0x1dd7ef[_0x559b68(0x1f1)]+_0x559b68(0x1a1))[_0x559b68(0x1c9)](_0x559b68(0x1c5)+_0x1dd7ef[_0x559b68(0x1f1)]+_0x559b68(0x1b1),{'action':_0x559b68(0x1d9),'record':_0x1dd7ef});}[a572_0x52bc47(0x1e6)](_0x29d832,_0x3ec8d2,_0x3db2af,_0x5e3fcc,_0xbf8d5f){const _0x5aebe6=a572_0x52bc47,_0x3fae27=(0x0,date_fns_1[_0x5aebe6(0x195)])(_0x3ec8d2,new Date());return _0x29d832>_0x3db2af?_0x3fae27*0x3e8+_0x5e3fcc:_0x3fae27*0x3e8+_0xbf8d5f;}[a572_0x52bc47(0x18a)](_0x45be70){const _0x40d249=a572_0x52bc47,_0x3322e3=[];return!(0x0,lodash_1[_0x40d249(0x17a)])(_0x45be70[_0x40d249(0x18f)])&&!(0x0,lodash_1[_0x40d249(0x1aa)])(_0x45be70['confirmationMessage1'])&&_0x3322e3[_0x40d249(0x1c3)](_0x45be70[_0x40d249(0x18f)]),!(0x0,lodash_1[_0x40d249(0x17a)])(_0x45be70['confirmationMessage2'])&&!(0x0,lodash_1[_0x40d249(0x1aa)])(_0x45be70[_0x40d249(0x1f7)])&&_0x3322e3['push'](_0x45be70[_0x40d249(0x1f7)]),!(0x0,lodash_1[_0x40d249(0x17a)])(_0x45be70[_0x40d249(0x16b)])&&!(0x0,lodash_1['isNil'])(_0x45be70[_0x40d249(0x16b)])&&_0x3322e3[_0x40d249(0x1c3)](_0x45be70[_0x40d249(0x16b)]),!(0x0,lodash_1[_0x40d249(0x17a)])(_0x45be70[_0x40d249(0x162)])&&!(0x0,lodash_1['isNil'])(_0x45be70[_0x40d249(0x162)])&&_0x3322e3[_0x40d249(0x1c3)](_0x45be70[_0x40d249(0x162)]),!(0x0,lodash_1[_0x40d249(0x17a)])(_0x45be70[_0x40d249(0x170)])&&!(0x0,lodash_1[_0x40d249(0x1aa)])(_0x45be70[_0x40d249(0x170)])&&_0x3322e3[_0x40d249(0x1c3)](_0x45be70[_0x40d249(0x170)]),_0x3322e3;}async[a572_0x52bc47(0x17c)](_0x2c6ac9){const _0x12a2dc=a572_0x52bc47;try{const {data:_0x598ff7}=_0x2c6ac9,{campaignShippingId:_0xc16e94,campaignId:_0x150f9c}=_0x598ff7,_0x3e7d39=await this['getCampaign'](_0x150f9c),_0x34de30=await(0x0,GetWhatsappWbot_1[_0x12a2dc(0x192)])(_0x3e7d39[_0x12a2dc(0x1a5)]);if(!_0x34de30){logger_1[_0x12a2dc(0x1c2)][_0x12a2dc(0x1be)](_0x12a2dc(0x1fb));return;}if(!_0x3e7d39['whatsapp']){logger_1[_0x12a2dc(0x1c2)][_0x12a2dc(0x1be)](_0x12a2dc(0x1ab));return;}if(!_0x34de30?.['user']?.['id']){logger_1[_0x12a2dc(0x1c2)]['error'](_0x12a2dc(0x1ff));return;}logger_1[_0x12a2dc(0x1c2)][_0x12a2dc(0x1fc)](_0x12a2dc(0x193)+_0x150f9c+';Registro='+_0xc16e94);const _0x43512a=await CampaignShipping_1[_0x12a2dc(0x192)]['findByPk'](_0xc16e94,{'include':[{'model':ContactListItem_1[_0x12a2dc(0x192)],'as':_0x12a2dc(0x16d)}]}),_0x6bd9aa=_0x43512a[_0x12a2dc(0x1dd)]+_0x12a2dc(0x1d1);let _0x26463a=_0x43512a[_0x12a2dc(0x1fa)][_0x12a2dc(0x1ad)]()[_0x12a2dc(0x1f9)]();_0x3e7d39['confirmation']&&_0x43512a[_0x12a2dc(0x17d)]===null&&(_0x26463a=_0x43512a['confirmationMessage']);await(0x0,SendPresenceStatus_1[_0x12a2dc(0x187)])(_0x34de30,_0x6bd9aa);if(!(0x0,lodash_1['isNil'])(_0x3e7d39['fileListId']))try{const _0x37b5ae=path_1['default'][_0x12a2dc(0x178)](__dirname,_0x12a2dc(0x188),_0x12a2dc(0x1b9),'company'+_0x3e7d39[_0x12a2dc(0x1f1)]),_0x3d541f=await(0x0,ShowService_1['default'])(_0x3e7d39[_0x12a2dc(0x1ba)],_0x3e7d39['companyId']),_0x331536=path_1[_0x12a2dc(0x192)]['resolve'](_0x37b5ae,_0x12a2dc(0x200),String(_0x3d541f['id']));for(const [_0x18cb59,_0x230add]of _0x3d541f[_0x12a2dc(0x1a4)]['entries']()){const _0x3da101=await(0x0,SendWhatsAppMedia_1[_0x12a2dc(0x1f4)])(_0x230add[_0x12a2dc(0x1ce)],path_1[_0x12a2dc(0x192)][_0x12a2dc(0x178)](_0x331536,_0x230add['path']),_0x230add[_0x12a2dc(0x1de)],_0x3e7d39[_0x12a2dc(0x1f1)]);await _0x34de30[_0x12a2dc(0x1a8)](_0x6bd9aa,{..._0x3da101});}}catch(_0x4c1503){logger_1[_0x12a2dc(0x1c2)]['info'](_0x4c1503);}if(_0x3e7d39[_0x12a2dc(0x1ed)]){const _0x585816=path_1[_0x12a2dc(0x192)][_0x12a2dc(0x178)](__dirname,_0x12a2dc(0x188),_0x12a2dc(0x1b9),_0x12a2dc(0x1e0)+_0x3e7d39[_0x12a2dc(0x1f1)]),_0x266cf4=path_1[_0x12a2dc(0x192)]['join'](_0x585816,_0x3e7d39[_0x12a2dc(0x1ed)]),_0x5ef674=await(0x0,SendWhatsAppMedia_1[_0x12a2dc(0x1f4)])(_0x3e7d39[_0x12a2dc(0x16e)],_0x266cf4,_0x26463a,_0x3e7d39[_0x12a2dc(0x1f1)]);Object[_0x12a2dc(0x1a9)](_0x5ef674)[_0x12a2dc(0x1e4)]&&await _0x34de30[_0x12a2dc(0x1a8)](_0x6bd9aa,{..._0x5ef674});}else _0x3e7d39[_0x12a2dc(0x17d)]&&_0x43512a[_0x12a2dc(0x17d)]===null?(await _0x34de30['sendMessage'](_0x6bd9aa,{'text':_0x26463a}),await _0x43512a[_0x12a2dc(0x1d9)]({'confirmationRequestedAt':(0x0,moment_1[_0x12a2dc(0x192)])()})):await _0x34de30[_0x12a2dc(0x1a8)](_0x6bd9aa,{'text':_0x26463a});await _0x43512a['update']({'deliveredAt':(0x0,moment_1[_0x12a2dc(0x192)])()}),await this[_0x12a2dc(0x16f)](_0x3e7d39);const _0x27e783=(0x0,socket_1['getIO'])();_0x27e783['to'](_0x12a2dc(0x1c5)+_0x3e7d39[_0x12a2dc(0x1f1)]+_0x12a2dc(0x1a1))['emit'](_0x12a2dc(0x1c5)+_0x3e7d39[_0x12a2dc(0x1f1)]+_0x12a2dc(0x1b1),{'action':'update','record':_0x3e7d39}),logger_1[_0x12a2dc(0x1c2)][_0x12a2dc(0x1fc)](_0x12a2dc(0x199)+_0x150f9c+_0x12a2dc(0x1b5)+_0x43512a['contact']['name']);}catch(_0x1c132b){Sentry[_0x12a2dc(0x1e3)](_0x1c132b),logger_1[_0x12a2dc(0x1c2)][_0x12a2dc(0x1be)](_0x1c132b[_0x12a2dc(0x1fa)]);}}[a572_0x52bc47(0x19b)](_0x5f086d){const _0xb2b7ce=a572_0x52bc47,_0x5a03c4=[];return!(0x0,lodash_1[_0xb2b7ce(0x17a)])(_0x5f086d[_0xb2b7ce(0x1a7)])&&!(0x0,lodash_1[_0xb2b7ce(0x1aa)])(_0x5f086d['message1'])&&_0x5a03c4[_0xb2b7ce(0x1c3)](_0x5f086d['message1']),!(0x0,lodash_1[_0xb2b7ce(0x17a)])(_0x5f086d['message2'])&&!(0x0,lodash_1[_0xb2b7ce(0x1aa)])(_0x5f086d['message2'])&&_0x5a03c4[_0xb2b7ce(0x1c3)](_0x5f086d[_0xb2b7ce(0x1b6)]),!(0x0,lodash_1[_0xb2b7ce(0x17a)])(_0x5f086d[_0xb2b7ce(0x18e)])&&!(0x0,lodash_1[_0xb2b7ce(0x1aa)])(_0x5f086d['message3'])&&_0x5a03c4[_0xb2b7ce(0x1c3)](_0x5f086d['message3']),!(0x0,lodash_1[_0xb2b7ce(0x17a)])(_0x5f086d[_0xb2b7ce(0x196)])&&!(0x0,lodash_1[_0xb2b7ce(0x1aa)])(_0x5f086d[_0xb2b7ce(0x196)])&&_0x5a03c4[_0xb2b7ce(0x1c3)](_0x5f086d[_0xb2b7ce(0x196)]),!(0x0,lodash_1['isEmpty'])(_0x5f086d[_0xb2b7ce(0x161)])&&!(0x0,lodash_1['isNil'])(_0x5f086d['message5'])&&_0x5a03c4[_0xb2b7ce(0x1c3)](_0x5f086d['message5']),_0x5a03c4;}[a572_0x52bc47(0x1dc)](_0x4c118a,_0x46f696,_0xcabed2){const _0x5daaba=a572_0x52bc47;let _0x354bf5=_0x4c118a;return _0x354bf5['includes']('{nome}')&&(_0x354bf5=_0x354bf5[_0x5daaba(0x1cc)](/{nome}/g,_0xcabed2[_0x5daaba(0x1de)])),_0x354bf5['includes'](_0x5daaba(0x19a))&&(_0x354bf5=_0x354bf5[_0x5daaba(0x1cc)](/{email}/g,_0xcabed2[_0x5daaba(0x1bf)])),_0x354bf5[_0x5daaba(0x172)](_0x5daaba(0x184))&&(_0x354bf5=_0x354bf5[_0x5daaba(0x1cc)](/{numero}/g,_0xcabed2['number'])),_0x46f696[_0x5daaba(0x168)](_0x437025=>{const _0x111abc=_0x5daaba;if(_0x354bf5['includes']('{'+_0x437025[_0x111abc(0x1d6)]+'}')){const _0x4f85ae=new RegExp('{'+_0x437025[_0x111abc(0x1d6)]+'}','g');_0x354bf5=_0x354bf5['replace'](_0x4f85ae,_0x437025[_0x111abc(0x183)]);}}),_0x354bf5;}async[a572_0x52bc47(0x1ea)](_0x17f444){const _0x65b4e6=a572_0x52bc47,_0x5d65fb=await CampaignSetting_1[_0x65b4e6(0x192)]['findAll']({'where':{'companyId':_0x17f444[_0x65b4e6(0x1f1)]},'attributes':[_0x65b4e6(0x1d6),_0x65b4e6(0x183)]});let _0x1aa125=0x14,_0x2d532c=0x14,_0x3e7f17=0x3c,_0xf85f3f=[];return _0x5d65fb[_0x65b4e6(0x168)](_0x7190b5=>{const _0x32320d=_0x65b4e6;_0x7190b5[_0x32320d(0x1d6)]==='messageInterval'&&(_0x1aa125=JSON[_0x32320d(0x1c8)](_0x7190b5[_0x32320d(0x183)])),_0x7190b5[_0x32320d(0x1d6)]==='longerIntervalAfter'&&(_0x2d532c=JSON[_0x32320d(0x1c8)](_0x7190b5[_0x32320d(0x183)])),_0x7190b5[_0x32320d(0x1d6)]===_0x32320d(0x1df)&&(_0x3e7f17=JSON[_0x32320d(0x1c8)](_0x7190b5[_0x32320d(0x183)])),_0x7190b5[_0x32320d(0x1d6)]===_0x32320d(0x167)&&(_0xf85f3f=JSON[_0x32320d(0x1c8)](_0x7190b5['value']));}),{'messageInterval':_0x1aa125,'longerIntervalAfter':_0x2d532c,'greaterInterval':_0x3e7f17,'variables':_0xf85f3f};}async[a572_0x52bc47(0x1f2)](_0x300495){const _0x5680af=a572_0x52bc47;try{const {id:_0x1644f2}=_0x300495[_0x5680af(0x17e)],_0x3134e8=await this[_0x5680af(0x1d7)](_0x1644f2),_0x3a3f25=await this['getSettings'](_0x3134e8);if(!_0x3134e8)throw new sequelize_1[(_0x5680af(0x1c1))]('Campaign\x20not\x20found');if(!_0x3134e8[_0x5680af(0x1c7)]||!_0x3134e8[_0x5680af(0x1c7)]['contacts'])throw new sequelize_1[(_0x5680af(0x1c1))](_0x5680af(0x160));if(_0x3134e8){const {contacts:_0x48d614}=_0x3134e8[_0x5680af(0x1c7)];if((0x0,lodash_1['isArray'])(_0x48d614)){const _0x3c0a0c=_0x48d614[_0x5680af(0x191)](_0x55ec75=>({'contactId':_0x55ec75['id'],'campaignId':_0x3134e8['id'],'variables':_0x3a3f25['variables']})),_0x49ed22=(0x0,queues_1[_0x5680af(0x1f3)])(_0x3a3f25[_0x5680af(0x18d)]),_0x49eff4=(0x0,queues_1[_0x5680af(0x1f3)])(_0x3a3f25[_0x5680af(0x1df)]),_0x45136b=_0x3a3f25[_0x5680af(0x1da)];let _0x17cfcb=_0x3134e8[_0x5680af(0x1a6)];const _0x27d822=[];for(let _0x14e452=0x0;_0x14e452<_0x3c0a0c[_0x5680af(0x1e4)];_0x14e452++){_0x17cfcb=(0x0,date_fns_1[_0x5680af(0x18b)])(_0x17cfcb,_0x14e452>_0x49ed22?_0x49eff4:_0x45136b);const {contactId:_0x19c407,campaignId:_0x49b1f2,variables:_0x5e1644}=_0x3c0a0c[_0x14e452],_0x1c6199=this[_0x5680af(0x1e6)](_0x14e452,_0x17cfcb,_0x49ed22,_0x49eff4,_0x45136b),_0x235e0e=queues_1[_0x5680af(0x175)][_0x5680af(0x173)](_0x5680af(0x171),{'contactId':_0x19c407,'campaignId':_0x49b1f2,'variables':_0x5e1644,'delay':_0x1c6199+(0x0,queues_1[_0x5680af(0x1bd)])(0x64,0x5dc)},{'removeOnComplete':!![]});_0x27d822['push'](_0x235e0e),logger_1[_0x5680af(0x1c2)][_0x5680af(0x1fc)](_0x5680af(0x1e1)+_0x3134e8['id']+_0x5680af(0x1b5)+_0x48d614[_0x14e452][_0x5680af(0x1de)]+';delay='+_0x1c6199);}await Promise[_0x5680af(0x1d2)](_0x27d822),await _0x3134e8['update']({'status':_0x5680af(0x19d)});}}}catch(_0x29d7bc){logger_1[_0x5680af(0x1c2)][_0x5680af(0x1be)](_0x29d7bc),Sentry['captureException'](_0x29d7bc);}}async[a572_0x52bc47(0x1d7)](_0x182435){const _0x3f511c=a572_0x52bc47,_0x211c48=await Campaign_1[_0x3f511c(0x192)][_0x3f511c(0x1b7)](_0x182435,{'include':[{'model':ContactList_1['default'],'as':_0x3f511c(0x1c7),'attributes':['id',_0x3f511c(0x1de)],'include':[{'model':ContactListItem_1[_0x3f511c(0x192)],'as':_0x3f511c(0x1b2),'attributes':['id',_0x3f511c(0x1de),'number',_0x3f511c(0x1bf),_0x3f511c(0x180)],'where':{'isWhatsappValid':!![]}}]},{'model':Whatsapp_1['default'],'as':_0x3f511c(0x1a5),'attributes':['id',_0x3f511c(0x1de)]},{'model':CampaignShipping_1[_0x3f511c(0x192)],'as':_0x3f511c(0x18c),'include':[{'model':ContactListItem_1['default'],'as':'contact'}]}]});if(!_0x211c48||!_0x211c48[_0x3f511c(0x1c7)])throw new sequelize_1[(_0x3f511c(0x1c1))]('Campaign\x20or\x20ContactList\x20not\x20found');return _0x211c48;}async[a572_0x52bc47(0x1a2)](_0x34c92d){const _0x39522f=a572_0x52bc47,_0x497587=new Date(new Date()[_0x39522f(0x185)]()+0x3c*0x3c*0x3e8);let _0x35ace3=await Campaign_1[_0x39522f(0x192)][_0x39522f(0x1d4)]({'where':{'scheduledAt':{[sequelize_1['Op'][_0x39522f(0x1cd)]]:+_0x497587},'status':'PROGRAMADA'},'attributes':['id',_0x39522f(0x1a6)]});if(_0x35ace3['length']>0x0)logger_1[_0x39522f(0x1c2)][_0x39522f(0x1fc)](_0x39522f(0x1b4)+_0x35ace3['length']);for(let _0x475762 of _0x35ace3){try{const _0x19b476=(0x0,moment_1['default'])(),_0x271e0c=(0x0,moment_1[_0x39522f(0x192)])(_0x475762[_0x39522f(0x1a6)]),_0x5095aa=_0x271e0c[_0x39522f(0x19e)](_0x19b476,'milliseconds');logger_1[_0x39522f(0x1c2)][_0x39522f(0x1fc)]('Campanha\x20enviada\x20para\x20a\x20fila\x20de\x20processamento:\x20Campanha='+_0x475762['id']+_0x39522f(0x197)+_0x5095aa);const _0x1fa726=await this[_0x39522f(0x1d7)](_0x475762['id']);if(!_0x1fa726['contactList']||!_0x1fa726[_0x39522f(0x1c7)][_0x39522f(0x1b2)])throw new sequelize_1[(_0x39522f(0x1c1))](_0x39522f(0x160));await queues_1[_0x39522f(0x175)][_0x39522f(0x173)]('ProcessCampaign',{'id':_0x475762['id'],'delay':_0x5095aa},{'delay':_0x5095aa,'removeOnComplete':!![]});}catch(_0xb095c5){return Sentry[_0x39522f(0x1e3)](_0xb095c5),Promise[_0x39522f(0x1cb)](new sequelize_1[(_0x39522f(0x1c1))](_0xb095c5));}}return Promise['resolve']({'count':_0x35ace3[_0x39522f(0x1e4)]});}}exports[a572_0x52bc47(0x192)]=CampaingJob;